<?xml version="1.0" encoding="utf-8"?>
<mdscript name="GT_GlobalSettings" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../ORIGINAL_MODS_DO NOT_MODIFY/X4Original/libraries/md.xsd">
  <cues>
    <cue name="Init" instantiate="true" version="3">
      <conditions>
        <check_any>
          <event_game_loaded/>
          <event_player_created/>
        </check_any>
      </conditions>
      <actions>
        <!-- CRITICAL: Only initialize settings if they don't exist (preserve saved settings) -->
        <do_if value="not global.$GT_GlobalSettings?">
          <!-- Initialize global GalaxyTrader MK3 settings -->
          <set_value name="global.$GT_GlobalSettings" exact="table[]"/>
          
          <!-- XP and Training Settings -->
          <set_value name="global.$GT_GlobalSettings.$XP" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$XP.$AutoTraining" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$XP.$XPMultiplier" exact="100"/> <!-- Percentage: 50-200% (100% = normal rate, balanced for ~500 trades) -->
          <set_value name="global.$GT_GlobalSettings.$XP.$MinTrainingDistance" exact="5"/> <!-- Max distance to training stations -->
          <set_value name="global.$GT_GlobalSettings.$XP.$TrainingCooldown" exact="600s"/> <!-- Cooldown between training sessions -->
          <set_value name="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent" exact="10"/> <!-- Percentage of subordinate XP awarded to commander (default: 10%) -->
          
          <!-- Fleet Coordination Settings -->
          <set_value name="global.$GT_GlobalSettings.$Fleet" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$Fleet.$EnableTradeCache" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold" exact="5"/> <!-- Percentage -->
          <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance" exact="15"/> <!-- Percentage -->
          <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheTTL" exact="300s"/> <!-- Time to live -->
          <set_value name="global.$GT_GlobalSettings.$Fleet.$MaxCachedRoutes" exact="50"/> <!-- Max cached routes -->
          <set_value name="global.$GT_GlobalSettings.$Fleet.$ZeroTradeCooldown" exact="30s"/> <!-- Cooldown after zero-trade live search (configurable, default: 30s) -->
          
          <!-- Notification Settings -->
          <set_value name="global.$GT_GlobalSettings.$Notifications" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$Notifications.$ShowXPGains" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$Notifications.$ShowTradeResults" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$Notifications.$ShowFleetStatus" exact="false"/>
          <set_value name="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency" exact="1"/> <!-- Minutes: 0-30 (0 = disabled, default: 1 minute) -->
          <set_value name="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency" exact="30"/> <!-- Minutes: 0-60 (0 = disabled, default: 30 minutes) -->

          <!-- Mobile Satellite Intelligence Settings -->
          <set_value name="global.$GT_GlobalSettings.$MobileIntel" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$MobileIntel.$Enable" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$MobileIntel.$SubscriptionDuration" exact="10min"/>
          <set_value name="global.$GT_GlobalSettings.$MobileIntel.$StationCooldown" exact="60s"/>
          
          <!-- Threat Avoidance Settings -->
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled" exact="false"/>
          <!-- Note: RiskTolerance removed - now configured per-ship in command behavior (0.0-1.0 scale) -->
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$ScanInterval" exact="5s"/>
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$ThreatExpiry" exact="600s"/> <!-- 10 minutes -->
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$HostileRelationThreshold" exact="-0.20"/> <!-- Only flag factions with relation <= this value (default: -0.20 = -20%) -->
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist" exact="false"/> <!-- Automatically blacklist dangerous sectors -->
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions" exact="true"/> <!-- Automatically block all sectors owned by enemy factions -->
          <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$BlacklistThreshold" exact="3"/> <!-- Threat level (1-5) required for blacklisting -->
          
          <!-- Debug Settings -->
          <set_value name="global.$GT_GlobalSettings.$Debug" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$Debug.$EnableDebugLogging" exact="false"/> <!-- Master toggle for debug_text output -->
          <set_value name="global.$GT_GlobalSettings.$Debug.$DebugLevel" exact="1"/> <!-- 0=None, 1=Basic, 2=Verbose -->
          <set_value name="global.$GT_GlobalSettings.$Debug.$TradeEvaluation" exact="false"/>
          
          <!-- Ship Naming Settings -->
          <set_value name="global.$GT_GlobalSettings.$ShipNaming" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$Enabled" exact="false"/> <!-- Master toggle - default OFF -->
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayXP" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$XPPosition" exact="'suffix'"/> <!-- 'prefix' or 'suffix' -->
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayRank" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$RankPosition" exact="'suffix'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$LevelPosition" exact="'suffix'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StatusPosition" exact="'prefix'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayOperationalState" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$OperationalStatePosition" exact="'prefix'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass" exact="false"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$ShipClassPosition" exact="'suffix'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource" exact="'macro.name'"/> <!-- 'macro.name', 'typename', 'macro.name.base', 'basename' -->
          
          <!-- Ship State Abbreviations (customizable) -->
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Resupply" exact="'RS'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Repair" exact="'RP'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Maintenance" exact="'MT'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Training" exact="'TR'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Escape" exact="'ES'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Reroute" exact="'RR'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Clearance" exact="'CL'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Blocked" exact="'BL'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Fallback" exact="'FB'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Isolated" exact="'IS'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Trading" exact="'TD'"/>
          <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Idle" exact="'ID'"/>
          
          <!-- Auto-Repair Settings -->
          <set_value name="global.$GT_GlobalSettings.$AutoRepair" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$AutoRepair.$Enabled" exact="true"/> <!-- Enable/disable auto-repair system -->
          <set_value name="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold" exact="95"/> <!-- Hull percentage threshold (1-99) -->
          <set_value name="global.$GT_GlobalSettings.$AutoRepair.$MinPilotLevel" exact="12"/> <!-- Minimum pilot level required -->
          
          <!-- Ship Modifications Settings -->
          <set_value name="global.$GT_GlobalSettings.$Modifications" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$Modifications.$Enabled" exact="false"/> <!-- Enable/disable automatic modification installation -->
          
          <!-- Performance Settings -->
          <set_value name="global.$GT_GlobalSettings.$Performance" exact="table[]"/>
          <!-- Smoothness > speed: increase delays to distribute load across frames -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay" exact="25"/> <!-- Delay in milliseconds (1-200) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$ValidationDelay" exact="50"/> <!-- Delay in milliseconds (1-100) -->
          <!-- Separate concurrency for cache (cheap) vs live (expensive) searches -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches" exact="2"/> <!-- Maximum cache work items started per scheduler tick (1-20). Smoothness > speed. -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches" exact="1"/> <!-- Maximum concurrent live searches (1-10) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches" exact="1"/> <!-- Maximum concurrent fallback live searches (1-10). Fallback searches bypass home-sector lock. -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn" exact="20"/> <!-- Maximum trades to return from cache search (1-100) -->
          <!-- CacheQuery chunking (frame pacing) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryChunkSize" exact="10"/> <!-- Cache entries validated per chunk (10-200). Smaller = smoother. -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare" exact="200"/> <!-- Maximum offers per ware in live search (50-1000) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare" exact="20"/> <!-- Maximum trades per ware during batch processing (5-100) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching" exact="20"/> <!-- Maximum offers per ware for matching in batch processor (5-100) - Processed in chunks to reduce CPU load -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold" exact="2000"/> <!-- Early exit threshold for batch processing (100-10000) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$SearchLockTTL" exact="600"/> <!-- Search lock time-to-live in seconds (60-7200). Self-heals stale locks from old saves. -->
          <!-- Smoothness > speed: higher interval means less frequent heavy offer-slice work per second -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval" exact="100"/> <!-- Live offer slice interval in milliseconds (5-2000) - controls how often live offer slices can start -->
          <!-- Smoothness > speed: cap how many offers are appended from a native query per frame-slice -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize" exact="200"/> <!-- Offers appended per append-slice (50-2000) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$BatchChunkSize" exact="5"/> <!-- Batch processing chunk size (5-20) - smaller = smoother (e.g., 5Ã—5 = 25 combinations) -->
          <!-- B5. BACKPRESSURE: Batch processor backlog thresholds -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold" exact="10"/> <!-- Soft threshold - start applying backpressure (5-50) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold" exact="25"/> <!-- Hard threshold - always block new live searches (10-100) -->
          <!-- NEW: Additional performance tuning parameters -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice" exact="2"/> <!-- Sectors processed per slice in live offer collection (1-5). Smaller = smoother. -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown" exact="30"/> <!-- Cooldown after home-sector refresh completes (10-120 seconds) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase" exact="10"/> <!-- Base cooldown after cache miss before retrying live search (1-30 seconds) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval" exact="100"/> <!-- Interval between scheduler ticks in milliseconds (50-500) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay" exact="10"/> <!-- Delay before sending GT_Trade_Found signal in milliseconds (0-1000). 0 = immediate (recommended for reliability). Higher = smoother but may cause race conditions. -->
          <!-- Per-tick processing limits -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick" exact="1"/> <!-- Maximum cache queries started per tick (1-5) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick" exact="1"/> <!-- Maximum search continuations started per tick (1-5) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick" exact="1"/> <!-- Maximum ships processed per scheduler tick (1-5) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick" exact="1"/> <!-- Maximum work items processed per tick (1-5) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick" exact="2"/> <!-- Maximum waiters woken per tick (1-10) -->
          <!-- Cache query settings -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries" exact="5"/> <!-- Maximum cache entries queried per batch (1-100) -->
          <!-- Stale threshold settings -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds" exact="300"/> <!-- Live search state stale threshold in seconds (60-600) -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds" exact="60"/> <!-- Queue item stale threshold in seconds (30-300) -->
          <!-- Failed trade cache expiration -->
          <set_value name="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds" exact="1800"/> <!-- Failed trade cache expiration in seconds (300-3600) -->
          
          <!-- Number Formatting Settings -->
          <set_value name="global.$GT_GlobalSettings.$NumberFormat" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$NumberFormat.$Format" exact="'german'"/> <!-- 'german' for '.' thousands and ',' decimals (123.456,78), 'english' for ',' thousands and '.' decimals (123,456.78) -->
          <set_value name="global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix" exact="true"/> <!-- Add 'M' suffix for numbers > 999,999 -->
          <set_value name="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold" exact="999999"/> <!-- Threshold for M suffix (default: 999,999) -->
          
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GalaxyTrader MK3] Global settings initialized with defaults'" chance="100"/>
          </do_if>
        </do_if>
        <do_else>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GalaxyTrader MK3] Global settings loaded from save'" chance="100"/>
          </do_if>
        </do_else>
        
        <!-- Migrate StateHistory for existing ships from old save games -->
        <!-- StateHistory might be null if ship states were created before StateHistory was added -->
        <do_if value="global.$GT_Ship_State?">
          <set_value name="$shipKeys" exact="global.$GT_Ship_State.keys.list"/>
          <set_value name="$migratedCount" exact="0"/>
          <do_all exact="$shipKeys.count" counter="$i">
            <set_value name="$ship" exact="$shipKeys.{$i}"/>
            <set_value name="$state" exact="global.$GT_Ship_State.{$ship}"/>
            <do_if value="not $state.$StateHistory? or $state.$StateHistory == null">
              <set_value name="$state.$StateHistory" exact="[]"/>
              <set_value name="$migratedCount" exact="$migratedCount + 1"/>
            </do_if>
          </do_all>
          <do_if value="$migratedCount gt 0">
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Migrated StateHistory for ' + $migratedCount + ' existing ships'" chance="100"/>
            </do_if>
          </do_if>
        </do_if>
        
        <!-- Text Colors for UI -->
        <set_value name="$TextGreen" exact="'Color.text_success'"/>
        <set_value name="$TextRed" exact="'Color.text_failure'"/>
      </actions>
      
      <cues>
        <!-- Settings Validation and Restoration -->
        <cue name="ValidateSettings" instantiate="true" version="2">
          <conditions>
            <check_any>
              <event_universe_generated/>
              <event_game_loaded/>
              <event_cue_signalled/>
            </check_any>
          </conditions>
          <actions>
            <set_value name="$MissingVarCount" exact="0"/>
            
            <!-- Validate and restore missing settings -->
            <do_if value="not global.$GT_GlobalSettings?">
              <set_value name="global.$GT_GlobalSettings" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- XP Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$XP?">
              <set_value name="global.$GT_GlobalSettings.$XP" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$XP.$AutoTraining?">
              <set_value name="global.$GT_GlobalSettings.$XP.$AutoTraining" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$XP.$XPMultiplier?">
              <set_value name="global.$GT_GlobalSettings.$XP.$XPMultiplier" exact="100"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$XP.$CommanderBonusPercent?">
              <set_value name="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent" exact="10"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Fleet Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$Fleet?">
              <set_value name="global.$GT_GlobalSettings.$Fleet" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination?">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Fleet.$EnableTradeCache?">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$EnableTradeCache" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold?">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold" exact="5"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance?">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance" exact="10"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Fleet.$CacheTTL?">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheTTL" exact="300"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Fleet.$MaxCachedRoutes?">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$MaxCachedRoutes" exact="500"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Initialize global trade cache system ALWAYS (early initialization to prevent race conditions) -->
            <!-- Even if global fleet coordination is disabled, individual ships may still use cache -->
            <!-- Switch to per-home-sector cache structure -->
            <!-- v5: Per-home-sector table structure - each home sector has its own cache list with pre-computed distances -->
            <do_if value="not global.$GT_TradeCacheVersion? or global.$GT_TradeCacheVersion lt 5">
              <!-- Migrate old cache structure if exists -->
              <do_if value="global.$GT_TradeCache?">
                <!-- Old cache exists - clear it (will be repopulated with new structure) -->
                <remove_value name="global.$GT_TradeCache"/>
                <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                  <debug_text text="'[GalaxyTrader MK3] Migrating trade cache from v4 (flat list) to v5 (per-home-sector table)'" chance="100"/>
                </do_if>
              </do_if>
              <!-- Create cache as table indexed by home sector - each home sector has its own list -->
              <set_value name="global.$GT_TradeCache" exact="table[]"/>
              <set_value name="global.$GT_TradeCacheVersion" exact="5"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Trade cache initialized as per-home-sector table (v5 - pre-computed distances)'" chance="100"/>
              </do_if>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- GT_TradeCacheIndex removed - no longer needed (cache is already indexed by home sector) -->
            <!-- Old index structure was for flat list - new structure is table indexed by home sector -->
            <!-- Ensure cleanup timestamp always exists -->
            <do_if value="not global.$GT_TradeCacheLastCleanup?">
              <set_value name="global.$GT_TradeCacheLastCleanup" exact="player.age"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Notification Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$Notifications?">
              <set_value name="global.$GT_GlobalSettings.$Notifications" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Remove old notification level setting if it exists (no longer used) -->
            <do_if value="global.$GT_GlobalSettings.$Notifications.$Level?">
              <remove_value name="global.$GT_GlobalSettings.$Notifications.$Level"/>
            </do_if>
            
            <!-- Validate report frequency settings -->
            <do_if value="not global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency?">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency lt 0 or global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency gt 30">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency" exact="1"/>
            </do_if>
            
            <do_if value="not global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency?">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency" exact="30"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency lt 0 or global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency gt 60">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency" exact="30"/>
            </do_if>
            
            <!-- Debug Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$Debug?">
              <set_value name="global.$GT_GlobalSettings.$Debug" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Mobile Intel Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$MobileIntel?">
              <set_value name="global.$GT_GlobalSettings.$MobileIntel" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$MobileIntel.$Enable?">
              <set_value name="global.$GT_GlobalSettings.$MobileIntel.$Enable" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$MobileIntel.$SubscriptionDuration?">
              <set_value name="global.$GT_GlobalSettings.$MobileIntel.$SubscriptionDuration" exact="10min"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$MobileIntel.$StationCooldown?">
              <set_value name="global.$GT_GlobalSettings.$MobileIntel.$StationCooldown" exact="60s"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Threat Avoidance Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled" exact="false"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Note: RiskTolerance validation removed - now per-ship parameter -->
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$ScanInterval?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$ScanInterval" exact="5s"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$ThreatExpiry?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$ThreatExpiry" exact="600s"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$HostileRelationThreshold?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$HostileRelationThreshold" exact="-0.20"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist" exact="false"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$BlacklistThreshold?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$BlacklistThreshold" exact="3"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions?">
              <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <do_if value="not global.$GT_GlobalSettings.$Debug.$EnableDebugLogging?">
              <set_value name="global.$GT_GlobalSettings.$Debug.$EnableDebugLogging" exact="false"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <do_if value="not global.$GT_GlobalSettings.$Debug.$DebugLevel?">
              <set_value name="global.$GT_GlobalSettings.$Debug.$DebugLevel" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Ship Naming Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$Enabled?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$Enabled" exact="false"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$DisplayXP?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayXP" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$XPPosition?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$XPPosition" exact="'suffix'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$DisplayRank?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayRank" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$RankPosition?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$RankPosition" exact="'suffix'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$LevelPosition?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$LevelPosition" exact="'suffix'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$StatusPosition?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StatusPosition" exact="'prefix'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource" exact="'macro.name'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass" exact="false"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$ShipClassPosition?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$ShipClassPosition" exact="'suffix'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Auto-Repair Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$AutoRepair?">
              <set_value name="global.$GT_GlobalSettings.$AutoRepair" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$AutoRepair.$Enabled?">
              <set_value name="global.$GT_GlobalSettings.$AutoRepair.$Enabled" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$AutoRepair.$HullThreshold?">
              <set_value name="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold" exact="95"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$AutoRepair.$MinPilotLevel?">
              <set_value name="global.$GT_GlobalSettings.$AutoRepair.$MinPilotLevel" exact="12"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Ship Modifications Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$Modifications?">
              <set_value name="global.$GT_GlobalSettings.$Modifications" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Modifications.$Enabled?">
              <set_value name="global.$GT_GlobalSettings.$Modifications.$Enabled" exact="false"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <!-- Performance Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$Performance?">
              <set_value name="global.$GT_GlobalSettings.$Performance" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay" exact="25"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Separate cache/live concurrency settings -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches" exact="2"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Migration: Remove deprecated MaxConcurrentSearches if it exists -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentSearches?">
              <remove_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentSearches"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn" exact="20"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare" exact="200"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare" exact="20"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching" exact="20"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- EarlyExitThreshold: default -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold" exact="2000"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Migration: if save still has an old default, treat as non-customized and update to new default -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold? and (global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold == 1000 or global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold == 800)">
              <set_value name="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold" exact="2000"/>
            </do_if>
            <!-- Validate range (1-500ms) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay" exact="25"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay gt 500">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay" exact="25"/>
            </do_if>
            <!-- Validate MaxConcurrentCacheSearches range (1-20) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches" exact="2"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches gt 20">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches" exact="2"/>
            </do_if>
            <!-- Validate MaxConcurrentLiveSearches range (1-10) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches gt 10">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches" exact="1"/>
            </do_if>
            <!-- Validate MaxConcurrentFallbackSearches range (1-10) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches gt 10">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches" exact="1"/>
            </do_if>
            <!-- Validate MaxTradesToReturn range (1-100) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn" exact="20"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn gt 100">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn" exact="20"/>
            </do_if>
            <!-- Validate MaxOffersPerWare range (50-1000) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare lt 50">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare" exact="200"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare gt 1000">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare" exact="200"/>
            </do_if>
            <!-- Validate MaxTradesPerWare range (5-100) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare lt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare" exact="20"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare gt 100">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare" exact="20"/>
            </do_if>
            <!-- Validate MaxOffersPerWareForMatching range (5-100) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching lt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching" exact="20"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching gt 100">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching" exact="20"/>
            </do_if>
            <!-- Validate EarlyExitThreshold range (100-10000) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold lt 100">
              <set_value name="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold" exact="2000"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold gt 10000">
              <set_value name="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold" exact="2000"/>
            </do_if>

            <!-- SearchLockTTL: default + validate range (60-7200 seconds) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$SearchLockTTL?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SearchLockTTL" exact="600"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- SearchLockTTL: validate range (60-7200 seconds) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$SearchLockTTL lt 60">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SearchLockTTL" exact="600"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$SearchLockTTL gt 7200">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SearchLockTTL" exact="600"/>
            </do_if>
            <!-- LiveOfferSliceInterval: default -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval" exact="100"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Validate LiveOfferSliceInterval range (5-2000ms) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval lt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval" exact="5"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval gt 2000">
              <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval" exact="100"/>
            </do_if>

            <!-- LiveOfferAppendChunkSize: default + validate range (50-2000) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize" exact="200"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize lt 50">
              <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize" exact="200"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize gt 2000">
              <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize" exact="200"/>
            </do_if>
            <!-- BatchChunkSize: default -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$BatchChunkSize?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchChunkSize" exact="5"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Validate BatchChunkSize range (5-20) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchChunkSize lt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchChunkSize" exact="5"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchChunkSize gt 20">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchChunkSize" exact="5"/>
            </do_if>
            <!-- B5. BACKPRESSURE: Batch processor backlog thresholds -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold" exact="10"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold" exact="25"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Validate thresholds range -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold lt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold" exact="10"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold gt 50">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold" exact="10"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold lt 10">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold" exact="25"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold gt 100">
              <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold" exact="25"/>
            </do_if>
            
            <!-- NEW: Additional performance tuning parameters -->
            <!-- SectorsPerSlice: default + validate range (1-5) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$SectorsPerSlice?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice" exact="2"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice" exact="2"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice gt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice" exact="2"/>
            </do_if>
            <!-- HomeRefreshCooldown: default + validate range (10-120 seconds) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown" exact="30"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown lt 10">
              <set_value name="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown" exact="30"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown gt 120">
              <set_value name="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown" exact="30"/>
            </do_if>
            <!-- CacheMissCooldownBase: default + validate range (1-30 seconds) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase" exact="10"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase" exact="10"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase gt 30">
              <set_value name="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase" exact="10"/>
            </do_if>
            <!-- SchedulerTickInterval: default + validate range (50-500 milliseconds) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval" exact="100"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval lt 50">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval" exact="100"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval gt 500">
              <set_value name="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval" exact="100"/>
            </do_if>
            <!-- TradeFoundSignalDelay: default + validate range (0-1000 milliseconds) -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay" exact="10"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay lt 0">
              <set_value name="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay" exact="10"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay gt 1000">
              <set_value name="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay" exact="10"/>
            </do_if>
            
            <!-- Per-tick processing limits: defaults + validation -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick" exact="1"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$MaxWakePerTick?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick" exact="2"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Validate per-tick limits (1-5 for most, 1-10 for MaxWakePerTick) -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick gt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick gt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick gt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick gt 5">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick" exact="2"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick gt 10">
              <set_value name="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick" exact="2"/>
            </do_if>
            
            <!-- Cache query settings: default + validation -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries" exact="5"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries lt 1">
              <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries" exact="5"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries gt 100">
              <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries" exact="5"/>
            </do_if>
            
            <!-- Stale threshold settings: defaults + validation -->
            <do_if value="not global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds" exact="300"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds" exact="60"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds?">
              <set_value name="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds" exact="1800"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Validate stale thresholds -->
            <do_if value="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds lt 60">
              <set_value name="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds" exact="300"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds gt 600">
              <set_value name="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds" exact="300"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds lt 30">
              <set_value name="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds" exact="60"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds gt 300">
              <set_value name="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds" exact="60"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds lt 300">
              <set_value name="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds" exact="1800"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds gt 3600">
              <set_value name="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds" exact="1800"/>
            </do_if>
            
            <!-- Number Format Settings Validation -->
            <do_if value="not global.$GT_GlobalSettings.$NumberFormat?">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$NumberFormat.$Format?">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat.$Format" exact="'german'"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix?">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold?">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold" exact="999999"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Validate format value (must be 'german' or 'english') -->
            <do_if value="global.$GT_GlobalSettings.$NumberFormat.$Format != 'german' and global.$GT_GlobalSettings.$NumberFormat.$Format != 'english'">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat.$Format" exact="'german'"/>
            </do_if>
            <!-- Validate MSuffixThreshold range (1000-999999999) -->
            <do_if value="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold lt 1000">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold" exact="999999"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold gt 999999999">
              <set_value name="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold" exact="999999"/>
            </do_if>
            
            <!-- CRITICAL: Validate BOTH config tables exist -->
            <do_if value="not global.$GT_Config.$Defense?">
              <set_value name="global.$GT_Config.$Defense" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_Config.$Defense.$Enabled?">
              <set_value name="global.$GT_Config.$Defense.$Enabled" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment" exact="table[]"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$Enabled?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$Enabled" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold" exact="50"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold" exact="70"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile" exact="2"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <!-- Individual equipment type toggles -->
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$RestockCountermeasures?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockCountermeasures" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$RestockDefenseDrones?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockDefenseDrones" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$RestockTradeDrones?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockTradeDrones" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$RestockLaserTowers?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockLaserTowers" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment.$RestockRepairDrones?">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockRepairDrones" exact="true"/>
              <set_value name="$MissingVarCount" exact="1" operation="add"/>
            </do_if>
            
            <do_if value="$MissingVarCount gt 0">
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Restored ' + $MissingVarCount + ' missing global settings'" chance="100"/>
              </do_if>
            </do_if>
          </actions>
        </cue>
        
      </cues>
    </cue>
    
    <!-- Simple Menu API Integration -->
    <!-- Follow Simple_Menu_API documentation pattern: instantiate="true", ONLY listen to Reloaded -->
    <!-- Renamed from RegisterOptionsMenu to GT_MenuRegistration to avoid "Cannot change parent cue" with existing saves -->
    <cue name="GT_MenuRegistration" instantiate="true">
      <conditions>
        <event_cue_signalled cue="md.Simple_Menu_API.Reloaded"/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GalaxyTrader MK3] GT_MenuRegistration cue fired!'" chance="100"/>
        </do_if>
        
        <!-- Ensure all settings are initialized before registering menu -->
        <do_if value="not global.$GT_GlobalSettings?">
          <set_value name="global.$GT_GlobalSettings" exact="table[]"/>
        </do_if>
        <do_if value="not global.$GT_GlobalSettings.$DefensiveEquipment?">
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment" exact="table[]"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$Enabled" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold" exact="50"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold" exact="70"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile" exact="2"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockCountermeasures" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockDefenseDrones" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockTradeDrones" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockLaserTowers" exact="true"/>
          <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$RestockRepairDrones" exact="true"/>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GalaxyTrader MK3] Initialized missing DefensiveEquipment settings'" chance="100"/>
          </do_if>
        </do_if>
        
        <!-- Pre-load title text -->
        <set_value name="$menuTitle" exact="{77000,9000}"/>
        
        <!-- Register GalaxyTrader MK3 options menu -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu" param="table[
          $id = 'gt_global_settings_menu',
          $columns = 8,
          $title = $menuTitle, 
          $onOpen = GT_SettingsMenu,
          $defaultFocus = false
        ]"/>
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GalaxyTrader MK3] Global settings menu registered with Simple Menu API'" chance="100"/>
        </do_if>
      </actions>
    </cue>
        
    <!-- Global Settings Menu Builder -->
    <cue name="GT_SettingsMenu" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Define color variables for UI -->
            <set_value name="$TextGreen" exact="'Color.text_success'"/>
            <set_value name="$TextRed" exact="'Color.text_failure'"/>
            
            <!-- XP and Training Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9010},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
                      $text = {77000,9012},
        $mouseOverText = {77000,9112}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$XP.$AutoTraining then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$XP.$AutoTraining then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$XP', '$AutoTraining', global.$GT_GlobalSettings.$XP.$AutoTraining]
            ]"/>
            
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
                      $text = {77000,9013},
        $mouseOverText = {77000,9113}
            ]"/>
            <!-- Validate slider value is within range (50-200%) -->
            <do_if value="global.$GT_GlobalSettings.$XP.$XPMultiplier lt 50">
              <set_value name="global.$GT_GlobalSettings.$XP.$XPMultiplier" exact="100"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$XP.$XPMultiplier gt 200">
              <set_value name="global.$GT_GlobalSettings.$XP.$XPMultiplier" exact="100"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 50,
              $max = 200,
              $start = global.$GT_GlobalSettings.$XP.$XPMultiplier,
              $step = 10,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$XP', $setting = '$XPMultiplier']
            ]"/>
            
            <!-- Commander Bonus Percent -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9015},
              $mouseOverText = {77000,9115}
            ]"/>
            <!-- Validate slider value is within range (0-50%) -->
            <do_if value="not global.$GT_GlobalSettings.$XP.$CommanderBonusPercent?">
              <set_value name="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent" exact="10"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent lt 0">
              <set_value name="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent" exact="0"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent gt 50">
              <set_value name="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent" exact="50"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 0,
              $max = 50,
              $start = global.$GT_GlobalSettings.$XP.$CommanderBonusPercent,
              $step = 1,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$XP', $setting = '$CommanderBonusPercent']
            ]"/>
            
            <!-- Trading Price Range Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9004},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Profit Threshold Base (affects MinAbsoluteProfit calculation) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9016},
              $mouseOverText = {77000,9116}
            ]"/>
            <!-- Validate base profit (0-500 Cr) stored in RAW centicredits -->
            <set_value name="$profitBaseRaw" exact="10000"/> <!-- Default: 100 Cr -->
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$MinAbsoluteProfit?">
              <set_value name="$profitBaseRaw" exact="@global.$GT_Config.$Trading.$MinAbsoluteProfit"/>
            </do_if>
            <do_if value="not $profitBaseRaw? or $profitBaseRaw == null or $profitBaseRaw lt 0 or $profitBaseRaw gt 50000">
              <set_value name="$profitBaseRaw" exact="10000"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GT-Settings] WARNING: Invalid Trading.MinAbsoluteProfit base, reset to 100Cr (10000 RAW)'" chance="100"/>
              </do_if>
              <do_if value="not global.$GT_Config?">
                <set_value name="global.$GT_Config" exact="table[]"/>
              </do_if>
              <do_if value="not global.$GT_Config.$Trading?">
                <set_value name="global.$GT_Config.$Trading" exact="table[]"/>
              </do_if>
              <set_value name="global.$GT_Config.$Trading.$MinAbsoluteProfit" exact="$profitBaseRaw"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 0,
              $max = 500,
              $start = ($profitBaseRaw / 100),
              $step = 10,
              $suffix = ' Cr',
              $onSliderCellChanged = GT_MinProfitBase_Update,
              $echo = table[$section = '$Trading', $setting = '$MinAbsoluteProfit', $isConfig = true]
            ]"/>

            <!-- Sell Price Max (Normal Trading) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9005},
              $mouseOverText = {77000,9104}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$sellPriceMax" exact="1.0"/>
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$SellPriceMax?">
              <set_value name="$sellPriceMax" exact="@global.$GT_Config.$Trading.$SellPriceMax"/>
            </do_if>
            <do_if value="$sellPriceMax lt -1.0 or $sellPriceMax gt 1.0">
              <set_value name="$sellPriceMax" exact="1.0"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 100,
              $start = ($sellPriceMax * 100),
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_PriceRange_Update,
              $echo = table[$section = '$Trading', $setting = '$SellPriceMax', $isConfig = true]
            ]"/>
            
            <!-- Buy Price Min (Normal Trading) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9006},
              $mouseOverText = {77000,9105}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$buyPriceMin" exact="-1.0"/>
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$BuyPriceMin?">
              <set_value name="$buyPriceMin" exact="@global.$GT_Config.$Trading.$BuyPriceMin"/>
            </do_if>
            <do_if value="$buyPriceMin lt -1.0 or $buyPriceMin gt 1.0">
              <set_value name="$buyPriceMin" exact="-1.0"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 100,
              $start = ($buyPriceMin * 100),
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_PriceRange_Update,
              $echo = table[$section = '$Trading', $setting = '$BuyPriceMin', $isConfig = true]
            ]"/>
            
            <!-- Isolated Sell Price Max -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9007},
              $mouseOverText = {77000,9106}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$isolatedSellPriceMax" exact="1.0"/>
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$IsolatedSellPriceMax?">
              <set_value name="$isolatedSellPriceMax" exact="@global.$GT_Config.$Trading.$IsolatedSellPriceMax"/>
            </do_if>
            <do_if value="$isolatedSellPriceMax lt -1.0 or $isolatedSellPriceMax gt 1.0">
              <set_value name="$isolatedSellPriceMax" exact="1.0"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 100,
              $start = ($isolatedSellPriceMax * 100),
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_PriceRange_Update,
              $echo = table[$section = '$Trading', $setting = '$IsolatedSellPriceMax', $isConfig = true]
            ]"/>
            
            <!-- Isolated Buy Price Min -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9008},
              $mouseOverText = {77000,9107}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$isolatedBuyPriceMin" exact="-1.0"/>
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$IsolatedBuyPriceMin?">
              <set_value name="$isolatedBuyPriceMin" exact="@global.$GT_Config.$Trading.$IsolatedBuyPriceMin"/>
            </do_if>
            <do_if value="$isolatedBuyPriceMin lt -1.0 or $isolatedBuyPriceMin gt 1.0">
              <set_value name="$isolatedBuyPriceMin" exact="-1.0"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 100,
              $start = ($isolatedBuyPriceMin * 100),
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_PriceRange_Update,
              $echo = table[$section = '$Trading', $setting = '$IsolatedBuyPriceMin', $isConfig = true]
            ]"/>
            
            <!-- Fallback Sell Price Max -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9009},
              $mouseOverText = {77000,9108}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$fallbackSellPriceMax" exact="1.0"/>
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$FallbackSellPriceMax?">
              <set_value name="$fallbackSellPriceMax" exact="@global.$GT_Config.$Trading.$FallbackSellPriceMax"/>
            </do_if>
            <do_if value="$fallbackSellPriceMax lt -1.0 or $fallbackSellPriceMax gt 1.0">
              <set_value name="$fallbackSellPriceMax" exact="1.0"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 100,
              $start = ($fallbackSellPriceMax * 100),
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_PriceRange_Update,
              $echo = table[$section = '$Trading', $setting = '$FallbackSellPriceMax', $isConfig = true]
            ]"/>
            
            <!-- Fallback Buy Price Min -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9014},
              $mouseOverText = {77000,9109}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$fallbackBuyPriceMin" exact="-1.0"/>
            <do_if value="global.$GT_Config? and global.$GT_Config.$Trading? and global.$GT_Config.$Trading.$FallbackBuyPriceMin?">
              <set_value name="$fallbackBuyPriceMin" exact="@global.$GT_Config.$Trading.$FallbackBuyPriceMin"/>
            </do_if>
            <do_if value="$fallbackBuyPriceMin lt -1.0 or $fallbackBuyPriceMin gt 1.0">
              <set_value name="$fallbackBuyPriceMin" exact="-1.0"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 100,
              $start = ($fallbackBuyPriceMin * 100),
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_PriceRange_Update,
              $echo = table[$section = '$Trading', $setting = '$FallbackBuyPriceMin', $isConfig = true]
            ]"/>
            
            <!-- Fleet Coordination Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9020},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
                      $text = {77000,9021},
        $mouseOverText = {77000,9121}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$Fleet', '$EnableFleetCoordination', global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination]
            ]"/>
            
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
                      $text = {77000,9022},
        $mouseOverText = {77000,9122}
            ]"/>
            <!-- Validate slider value is within range before creating slider -->
            <do_if value="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold lt 1">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold" exact="5"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold gt 30">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold" exact="5"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 30,
              $start = global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold,
              $step = 1,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Fleet', $setting = '$CacheProfitThreshold']
            ]"/>
            
            <!-- Cache Dropoff Tolerance -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9024},
              $mouseOverText = {77000,9124}
            ]"/>
            <!-- Validate slider value is within range -->
            <do_if value="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance lt 0">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance" exact="15"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance gt 50">
              <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance" exact="15"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 0,
              $max = 50,
              $start = global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance,
              $step = 1,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Fleet', $setting = '$CacheDropoffTolerance']
            ]"/>
            
            <!-- Threat Avoidance Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9050},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Enable Threat Avoidance -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9051},
              $mouseOverText = {77000,9151}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ThreatAvoidance', '$Enabled', global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled]
            ]"/>
            
            <!-- Hostile Relation Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9052},
              $mouseOverText = {77000,9152}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$tempThreshold" exact="(global.$GT_GlobalSettings.$ThreatAvoidance.$HostileRelationThreshold * 100)"/>
            <do_if value="$tempThreshold lt -100">
              <set_value name="$tempThreshold" exact="-30"/>
            </do_if>
            <do_if value="$tempThreshold gt 0">
              <set_value name="$tempThreshold" exact="-30"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = -100,
              $max = 0,
              $start = $tempThreshold,
              $step = 1,
              $suffix = '%',
              $onSliderCellChanged = GT_Relation_Update,
              $echo = table[$section = '$ThreatAvoidance', $setting = '$HostileRelationThreshold']
            ]"/>
            
            <!-- Use Dynamic Blacklist -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9053},
              $mouseOverText = {77000,9153}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ThreatAvoidance', '$UseDynamicBlacklist', global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist]
            ]"/>
            
            <!-- Block Enemy Factions -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9054},
              $mouseOverText = {77000,9154}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ThreatAvoidance', '$BlockEnemyFactions', global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions]
            ]"/>
            
            <!-- Blacklist Threat Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9055},
              $mouseOverText = {77000,9155}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 5,
              $start = global.$GT_GlobalSettings.$ThreatAvoidance.$BlacklistThreshold,
              $step = 1,
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$ThreatAvoidance', $setting = '$BlacklistThreshold']
            ]"/>
            
            <!-- Recreate Blacklist Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 5,
              $text = {77000,9056},
              $mouseOverText = {77000,9156}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 6,
              $colSpan = 3,
              $text = table[
                $text = {77000,9057},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_RecreateBlacklist,
              $onRightClick = GT_RecreateBlacklist
            ]"/>
            
            <!-- Note: Risk Tolerance is now configured per-ship in the command behavior settings -->
            
            <!-- Auto-Repair Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9040},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Enable Auto-Repair -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9041},
              $mouseOverText = {77000,9141}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$AutoRepair.$Enabled then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$AutoRepair.$Enabled then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$AutoRepair', '$Enabled', global.$GT_GlobalSettings.$AutoRepair.$Enabled]
            ]"/>
            
            <!-- Hull Threshold Slider -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9042},
              $mouseOverText = {77000,9142}
            ]"/>
            <!-- Validate slider value is within range -->
            <do_if value="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold lt 50">
              <set_value name="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold" exact="80"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold gt 99">
              <set_value name="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold" exact="80"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 50,
              $max = 99,
              $start = global.$GT_GlobalSettings.$AutoRepair.$HullThreshold,
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$AutoRepair', $setting = '$HullThreshold']
            ]"/>
            
            <!-- Note: Minimum pilot level for auto-repair is hardcoded to Level 12+ -->
            
            <!-- Notifications Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9030},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Simple Report Frequency -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9246},
              $mouseOverText = {77000,9346}
            ]"/>
            <!-- Validate slider value is within range -->
            <do_if value="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency lt 0">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency" exact="1"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency gt 30">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 0,
              $max = 30,
              $start = global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency,
              $step = 1,
              $suffix = ' min',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Notifications', $setting = '$SimpleReportFrequency']
            ]"/>
            
            <!-- Comprehensive Report Frequency -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9247},
              $mouseOverText = {77000,9347}
            ]"/>
            <!-- Validate slider value is within range -->
            <do_if value="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency lt 0">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency" exact="30"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency gt 60">
              <set_value name="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency" exact="30"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 0,
              $max = 60,
              $start = global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency,
              $step = 1,
              $suffix = ' min',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Notifications', $setting = '$ComprehensiveReportFrequency']
            ]"/>
            
            <!-- Ship Modifications Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9090},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Enable Ship Modifications -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9091},
              $mouseOverText = {77000,9191}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$Modifications.$Enabled then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$Modifications.$Enabled then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$Modifications', '$Enabled', global.$GT_GlobalSettings.$Modifications.$Enabled]
            ]"/>
            
            <!-- Defensive Equipment Section (Level 15 Feature) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9060},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Enable Defensive Equipment -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9061},
              $mouseOverText = {77000,9161}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$DefensiveEquipment.$Enabled then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$DefensiveEquipment.$Enabled then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$DefensiveEquipment', '$Enabled', global.$GT_GlobalSettings.$DefensiveEquipment.$Enabled]
            ]"/>
            
            <!-- Restock Countermeasures -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9062},
              $mouseOverText = {77000,9162}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockCountermeasures then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockCountermeasures then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$DefensiveEquipment', '$RestockCountermeasures', global.$GT_GlobalSettings.$DefensiveEquipment.$RestockCountermeasures]
            ]"/>
            
            <!-- Restock Defense Drones -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9063},
              $mouseOverText = {77000,9163}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockDefenseDrones then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockDefenseDrones then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$DefensiveEquipment', '$RestockDefenseDrones', global.$GT_GlobalSettings.$DefensiveEquipment.$RestockDefenseDrones]
            ]"/>
            
            <!-- Restock Trade Drones -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9064},
              $mouseOverText = {77000,9164}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockTradeDrones then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockTradeDrones then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$DefensiveEquipment', '$RestockTradeDrones', global.$GT_GlobalSettings.$DefensiveEquipment.$RestockTradeDrones]
            ]"/>
            
            <!-- Restock Laser Towers -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9065},
              $mouseOverText = {77000,9165}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockLaserTowers then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockLaserTowers then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$DefensiveEquipment', '$RestockLaserTowers', global.$GT_GlobalSettings.$DefensiveEquipment.$RestockLaserTowers]
            ]"/>
            
            <!-- Restock Repair Drones -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9066},
              $mouseOverText = {77000,9166}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockRepairDrones then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$DefensiveEquipment.$RestockRepairDrones then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$DefensiveEquipment', '$RestockRepairDrones', global.$GT_GlobalSettings.$DefensiveEquipment.$RestockRepairDrones]
            ]"/>
            
            <!-- Countermeasure Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9067},
              $mouseOverText = {77000,9167}
            ]"/>
            <!-- Validate slider value is within range -->
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold lt 10">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold" exact="50"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold gt 100">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold" exact="50"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 10,
              $max = 100,
              $start = global.$GT_GlobalSettings.$DefensiveEquipment.$CountermeasureThreshold,
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$DefensiveEquipment', $setting = '$CountermeasureThreshold']
            ]"/>
            
            <!-- Unified Capacity Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9068},
              $mouseOverText = {77000,9168}
            ]"/>
            <!-- Validate slider value is within range -->
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold lt 10">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold" exact="70"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold gt 100">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold" exact="70"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 10,
              $max = 100,
              $start = global.$GT_GlobalSettings.$DefensiveEquipment.$UnifiedThreshold,
              $step = 5,
              $suffix = '%',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$DefensiveEquipment', $setting = '$UnifiedThreshold']
            ]"/>
            
            <!-- Balance Profile Cycling Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9069},
              $mouseOverText = {77000,9169}
            ]"/>
            <!-- Validate profile value is within range -->
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile lt 0">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile" exact="2"/>
            </do_if>
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile gt 4">
              <set_value name="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile" exact="2"/>
            </do_if>
            <!-- Get profile name for display using translation IDs -->
            <!-- Set profile name using conditional logic (translation IDs must be literals) -->
            <set_value name="$profileName" exact="{77000,6103}"/>  <!-- Default: Trading-Focused -->
            <do_if value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile == 0">
              <set_value name="$profileName" exact="{77000,6101}"/>  <!-- Balanced -->
            </do_if>
            <do_elseif value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile == 1">
              <set_value name="$profileName" exact="{77000,6102}"/>  <!-- Defensive -->
            </do_elseif>
            <do_elseif value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile == 2">
              <set_value name="$profileName" exact="{77000,6103}"/>  <!-- Trading-Focused -->
            </do_elseif>
            <do_elseif value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile == 3">
              <set_value name="$profileName" exact="{77000,6104}"/>  <!-- Heavy Defense -->
            </do_elseif>
            <do_elseif value="global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile == 4">
              <set_value name="$profileName" exact="{77000,6105}"/>  <!-- Tower Support -->
            </do_elseif>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 4,
              $text = table[
                $text = $profileName,
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Profile_Cycle,
              $onRightClick = GT_Profile_Cycle,
              $echo = ['$DefensiveEquipment', '$BalanceProfile', global.$GT_GlobalSettings.$DefensiveEquipment.$BalanceProfile]
            ]"/>
            
            <!-- Ship Naming Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9070},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Master Enable/Disable Toggle -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9075},
              $mouseOverText = {77000,9175}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$Enabled then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ShipNaming.$Enabled then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ShipNaming', '$Enabled', global.$GT_GlobalSettings.$ShipNaming.$Enabled]
            ]"/>
            
            <!-- Display XP Setting -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9071},
              $mouseOverText = {77000,9171}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$DisplayXP then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ShipNaming.$DisplayXP then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ShipNaming', '$DisplayXP', global.$GT_GlobalSettings.$ShipNaming.$DisplayXP]
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$XPPosition == 'prefix' then {77000,9076} else {77000,9077},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Position_Toggle,
              $onRightClick = GT_Position_Toggle,
              $echo = ['$ShipNaming', '$XPPosition', global.$GT_GlobalSettings.$ShipNaming.$XPPosition]
            ]"/>
            
            <!-- Display Rank Setting -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9072},
              $mouseOverText = {77000,9172}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$DisplayRank then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ShipNaming.$DisplayRank then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ShipNaming', '$DisplayRank', global.$GT_GlobalSettings.$ShipNaming.$DisplayRank]
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$RankPosition == 'prefix' then {77000,9076} else {77000,9077},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Position_Toggle,
              $onRightClick = GT_Position_Toggle,
              $echo = ['$ShipNaming', '$RankPosition', global.$GT_GlobalSettings.$ShipNaming.$RankPosition]
            ]"/>
            
            <!-- Display Level Setting -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9073},
              $mouseOverText = {77000,9173}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ShipNaming', '$DisplayLevel', global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel]
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$LevelPosition == 'prefix' then {77000,9076} else {77000,9077},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Position_Toggle,
              $onRightClick = GT_Position_Toggle,
              $echo = ['$ShipNaming', '$LevelPosition', global.$GT_GlobalSettings.$ShipNaming.$LevelPosition]
            ]"/>
            
            <!-- Display Ship Class Setting -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9082},
              $mouseOverText = {77000,9182}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ShipNaming', '$DisplayShipClass', global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass]
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$ShipClassPosition == 'prefix' then {77000,9076} else {77000,9077},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Position_Toggle,
              $onRightClick = GT_Position_Toggle,
              $echo = ['$ShipNaming', '$ShipClassPosition', global.$GT_GlobalSettings.$ShipNaming.$ShipClassPosition]
            ]"/>
            
            <!-- Display Status Setting -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9074},
              $mouseOverText = {77000,9174}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$ShipNaming', '$DisplayStatus', global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus]
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$StatusPosition == 'prefix' then {77000,9076} else {77000,9077},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Position_Toggle,
              $onRightClick = GT_Position_Toggle,
              $echo = ['$ShipNaming', '$StatusPosition', global.$GT_GlobalSettings.$ShipNaming.$StatusPosition]
            ]"/>
            
            <!-- Default Name Source Setting -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9078},
              $mouseOverText = {77000,9178}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 4,
              $text = table[
                $text = if global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource == 'macro.name' then {77000,9079} else if global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource == 'typename' then {77000,9080} else if global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource == 'macro.name.base' then {77000,9081} else {77000,9083},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_NameSource_Cycle,
              $onRightClick = GT_NameSource_Cycle,
              $echo = ['$ShipNaming', '$DefaultNameSource', global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource]
            ]"/>
            
            <!-- Performance Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9230},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Batch Processing Delay -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9231},
              $mouseOverText = {77000,9331}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$batchDelay" exact="25"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay?">
              <set_value name="$batchDelay" exact="@global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay"/>
            </do_if>
            <do_if value="$batchDelay lt 1 or $batchDelay gt 500">
              <set_value name="$batchDelay" exact="25"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 500,
              $start = $batchDelay,
              $step = 5,
              $suffix = 'ms',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$BatchProcessingDelay']
            ]"/>

            <!-- Max Concurrent Cache Searches -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9248},
              $mouseOverText = {77000,9348}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxConcurrentCache" exact="2"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches?">
              <set_value name="$maxConcurrentCache" exact="@global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches"/>
            </do_if>
            <do_if value="$maxConcurrentCache lt 1 or $maxConcurrentCache gt 20">
              <set_value name="$maxConcurrentCache" exact="2"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 20,
              $start = $maxConcurrentCache,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxConcurrentCacheSearches']
            ]"/>

            <!-- Max Concurrent Live Searches -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9249},
              $mouseOverText = {77000,9349}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxConcurrentLive" exact="1"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches?">
              <set_value name="$maxConcurrentLive" exact="@global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches"/>
            </do_if>
            <do_if value="$maxConcurrentLive lt 1 or $maxConcurrentLive gt 10">
              <set_value name="$maxConcurrentLive" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 10,
              $start = $maxConcurrentLive,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxConcurrentLiveSearches']
            ]"/>

            <!-- Max Concurrent Fallback Searches -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9386},
              $mouseOverText = {77000,9485}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxConcurrentFallback" exact="1"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches?">
              <set_value name="$maxConcurrentFallback" exact="@global.$GT_GlobalSettings.$Performance.$MaxConcurrentFallbackSearches"/>
            </do_if>
            <do_if value="$maxConcurrentFallback lt 1 or $maxConcurrentFallback gt 10">
              <set_value name="$maxConcurrentFallback" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 10,
              $start = $maxConcurrentFallback,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxConcurrentFallbackSearches']
            ]"/>
            
            <!-- Max Trades To Return -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9234},
              $mouseOverText = {77000,9334}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxTrades" exact="20"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn?">
              <set_value name="$maxTrades" exact="@global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn"/>
            </do_if>
            <do_if value="$maxTrades lt 1 or $maxTrades gt 100">
              <set_value name="$maxTrades" exact="20"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 100,
              $start = $maxTrades,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxTradesToReturn']
            ]"/>
            
            <!-- Max Offers Per Ware -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9235},
              $mouseOverText = {77000,9335}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxOffers" exact="200"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare?">
              <set_value name="$maxOffers" exact="@global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare"/>
            </do_if>
            <do_if value="$maxOffers lt 50 or $maxOffers gt 1000">
              <set_value name="$maxOffers" exact="200"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 50,
              $max = 1000,
              $start = $maxOffers,
              $step = 10,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxOffersPerWare']
            ]"/>
            
            <!-- Max Trades Per Ware -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9236},
              $mouseOverText = {77000,9336}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxTradesPerWare" exact="20"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare?">
              <set_value name="$maxTradesPerWare" exact="@global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare"/>
            </do_if>
            <do_if value="$maxTradesPerWare lt 5 or $maxTradesPerWare gt 100">
              <set_value name="$maxTradesPerWare" exact="20"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 5,
              $max = 100,
              $start = $maxTradesPerWare,
              $step = 5,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxTradesPerWare']
            ]"/>
            
            <!-- Max Offers Per Ware For Matching -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9237},
              $mouseOverText = {77000,9337}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$maxOffersForMatching" exact="20"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching?">
              <set_value name="$maxOffersForMatching" exact="@global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching"/>
            </do_if>
            <do_if value="$maxOffersForMatching lt 5 or $maxOffersForMatching gt 100">
              <set_value name="$maxOffersForMatching" exact="20"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 5,
              $max = 100,
              $start = $maxOffersForMatching,
              $step = 5,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxOffersPerWareForMatching']
            ]"/>
            
            <!-- Early Exit Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9238},
              $mouseOverText = {77000,9338}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$earlyExitThreshold" exact="2000"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold?">
              <set_value name="$earlyExitThreshold" exact="@global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold"/>
            </do_if>
            <do_if value="$earlyExitThreshold lt 100 or $earlyExitThreshold gt 10000">
              <set_value name="$earlyExitThreshold" exact="2000"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 100,
              $max = 10000,
              $start = $earlyExitThreshold,
              $step = 100,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$EarlyExitThreshold']
            ]"/>
            
            <!-- Live Offer Slice Interval -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9241},
              $mouseOverText = {77000,9341}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$liveOfferSliceInterval" exact="100"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval?">
              <set_value name="$liveOfferSliceInterval" exact="@global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval"/>
            </do_if>
            <do_if value="$liveOfferSliceInterval lt 5 or $liveOfferSliceInterval gt 2000">
              <set_value name="$liveOfferSliceInterval" exact="100"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 5,
              $max = 2000,
              $start = $liveOfferSliceInterval,
              $step = 25,
              $suffix = 'ms',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$LiveOfferSliceInterval']
            ]"/>

            <!-- Search Lock TTL (self-heal for old saves) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9266},
              $mouseOverText = {77000,9366}
            ]"/>
            <set_value name="$searchLockTtl" exact="600"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$SearchLockTTL?">
              <set_value name="$searchLockTtl" exact="@global.$GT_GlobalSettings.$Performance.$SearchLockTTL"/>
            </do_if>
            <do_if value="$searchLockTtl lt 60 or $searchLockTtl gt 7200">
              <set_value name="$searchLockTtl" exact="600"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 60,
              $max = 7200,
              $start = $searchLockTtl,
              $step = 60,
              $suffix = 's',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$SearchLockTTL']
            ]"/>

            <!-- Live Offer Append Chunk Size -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9265},
              $mouseOverText = {77000,9365}
            ]"/>
            <set_value name="$liveOfferAppendChunkSize" exact="200"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize?">
              <set_value name="$liveOfferAppendChunkSize" exact="@global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize"/>
            </do_if>
            <do_if value="$liveOfferAppendChunkSize lt 50 or $liveOfferAppendChunkSize gt 2000">
              <set_value name="$liveOfferAppendChunkSize" exact="200"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 50,
              $max = 2000,
              $start = $liveOfferAppendChunkSize,
              $step = 50,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$LiveOfferAppendChunkSize']
            ]"/>
            
            <!-- Batch Chunk Size -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9263},
              $mouseOverText = {77000,9363}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$batchChunkSize" exact="5"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$BatchChunkSize?">
              <set_value name="$batchChunkSize" exact="@global.$GT_GlobalSettings.$Performance.$BatchChunkSize"/>
            </do_if>
            <do_if value="$batchChunkSize lt 5 or $batchChunkSize gt 20">
              <set_value name="$batchChunkSize" exact="5"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 5,
              $max = 20,
              $start = $batchChunkSize,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$BatchChunkSize']
            ]"/>
            
            <!-- Batch Backpressure Soft Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9370},
              $mouseOverText = {77000,9470}
            ]"/>
            <set_value name="$backpressureSoft" exact="10"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold?">
              <set_value name="$backpressureSoft" exact="@global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold"/>
            </do_if>
            <do_if value="$backpressureSoft lt 5 or $backpressureSoft gt 50">
              <set_value name="$backpressureSoft" exact="10"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 5,
              $max = 50,
              $start = $backpressureSoft,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$BatchBackpressureSoftThreshold']
            ]"/>
            
            <!-- Batch Backpressure Hard Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9371},
              $mouseOverText = {77000,9471}
            ]"/>
            <set_value name="$backpressureHard" exact="25"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold?">
              <set_value name="$backpressureHard" exact="@global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold"/>
            </do_if>
            <do_if value="$backpressureHard lt 10 or $backpressureHard gt 100">
              <set_value name="$backpressureHard" exact="25"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 10,
              $max = 100,
              $start = $backpressureHard,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$BatchBackpressureHardThreshold']
            ]"/>
            
            <!-- Sectors Per Slice -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9372},
              $mouseOverText = {77000,9472}
            ]"/>
            <set_value name="$sectorsPerSlice" exact="2"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$SectorsPerSlice?">
              <set_value name="$sectorsPerSlice" exact="@global.$GT_GlobalSettings.$Performance.$SectorsPerSlice"/>
            </do_if>
            <do_if value="$sectorsPerSlice lt 1 or $sectorsPerSlice gt 5">
              <set_value name="$sectorsPerSlice" exact="2"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 5,
              $start = $sectorsPerSlice,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$SectorsPerSlice']
            ]"/>
            
            <!-- Home Refresh Cooldown -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9373},
              $mouseOverText = {77000,9473}
            ]"/>
            <set_value name="$homeRefreshCooldown" exact="30"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown?">
              <set_value name="$homeRefreshCooldown" exact="@global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown"/>
            </do_if>
            <do_if value="$homeRefreshCooldown lt 10 or $homeRefreshCooldown gt 120">
              <set_value name="$homeRefreshCooldown" exact="30"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 10,
              $max = 120,
              $start = $homeRefreshCooldown,
              $step = 5,
              $suffix = 's',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$HomeRefreshCooldown']
            ]"/>
            
            <!-- Cache Miss Cooldown Base -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9374},
              $mouseOverText = {77000,9474}
            ]"/>
            <set_value name="$cacheMissCooldown" exact="10"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase?">
              <set_value name="$cacheMissCooldown" exact="@global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase"/>
            </do_if>
            <do_if value="$cacheMissCooldown lt 1 or $cacheMissCooldown gt 30">
              <set_value name="$cacheMissCooldown" exact="10"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 30,
              $start = $cacheMissCooldown,
              $step = 1,
              $suffix = 's',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$CacheMissCooldownBase']
            ]"/>
            
            <!-- Scheduler Tick Interval -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9375},
              $mouseOverText = {77000,9475}
            ]"/>
            <set_value name="$schedulerTickInterval" exact="100"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval?">
              <set_value name="$schedulerTickInterval" exact="@global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval"/>
            </do_if>
            <do_if value="$schedulerTickInterval lt 50 or $schedulerTickInterval gt 500">
              <set_value name="$schedulerTickInterval" exact="100"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 50,
              $max = 500,
              $start = $schedulerTickInterval,
              $step = 10,
              $suffix = 'ms',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$SchedulerTickInterval']
            ]"/>
            
            <!-- Trade Found Signal Delay -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9490},
              $mouseOverText = {77000,9590}
            ]"/>
            <set_value name="$tradeFoundSignalDelay" exact="10"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay?">
              <set_value name="$tradeFoundSignalDelay" exact="@global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay"/>
            </do_if>
            <do_if value="$tradeFoundSignalDelay lt 0 or $tradeFoundSignalDelay gt 1000">
              <set_value name="$tradeFoundSignalDelay" exact="10"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 0,
              $max = 1000,
              $start = $tradeFoundSignalDelay,
              $step = 10,
              $suffix = 'ms',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$TradeFoundSignalDelay']
            ]"/>
            
            <!-- Max Cache Queries Per Tick -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9376},
              $mouseOverText = {77000,9476}
            ]"/>
            <set_value name="$maxCacheQueriesPerTick" exact="1"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick?">
              <set_value name="$maxCacheQueriesPerTick" exact="@global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick"/>
            </do_if>
            <do_if value="$maxCacheQueriesPerTick lt 1 or $maxCacheQueriesPerTick gt 5">
              <set_value name="$maxCacheQueriesPerTick" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 5,
              $start = $maxCacheQueriesPerTick,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxCacheQueriesPerTick']
            ]"/>
            
            <!-- Max Search Continuations Per Tick -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9377},
              $mouseOverText = {77000,9477}
            ]"/>
            <set_value name="$maxContinuationsPerTick" exact="1"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick?">
              <set_value name="$maxContinuationsPerTick" exact="@global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick"/>
            </do_if>
            <do_if value="$maxContinuationsPerTick lt 1 or $maxContinuationsPerTick gt 5">
              <set_value name="$maxContinuationsPerTick" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 5,
              $start = $maxContinuationsPerTick,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxSearchContinuationsPerTick']
            ]"/>
            
            <!-- Max Ships Per Tick -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9378},
              $mouseOverText = {77000,9478}
            ]"/>
            <set_value name="$maxShipsPerTick" exact="1"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick?">
              <set_value name="$maxShipsPerTick" exact="@global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick"/>
            </do_if>
            <do_if value="$maxShipsPerTick lt 1 or $maxShipsPerTick gt 5">
              <set_value name="$maxShipsPerTick" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 5,
              $start = $maxShipsPerTick,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxShipsPerTick']
            ]"/>
            
            <!-- Max Items Per Tick -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9379},
              $mouseOverText = {77000,9479}
            ]"/>
            <set_value name="$maxItemsPerTick" exact="1"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick?">
              <set_value name="$maxItemsPerTick" exact="@global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick"/>
            </do_if>
            <do_if value="$maxItemsPerTick lt 1 or $maxItemsPerTick gt 5">
              <set_value name="$maxItemsPerTick" exact="1"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 5,
              $start = $maxItemsPerTick,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxItemsPerTick']
            ]"/>
            
            <!-- Max Wake Per Tick -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9380},
              $mouseOverText = {77000,9480}
            ]"/>
            <set_value name="$maxWakePerTick" exact="2"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxWakePerTick?">
              <set_value name="$maxWakePerTick" exact="@global.$GT_GlobalSettings.$Performance.$MaxWakePerTick"/>
            </do_if>
            <do_if value="$maxWakePerTick lt 1 or $maxWakePerTick gt 10">
              <set_value name="$maxWakePerTick" exact="2"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 10,
              $start = $maxWakePerTick,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$MaxWakePerTick']
            ]"/>
            
            <!-- Cache Query Max Entries -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9381},
              $mouseOverText = {77000,9481}
            ]"/>
            <set_value name="$cacheQueryMaxEntries" exact="5"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries?">
              <set_value name="$cacheQueryMaxEntries" exact="@global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries"/>
            </do_if>
            <do_if value="$cacheQueryMaxEntries lt 1 or $cacheQueryMaxEntries gt 100">
              <set_value name="$cacheQueryMaxEntries" exact="5"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1,
              $max = 100,
              $start = $cacheQueryMaxEntries,
              $step = 1,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$CacheQueryMaxEntries']
            ]"/>
            
            <!-- Stale Threshold Seconds -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9382},
              $mouseOverText = {77000,9482}
            ]"/>
            <set_value name="$staleThresholdSeconds" exact="300"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds?">
              <set_value name="$staleThresholdSeconds" exact="@global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds"/>
            </do_if>
            <do_if value="$staleThresholdSeconds lt 60 or $staleThresholdSeconds gt 600">
              <set_value name="$staleThresholdSeconds" exact="300"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 60,
              $max = 600,
              $start = $staleThresholdSeconds,
              $step = 30,
              $suffix = 's',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$StaleThresholdSeconds']
            ]"/>
            
            <!-- Queue Stale Threshold Seconds -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9383},
              $mouseOverText = {77000,9483}
            ]"/>
            <set_value name="$queueStaleThreshold" exact="60"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds?">
              <set_value name="$queueStaleThreshold" exact="@global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds"/>
            </do_if>
            <do_if value="$queueStaleThreshold lt 30 or $queueStaleThreshold gt 300">
              <set_value name="$queueStaleThreshold" exact="60"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 30,
              $max = 300,
              $start = $queueStaleThreshold,
              $step = 10,
              $suffix = 's',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$QueueStaleThresholdSeconds']
            ]"/>
            
            <!-- Failed Trade Expiration Seconds -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9384},
              $mouseOverText = {77000,9484}
            ]"/>
            <set_value name="$failedTradeExpiration" exact="1800"/>
            <do_if value="global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds?">
              <set_value name="$failedTradeExpiration" exact="@global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds"/>
            </do_if>
            <do_if value="$failedTradeExpiration lt 300 or $failedTradeExpiration gt 3600">
              <set_value name="$failedTradeExpiration" exact="1800"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 300,
              $max = 3600,
              $start = $failedTradeExpiration,
              $step = 300,
              $suffix = 's',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$Performance', $setting = '$FailedTradeExpirationSeconds']
            ]"/>
            
            <!-- Number Format Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9239},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Number Format Style -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9240},
              $mouseOverText = {77000,9340}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 5,
              $colSpan = 4,
              $text = table[
                $text = if global.$GT_GlobalSettings.$NumberFormat.$Format == 'german' then {77000,9244} else {77000,9245},
                $color = 'Color.text_normal',
                $halign = 'center'
              ],
              $onClick = GT_Format_Cycle,
              $onRightClick = GT_Format_Cycle,
              $echo = ['$NumberFormat', '$Format', global.$GT_GlobalSettings.$NumberFormat.$Format]
            ]"/>
            
            <!-- Use M Suffix -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9242},
              $mouseOverText = {77000,9342}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$NumberFormat', '$UseMSuffix', global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix]
            ]"/>
            
            <!-- M Suffix Threshold -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9243},
              $mouseOverText = {77000,9343}
            ]"/>
            <!-- Validate slider value is within range -->
            <set_value name="$mThreshold" exact="999999"/>
            <do_if value="global.$GT_GlobalSettings.$NumberFormat? and global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold?">
              <set_value name="$mThreshold" exact="@global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold"/>
            </do_if>
            <do_if value="$mThreshold lt 1000 or $mThreshold gt 999999999">
              <set_value name="$mThreshold" exact="999999"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
              $col = 5,
              $colSpan = 4,
              $min = 1000,
              $max = 999999999,
              $start = $mThreshold,
              $step = 100000,
              $suffix = '',
              $onSliderCellChanged = GT_Slider_Update,
              $echo = table[$section = '$NumberFormat', $setting = '$MSuffixThreshold']
            ]"/>
            
            <!-- Maintenance & Diagnostics Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9220},
              $halign = 'center',
              $color = 'Color.text_positive'
            ]"/>
            
            <!-- Enable Debug Logging -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9201},
              $mouseOverText = {77000,9202}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = if global.$GT_GlobalSettings.$Debug.$EnableDebugLogging then {1001,4825} else {1001,8942},
                $color = if global.$GT_GlobalSettings.$Debug.$EnableDebugLogging then $TextGreen else $TextRed,
                $halign = 'center'
              ],
              $onClick = GT_Setting_Toggle,
              $onRightClick = GT_Setting_Toggle,
              $echo = ['$Debug', '$EnableDebugLogging', global.$GT_GlobalSettings.$Debug.$EnableDebugLogging]
            ]"/>
            
            <!-- Reset Profit Statistics Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9221},
              $mouseOverText = {77000,9321}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = {77000,9222},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_ResetProfitStats,
              $onRightClick = GT_ResetProfitStats
            ]"/>
            
            <!-- Clear All Blacklisted Sectors Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9223},
              $mouseOverText = {77000,9323}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = {77000,9224},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_ClearAllBlacklistedSectors,
              $onRightClick = GT_ClearAllBlacklistedSectors
            ]"/>
            
            <!-- Reset All Settings to Defaults Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9225},
              $mouseOverText = {77000,9325}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = {77000,9226},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_ResetAllSettings,
              $onRightClick = GT_ResetAllSettings
            ]"/>
            
            <!-- Clear Trade Cache for All Home Sectors Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9227},
              $mouseOverText = {77000,9327}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = {77000,9228},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_ClearTradeCache,
              $onRightClick = GT_ClearTradeCache
            ]"/>

            <!-- Dump Trade Cache (FULL; heavy) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9292},
              $mouseOverText = {77000,9392}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = {77000,9293},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_DumpTradeCache,
              $onRightClick = GT_DumpTradeCache
            ]"/>

            <!-- Release All Search Locks Button -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 1,
              $colSpan = 8,
              $text = table[
                $text = {77000,9229},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $mouseOverText = {77000,9329},
              $onClick = GT_ReleaseAllLocks,
              $onRightClick = GT_ReleaseAllLocks
            ]"/>

            <!-- Dump Trade Hub Status (on-demand debug snapshot) -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 6,
              $text = {77000,9290},
              $mouseOverText = {77000,9390}
            ]"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Button" param="table[
              $col = 7,
              $colSpan = 2,
              $text = table[
                $text = {77000,9291},
                $color = 'Color.text_warning',
                $halign = 'center'
              ],
              $onClick = GT_DumpTradeHubStatus,
              $onRightClick = GT_DumpTradeHubStatus
            ]"/>
            
            <!-- Ship State Naming Section -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 8,
              $text = {77000,9250},
              $halign = 'center',
              $color = 'Color.text_positive',
              $mouseOverText = {77000,9350}
            ]"/>
            
            <!-- Resupply State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9251},
              $mouseOverText = {77000,9351}
            ]"/>
            <set_value name="$resupplyAbbr" exact="'RS'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Resupply?">
              <set_value name="$resupplyAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Resupply"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $resupplyAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Resupply', $setting = '$Resupply']
            ]"/>
            
            <!-- Repair State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9252},
              $mouseOverText = {77000,9352}
            ]"/>
            <set_value name="$repairAbbr" exact="'RP'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Repair?">
              <set_value name="$repairAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Repair"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $repairAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Repair', $setting = '$Repair']
            ]"/>
            
            <!-- Maintenance State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9253},
              $mouseOverText = {77000,9353}
            ]"/>
            <set_value name="$maintenanceAbbr" exact="'MT'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Maintenance?">
              <set_value name="$maintenanceAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Maintenance"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $maintenanceAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Maintenance', $setting = '$Maintenance']
            ]"/>
            
            <!-- Training State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9254},
              $mouseOverText = {77000,9354}
            ]"/>
            <set_value name="$trainingAbbr" exact="'TR'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Training?">
              <set_value name="$trainingAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Training"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $trainingAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Training', $setting = '$Training']
            ]"/>
            
            <!-- Escape State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9262},
              $mouseOverText = {77000,9362}
            ]"/>
            <set_value name="$escapeAbbr" exact="'ES'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Escape?">
              <set_value name="$escapeAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Escape"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $escapeAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Escape', $setting = '$Escape']
            ]"/>
            
            <!-- Reroute State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9255},
              $mouseOverText = {77000,9355}
            ]"/>
            <set_value name="$rerouteAbbr" exact="'RR'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Reroute?">
              <set_value name="$rerouteAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Reroute"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $rerouteAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Reroute', $setting = '$Reroute']
            ]"/>
            
            <!-- Clearance State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9256},
              $mouseOverText = {77000,9356}
            ]"/>
            <set_value name="$clearanceAbbr" exact="'CL'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Clearance?">
              <set_value name="$clearanceAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Clearance"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $clearanceAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Clearance', $setting = '$Clearance']
            ]"/>
            
            <!-- Blocked State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9257},
              $mouseOverText = {77000,9357}
            ]"/>
            <set_value name="$blockedAbbr" exact="'BL'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Blocked?">
              <set_value name="$blockedAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Blocked"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $blockedAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Blocked', $setting = '$Blocked']
            ]"/>
            
            <!-- Fallback State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9258},
              $mouseOverText = {77000,9358}
            ]"/>
            <set_value name="$fallbackAbbr" exact="'FB'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Fallback?">
              <set_value name="$fallbackAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Fallback"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $fallbackAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Fallback', $setting = '$Fallback']
            ]"/>
            
            <!-- Isolated State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9259},
              $mouseOverText = {77000,9359}
            ]"/>
            <set_value name="$isolatedAbbr" exact="'IS'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Isolated?">
              <set_value name="$isolatedAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Isolated"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $isolatedAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Isolated', $setting = '$Isolated']
            ]"/>
            
            <!-- Trading State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9260},
              $mouseOverText = {77000,9360}
            ]"/>
            <set_value name="$tradingAbbr" exact="'TD'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Trading?">
              <set_value name="$tradingAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Trading"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $tradingAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Trading', $setting = '$Trading']
            ]"/>
            
            <!-- Idle State Abbreviation -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
              $col = 1,
              $colSpan = 4,
              $text = {77000,9261},
              $mouseOverText = {77000,9361}
            ]"/>
            <set_value name="$idleAbbr" exact="'ID'"/>
            <do_if value="global.$GT_GlobalSettings.$ShipNaming? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations? and global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Idle?">
              <set_value name="$idleAbbr" exact="@global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Idle"/>
            </do_if>
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_EditBox" param="table[
              $col = 5,
              $colSpan = 4,
              $defaultText = $idleAbbr,
              $maxChars = 12,
              $onEditBoxDeactivated = GT_StateAbbreviation_Update,
              $echo = table[$state = 'Idle', $setting = '$Idle']
            ]"/>
      </actions>
        </cue>
        
    <!-- Setting Toggle Handler -->
    <cue name="GT_Setting_Toggle" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Debug: Show the full parameter structure -->
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] ToggleSetting called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Extract parameters from the echo array -->
            <set_value name="$section" exact="event.param.$echo.{1}"/>
            <set_value name="$setting" exact="event.param.$echo.{2}"/>
            <set_value name="$currentValue" exact="event.param.$echo.{3}"/>
            
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Extracted parameters - Section: ' + $section + ', Setting: ' + $setting + ', CurrentValue: ' + $currentValue" chance="100"/>
            </do_if>
            
            <!-- Toggle the setting -->
            <set_value name="global.$GT_GlobalSettings.{$section}.{$setting}" exact="not $currentValue"/>
            
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Global setting toggled: ' + $section + '.' + $setting + ' = ' + global.$GT_GlobalSettings.{$section}.{$setting}" chance="100"/>
            </do_if>
            
            <!-- If this is a ship naming setting, update all ship names -->
            <do_if value="$section == '$ShipNaming'">
              <signal_cue_instantly cue="md.GT_CoreSystem.UpdateAllShipNames"/>
            </do_if>
            
            <!-- Refresh the menu -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
        </cue>
        
    <!-- Position Toggle Handler -->
    <cue name="GT_Position_Toggle" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Debug: Show the full parameter structure -->
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] TogglePosition called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Extract parameters from the echo array -->
            <set_value name="$section" exact="event.param.$echo.{1}"/>
            <set_value name="$setting" exact="event.param.$echo.{2}"/>
            <set_value name="$currentValue" exact="event.param.$echo.{3}"/>
            
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Extracted parameters - Section: ' + $section + ', Setting: ' + $setting + ', CurrentValue: ' + $currentValue" chance="100"/>
            </do_if>
            
            <!-- Toggle between 'prefix' and 'suffix' -->
            <set_value name="global.$GT_GlobalSettings.{$section}.{$setting}" exact="if $currentValue == 'prefix' then 'suffix' else 'prefix'"/>
            
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Position setting toggled: ' + $section + '.' + $setting + ' = ' + global.$GT_GlobalSettings.{$section}.{$setting}" chance="100"/>
            </do_if>
            
            <!-- Update all ship names when position changes -->
            <signal_cue_instantly cue="md.GT_CoreSystem.UpdateAllShipNames"/>
            
            <!-- Refresh the menu -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
        </cue>
        
    <!-- Name Source Cycle Handler -->
    <cue name="GT_NameSource_Cycle" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Extract parameters from the echo array -->
            <set_value name="$section" exact="event.param.$echo.{1}"/>
            <set_value name="$setting" exact="event.param.$echo.{2}"/>
            <set_value name="$currentValue" exact="event.param.$echo.{3}"/>
            
            <!-- Cycle through options: 'macro.name' -> 'typename' -> 'macro.name.base' -> 'basename' -> 'macro.name' -->
            <set_value name="$newValue" exact="'macro.name'"/>
            <do_if value="$currentValue == 'macro.name'">
              <set_value name="$newValue" exact="'typename'"/>
            </do_if>
            <do_elseif value="$currentValue == 'typename'">
              <set_value name="$newValue" exact="'macro.name.base'"/>
            </do_elseif>
            <do_elseif value="$currentValue == 'macro.name.base'">
              <set_value name="$newValue" exact="'basename'"/>
            </do_elseif>
            <do_else>
              <set_value name="$newValue" exact="'macro.name'"/>
            </do_else>
            
            <set_value name="global.$GT_GlobalSettings.{$section}.{$setting}" exact="$newValue"/>
            
            <!-- Update all ship names when name source changes -->
            <signal_cue_instantly cue="md.GT_CoreSystem.UpdateAllShipNames"/>
            
            <!-- Refresh the menu -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
        </cue>
    
    <!-- Number Format Cycle Handler -->
    <cue name="GT_Format_Cycle" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Extract parameters from the echo array -->
            <set_value name="$section" exact="event.param.$echo.{1}"/>
            <set_value name="$setting" exact="event.param.$echo.{2}"/>
            <set_value name="$currentValue" exact="event.param.$echo.{3}"/>
            
            <!-- Cycle between 'german' and 'english' -->
            <set_value name="$newValue" exact="'german'"/>
            <do_if value="$currentValue == 'german'">
              <set_value name="$newValue" exact="'english'"/>
            </do_if>
            <do_else>
              <set_value name="$newValue" exact="'german'"/>
            </do_else>
            
            <set_value name="global.$GT_GlobalSettings.{$section}.{$setting}" exact="$newValue"/>
            
            <!-- Refresh the menu -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
        
    <!-- Balance Profile Cycle Handler -->
    <cue name="GT_Profile_Cycle" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Debug: Show the full parameter structure -->
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] ProfileCycle called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Extract parameters from the echo array -->
            <set_value name="$section" exact="event.param.$echo.{1}"/>
            <set_value name="$setting" exact="event.param.$echo.{2}"/>
            <set_value name="$currentValue" exact="event.param.$echo.{3}"/>
            
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Extracted parameters - Section: ' + $section + ', Setting: ' + $setting + ', CurrentValue: ' + $currentValue" chance="100"/>
            </do_if>
            
            <!-- Cycle through profiles: 0=Balanced, 1=Defensive, 2=Trading-Focused, 3=Heavy Defense, 4=Tower Support -->
            <set_value name="$newValue" exact="($currentValue + 1) % 5"/>
            <set_value name="global.$GT_GlobalSettings.{$section}.{$setting}" exact="$newValue"/>
            
            <!-- Get profile name for debug -->
            <set_value name="$profileName" exact="'Trading-Focused'"/>
            <do_if value="$newValue == 0">
              <set_value name="$profileName" exact="'Balanced'"/>
            </do_if>
            <do_elseif value="$newValue == 1">
              <set_value name="$profileName" exact="'Defensive'"/>
            </do_elseif>
            <do_elseif value="$newValue == 2">
              <set_value name="$profileName" exact="'Trading-Focused'"/>
            </do_elseif>
            <do_elseif value="$newValue == 3">
              <set_value name="$profileName" exact="'Heavy Defense'"/>
            </do_elseif>
            <do_elseif value="$newValue == 4">
              <set_value name="$profileName" exact="'Tower Support'"/>
            </do_elseif>
            
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] Profile cycled: ' + $section + '.' + $setting + ' = ' + $newValue + ' (' + $profileName + ')'" chance="100"/>
            </do_if>
            
        <!-- Refresh the menu -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
    
    <!-- Clear Trade Cache for All Home Sectors Button Handler -->
    <cue name="GT_ClearTradeCache" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Clear Trade Cache button clicked'" chance="100"/>
        </do_if>
        
        <!-- Clear trade cache for all home sectors -->
        <set_value name="$clearedCount" exact="0"/>
        
        <!-- Clear main trade cache -->
        <do_if value="global.$GT_TradeCache?">
          <set_value name="$cacheKeys" exact="@global.$GT_TradeCache.keys"/>
          <do_if value="$cacheKeys?">
            <set_value name="$cacheKeysCount" exact="@$cacheKeys.count"/>
            <do_if value="$cacheKeysCount? and $cacheKeysCount gt 0">
              <set_value name="$clearedCount" exact="$cacheKeysCount"/>
            </do_if>
          </do_if>
          <set_value name="global.$GT_TradeCache" exact="table[]"/>
        </do_if>
        
        <!-- Clear trade cache homes registry -->
        <do_if value="global.$GT_TradeCacheHomes?">
          <set_value name="global.$GT_TradeCacheHomes" exact="[]"/>
        </do_if>
        
        <!-- Clear trade cache by ware index -->
        <do_if value="global.$GT_TradeCacheByWare?">
          <set_value name="global.$GT_TradeCacheByWare" exact="table[]"/>
        </do_if>
        
        <!-- Log result -->
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Trade cache cleared for ' + $clearedCount + ' home sector(s)'" chance="100"/>
        </do_if>
        
        <!-- Refresh the menu -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>

    <!-- Dump Trade Cache (FULL) Button Handler -->
    <!-- NOTE: This is intentionally heavy; it is chunked across frames to reduce spikes. -->
    <cue name="GT_DumpTradeCache" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <!-- Always show immediate feedback so the user knows the click was received -->
        <show_notification text="'[GT] Cache dump requested. Output goes to DebugLog. Click again to cancel.'" timeout="6s" priority="5"/>

        <!-- If debug logging is disabled, still allow the dump (explicit user action), but warn. -->
        <do_if value="not global.$GT_GlobalSettings? or not global.$GT_GlobalSettings.$Debug? or not global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <show_notification text="'[GT] Note: Debug Logging is OFF. Dump will still run (explicit) and write to log.'" timeout="6s"/>
        </do_if>

        <do_if value="not global.$GT_CacheDumpState? or global.$GT_CacheDumpState == null">
          <set_value name="global.$GT_CacheDumpState" exact="table[]"/>
        </do_if>

        <!-- Toggle behavior: if already dumping, cancel -->
        <do_if value="global.$GT_CacheDumpState.$Active? and global.$GT_CacheDumpState.$Active">
          <set_value name="global.$GT_CacheDumpState.$Cancel" exact="true"/>
          <show_notification text="'[GT] Cache dump: cancel requested (will stop shortly).'" timeout="4s"/>
          <debug_text text="'[GT-Cache-Dump] CANCEL requested'" chance="100"/>
          <cancel_cue cue="this"/>
        </do_if>

        <set_value name="$total" exact="0"/>
        <run_actions ref="md.GT_Libraries_General.GT_CalculateTotalCacheCount" result="$total"/>

        <!-- Detect cache shape and build home list -->
        <set_value name="$isLegacyList" exact="false"/>
        <do_if value="global.$GT_TradeCache? and typeof global.$GT_TradeCache == datatype.list">
          <set_value name="$isLegacyList" exact="true"/>
        </do_if>

        <set_value name="$homeKeys" exact="[]"/>
        <do_if value="not $isLegacyList">
          <!-- Prefer homes registry only if it exists AND is non-empty; otherwise fall back to GT_TradeCache.keys.
               Some saves can end up with cache keys but an empty registry, which made dumps show total=0 incorrectly. -->
          <do_if value="global.$GT_TradeCacheHomes? and global.$GT_TradeCacheHomes != null and typeof global.$GT_TradeCacheHomes == datatype.list and global.$GT_TradeCacheHomes.count gt 0">
            <set_value name="$homeKeys" exact="@global.$GT_TradeCacheHomes"/>
          </do_if>
          <do_else>
            <set_value name="$cacheObj" exact="@global.$GT_TradeCache"/>
            <set_value name="$homeKeys" exact="@$cacheObj.keys"/>
            <do_if value="$homeKeys == null">
              <set_value name="$homeKeys" exact="[]"/>
            </do_if>
          </do_else>
        </do_if>

        <set_value name="global.$GT_CacheDumpState" exact="table[
          $Active = true,
          $Cancel = false,
          $StartedAt = player.age,
          $LegacyList = $isLegacyList,
          $HomeKeys = $homeKeys,
          $HomeIndex = 1,
          $EntryIndex = 1,
          $Total = $total,
          $Lines = 0,
          $CurrentHomeHeaderPrinted = false,
          $DockShip = if global.$GT_LastTradeRequestShip? and global.$GT_LastTradeRequestShip.exists then global.$GT_LastTradeRequestShip else null
        ]"/>

        <debug_text text="'[GT-Cache-Dump] BEGIN t=' + (player.age / 1) + 's total=' + $total + ' legacyList=' + $isLegacyList + ' homeKeys=' + $homeKeys.count" chance="100"/>

        <signal_cue_instantly cue="md.GT_GlobalSettings.GT_DumpTradeCache_Process"/>
      </actions>
    </cue>

    <!-- Cache dump worker (chunked across frames) -->
    <cue name="GT_DumpTradeCache_Process" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <delay min="10ms" max="40ms"/>
      <actions>
        <do_if value="not global.$GT_CacheDumpState? or not global.$GT_CacheDumpState.$Active? or not global.$GT_CacheDumpState.$Active">
          <cancel_cue cue="this"/>
        </do_if>

        <do_if value="global.$GT_CacheDumpState.$Cancel">
          <set_value name="global.$GT_CacheDumpState.$Active" exact="false"/>
          <debug_text text="'[GT-Cache-Dump] CANCELLED after lines=' + global.$GT_CacheDumpState.$Lines" chance="100"/>
          <show_notification text="'[GT] Cache dump cancelled.'" timeout="4s"/>
          <cancel_cue cue="this"/>
        </do_if>

        <set_value name="$maxLinesPerTick" exact="40"/>
        <set_value name="$emitted" exact="0"/>

        <do_while value="$emitted lt $maxLinesPerTick and global.$GT_CacheDumpState.$Active">
          <do_if value="global.$GT_CacheDumpState.$LegacyList">
            <!-- Legacy list-shaped cache -->
            <set_value name="$sectorCache" exact="@global.$GT_TradeCache"/>
            <do_if value="not $sectorCache? or $sectorCache == null or not $sectorCache.count?">
              <set_value name="global.$GT_CacheDumpState.$Active" exact="false"/>
              <break/>
            </do_if>

            <do_if value="not global.$GT_CacheDumpState.$CurrentHomeHeaderPrinted">
              <debug_text text="'[GT-Cache-Dump] HOME [GT_TradeCache legacy list] entries=' + $sectorCache.count" chance="100"/>
              <set_value name="global.$GT_CacheDumpState.$Lines" operation="add"/>
              <set_value name="global.$GT_CacheDumpState.$CurrentHomeHeaderPrinted" exact="true"/>
              <set_value name="$emitted" operation="add"/>
            </do_if>

            <set_value name="$i" exact="global.$GT_CacheDumpState.$EntryIndex"/>
            <do_if value="$i gt $sectorCache.count">
              <set_value name="global.$GT_CacheDumpState.$Active" exact="false"/>
              <break/>
            </do_if>

            <set_value name="$e" exact="$sectorCache.{$i}"/>
            <set_value name="global.$GT_CacheDumpState.$EntryIndex" operation="add"/>
          </do_if>
          <do_else>
            <!-- Normal shape: per-home-sector lists -->
            <set_value name="$homeKeys" exact="@global.$GT_CacheDumpState.$HomeKeys"/>
            <set_value name="$hi" exact="global.$GT_CacheDumpState.$HomeIndex"/>

            <do_if value="not $homeKeys? or $homeKeys == null or $hi gt $homeKeys.count">
              <set_value name="global.$GT_CacheDumpState.$Active" exact="false"/>
              <break/>
            </do_if>

            <set_value name="$home" exact="$homeKeys.{$hi}"/>
            <set_value name="$sectorCache" exact="@global.$GT_TradeCache.{$home}"/>
            <do_if value="$sectorCache == null or not $sectorCache.count? or $sectorCache.count le 0">
              <!-- Move to next home -->
              <set_value name="global.$GT_CacheDumpState.$HomeIndex" operation="add"/>
              <set_value name="global.$GT_CacheDumpState.$EntryIndex" exact="1"/>
              <set_value name="global.$GT_CacheDumpState.$CurrentHomeHeaderPrinted" exact="false"/>
              <continue/>
            </do_if>

            <do_if value="not global.$GT_CacheDumpState.$CurrentHomeHeaderPrinted">
              <set_value name="$homeName" exact="@$home.knownname"/>
              <do_if value="not $homeName?">
                <set_value name="$homeName" exact="'[unknown home sector]'"/>
              </do_if>
              <debug_text text="'[GT-Cache-Dump] HOME ' + $homeName + ' entries=' + $sectorCache.count" chance="100"/>
              <set_value name="global.$GT_CacheDumpState.$Lines" operation="add"/>
              <set_value name="global.$GT_CacheDumpState.$CurrentHomeHeaderPrinted" exact="true"/>
              <set_value name="$emitted" operation="add"/>
            </do_if>

            <set_value name="$i" exact="global.$GT_CacheDumpState.$EntryIndex"/>
            <do_if value="$i gt $sectorCache.count">
              <!-- Next home -->
              <set_value name="global.$GT_CacheDumpState.$HomeIndex" operation="add"/>
              <set_value name="global.$GT_CacheDumpState.$EntryIndex" exact="1"/>
              <set_value name="global.$GT_CacheDumpState.$CurrentHomeHeaderPrinted" exact="false"/>
              <continue/>
            </do_if>

            <set_value name="$e" exact="$sectorCache.{$i}"/>
            <set_value name="global.$GT_CacheDumpState.$EntryIndex" operation="add"/>
          </do_else>

          <!-- Dump entry (best-effort safe reads) -->
          <do_if value="$e != null">
            <set_value name="$buyOffer" exact="@$e.$BuyOffer"/>
            <set_value name="$sellOffer" exact="@$e.$SellOffer"/>
            <set_value name="$amount" exact="@$e.$Amount"/>
            <do_if value="$amount == null">
              <set_value name="$amount" exact="0"/>
            </do_if>

            <set_value name="$buyPriceRaw" exact="@$e.$BuyPrice"/>
            <do_if value="$buyPriceRaw == null">
              <set_value name="$buyPriceRaw" exact="0"/>
            </do_if>
            <set_value name="$sellPriceRaw" exact="@$e.$SellPrice"/>
            <do_if value="$sellPriceRaw == null">
              <set_value name="$sellPriceRaw" exact="0"/>
            </do_if>
            <set_value name="$score" exact="@$e.$Score"/>
            <do_if value="$score == null">
              <set_value name="$score" exact="0"/>
            </do_if>

            <set_value name="$failCount" exact="@$e.$FailCount"/>
            <do_if value="$failCount == null">
              <set_value name="$failCount" exact="0"/>
            </do_if>
            <set_value name="$failedShips" exact="@$e.$FailedShips"/>
            <set_value name="$failedShipsCount" exact="0"/>
            <do_if value="$failedShips != null and $failedShips.count?">
              <set_value name="$failedShipsCount" exact="$failedShips.count"/>
            </do_if>

            <set_value name="$dockShip" exact="@global.$GT_CacheDumpState.$DockShip"/>
            <set_value name="$buyDockOk" exact="null"/>
            <set_value name="$sellDockOk" exact="null"/>
            <do_if value="$dockShip? and $dockShip != null and $dockShip.exists and $buyOffer != null and $sellOffer != null">
              <set_value name="$buyDockOk" exact="@$buyOffer.owner.dockingallowed.{$dockShip}"/>
              <set_value name="$sellDockOk" exact="@$sellOffer.owner.dockingallowed.{$dockShip}"/>
            </do_if>

            <set_value name="$wareObj" exact="@$buyOffer.ware"/>
            <set_value name="$wareName" exact="if $e.$WareName? then $e.$WareName else @$wareObj.name"/>
            <do_if value="not $wareName?">
              <set_value name="$wareName" exact="'[unknown ware]'"/>
            </do_if>

            <set_value name="$roi" exact="@$e.$ROI"/>
            <do_if value="$roi == null">
              <set_value name="$roi" exact="-1"/>
            </do_if>

            <set_value name="$profit" exact="@$e.$Profit"/>
            <do_if value="$profit == null">
              <set_value name="$profit" exact="0"/>
            </do_if>

            <set_value name="$dist" exact="@$e.$Distance"/>
            <do_if value="$dist == null">
              <set_value name="$dist" exact="-1"/>
            </do_if>

            <set_value name="$age" exact="-1"/>
            <do_if value="$e.$Timestamp? and $e.$Timestamp != null">
              <set_value name="$age" exact="(player.age - $e.$Timestamp) / 1"/>
            </do_if>

            <set_value name="$buyName" exact="@$buyOffer.owner.knownname"/>
            <do_if value="not $buyName?">
              <set_value name="$buyName" exact="'[unknown buy]'"/>
            </do_if>
            <set_value name="$sellName" exact="@$sellOffer.owner.knownname"/>
            <do_if value="not $sellName?">
              <set_value name="$sellName" exact="'[unknown sell]'"/>
            </do_if>

            <debug_text text="'[GT-Cache-Dump]  ' + ($i / 1) +
              ' ware=' + $wareName +
              ' amount=' + $amount +
              ' buyP=' + ($buyPriceRaw / 100) + 'Cr' +
              ' sellP=' + ($sellPriceRaw / 100) + 'Cr' +
              ' roi=' + ($roi / 1) + '%' +
              ' profit=' + ($profit / 100) + 'Cr' +
              ' score=' + $score +
              ' dist=' + $dist +
              ' age=' + $age + 's' +
              ' fail=' + $failCount +
              ' failedShips=' + $failedShipsCount +
              ' dock=' + (if $buyDockOk? then $buyDockOk else 'n/a') + '/' + (if $sellDockOk? then $sellDockOk else 'n/a') +
              ' buy=' + $buyName +
              ' sell=' + $sellName" chance="100"/>
            <set_value name="global.$GT_CacheDumpState.$Lines" operation="add"/>
            <set_value name="$emitted" operation="add"/>
          </do_if>
        </do_while>

        <do_if value="not global.$GT_CacheDumpState.$Active">
          <set_value name="$dur" exact="player.age - global.$GT_CacheDumpState.$StartedAt"/>
          <debug_text text="'[GT-Cache-Dump] END lines=' + global.$GT_CacheDumpState.$Lines + ' durationMs=' + ($dur / 1ms)" chance="100"/>
          <show_notification text="'[GT] Cache dump finished. (lines=' + global.$GT_CacheDumpState.$Lines + ')'" timeout="6s" priority="5"/>
          <cancel_cue cue="this"/>
        </do_if>

        <!-- Continue next chunk -->
        <do_if value="global.$GT_CacheDumpState? and global.$GT_CacheDumpState.$Active? and global.$GT_CacheDumpState.$Active">
          <signal_cue_instantly cue="md.GT_GlobalSettings.GT_DumpTradeCache_Process"/>
        </do_if>
      </actions>
    </cue>

    <!-- Release All Search Locks Button Handler -->
    <cue name="GT_ReleaseAllLocks" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Release All Locks button clicked'" chance="100"/>
        </do_if>

        <set_value name="$released" exact="0"/>
        <do_if value="global.$GT_SearchLocks? and global.$GT_SearchLocks.keys.count gt 0">
          <!-- Snapshot keys list; releasing locks mutates the table -->
          <set_value name="$lockKeys" exact="global.$GT_SearchLocks.keys.list"/>
          <do_all exact="$lockKeys.count" counter="$i">
            <set_value name="$ship" exact="$lockKeys.{$i}"/>
            <!-- stale_lock_cleanup triggers deep cleanup in GT_RequestRegistry_Release (live/batch queues, slice state, cooldowns) -->
            <run_actions ref="md.GT_Libraries_General.GT_RequestRegistry_Release">
              <param name="ship" value="$ship"/>
              <param name="reason" value="'stale_lock_cleanup'"/>
            </run_actions>

            <!-- Also clear scheduler active marker for this ship, if present -->
            <do_if value="global.$GT_Scheduler? and global.$GT_Scheduler.$ActiveWork? and global.$GT_Scheduler.$ActiveWork.{$ship}?">
              <remove_value name="global.$GT_Scheduler.$ActiveWork.{$ship}"/>
            </do_if>

            <set_value name="$released" operation="add"/>
          </do_all>
        </do_if>

        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Release All Locks complete: released=' + $released" chance="100"/>
        </do_if>
      </actions>
    </cue>

    <!-- Dump Trade Hub Status Button Handler -->
    <!-- On-demand snapshot: scheduler queue/work + per-ship hub request status (and last requester) -->
    <cue name="GT_DumpTradeHubStatus" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <set_value name="$tsQueue" exact="if global.$GT_TS? and global.$GT_TS.$Queue? then global.$GT_TS.$Queue.count else 0"/>
        <set_value name="$workQueue" exact="if global.$GT_Scheduler? and global.$GT_Scheduler.$WorkQueue? then global.$GT_Scheduler.$WorkQueue.count else 0"/>
        <set_value name="$activeWork" exact="if global.$GT_Scheduler? and global.$GT_Scheduler.$ActiveWork? then global.$GT_Scheduler.$ActiveWork.keys.count else 0"/>
        <set_value name="$statusCount" exact="if global.$GT_RequestStatus? then global.$GT_RequestStatus.keys.count else 0"/>

        <!-- Build a compact summary and show to player -->
        <set_value name="$msg" exact="'[GT] Trade Hub Snapshot\n'"/>
        <set_value name="$msg" exact="$msg + 'Queue: ' + $tsQueue + ' | WorkQueue: ' + $workQueue + ' | ActiveWork: ' + $activeWork + '\n'"/>
        <set_value name="$msg" exact="$msg + 'RequestStatus entries: ' + $statusCount + '\n'"/>

        <!-- Cache coverage summary (matchable wares coverage).
             Goal: quickly validate that the cache is being filled broadly (many wares) and deeply (enough entries/ware),
             without flooding the log like the full cache dump. -->
        <set_value name="$cacheTotal" exact="0"/>
        <run_actions ref="md.GT_Libraries_General.GT_CalculateTotalCacheCount" result="$cacheTotal"/>
        <set_value name="$cacheHomes" exact="0"/>
        <set_value name="$homeKeys" exact="[]"/>
        <!-- Prefer homes registry only if it exists AND is non-empty; otherwise fall back to GT_TradeCache.keys. -->
        <do_if value="global.$GT_TradeCacheHomes? and global.$GT_TradeCacheHomes != null and typeof global.$GT_TradeCacheHomes == datatype.list and global.$GT_TradeCacheHomes.count gt 0">
          <set_value name="$homeKeys" exact="@global.$GT_TradeCacheHomes"/>
        </do_if>
        <do_else>
          <do_if value="global.$GT_TradeCache?">
            <set_value name="$cacheObj" exact="@global.$GT_TradeCache"/>
            <set_value name="$homeKeys" exact="@$cacheObj.keys"/>
            <do_if value="$homeKeys == null">
              <set_value name="$homeKeys" exact="[]"/>
            </do_if>
          </do_if>
        </do_else>
        <set_value name="$cacheHomes" exact="$homeKeys.count"/>

        <set_value name="$targetPerWare" exact="20"/>
        <do_if value="global.$GT_GlobalSettings? and global.$GT_GlobalSettings.$Performance? and global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare?">
          <set_value name="$targetPerWare" exact="@global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare"/>
        </do_if>
        <do_if value="$targetPerWare lt 1">
          <set_value name="$targetPerWare" exact="1"/>
        </do_if>

        <set_value name="$msg" exact="$msg + 'Cache: total=' + $cacheTotal + ' homes=' + $cacheHomes + ' targetPerWare=' + $targetPerWare + '\n'"/>

        <do_if value="$cacheHomes gt 0 and global.$GT_TradeCache?">
          <set_value name="$maxHomesToShow" exact="5"/>
          <set_value name="$homesShown" exact="0"/>
          <do_all exact="$homeKeys.count" counter="$hk">
            <do_if value="$homesShown ge $maxHomesToShow">
              <break/>
            </do_if>
            <set_value name="$home" exact="$homeKeys.{$hk}"/>
            <set_value name="$sectorCache" exact="@global.$GT_TradeCache.{$home}"/>
            <do_if value="$sectorCache == null or not $sectorCache.count?">
              <continue/>
            </do_if>
            <set_value name="$homesShown" operation="add"/>

            <set_value name="$homeName" exact="@$home.knownname"/>
            <do_if value="not $homeName?">
              <set_value name="$homeName" exact="'[unknown home]'"/>
            </do_if>

            <!-- Build per-ware counts (by ware name) -->
            <set_value name="$wareSummary" exact="[]"/>
            <set_value name="$scanLimit" exact="2000"/>
            <set_value name="$scanCount" exact="[$sectorCache.count, $scanLimit].min"/>
            <do_all exact="$scanCount" counter="$ci">
              <set_value name="$e" exact="$sectorCache.{$ci}"/>
              <do_if value="$e == null">
                <continue/>
              </do_if>
              <set_value name="$wareObj" exact="@$e.$BuyOffer.ware"/>
              <set_value name="$wareName" exact="if $e.$WareName? then $e.$WareName else @$wareObj.name"/>
              <do_if value="not $wareName?">
                <set_value name="$wareName" exact="'[unknown ware]'"/>
              </do_if>
              <set_value name="$found" exact="false"/>
              <do_all exact="$wareSummary.count" counter="$wi">
                <do_if value="$wareSummary.{$wi}.$WareName == $wareName">
                  <set_value name="$wareSummary.{$wi}.$Count" exact="$wareSummary.{$wi}.$Count + 1"/>
                  <set_value name="$found" exact="true"/>
                  <break/>
                </do_if>
              </do_all>
              <do_if value="not $found">
                <append_to_list name="$wareSummary" exact="table[$WareName = $wareName, $Count = 1]"/>
              </do_if>
            </do_all>

            <set_value name="$distinctWares" exact="$wareSummary.count"/>
            <set_value name="$underfilled" exact="0"/>
            <set_value name="$underList" exact="''"/>
            <set_value name="$underShown" exact="0"/>
            <do_all exact="$wareSummary.count" counter="$wi">
              <set_value name="$row" exact="$wareSummary.{$wi}"/>
              <set_value name="$c" exact="if $row.$Count? then $row.$Count else 0"/>
              <do_if value="$c lt $targetPerWare">
                <set_value name="$underfilled" exact="$underfilled + 1"/>
                <do_if value="$underShown lt 8">
                  <set_value name="$underList" exact="$underList + (if $row.$WareName? then $row.$WareName else 'unknown') + '(' + $c + ') '"/>
                  <set_value name="$underShown" operation="add"/>
                </do_if>
              </do_if>
            </do_all>

            <set_value name="$msg" exact="$msg + '  HOME ' + $homeName + ': entries=' + $sectorCache.count + ' distinctWares=' + $distinctWares + ' underfilled=' + $underfilled"/>
            <do_if value="$underfilled gt 0">
              <set_value name="$msg" exact="$msg + ' sample=' + $underList"/>
            </do_if>
            <set_value name="$msg" exact="$msg + '\n'"/>
          </do_all>
        </do_if>

        <!-- Stage histogram (on-demand only).
             IMPORTANT: MD does not support dynamic table keys in set_value name="$table.{$key}".
             Use a list of rows ([$Stage,$Count]) instead. -->
        <set_value name="$stageCounts" exact="[]"/>
        <do_if value="global.$GT_RequestStatus? and global.$GT_RequestStatus.keys.count gt 0">
          <set_value name="$keys" exact="global.$GT_RequestStatus.keys.list"/>
          <set_value name="$maxScan" exact="200"/>
          <set_value name="$scan" exact="[$keys.count, $maxScan].min"/>
          <do_all exact="$scan" counter="$i">
            <set_value name="$ship" exact="$keys.{$i}"/>
            <set_value name="$st" exact="if global.$GT_RequestStatus.{$ship}? and global.$GT_RequestStatus.{$ship}.$Stage? then global.$GT_RequestStatus.{$ship}.$Stage else 'unknown'"/>
            <set_value name="$foundStage" exact="false"/>
            <do_all exact="$stageCounts.count" counter="$si">
              <do_if value="$stageCounts.{$si}? and $stageCounts.{$si}.$Stage? and $stageCounts.{$si}.$Stage == $st">
                <set_value name="$stageCounts.{$si}.$Count" exact="if $stageCounts.{$si}.$Count? then ($stageCounts.{$si}.$Count + 1) else 1"/>
                <set_value name="$foundStage" exact="true"/>
                <break/>
              </do_if>
            </do_all>
            <do_if value="not $foundStage">
              <append_to_list name="$stageCounts" exact="table[$Stage = $st, $Count = 1]"/>
            </do_if>
          </do_all>
        </do_if>
        <do_if value="$stageCounts.count gt 0">
          <set_value name="$msg" exact="$msg + 'Stages (sample up to 200): '"/>
          <set_value name="$shown" exact="0"/>
          <do_all exact="$stageCounts.count" counter="$k">
            <do_if value="$shown lt 8">
              <set_value name="$row" exact="$stageCounts.{$k}"/>
              <set_value name="$msg" exact="$msg + (if $row.$Stage? then $row.$Stage else 'unknown') + '=' + (if $row.$Count? then $row.$Count else 0) + ' '"/>
              <set_value name="$shown" operation="add"/>
            </do_if>
          </do_all>
          <set_value name="$msg" exact="$msg + '\n'"/>
        </do_if>

        <!-- Last requester details (if available) -->
        <set_value name="$lastShip" exact="@global.$GT_LastTradeRequestShip"/>
        <do_if value="$lastShip? and $lastShip.exists">
          <set_value name="$msg" exact="$msg + 'LastRequest: ' + $lastShip.idcode + ' @ ' + (if global.$GT_LastTradeRequestTime? then global.$GT_LastTradeRequestTime else 0) + '\n'"/>
          <do_if value="global.$GT_RequestStatus? and global.$GT_RequestStatus.{$lastShip}?">
            <set_value name="$st" exact="if global.$GT_RequestStatus.{$lastShip}.$Stage? then global.$GT_RequestStatus.{$lastShip}.$Stage else 'unknown'"/>
            <set_value name="$state" exact="if global.$GT_RequestStatus.{$lastShip}.$State? then global.$GT_RequestStatus.{$lastShip}.$State else 'unknown'"/>
            <set_value name="$reason" exact="if global.$GT_RequestStatus.{$lastShip}.$Reason? then global.$GT_RequestStatus.{$lastShip}.$Reason else ''"/>
            <set_value name="$trace" exact="if global.$GT_RequestStatus.{$lastShip}.$TraceId? then global.$GT_RequestStatus.{$lastShip}.$TraceId else ''"/>
            <set_value name="$msg" exact="$msg + '  Status: ' + $st + '/' + $state + ' reason=' + $reason + ' trace=' + $trace + '\n'"/>
          </do_if>
          <do_else>
            <set_value name="$msg" exact="$msg + '  Status: (no GT_RequestStatus entry)\n'"/>
          </do_else>
          <do_if value="global.$GT_TS? and global.$GT_TS.$Queued? and global.$GT_TS.$Queued.{$lastShip}?">
            <set_value name="$msg" exact="$msg + '  SchedulerQueue: queued=true\n'"/>
          </do_if>
        </do_if>

        <show_notification text="$msg" timeout="10s" priority="5"/>

        <!-- Always print to debug log for on-demand diagnostics (button-triggered, not periodic). -->
        <debug_text text="$msg" chance="100"/>
      </actions>
    </cue>
    
    <!-- Price Range Update Handler (converts percentage to normalized value for GT_Config) -->
    <cue name="GT_PriceRange_Update" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] PriceRangeUpdate called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Simple Menu API passes a table with $value (percentage -100 to +100) and $echo -->
            <set_value name="$percentageValue" exact="null"/>
            <set_value name="$section" exact="null"/>
            <set_value name="$setting" exact="null"/>
            
            <!-- Get the percentage value from $value -->
            <do_if value="event.param.$value?">
              <set_value name="$percentageValue" exact="event.param.$value"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Price range percentage value: ' + $percentageValue + '%'" chance="100"/>
              </do_if>
            </do_if>
            
            <!-- Get the echo data from $echo -->
            <do_if value="event.param.$echo? and event.param.$echo.$section? and event.param.$echo.$setting?">
              <set_value name="$section" exact="event.param.$echo.$section"/>
              <set_value name="$setting" exact="event.param.$echo.$setting"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Echo data - Section: ' + $section + ', Setting: ' + $setting" chance="100"/>
              </do_if>
            </do_if>
            
            <!-- Convert percentage to normalized value and update GT_Config -->
            <do_if value="$percentageValue? and $section and $setting">
              <!-- Convert percentage (-100 to +100) to normalized (-1.0 to +1.0) -->
              <set_value name="$normalizedValue" exact="$percentageValue / 100"/>
              
              <!-- Ensure GT_Config.$Trading exists -->
              <do_if value="not global.$GT_Config?">
                <set_value name="global.$GT_Config" exact="table[]"/>
              </do_if>
              <do_if value="not global.$GT_Config.$Trading?">
                <set_value name="global.$GT_Config.$Trading" exact="table[]"/>
              </do_if>
              
              <!-- Update the setting in GT_Config.$Trading -->
              <set_value name="global.$GT_Config.$Trading.{$setting}" exact="$normalizedValue"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Price range updated: GT_Config.$Trading.' + $setting + ' = ' + $normalizedValue + ' (' + $percentageValue + '%)'" chance="100"/>
              </do_if>
            </do_if>
            <do_else>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] ERROR: Missing required parameters for price range update'" chance="100"/>
              </do_if>
            </do_else>
      </actions>
    </cue>

    <!-- Trading MinAbsoluteProfit Base Update Handler (Cr slider -> RAW centicredits in GT_Config) -->
    <cue name="GT_MinProfitBase_Update" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <set_value name="$newValue" exact="null"/>
        <set_value name="$section" exact="null"/>
        <set_value name="$setting" exact="null"/>
        <do_if value="event.param.$value?">
          <set_value name="$newValue" exact="event.param.$value"/>
        </do_if>
        <do_if value="event.param.$echo? and event.param.$echo.$section? and event.param.$echo.$setting?">
          <set_value name="$section" exact="event.param.$echo.$section"/>
          <set_value name="$setting" exact="event.param.$echo.$setting"/>
        </do_if>

        <!-- Slider value is in Cr, range 0..500; store in RAW centicredits -->
        <do_if value="$newValue? and $newValue != null and $section == '$Trading' and $setting == '$MinAbsoluteProfit'">
          <set_value name="$clamped" exact="[$newValue, 0].max"/>
          <set_value name="$clamped" exact="[$clamped, 500].min"/>
          <set_value name="$raw" exact="$clamped * 100"/>

          <do_if value="not global.$GT_Config?">
            <set_value name="global.$GT_Config" exact="table[]"/>
          </do_if>
          <do_if value="not global.$GT_Config.$Trading?">
            <set_value name="global.$GT_Config.$Trading" exact="table[]"/>
          </do_if>
          <set_value name="global.$GT_Config.$Trading.$MinAbsoluteProfit" exact="$raw"/>

          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT-Settings] Updated GT_Config.$Trading.$MinAbsoluteProfit base = ' + $clamped + ' Cr (' + $raw + ' RAW)'" chance="100"/>
          </do_if>

          <!-- NOTE: Do NOT call Refresh_Menu here â€” it destroys and recreates the slider mid-interaction,
               causing widget_fullscreen.lua to access a destroyed slidercellElement (nil crash).
               The slider already displays the correct value; no refresh needed (consistent with GT_PriceRange_Update). -->
        </do_if>
      </actions>
    </cue>
    
    <!-- Slider Value Update Handler -->
    <!-- Reset Profit Statistics Button Handler -->
    <cue name="GT_ResetProfitStats" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Reset Profit Statistics button clicked - triggering migration'" chance="100"/>
        </do_if>
        
        <!-- Trigger the profit statistics reset -->
        <signal_cue_instantly cue="md.GT_Profit_Migration.ResetInflatedProfitStats"/>
        
        <!-- Refresh the menu -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
    
    <!-- Clear All Blacklisted Sectors Button Handler -->
    <cue name="GT_ClearAllBlacklistedSectors" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Clear All Blacklisted Sectors button clicked'" chance="100"/>
        </do_if>
        
        <!-- Count sectors before clearing -->
        <set_value name="$sectorCount" exact="0"/>
        <do_if value="global.$GT_ThreatIntelligence?">
          <set_value name="$sectorCount" exact="global.$GT_ThreatIntelligence.keys.count"/>
        </do_if>
        
        <!-- Clear all threat intelligence data FIRST (before sending Lua signal) -->
        <do_if value="global.$GT_ThreatIntelligence?">
          <remove_value name="global.$GT_ThreatIntelligence"/>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT-Settings] Cleared ' + $sectorCount + ' blacklisted sectors from threat intelligence'" chance="100"/>
          </do_if>
        </do_if>
        
        <!-- Update blacklist - send empty string to Lua to clear all sectors -->
        <!-- This MUST happen AFTER clearing global.$GT_ThreatIntelligence to prevent repopulation -->
        <!-- Always send to Lua regardless of UseDynamicBlacklist setting - there may be existing blacklisted sectors -->
        <raise_lua_event name="'GT_Blacklist.Update'" param="''"/>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Sent empty blacklist to Lua to clear all sectors'" chance="100"/>
        </do_if>
        
        <!-- Apply cleared blacklist to all ships to actually remove blacklists from ship pathfinding -->
        <!-- ApplyBlacklistToFleet will check UseDynamicBlacklist internally, but we signal it anyway -->
        <!-- This ensures ships stop avoiding sectors even if threat avoidance is currently disabled -->
        <signal_cue_instantly cue="md.GT_ThreatIntelligence.ApplyBlacklistToFleet"/>
        
        <!-- Note: We do NOT signal UpdateBlacklistOnThreat here because:
             - global.$GT_ThreatIntelligence is already cleared
             - UpdateBlacklistOnThreat would check if it exists and do nothing anyway
             - Sending empty string to Lua directly is sufficient -->
        
        <!-- Show notification to player -->
        <do_if value="$sectorCount gt 0">
          <show_notification text="'Cleared ' + $sectorCount + ' blacklisted sectors'" timeout="5s"/>
        </do_if>
        <do_else>
          <show_notification text="'No blacklisted sectors to clear'" timeout="3s"/>
        </do_else>
        
        <!-- Refresh the menu -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
    
    <!-- Reset All Settings to Defaults Button Handler -->
    <cue name="GT_ResetAllSettings" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] Reset All Settings to Defaults button clicked'" chance="100"/>
        </do_if>
        
        <!-- Reset all global settings to defaults by re-running initialization logic -->
        <!-- XP and Training Settings -->
        <set_value name="global.$GT_GlobalSettings.$XP" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$XP.$AutoTraining" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$XP.$XPMultiplier" exact="100"/>
        <set_value name="global.$GT_GlobalSettings.$XP.$MinTrainingDistance" exact="5"/>
        <set_value name="global.$GT_GlobalSettings.$XP.$TrainingCooldown" exact="600s"/>
        <set_value name="global.$GT_GlobalSettings.$XP.$CommanderBonusPercent" exact="10"/>
        
        <!-- Fleet Coordination Settings -->
        <set_value name="global.$GT_GlobalSettings.$Fleet" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$EnableFleetCoordination" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$EnableTradeCache" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheProfitThreshold" exact="5"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheDropoffTolerance" exact="15"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$CacheTTL" exact="300s"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$MaxCachedRoutes" exact="50"/>
        <set_value name="global.$GT_GlobalSettings.$Fleet.$ZeroTradeCooldown" exact="30s"/>
        
        <!-- Notification Settings -->
        <set_value name="global.$GT_GlobalSettings.$Notifications" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$Notifications.$ShowXPGains" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$Notifications.$ShowTradeResults" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$Notifications.$ShowFleetStatus" exact="false"/>
        <set_value name="global.$GT_GlobalSettings.$Notifications.$SimpleReportFrequency" exact="1"/>
        <set_value name="global.$GT_GlobalSettings.$Notifications.$ComprehensiveReportFrequency" exact="30"/>
        
        <!-- Mobile Satellite Intelligence Settings -->
        <set_value name="global.$GT_GlobalSettings.$MobileIntel" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$MobileIntel.$Enable" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$MobileIntel.$SubscriptionDuration" exact="10min"/>
        <set_value name="global.$GT_GlobalSettings.$MobileIntel.$StationCooldown" exact="60s"/>
        
        <!-- Threat Avoidance Settings -->
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$Enabled" exact="false"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$ScanInterval" exact="5s"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$ThreatExpiry" exact="600s"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$HostileRelationThreshold" exact="-0.20"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$UseDynamicBlacklist" exact="false"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$ThreatAvoidance.$BlacklistThreshold" exact="3"/>
        
        <!-- Debug Settings (reset to false by default) -->
        <set_value name="global.$GT_GlobalSettings.$Debug" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$Debug.$EnableDebugLogging" exact="false"/>
        <set_value name="global.$GT_GlobalSettings.$Debug.$DebugLevel" exact="1"/>
        <set_value name="global.$GT_GlobalSettings.$Debug.$TradeEvaluation" exact="false"/>
        
        <!-- Ship Naming Settings -->
        <set_value name="global.$GT_GlobalSettings.$ShipNaming" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$Enabled" exact="false"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayXP" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$XPPosition" exact="'suffix'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayRank" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$RankPosition" exact="'suffix'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayLevel" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$LevelPosition" exact="'suffix'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayStatus" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StatusPosition" exact="'prefix'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayOperationalState" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$OperationalStatePosition" exact="'prefix'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DisplayShipClass" exact="false"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$ShipClassPosition" exact="'suffix'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$DefaultNameSource" exact="'macro.name'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Resupply" exact="'RS'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Repair" exact="'RP'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Maintenance" exact="'MT'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Training" exact="'TR'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Escape" exact="'ES'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Reroute" exact="'RR'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Clearance" exact="'CL'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Blocked" exact="'BL'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Fallback" exact="'FB'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Isolated" exact="'IS'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Trading" exact="'TD'"/>
        <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.$Idle" exact="'ID'"/>
        
        <!-- Auto-Repair Settings -->
        <set_value name="global.$GT_GlobalSettings.$AutoRepair" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$AutoRepair.$Enabled" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$AutoRepair.$HullThreshold" exact="95"/>
        <set_value name="global.$GT_GlobalSettings.$AutoRepair.$MinPilotLevel" exact="12"/>
        
        <!-- Ship Modifications Settings -->
        <set_value name="global.$GT_GlobalSettings.$Modifications" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$Modifications.$Enabled" exact="false"/>
        
        <!-- Performance Settings -->
        <set_value name="global.$GT_GlobalSettings.$Performance" exact="table[]"/>
        <!-- Smoothness > speed: increase delays to distribute load across frames -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$BatchProcessingDelay" exact="120"/> <!-- Delay in milliseconds (1-200) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$ValidationDelay" exact="50"/> <!-- Delay in milliseconds (1-100) -->
        <!-- Separate concurrency for cache (cheap) vs live (expensive) searches -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentCacheSearches" exact="2"/> <!-- Maximum cache work items started per scheduler tick (1-20). Smoothness > speed. -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxConcurrentLiveSearches" exact="1"/> <!-- Maximum concurrent live searches (1-10) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesToReturn" exact="20"/> <!-- Maximum trades to return from cache search (1-100) -->
        <!-- CacheQuery chunking (frame pacing) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryChunkSize" exact="10"/> <!-- Cache entries validated per chunk (10-200). Smaller = smoother. -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWare" exact="200"/> <!-- Maximum offers per ware in live search (50-1000) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxTradesPerWare" exact="20"/> <!-- Maximum trades per ware during batch processing (5-100) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxOffersPerWareForMatching" exact="20"/> <!-- Maximum offers per ware for matching in batch processor (5-100) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$EarlyExitThreshold" exact="2000"/> <!-- Early exit threshold for batch processing (100-10000) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$SearchLockTTL" exact="600"/> <!-- Search lock time-to-live in seconds (60-7200). Self-heals stale locks from old saves. -->
        <!-- Smoothness > speed: higher interval means less frequent heavy offer-slice work per second -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferSliceInterval" exact="500"/> <!-- Live offer slice interval in milliseconds (5-2000) -->
        <!-- Smoothness > speed: cap how many offers are appended from a native query per frame-slice -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$LiveOfferAppendChunkSize" exact="200"/> <!-- Offers appended per append-slice (50-2000) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$BatchChunkSize" exact="5"/> <!-- Batch processing chunk size (5-20) - smaller = smoother -->
        <!-- B5. BACKPRESSURE: Batch processor backlog thresholds -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureSoftThreshold" exact="10"/> <!-- Soft threshold - start applying backpressure (5-50) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$BatchBackpressureHardThreshold" exact="25"/> <!-- Hard threshold - always block new live searches (10-100) -->
        <!-- NEW: Additional performance tuning parameters -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$SectorsPerSlice" exact="1"/> <!-- Sectors processed per slice in live offer collection (1-5). Smaller = smoother. -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$HomeRefreshCooldown" exact="30"/> <!-- Cooldown after home-sector refresh completes (10-120 seconds) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$CacheMissCooldownBase" exact="10"/> <!-- Base cooldown after cache miss before retrying live search (1-30 seconds) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$SchedulerTickInterval" exact="100"/> <!-- Interval between scheduler ticks in milliseconds (50-500) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$TradeFoundSignalDelay" exact="0"/> <!-- Delay before sending GT_Trade_Found signal in milliseconds (0-1000). 0 = immediate (recommended for reliability). Higher = smoother but may cause race conditions. -->
        <!-- Per-tick processing limits -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxCacheQueriesPerTick" exact="1"/> <!-- Maximum cache queries started per tick (1-5) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxSearchContinuationsPerTick" exact="1"/> <!-- Maximum search continuations started per tick (1-5) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxShipsPerTick" exact="1"/> <!-- Maximum ships processed per scheduler tick (1-5) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxItemsPerTick" exact="1"/> <!-- Maximum work items processed per tick (1-5) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$MaxWakePerTick" exact="2"/> <!-- Maximum waiters woken per tick (1-10) -->
        <!-- Cache query settings -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$CacheQueryMaxEntries" exact="5"/> <!-- Maximum cache entries queried per batch (1-100) -->
        <!-- Stale threshold settings -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$StaleThresholdSeconds" exact="300"/> <!-- Live search state stale threshold in seconds (60-600) -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$QueueStaleThresholdSeconds" exact="60"/> <!-- Queue item stale threshold in seconds (30-300) -->
        <!-- Failed trade cache expiration -->
        <set_value name="global.$GT_GlobalSettings.$Performance.$FailedTradeExpirationSeconds" exact="1800"/> <!-- Failed trade cache expiration in seconds (300-3600) -->
        
        <!-- Number Formatting Settings -->
        <set_value name="global.$GT_GlobalSettings.$NumberFormat" exact="table[]"/>
        <set_value name="global.$GT_GlobalSettings.$NumberFormat.$Format" exact="'german'"/>
        <set_value name="global.$GT_GlobalSettings.$NumberFormat.$UseMSuffix" exact="true"/>
        <set_value name="global.$GT_GlobalSettings.$NumberFormat.$MSuffixThreshold" exact="999999"/>
        
        <!-- Trading Price Range Settings (stored in GT_Config.$Trading) -->
        <do_if value="not global.$GT_Config?">
          <set_value name="global.$GT_Config" exact="table[]"/>
        </do_if>
        <do_if value="not global.$GT_Config.$Trading?">
          <set_value name="global.$GT_Config.$Trading" exact="table[]"/>
        </do_if>
        <set_value name="global.$GT_Config.$Trading.$SellPriceMax" exact="1.0"/> <!-- Max: +100% -->
        <set_value name="global.$GT_Config.$Trading.$BuyPriceMin" exact="-1.0"/> <!-- Min: -100% -->
        <set_value name="global.$GT_Config.$Trading.$IsolatedSellPriceMax" exact="1.0"/> <!-- Max: +100% -->
        <set_value name="global.$GT_Config.$Trading.$IsolatedBuyPriceMin" exact="-1.0"/> <!-- Min: -100% -->
        <set_value name="global.$GT_Config.$Trading.$FallbackSellPriceMax" exact="1.0"/> <!-- Max: +100% -->
        <set_value name="global.$GT_Config.$Trading.$FallbackBuyPriceMin" exact="-1.0"/> <!-- Min: -100% -->
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Settings] All global settings reset to defaults'" chance="100"/>
        </do_if>
        
        <!-- Refresh the menu -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
    
    <!-- Recreate Blacklist Button Handler -->
    <cue name="GT_RecreateBlacklist" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Blacklist] Manual blacklist recreation requested via menu button'" chance="100"/>
        </do_if>
        
        <!-- Keep track of the old ID (don't clear it until we have a new one) -->
        <set_value name="$oldID" exact="@global.$GT_BlacklistID"/>
        
        <do_if value="$oldID?">
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT-Blacklist] Current stored ID: ' + $oldID + ' (will attempt to recreate)'" chance="100"/>
          </do_if>
        </do_if>
        <do_else>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT-Blacklist] No stored ID found - will create fresh blacklist'" chance="100"/>
          </do_if>
        </do_else>
        
        <!-- Trigger blacklist recreation by calling dedicated Recreate event -->
        <!-- Only pass relation threshold if BlockEnemyFactions is enabled (default: true) -->
        <set_value name="$blockEnemyFactions" exact="@global.$GT_GlobalSettings.$ThreatAvoidance.$BlockEnemyFactions"/>
        <do_if value="not $blockEnemyFactions?">
          <set_value name="$blockEnemyFactions" exact="true"/> <!-- Default: enabled -->
        </do_if>
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Blacklist] Recreate: BlockEnemyFactions setting: ' + $blockEnemyFactions" chance="100"/>
        </do_if>
        
        <set_value name="$relationValue" exact="''"/>
        <do_if value="$blockEnemyFactions">
          <set_value name="$relationValue" exact="'enemy'"/>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT-Blacklist] Recreate: Enemy faction blocking ENABLED (X4 relation field = &quot;enemy&quot;)'" chance="100"/>
          </do_if>
        </do_if>
        <do_else>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT-Blacklist] Recreate: Enemy faction blocking DISABLED (X4 relation field = &quot;&quot;)'" chance="100"/>
          </do_if>
        </do_else>
        
        <!-- Pass relation|0 to force recreation (Lua will reset initialized flag and recreate) -->
        <set_value name="$initData" exact="$relationValue + '|0'"/>
        <raise_lua_event name="'GT_Blacklist.Recreate'" param="$initData"/>
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Blacklist] Blacklist recreation triggered - StoreBlacklistID cue will update ID when Lua responds'" chance="100"/>
        </do_if>
        
        <!-- Reload existing threats into the newly recreated blacklist -->
        <signal_cue_instantly cue="md.GT_ThreatIntelligence.UpdateBlacklistOnThreat"/>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT-Blacklist] Reloading existing threat data into recreated blacklist'" chance="100"/>
        </do_if>
        
        <!-- Refresh the menu to show any changes -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
    
    <cue name="GT_Slider_Update" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <!-- Debug: Print the entire event parameter structure -->
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] UpdateSliderValue called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Simple Menu API passes a table with $value and $echo -->
            <set_value name="$newValue" exact="null"/>
            <set_value name="$section" exact="null"/>
            <set_value name="$setting" exact="null"/>
            
            <!-- Get the new slider value from $value -->
            <do_if value="event.param.$value?">
              <set_value name="$newValue" exact="event.param.$value"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Slider new value: ' + $newValue" chance="100"/>
              </do_if>
            </do_if>
            
            <!-- Get the echo data from $echo -->
            <do_if value="event.param.$echo? and event.param.$echo.$section? and event.param.$echo.$setting?">
              <set_value name="$section" exact="event.param.$echo.$section"/>
              <set_value name="$setting" exact="event.param.$echo.$setting"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Echo data - Section: ' + $section + ', Setting: ' + $setting" chance="100"/>
              </do_if>
            </do_if>
            
            <!-- Update the setting if we have all required data -->
            <!-- Use explicit existence + null checks (vanilla pattern) -->
            <do_if value="$newValue? and $newValue != null and $section? and $section != null and $setting? and $setting != null">
              <!-- Use the section and setting names directly as they come from the echo parameter -->
              <!-- The global settings structure uses these exact names with dollar signs -->
              <set_value name="$cleanSection" exact="$section"/>
              <set_value name="$cleanSetting" exact="$setting"/>
              
              <!-- Update the setting -->
              <set_value name="global.$GT_GlobalSettings.{$cleanSection}.{$cleanSetting}" exact="$newValue"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Global setting updated: ' + $cleanSection + '.' + $cleanSetting + ' = ' + $newValue" chance="100"/>
              </do_if>
              
              <!-- If cache/live concurrency changed, update in-flight queues so changes apply immediately -->
              <do_if value="$cleanSection == '$Performance' and $cleanSetting == '$MaxConcurrentCacheSearches'">
                <do_if value="global.$GT_SearchQueue?">
                  <set_value name="global.$GT_SearchQueue.$MaxConcurrent" exact="$newValue"/>
                  <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                    <debug_text text="'[GalaxyTrader MK3] Search queue (cache) MaxConcurrent updated to: ' + $newValue" chance="100"/>
                  </do_if>
                </do_if>
              </do_if>
              <do_elseif value="$cleanSection == '$Performance' and $cleanSetting == '$MaxConcurrentLiveSearches'">
                <!-- Hub pipeline: live searches are scheduled via scheduler HomeSearch work items -->
                <do_if value="global.$GT_Scheduler? and global.$GT_Scheduler.$Budgets?">
                  <set_value name="global.$GT_Scheduler.$Budgets.$MaxActiveHomeSearches" exact="$newValue"/>
                  <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                    <debug_text text="'[GalaxyTrader MK3] Scheduler MaxActiveHomeSearches updated to: ' + $newValue" chance="100"/>
                  </do_if>
                </do_if>
              </do_elseif>
            </do_if>
            <do_else>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] ERROR: Missing required parameters - Value: ' + $newValue + ', Section: ' + $section + ', Setting: ' + $setting" chance="100"/>
              </do_if>
            </do_else>
      </actions>
        </cue>
        
    <!-- Relation Threshold Update Handler (converts percentage to normalized value) -->
    <cue name="GT_Relation_Update" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] UpdateRelationThreshold called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Simple Menu API passes a table with $value (percentage -100 to 0) and $echo -->
            <set_value name="$percentageValue" exact="null"/>
            <set_value name="$section" exact="null"/>
            <set_value name="$setting" exact="null"/>
            
            <!-- Get the percentage value from $value -->
            <do_if value="event.param.$value?">
              <set_value name="$percentageValue" exact="event.param.$value"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Relation threshold percentage value: ' + $percentageValue + '%'" chance="100"/>
              </do_if>
            </do_if>
            
            <!-- Get the echo data from $echo -->
            <do_if value="event.param.$echo? and event.param.$echo.$section? and event.param.$echo.$setting?">
              <set_value name="$section" exact="event.param.$echo.$section"/>
              <set_value name="$setting" exact="event.param.$echo.$setting"/>
            </do_if>
            
            <!-- Convert percentage to normalized value and update setting -->
            <!-- Use explicit existence + null checks (vanilla pattern) -->
            <do_if value="$percentageValue? and $percentageValue != null and $section? and $section != null and $setting? and $setting != null">
              <!-- Convert percentage (-100 to 0) to normalized (-1.0 to 0.0) -->
              <set_value name="$normalizedValue" exact="$percentageValue / 100"/>
              
              <!-- Update the setting -->
              <set_value name="global.$GT_GlobalSettings.{$section}.{$setting}" exact="$normalizedValue"/>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] Relation threshold updated: ' + $section + '.' + $setting + ' = ' + $normalizedValue + ' (' + $percentageValue + '%)'" chance="100"/>
              </do_if>
            </do_if>
            <do_else>
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] ERROR: Missing required parameters for relation threshold update'" chance="100"/>
              </do_if>
            </do_else>
      </actions>
    </cue>
    
    <!-- State Abbreviation Update Handler -->
    <cue name="GT_StateAbbreviation_Update" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
            <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
              <debug_text text="'[GalaxyTrader MK3] GT_StateAbbreviation_Update called with event.param: ' + event.param" chance="100"/>
            </do_if>
            
            <!-- Extract text and echo data -->
            <set_value name="$text" exact="event.param.$text"/>
            <set_value name="$state" exact="event.param.$echo.$state"/>
            <set_value name="$setting" exact="event.param.$echo.$setting"/>
            
            <!-- Initialize structure if needed -->
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming" exact="table[]"/>
            </do_if>
            <do_if value="not global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations?">
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations" exact="table[]"/>
            </do_if>
            
            <!-- Store custom abbreviation (trim whitespace and limit length) -->
            <set_value name="$cleanText" exact="$text"/>
            <!-- Trim leading/trailing whitespace (basic approach - X4 doesn't have trim function) -->
            <do_if value="$cleanText != ''">
              <!-- Limit to 12 characters max -->
              <do_if value="$cleanText.length gt 12">
                <set_value name="$cleanText" exact="$cleanText.[1,12]"/>
              </do_if>
              <!-- Store the abbreviation -->
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.{$setting}" exact="$cleanText"/>
              
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] State abbreviation updated: ' + $state + ' (' + $setting + ') = ' + $cleanText" chance="100"/>
              </do_if>
              
              <!-- Update all ship names when abbreviation changes -->
              <signal_cue_instantly cue="md.GT_CoreSystem.UpdateAllShipNames"/>
            </do_if>
            <do_else>
              <!-- Empty text - restore default -->
              <run_actions ref="md.GT_Ship_Management.Get_State_Abbreviation" result="$defaultAbbr">
                <param name="stateType" value="$state"/>
              </run_actions>
              <set_value name="global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations.{$setting}" exact="$defaultAbbr"/>
              
              <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
                <debug_text text="'[GalaxyTrader MK3] State abbreviation reset to default: ' + $state + ' (' + $setting + ') = ' + $defaultAbbr" chance="100"/>
              </do_if>
              
              <!-- Update all ship names -->
              <signal_cue_instantly cue="md.GT_CoreSystem.UpdateAllShipNames"/>
            </do_else>
            
            <!-- Refresh the menu to show updated value -->
            <signal_cue_instantly cue="md.Simple_Menu_API.Refresh_Menu"/>
      </actions>
    </cue>
    
  </cues>
</mdscript>
