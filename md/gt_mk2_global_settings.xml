<?xml version="1.0" encoding="utf-8"?>
<!--
  GalaxyTrader MK2 â€” Global Settings
  Initializes MK2-specific settings table and registers a Simple Menu API options menu.
-->
<mdscript name="GT_MK2_GlobalSettings" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../ORIGINAL_MODS_DO NOT_MODIFY/X4Original/libraries/md.xsd">
  <cues>

    <cue name="MK2_Init" instantiate="true" version="1">
      <conditions>
        <check_any>
          <event_game_loaded/>
          <event_player_created/>
        </check_any>
      </conditions>
      <actions>
        <do_if value="not global.$GT_MK2_GlobalSettings?">
          <set_value name="global.$GT_MK2_GlobalSettings" exact="table[]"/>
        </do_if>

        <do_if value="not global.$GT_MK2_GlobalSettings.$Distribution?">
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution" exact="table[]"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$DefaultMinStorage" exact="20"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$DefaultStaticStorage" exact="40"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$DefaultMaxStorage" exact="70"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$MinimumCargoFillPercent" exact="25"/>
        </do_if>

        <do_if value="not global.$GT_MK2_GlobalSettings.$Notifications?">
          <set_value name="global.$GT_MK2_GlobalSettings.$Notifications" exact="table[]"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Notifications.$EnableTradeNotifications" exact="true"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Notifications.$Verbosity" exact="1"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Notifications.$LogbookEntries" exact="true"/>
        </do_if>

        <do_if value="not global.$GT_MK2_GlobalSettings.$Debug?">
          <set_value name="global.$GT_MK2_GlobalSettings.$Debug" exact="table[]"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Debug.$EnableDebugLogging" exact="false"/>
          <set_value name="global.$GT_MK2_GlobalSettings.$Debug.$DebugLevel" exact="1"/>
        </do_if>
      </actions>
    </cue>

    <cue name="MK2_MenuRegistration" instantiate="true">
      <conditions>
        <event_cue_signalled cue="md.Simple_Menu_API.Reloaded"/>
      </conditions>
      <actions>
        <signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu" param="table[
          $id = 'gt_mk2_settings_menu',
          $columns = 6,
          $title = {77000, 20500},
          $onOpen = MK2_SettingsMenu,
          $defaultFocus = false
        ]"/>
      </actions>
    </cue>

    <cue name="MK2_SettingsMenu" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <!-- Header -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[
          $col = 1,
          $colSpan = 6,
          $text = {77000, 20501},
          $halign = 'center'
        ]"/>

        <!-- Min Storage -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col = 1, $colSpan = 2, $text = {77000, 20510}]"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
          $col = 3, $colSpan = 4,
          $current = global.$GT_MK2_GlobalSettings.$Distribution.$DefaultMinStorage,
          $min = 0, $max = 98, $step = 1,
          $event = md.GT_MK2_GlobalSettings.MK2_UpdateSliderValue,
          $echo = 'mk2_default_minstorage'
        ]"/>

        <!-- Static Storage -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col = 1, $colSpan = 2, $text = {77000, 20511}]"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
          $col = 3, $colSpan = 4,
          $current = global.$GT_MK2_GlobalSettings.$Distribution.$DefaultStaticStorage,
          $min = 1, $max = 99, $step = 1,
          $event = md.GT_MK2_GlobalSettings.MK2_UpdateSliderValue,
          $echo = 'mk2_default_staticstorage'
        ]"/>

        <!-- Max Storage -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col = 1, $colSpan = 2, $text = {77000, 20512}]"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
          $col = 3, $colSpan = 4,
          $current = global.$GT_MK2_GlobalSettings.$Distribution.$DefaultMaxStorage,
          $min = 2, $max = 100, $step = 1,
          $event = md.GT_MK2_GlobalSettings.MK2_UpdateSliderValue,
          $echo = 'mk2_default_maxstorage'
        ]"/>

        <!-- Minimum Cargo Fill -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col = 1, $colSpan = 2, $text = {77000, 20514}]"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
          $col = 3, $colSpan = 4,
          $current = global.$GT_MK2_GlobalSettings.$Distribution.$MinimumCargoFillPercent,
          $min = 10, $max = 100, $step = 5,
          $event = md.GT_MK2_GlobalSettings.MK2_UpdateSliderValue,
          $echo = 'mk2_min_cargo_fill'
        ]"/>

        <!-- Notification level -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col = 1, $colSpan = 2, $text = {77000, 20520}]"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
          $col = 3, $colSpan = 4,
          $current = global.$GT_MK2_GlobalSettings.$Notifications.$Verbosity,
          $min = 0, $max = 2, $step = 1,
          $event = md.GT_MK2_GlobalSettings.MK2_UpdateSliderValue,
          $echo = 'mk2_notifications_verbosity'
        ]"/>

        <!-- Debug level -->
        <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text" param="table[$col = 1, $colSpan = 2, $text = {77000, 20521}]"/>
        <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider" param="table[
          $col = 3, $colSpan = 4,
          $current = global.$GT_MK2_GlobalSettings.$Debug.$DebugLevel,
          $min = 0, $max = 2, $step = 1,
          $event = md.GT_MK2_GlobalSettings.MK2_UpdateSliderValue,
          $echo = 'mk2_debug_level'
        ]"/>
      </actions>
    </cue>

    <cue name="MK2_UpdateSliderValue" instantiate="true">
      <conditions>
        <event_cue_signalled/>
      </conditions>
      <actions>
        <set_value name="$data" exact="event.param"/>
        <set_value name="$echo" exact="$data.$echo"/>
        <set_value name="$value" exact="$data.$value"/>

        <do_if value="$echo == 'mk2_default_minstorage'">
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$DefaultMinStorage" exact="$value"/>
        </do_if>
        <do_elseif value="$echo == 'mk2_default_staticstorage'">
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$DefaultStaticStorage" exact="$value"/>
        </do_elseif>
        <do_elseif value="$echo == 'mk2_default_maxstorage'">
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$DefaultMaxStorage" exact="$value"/>
        </do_elseif>
        <do_elseif value="$echo == 'mk2_min_cargo_fill'">
          <set_value name="global.$GT_MK2_GlobalSettings.$Distribution.$MinimumCargoFillPercent" exact="$value"/>
        </do_elseif>
        <do_elseif value="$echo == 'mk2_notifications_verbosity'">
          <set_value name="global.$GT_MK2_GlobalSettings.$Notifications.$Verbosity" exact="$value"/>
        </do_elseif>
        <do_elseif value="$echo == 'mk2_debug_level'">
          <set_value name="global.$GT_MK2_GlobalSettings.$Debug.$DebugLevel" exact="$value"/>
        </do_elseif>
      </actions>
    </cue>

  </cues>
</mdscript>
