<?xml version="1.0" encoding="utf-8"?>
<mdscript name="GT_Pilot_Promotion" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../ORIGINAL_MODS_DO NOT_MODIFY/x4Original/libraries/md.xsd">
  
  <cues>
    <!-- Check if pilot is eligible for promotion -->
    <library name="CheckPilotPromotionEligibility" purpose="run_actions">
      <params>
        <param name="pilot" comment="Pilot entity to check"/>
      </params>
      <actions>
        <set_value name="$eligibleClass" exact="null"/>
        <set_value name="$currentShipClass" exact="null"/>
        
        <!-- Get pilot's current ship -->
        <set_value name="$currentShip" exact="null"/>
        <do_if value="$pilot? and global.$GT_Pilots.{$pilot}? and global.$GT_Pilots.{$pilot}.$Ship?">
          <set_value name="$currentShip" exact="global.$GT_Pilots.{$pilot}.$Ship"/>
        </do_if>
        
        <!-- If no ship assigned, not eligible -->
        <do_if value="not $currentShip? or not $currentShip.exists">
          <return value="table[$EligibleClass=null, $CurrentShipClass=null, $CanPromote=false]"/>
        </do_if>
        
        <!-- Detect current ship class -->
        <run_actions ref="md.GT_Ship_Management.Detect_Ship_Class" result="$classInfo">
          <param name="ship" value="$currentShip"/>
        </run_actions>
        <set_value name="$currentShipClass" exact="$classInfo.$Size"/> <!-- 'S', 'M', 'L', or 'XL' -->
        
        <!-- Calculate pilot's skill level from XP -->
        <set_value name="$pilotXP" exact="0"/>
        <do_if value="global.$GT_Pilots.{$pilot}? and global.$GT_Pilots.{$pilot}.$XP?">
          <set_value name="$pilotXP" exact="global.$GT_Pilots.{$pilot}.$XP"/>
        </do_if>
        <run_actions ref="md.GT_Ship_Management.Calculate_Skill_Level_From_XP" result="$skillLevel">
          <param name="pilot" value="$pilot"/>
          <param name="xp" value="$pilotXP"/>
        </run_actions>
        
        <!-- Check promotion thresholds based on skill level -->
        <!-- Level 4+ can promote to M-class -->
        <!-- Level 7+ can promote to L-class -->
        <!-- Level 10+ can promote to XL-class -->
        <do_if value="$skillLevel ge 10 and $currentShipClass != 'XL'">
          <set_value name="$eligibleClass" exact="'XL'"/>
        </do_if>
        <do_elseif value="$skillLevel ge 7 and $currentShipClass != 'L' and $currentShipClass != 'XL'">
          <set_value name="$eligibleClass" exact="'L'"/>
        </do_elseif>
        <do_elseif value="$skillLevel ge 4 and $currentShipClass == 'S'">
          <set_value name="$eligibleClass" exact="'M'"/>
        </do_elseif>
        
        <!-- Return eligibility result -->
        <set_value name="$canPromote" exact="($eligibleClass? and $eligibleClass != null)"/>
        <return value="table[
          $EligibleClass=$eligibleClass,
          $CurrentShipClass=$currentShipClass,
          $CanPromote=$canPromote,
          $SkillLevel=$skillLevel
        ]"/>
      </actions>
    </library>
    
    <!-- Find available ships for promotion -->
    <library name="FindAvailableShipsForPromotion" purpose="run_actions">
      <params>
        <param name="targetClass" comment="Target ship class ('M', 'L', or 'XL')"/>
        <param name="pilot" comment="Pilot entity (for distance calculation)"/>
      </params>
      <actions>
        <create_list name="$availableShips"/>
        
        <!-- Get pilot's current ship for distance calculation -->
        <set_value name="$pilotShip" exact="null"/>
        <set_value name="$pilotSector" exact="null"/>
        <do_if value="$pilot? and global.$GT_Pilots.{$pilot}? and global.$GT_Pilots.{$pilot}.$Ship?">
          <set_value name="$pilotShip" exact="global.$GT_Pilots.{$pilot}.$Ship"/>
          <do_if value="$pilotShip.exists and $pilotShip.sector?">
            <set_value name="$pilotSector" exact="$pilotShip.sector"/>
          </do_if>
        </do_if>
        
        <!-- Iterate through all player ships -->
        <set_value name="$shipsKeysCount" exact="@global.$GT_Ships.keys.count"/>
        <do_if value="$shipsKeysCount? and $shipsKeysCount gt 0">
          <do_all exact="$shipsKeysCount" counter="$i">
            <set_value name="$ship" exact="global.$GT_Ships.keys.{$i}"/>
            
            <!-- Filter criteria -->
            <do_if value="$ship.exists and 
                          $ship.isoperational and 
                          $ship.isplayerowned and
                          not $ship.pilot?">
              
              <!-- Check ship class matches target -->
              <run_actions ref="md.GT_Ship_Management.Detect_Ship_Class" result="$shipClassInfo">
                <param name="ship" value="$ship"/>
              </run_actions>
              
              <do_if value="$shipClassInfo.$Size == $targetClass">
                <!-- Calculate distance if pilot ship available -->
                <set_value name="$distance" exact="-1"/>
                <do_if value="$pilotShip? and $pilotShip.exists and $ship.sector?">
                  <set_value name="$distance" exact="$pilotShip.gatedistance.{$ship.sector}"/>
                  <do_if value="$distance lt 0">
                    <set_value name="$distance" exact="999999"/> <!-- Unreachable -->
                  </do_if>
                </do_if>
                
                <!-- Get cargo capacity -->
                <set_value name="$cargoCapacity" exact="0"/>
                <do_if value="$ship.cargo? and $ship.cargo.capacity?">
                  <set_value name="$cargoCapacity" exact="$ship.cargo.capacity.all"/>
                </do_if>
                
                <!-- Add ship to available list -->
                <append_to_list name="$availableShips" exact="table[
                  $Ship=$ship,
                  $Name=$ship.knownname,
                  $IDCode=$ship.idcode,
                  $CargoCapacity=$cargoCapacity,
                  $SectorName=@$ship.sector.knownname,
                  $Distance=$distance
                ]"/>
              </do_if>
            </do_if>
          </do_all>
        </do_if>
        
        <!-- Sort by cargo capacity (descending), then by distance (ascending) -->
        <do_if value="$availableShips.count gt 1">
          <!-- Simple bubble sort (MD doesn't have advanced sorting) -->
          <do_all exact="$availableShips.count" counter="$i">
            <do_all exact="($availableShips.count - $i)" counter="$j">
              <set_value name="$ship1" exact="$availableShips.{$j}"/>
              <set_value name="$ship2" exact="$availableShips.{$j + 1}"/>
              
              <!-- Compare: cargo first, then distance -->
              <set_value name="$shouldSwap" exact="false"/>
              <do_if value="$ship1.$CargoCapacity lt $ship2.$CargoCapacity">
                <set_value name="$shouldSwap" exact="true"/>
              </do_if>
              <do_elseif value="$ship1.$CargoCapacity == $ship2.$CargoCapacity and $ship1.$Distance gt $ship2.$Distance">
                <set_value name="$shouldSwap" exact="true"/>
              </do_elseif>
              <do_else>
                <!-- No swap needed -->
              </do_else>
              
              <do_if value="$shouldSwap">
                <set_value name="$availableShips.{$j}" exact="$ship2"/>
                <set_value name="$availableShips.{$j + 1}" exact="$ship1"/>
              </do_if>
            </do_all>
          </do_all>
        </do_if>
        
        <return value="$availableShips"/>
      </actions>
    </library>
    
    <!-- Handle promotion ship request from Lua -->
    <cue name="GT_HandlePromotionShipRequest" instantiate="true">
      <conditions>
        <event_object_signalled object="player.entity" param="'gt_promotion_request_ships'"/>
      </conditions>
      <actions>
        <set_value name="$shipId" exact="event.param2.$ShipId"/>
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT Promotion] Received ship request for promotion: ' + $shipId" chance="100"/>
        </do_if>
        
        <!-- Find ship by ID -->
        <set_value name="$ship" exact="null"/>
        <set_value name="$shipsKeysCount" exact="@global.$GT_Ships.keys.count"/>
        <do_if value="$shipsKeysCount? and $shipsKeysCount gt 0">
          <do_all exact="$shipsKeysCount" counter="$i">
            <set_value name="$checkShip" exact="global.$GT_Ships.keys.{$i}"/>
            <do_if value="$checkShip.exists and $checkShip.idcode == $shipId">
              <set_value name="$ship" exact="$checkShip"/>
              <break/>
            </do_if>
          </do_all>
        </do_if>
        
        <!-- Check if ship found and has pilot -->
        <do_if value="@$ship.exists and (@$ship.pilot != null)">
          <set_value name="$pilot" exact="$ship.pilot"/>
          
          <!-- Check eligibility -->
          <run_actions ref="md.GT_Pilot_Promotion.CheckPilotPromotionEligibility" result="$eligibility">
            <param name="pilot" value="$pilot"/>
          </run_actions>
          
          <do_if value="$eligibility.$CanPromote">
            <!-- Find available ships -->
            <run_actions ref="md.GT_Pilot_Promotion.FindAvailableShipsForPromotion" result="$availableShips">
              <param name="targetClass" value="$eligibility.$EligibleClass"/>
              <param name="pilot" value="$pilot"/>
            </run_actions>
            
            <!-- Send ship list to Lua -->
            <do_if value="$availableShips.count gt 0">
              <!-- Build ship data string for Lua -->
              <set_value name="$shipDataString" exact="''"/>
              <do_all exact="$availableShips.count" counter="$i">
                <set_value name="$shipData" exact="$availableShips.{$i}"/>
                <do_if value="$i gt 1">
                  <set_value name="$shipDataString" exact="$shipDataString + '||'"/>
                </do_if>
                <set_value name="$shipDataString" exact="$shipDataString + 
                  $shipData.$IDCode + '|' +
                  $shipData.$Name + '|' +
                  $shipData.$CargoCapacity + '|' +
                  $shipData.$SectorName + '|' +
                  $shipData.$Distance"/>
              </do_all>
              
              <!-- Send to Lua -->
              <raise_lua_event name="'GT_PromotionShips.Available'" param="table[
                $ShipId=$shipId,
                $PilotName=$pilot.name,
                $TargetClass=$eligibility.$EligibleClass,
                $ShipData=$shipDataString
              ]"/>
            </do_if>
            <do_else>
              <!-- No ships available -->
              <raise_lua_event name="'GT_PromotionShips.None'" param="table[
                $ShipId=$shipId,
                $PilotName=$pilot.name,
                $TargetClass=$eligibility.$EligibleClass
              ]"/>
            </do_else>
          </do_if>
          <do_else>
            <!-- Not eligible -->
            <raise_lua_event name="'GT_PromotionShips.NotEligible'" param="table[
              $ShipId=$shipId,
              $PilotName=$pilot.name
            ]"/>
          </do_else>
        </do_if>
      </actions>
    </cue>
    
    <!-- Handle ship selection from Lua and execute promotion -->
    <cue name="GT_PromotePilotShipSelected" instantiate="true">
      <conditions>
        <event_object_signalled object="player.entity" param="'gt_promotion_ship_selected'"/>
      </conditions>
      <actions>
        <set_value name="$shipId" exact="event.param2.$ShipId"/>
        <set_value name="$targetShipId" exact="event.param2.$TargetShipId"/>
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT Promotion] Executing promotion: Ship ' + $shipId + ' -> ' + $targetShipId" chance="100"/>
        </do_if>
        
        <!-- Find source ship -->
        <set_value name="$sourceShip" exact="null"/>
        <set_value name="$shipsKeysCount" exact="@global.$GT_Ships.keys.count"/>
        <do_if value="$shipsKeysCount? and $shipsKeysCount gt 0">
          <do_all exact="$shipsKeysCount" counter="$i">
            <set_value name="$checkShip" exact="global.$GT_Ships.keys.{$i}"/>
            <do_if value="$checkShip.exists and $checkShip.idcode == $shipId">
              <set_value name="$sourceShip" exact="$checkShip"/>
              <break/>
            </do_if>
          </do_all>
        </do_if>
        
        <!-- Find target ship -->
        <set_value name="$targetShip" exact="null"/>
        <do_if value="$shipsKeysCount? and $shipsKeysCount gt 0">
          <do_all exact="$shipsKeysCount" counter="$i">
            <set_value name="$checkShip" exact="global.$GT_Ships.keys.{$i}"/>
            <do_if value="$checkShip.exists and $checkShip.idcode == $targetShipId">
              <set_value name="$targetShip" exact="$checkShip"/>
              <break/>
            </do_if>
          </do_all>
        </do_if>
        
        <!-- Validate ships -->
        <do_if value="@$sourceShip.exists and @$targetShip.exists and (@$sourceShip.pilot != null) and (@$targetShip.pilot == null)">
          <set_value name="$pilot" exact="$sourceShip.pilot"/>
          
          <!-- Execute pilot transfer -->
          <run_actions ref="md.GT_Pilot_Promotion.ExecutePilotPromotion" result="$result">
            <param name="pilot" value="$pilot"/>
            <param name="sourceShip" value="$sourceShip"/>
            <param name="targetShip" value="$targetShip"/>
          </run_actions>
          
          <!-- Send result to Lua -->
          <raise_lua_event name="'GT_Promotion.Complete'" param="table[
            $Success=$result.$Success,
            $Message=$result.$Message
          ]"/>
        </do_if>
        <do_else>
          <!-- Validation failed -->
          <raise_lua_event name="'GT_Promotion.Complete'" param="table[
            $Success=false,
            $Message='Promotion failed: Invalid ships'
          ]"/>
        </do_else>
      </actions>
    </cue>
    
    <!-- Execute pilot promotion (transfer pilot to new ship) -->
    <library name="ExecutePilotPromotion" purpose="run_actions">
      <params>
        <param name="pilot" comment="Pilot entity to transfer"/>
        <param name="sourceShip" comment="Source ship (current ship)"/>
        <param name="targetShip" comment="Target ship (new ship)"/>
      </params>
      <actions>
        <set_value name="$success" exact="false"/>
        <set_value name="$message" exact="'Unknown error'"/>
        
        <!-- Validate inputs -->
        <do_if value="not $pilot? or not $sourceShip? or not $targetShip?">
          <return value="table[$Success=false, $Message='Invalid parameters']"/>
        </do_if>
        
        <do_if value="not $sourceShip.exists or not $targetShip.exists">
          <return value="table[$Success=false, $Message='Ship does not exist']"/>
        </do_if>
        
        <!-- Verify pilot is on source ship -->
        <do_if value="not $sourceShip.pilot? or $sourceShip.pilot != $pilot">
          <return value="table[$Success=false, $Message='Pilot not on source ship']"/>
        </do_if>
        
        <!-- Verify target ship has no pilot -->
        <do_if value="$targetShip.pilot?">
          <return value="table[$Success=false, $Message='Target ship already has a pilot']"/>
        </do_if>
        
        <!-- Store original ship name for cleanup -->
        <set_value name="$originalShipName" exact="null"/>
        <do_if value="global.$GT_Ships? and global.$GT_Ships.{$sourceShip}? and global.$GT_Ships.{$sourceShip}.$OriginalShipName?">
          <set_value name="$originalShipName" exact="global.$GT_Ships.{$sourceShip}.$OriginalShipName"/>
        </do_if>
        <do_else>
          <!-- Extract original name from current ship name (remove GT formatting) -->
          <run_actions ref="md.GT_Ship_Management.Strip_GT_Name_Formatting" result="$cleanedName">
            <param name="shipName" value="$sourceShip.knownname"/>
          </run_actions>
          <set_value name="$originalShipName" exact="$cleanedName"/>
        </do_else>
        
        <!-- Check if source ship has GT order -->
        <set_value name="$sourceHasGTOrder" exact="false"/>
        <do_if value="$sourceShip.defaultorder? and (@$sourceShip.defaultorder.id == 'GalaxyTraderMK3' or @$sourceShip.defaultorder.id == 'GalaxyTraderMK2' or @$sourceShip.defaultorder.id == 'GalaxyTraderMK1')">
          <set_value name="$sourceHasGTOrder" exact="true"/>
        </do_if>
        
        <!-- Step 1: Remove GT order from source ship (if present) -->
        <do_if value="$sourceHasGTOrder">
          <do_if value="$sourceShip.defaultorder?">
            <cancel_order order="$sourceShip.defaultorder"/>
          </do_if>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT Promotion] Removed GT order from source ship ' + $sourceShip.knownname" chance="100"/>
          </do_if>
        </do_if>
        
        <!-- Step 2: Restore original name to source ship -->
        <do_if value="$originalShipName? and $originalShipName != ''">
          <run_actions ref="md.GT_Ship_Management.Restore_Original_Ship_Name">
            <param name="ship" value="$sourceShip"/>
            <param name="pilot" value="$pilot"/>
          </run_actions>
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT Promotion] Restored original name to source ship: ' + $originalShipName" chance="100"/>
          </do_if>
        </do_if>
        
        <!-- Step 3: Update pilot registry with new ship (before actual transfer) -->
        <do_if value="global.$GT_Pilots.{$pilot}?">
          <set_value name="global.$GT_Pilots.{$pilot}.$Ship" exact="$targetShip"/>
          <set_value name="global.$GT_Pilots.{$pilot}.$ShipID" exact="$targetShip.idcode"/>
          
          <!-- Store original name for new ship -->
          <!-- Initialize ship registry if needed -->
          <do_if value="not global.$GT_Ships?">
            <set_value name="global.$GT_Ships" exact="table[]"/>
          </do_if>
          <do_if value="not global.$GT_Ships.{$targetShip}?">
            <set_value name="global.$GT_Ships.{$targetShip}" exact="table[]"/>
          </do_if>
          <run_actions ref="md.GT_Ship_Management.Strip_GT_Name_Formatting" result="$targetCleanedName">
            <param name="shipName" value="$targetShip.knownname"/>
          </run_actions>
          <set_value name="global.$GT_Ships.{$targetShip}.$OriginalShipName" exact="$targetCleanedName"/>
          
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT Promotion] Updated pilot registry: ' + $pilot.name + ' -> ' + $targetShip.knownname" chance="100"/>
          </do_if>
        </do_if>
        
        <!-- Step 4: Assign GT order to target ship (if source had GT order) -->
        <!-- Note: Order is assigned BEFORE pilot transfer so GT system is ready -->
        <!-- Note: GT orders are created through game UI, not MD. We'll signal the system to register the ship -->
        <do_if value="$sourceHasGTOrder">
          <!-- Signal that ship should get GT order (will be handled by RegisterShip cue) -->
          <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
            <debug_text text="'[GT Promotion] Target ship will receive GT order when pilot is assigned: ' + $targetShip.knownname" chance="100"/>
          </do_if>
        </do_if>
        
        <!-- Step 5: Update ship registry -->
        <do_if value="global.$GT_Ships.{$sourceShip}?">
          <!-- Remove pilot reference from old ship -->
          <remove_value name="global.$GT_Ships.{$sourceShip}.$Pilot"/>
        </do_if>
        
        <do_if value="global.$GT_Ships.{$targetShip}?">
          <!-- Set pilot reference on new ship -->
          <set_value name="global.$GT_Ships.{$targetShip}.$Pilot" exact="$pilot"/>
        </do_if>
        
        <!-- Step 6: Assign pilot to target ship -->
        <!-- Note: X4 MD scripts cannot directly assign pilots - this must be done through game UI -->
        <!-- GT will detect the pilot assignment via GT_Update_Ship events when it happens -->
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT Promotion] Pilot ' + $pilot.name + ' should be manually assigned to ship ' + $targetShip.knownname + ' through game UI'" chance="100"/>
        </do_if>
        
        <!-- Step 7: Write logbook message -->
        <run_actions ref="md.GT_Libraries_General.WriteLogbookMessage">
          <param name="Message" value="'Pilot ' + $pilot.name + ' promotion prepared: GT order moved from ' + $sourceShip.knownname + ' to ' + $targetShip.knownname + '. Please assign pilot ' + $pilot.name + ' to ' + $targetShip.knownname + ' manually if needed.'"/>
          <param name="Category" value="'news'"/>
          <param name="Title" value="'Pilot Promotion Prepared: ' + $pilot.name"/>
          <param name="Object" value="$targetShip"/>
        </run_actions>
        
        <set_value name="$success" exact="true"/>
        <set_value name="$message" exact="'Promotion prepared - GT registry updated, orders moved. Pilot assignment may require manual intervention.'"/>
        
        <return value="table[$Success=$success, $Message=$message]"/>
      </actions>
    </library>
    
    <!-- Handle auto-transfer request (process all eligible pilots) -->
    <cue name="GT_HandleAutoTransfer" instantiate="true">
      <conditions>
        <event_object_signalled object="player.entity" param="'gt_promotion_auto_transfer'"/>
      </conditions>
      <actions>
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <debug_text text="'[GT Promotion] Auto-transfer requested - processing all eligible pilots'" chance="100"/>
        </do_if>
        
        <set_value name="$processedCount" exact="0"/>
        <set_value name="$successCount" exact="0"/>
        <set_value name="$failedCount" exact="0"/>
        
        <!-- Get all pilots -->
        <set_value name="$pilotsKeysCount" exact="@global.$GT_Pilots.keys.count"/>
        <do_if value="$pilotsKeysCount? and $pilotsKeysCount gt 0">
          <do_all exact="$pilotsKeysCount" counter="$i">
            <set_value name="$pilot" exact="global.$GT_Pilots.keys.{$i}"/>
            
            <!-- Check if pilot is eligible -->
            <run_actions ref="md.GT_Pilot_Promotion.CheckPilotPromotionEligibility" result="$eligibility">
              <param name="pilot" value="$pilot"/>
            </run_actions>
            
            <do_if value="$eligibility.$CanPromote">
              <set_value name="$processedCount" operation="add"/>
              
              <!-- Find best available ship -->
              <run_actions ref="md.GT_Pilot_Promotion.FindAvailableShipsForPromotion" result="$availableShips">
                <param name="targetClass" value="$eligibility.$EligibleClass"/>
                <param name="pilot" value="$pilot"/>
              </run_actions>
              
              <!-- If ships available, use first one (already sorted by cargo/distance) -->
              <do_if value="$availableShips.count gt 0">
                <set_value name="$sourceShip" exact="null"/>
                <do_if value="global.$GT_Pilots.{$pilot}? and global.$GT_Pilots.{$pilot}.$Ship?">
                  <set_value name="$sourceShip" exact="global.$GT_Pilots.{$pilot}.$Ship"/>
                </do_if>
                
                <do_if value="@$sourceShip.exists">
                  <set_value name="$targetShip" exact="$availableShips.{1}.$Ship"/>
                  
                  <!-- Execute promotion -->
                  <run_actions ref="md.GT_Pilot_Promotion.ExecutePilotPromotion" result="$result">
                    <param name="pilot" value="$pilot"/>
                    <param name="sourceShip" value="$sourceShip"/>
                    <param name="targetShip" value="$targetShip"/>
                  </run_actions>
                  
                  <do_if value="$result.$Success">
                    <set_value name="$successCount" operation="add"/>
                  </do_if>
                  <do_else>
                    <set_value name="$failedCount" operation="add"/>
                  </do_else>
                </do_if>
              </do_if>
            </do_if>
          </do_all>
        </do_if>
        
        <!-- Send completion message to Lua -->
        <raise_lua_event name="'GT_Promotion.AutoTransferComplete'" param="table[
          $Processed=$processedCount,
          $Success=$successCount,
          $Failed=$failedCount
        ]"/>
        
        <do_if value="@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging">
          <set_value name="$debugMsg" exact="'[GT Promotion] Auto-transfer complete: ' + $processedCount + ' processed, ' + $successCount + ' successful, ' + $failedCount + ' failed'"/>
          <debug_text text="$debugMsg" chance="100"/>
        </do_if>
      </actions>
    </cue>
  </cues>
  
</mdscript>
