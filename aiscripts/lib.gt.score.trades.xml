<?xml version="1.0" encoding="utf-8"?>
<aiscript name="lib.gt.score.trades" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../ORIGINAL_MODS_DO NOT_MODIFY/X4Original/libraries/aiscripts.xsd" version="1">
  <params>
    <param name="tradeList" default="[]"/>
    <param name="debugchance" default="0"/>
  </params>
  <attention min="unknown">
    <actions>
      <set_value name="$bestTrade" exact="null"/>
      <set_value name="$bestScore" exact="0"/>
      <create_list name="$sortedTrades"/>

      <do_if value="not $tradeList? or $tradeList.count == 0">
        <return value="table[
          $Found = false,
          $BestTrade = null,
          $BestScore = 0,
          $SortedTrades = $sortedTrades
        ]"/>
      </do_if>

      <do_all exact="$tradeList.count" counter="$i">
        <set_value name="$trade" exact="$tradeList.{$i}"/>
        <append_to_list name="$sortedTrades" exact="$trade"/>
        <do_if value="$trade.$Score gt $bestScore">
          <set_value name="$bestScore" exact="$trade.$Score"/>
          <set_value name="$bestTrade" exact="$trade"/>
        </do_if>
      </do_all>

      <sort_list list="$sortedTrades" sortbyvalue="loop.element.$Score" sortdescending="true"/>

      <return value="table[
        $Found = ($bestTrade != null),
        $BestTrade = $bestTrade,
        $BestScore = $bestScore,
        $SortedTrades = $sortedTrades
      ]"/>
    </actions>
  </attention>
</aiscript>
