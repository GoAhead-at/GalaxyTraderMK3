GalaxyTrader MK3 - Changelog
========================================

Version 0.6.13 - 2025-11-23
---------------------------

FEATURE: Lua Order Monitor - Event-Driven Ship Cleanup Detection
  - Replaced polling-based orphaned ship cleanup with efficient batched Lua monitoring
  - Problem: Previous cleanup system used 5-minute polling intervals
    * Ships could remain orphaned for up to 5 minutes before cleanup
    * Polling overhead increased with large fleets
    * Race conditions between polling checks and manual order removal
    * Ships with removed GT orders weren't detected immediately
  - Solution: Lua UI script with batched order change detection
    * Monitors GT-registered ships continuously (1 ship every 5 frames)
    * Detects GT order removal, missing pilots, commander changes immediately
    * Zero overhead when no ships registered (monitoring only active ships)
    * Event-driven cleanup triggers MD system directly
  - Implementation:
    * Lua Script (`ui/gt_order_monitor.lua`):
      - Uses `onUpdate` hook for batched checks (prevents frame drops)
      - Tracks previous order IDs, pilot assignments, commander relationships
      - Detects changes: GT order removed, pilot missing, commander lost GT order
      - Raises UI events: `GTOrderRemoved`, `MissingPilot`, `CommanderLostGT`, `CommanderRemoved`
      - FFI integration for order checking (`GetDefaultOrder`, `GetCommander`)
      - Handles UniverseID conversion and ship ID code mapping
    * MD Bridge (`md/gt_order_monitor_bridge.xml`):
      - Sends ship list to Lua monitor (UniverseID:IDCode pairs)
      - Receives cleanup events from Lua and triggers MD cleanup
      - Updates ship list when ships removed from GT registry
      - Periodic updates (30s) to catch new ship registrations
      - Deduplication prevents multiple updates for same ship removal
    * Integration:
      - Removed `OrphanedPilotCleanup` polling cue (gt_core_system.xml)
      - Removed `OrphanedPilotCleanupScheduler` (5-minute interval)
      - Lua monitor replaces all polling-based cleanup detection
      - MD cleanup handlers (`HandleShipOrderAborted`) remain for actual cleanup execution
  - Files Added:
    * `ui/gt_order_monitor.lua`: Lua UI script for batched monitoring
    * `md/gt_order_monitor_bridge.xml`: MD bridge for Lua-MD communication
  - Files Modified:
    * `md/gt_core_system.xml`: Removed polling cues (`OrphanedPilotCleanup`, `OrphanedPilotCleanupScheduler`)
    * `ui.xml`: Added `gt_order_monitor.lua` to UI file list
  - Benefits:
    * Immediate detection: Ships cleaned up within seconds instead of up to 5 minutes
    * Performance: Batched checks (1 ship/5 frames) prevent frame drops even with 100+ ships
    * Reliability: Detects order removal even when MD events don't fire
    * Event-driven: No polling overhead when no changes occur
    * Fleet-aware: Handles commander/subordinate relationships correctly
    * Pilot tracking: Detects missing pilots immediately
  - Technical Details:
    * Check interval: 1 ship every 5 frames (configurable via `L.CHECK_INTERVAL`)
    * Ship list format: Comma-separated "UniverseID:IDCode" pairs
    * Cleanup triggers: Direct `GT_Ship_Order_Aborted` signals to MD system
    * Deduplication: `cleanupTriggered` table prevents duplicate cleanup for same ship
    * Commander detection: Uses `GetCommander` and `GetDefaultOrder` FFI calls
    * Pilot detection: Uses `GetComponentData(ship, "assignedpilot")`
  - User Experience:
    * Automatic: No configuration required, works out of the box
    * Transparent: Debug logging shows cleanup actions (if debug enabled)
    * Reliable: Ships cleaned up immediately when GT order removed or pilot transferred
    * Efficient: Zero performance impact with large fleets

FIX: Dock Failure Tracking - Missing Failure Text Variable
  - Fixed property lookup error when tracking dock failures
  - Problem: `$failuretext` variable was used but never initialized in dock failure tracking
    * Error: "Property lookup failed: $failuretext" in order.dock.xml line 39
    * Dock failures couldn't be properly tracked for trade order cleanup
    * Trade orders couldn't detect pathfinding failures correctly
  - Solution: Initialize `$failuretext` with translation ID before using it
    * Set `$failuretext` to `{1045, 124}` (standard error message format)
    * Initialize before creating failure tracking table
    * Update in all failure reason branches (no path, blacklisted destination, blacklisted sector)
  - Implementation:
    * `order.dock.xml` (lines ~15-27):
      - Initialize `$failuretext` after determining failure reason
      - Set appropriate failure text for each failure type
      - Ensures variable exists before table creation
  - Files Modified:
    * `aiscripts/order.dock.xml`: Added `$failuretext` initialization for all failure paths
  - Benefits:
    * Dock failures are properly tracked without errors
    * Trade orders can detect pathfinding failures correctly
    * No more property lookup errors in dock failure handling
    * Consistent error message format across all failure types

FIX: False Removal Detection for Subordinates
  - Fixed subordinates incorrectly triggering removal detection when completing trades
  - Problem: Subordinates completing trade orders were sending PAUSE signals
    * PAUSE signal removed ship from `GT_Ships` registry
    * Assist order cleanup then detected ship as "removed" even though still subordinate
    * Subordinates were being unregistered while still part of fleet
    * Log showed: "Ship was tracked as subordinate to GT commander - needs cleanup"
  - Root Cause:
    * When trade order completes, `$isActivelyTrading` becomes false
    * PAUSE signal condition checked only: `not $isActivelyTrading and not transitioning`
    * Didn't check if ship was subordinate with Assist order
    * Subordinates should stay registered while part of fleet
  - Solution: Prevent PAUSE signals for subordinates with Assist orders
    * Added check: `not ($hasGTCommander and $currentDefaultOrder == 'Assist')`
    * Subordinates with Assist orders skip PAUSE signal entirely
    * Subordinates remain registered in `GT_Ships` while commander has GT order
  - Implementation:
    * `order.trade.galaxytrader.xml` (lines ~4566-4590):
      - Modified PAUSE condition to exclude subordinates with Assist orders
      - Added explicit `elseif` block for subordinates to skip PAUSE
      - Added debug logging for subordinate skip case
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml`: Added subordinate check to prevent PAUSE signals
  - Benefits:
    * Subordinates stay registered while part of fleet
    * No false removal detection when trades complete
    * Fleet coordination works correctly for subordinates
    * Subordinates properly tracked until commander order removed or ship reassigned

FEATURE: Commander XP Bonus from Subordinates
  - Added XP bonus system where commanders gain a percentage of XP from their subordinates' trades
  - Problem: Commanders managing fleets didn't benefit from their subordinates' trading activities
  - Solution: Automatic XP bonus awarded to commander pilots when subordinates complete trades
    * Default bonus: 10% of subordinate XP (configurable)
    * Commander gains bonus XP every time a subordinate completes a trade
    * Bonus respects XP blocking and training requirements (same as normal XP)
    * Commander's skill level and ship name updated automatically if level increases
  - Implementation:
    * Configuration: `global.$GT_GlobalSettings.$XP.$CommanderBonusPercent` (default: 10)
    * XP bonus calculated in `ProcessXPEvents` cue (gt_xp_training.xml)
    * Checks if ship has commander before awarding bonus
    * Verifies commander has GT pilot before awarding
    * Calculates bonus as percentage of subordinate XP gained
    * Applies same XP blocking/training checks as normal XP
    * Updates commander ship name if skill level increases
  - Files Modified:
    * `md/gt_global_settings.xml`:
      - Added `$XP.$CommanderBonusPercent` setting (default: 10%)
      - Added migration/validation for existing saves
      - Added UI slider in Global Settings menu (0-50% range, step: 1%)
      - Integrated with `GT_Slider_Update` handler for real-time updates
    * `md/gt_xp_training.xml`:
      - Added commander XP bonus logic in `ProcessXPEvents` (lines ~308-380)
      - Checks commander relationship and awards bonus XP
      - Updates commander skill level and ship name if needed
    * `t/0001-l*.xml` (all language files):
      - Added translation ID 9015: "Commander Bonus Percent" (label)
      - Added translation ID 9115: Tooltip explaining commander bonus XP system
  - Benefits:
    * Encourages fleet management: Commanders benefit from managing subordinates
    * Realistic progression: Commanders learn from their fleet's trading activities
    * Configurable: Bonus percentage adjustable via UI slider in Global Settings menu (0-50%, default: 10%)
      - Accessible through: Global Settings → XP and Training section
      - Set to 0% to disable commander bonus XP
      - Real-time adjustment with immediate effect
    * Balanced: Default 10% provides meaningful bonus without overpowering
    * Multiple subordinates: Commander gains bonus from each subordinate trade
  - User Experience:
    * Automatic: No player intervention required
    * Transparent: Debug logging shows bonus XP awards
    * Fair: Respects training requirements (commander must complete training to progress)
  - Technical Notes:
    * Bonus XP is integer-rounded (10% of 50 XP = 5 XP)
    * Commander bonus is separate from subordinate XP (doesn't reduce subordinate's XP)
    * Works with any number of subordinates (each trade awards bonus)
    * Commander must have GT pilot to receive bonus (subordinate must be in GT system)

FIX: Per-Sector Trade Queries (Vanilla Pattern)
  - Changed cargo disposal search to query stations per-sector instead of galaxy-wide
  - Problem: `SearchSellOpportunities` used `space="player.galaxy"` which requires initialized market data
    * Ships couldn't find trades without satellites or pre-scanned sectors
    * New freighters in unexplored areas failed to find disposal trades
    * Galaxy-wide queries may require market intelligence to be initialized
  - Solution: Query stations per-sector (matching vanilla X4 behavior)
    * Build sector list using `GT_FindSectorsInRange` (within `maxDistance` from home sector)
    * Iterate through sectors and query `find_buy_offer` with `space="$sector"` for each sector
    * Matches vanilla pattern: `trade.find.free.xml` queries stations in specific sectors
  - Implementation:
    * `SearchSellOpportunities` now builds `$sellspaces` list before querying
    * Per-sector queries allow ships to check prices at stations they can detect (gravidar range)
    * Works without satellites: Ships can query stations in sectors they're in or have visited
  - Files Modified:
    * `md/gt_trading_search.xml`:
      - Modified `SearchSellOpportunities` to build sector list and query per-sector (lines ~2950-3047)
      - Replaced galaxy-wide `find_buy_offer` with per-sector loop
      - Added home sector determination and blacklistgroup setup
  - Benefits:
    * Ships can find trades even without initialized market data (satellites)
    * More realistic: Traders check prices at nearby stations they can detect
    * Matches vanilla X4 behavior for consistency
    * New freighters can find trades immediately without requiring scout activity
  - Technical Notes:
    * Main live search (`SearchLiveTrades`) already used per-sector queries
    * This change aligns cargo disposal search with the same pattern
    * Per-sector queries are more efficient than galaxy-wide queries

FIX: Race Condition Prevention in SearchLiveTrades
  - Fixed race condition where multiple searches could overwrite each other's state
  - Problem: Multiple `SearchLiveTrades` instances could run concurrently for the same ship
    * `SearchTradeRoutes` could start fallback search before original search completed
    * Second search overwrote `global.$GT_SearchLiveTrades_State.{$ship}` 
    * `SearchLiveTrades_Resume` couldn't find state when original search completed
    * Error: "Ship state not found in global.$GT_SearchLiveTrades_State - cannot continue trade search"
  - Root Cause:
    * `cancel_cue` doesn't immediately stop execution - code after it still runs
    * Guard checks passed but code continued executing, overwriting state
    * Incorrect guard: Checked `global.$GT_SearchResult.{$ship}.$WaitingForBatch` (doesn't exist)
  - Solution: Proper guard checks with `do_else` blocks to prevent execution
    * Check `global.$GT_SearchLiveTrades_State.{$ship}` exists before starting new search
    * Wrap state storage/signaling code in `do_else` blocks so it only runs if guard passes
    * Added guards in three places:
      - `SearchTradeRoutes`: Checks before signaling `SearchLiveTrades`
      - `SearchFallbackTrades`: Checks before signaling `SearchLiveTrades`
      - `SearchLiveTrades`: Checks at start and exits if state already exists
  - Implementation:
    * `SearchTradeRoutes` (gt_trading_search.xml, lines ~773-808):
      - Checks if search in progress before signaling
      - Exits immediately if search already running
    * `SearchFallbackTrades` (gt_search_methods.xml, lines ~2083-2119):
      - Checks if search in progress before signaling fallback search
      - Wraps signaling code in `do_else` to prevent execution if blocked
    * `SearchLiveTrades` (gt_search_methods.xml, lines ~1387-1443):
      - Checks at start if state already exists
      - Wraps state storage/signaling in `do_else` to prevent overwriting
  - Files Modified:
    * `md/gt_trading_search.xml`: Added guard check before signaling `SearchLiveTrades`
    * `md/gt_search_methods.xml`: Added guards in `SearchFallbackTrades` and `SearchLiveTrades`
  - Benefits:
    * Prevents state overwrite errors
    * Ensures only one search runs per ship at a time
    * Eliminates "state not found" errors in `SearchLiveTrades_Resume`
    * Proper synchronization prevents race conditions

FIX: Operational State Reset After Repair/Resupply Completion
  - Fixed operational states (`[REPAIR]`, `[RESUPPLY]`) not being cleared after completion
  - Problem: Ship names showed operational states even after repair/resupply completed
    * Auto-repair ships: `[REPAIR]` state persisted after successful repair
    * Stale resupply orders: `[RESUPPLY]` state persisted after resupply completed
    * States weren't cleared when ships weren't tracked in `$GT_MaintenanceOrders`
  - Root Cause:
    * `ProcessRepairComplete` only handled ships in `$GT_MaintenanceOrders`
    * Auto-repair ships tracked in `$GT_AutoRepair` weren't handled
    * `ProcessResupplyComplete` didn't clear state for stale orders (ships not in `$GT_MaintenanceOrders`)
  - Solution: Added state cleanup for all completion paths
    * Auto-repair completion: Clear `$NeedsRepair` flag and update ship name
    * Stale resupply completion: Clear `$GT_ResupplyOrders` tracking and update ship name
    * Both paths trigger ship name update to remove operational state from display
  - Implementation:
    * `ProcessRepairComplete` (gt_maintenance.xml, lines ~1544-1572):
      - Added `do_elseif` block for `$GT_AutoRepair` ships
      - Clears `$NeedsRepair` flag after repair completes
      - Triggers ship name update to remove `[REPAIR]` state
      - Sends `GT_RepairCompleted` signal to AI script
    * `ProcessResupplyComplete` (gt_maintenance.xml, lines ~1479-1495):
      - Added cleanup for stale resupply orders (ships not in `$GT_MaintenanceOrders`)
      - Clears `$GT_ResupplyOrders` tracking
      - Triggers ship name update to remove `[RESUPPLY]` state
  - Files Modified:
    * `md/gt_maintenance.xml`: Added state cleanup for auto-repair and stale resupply orders
  - Benefits:
    * Ship names correctly update after repair/resupply completion
    * No persistent `[REPAIR]` or `[RESUPPLY]` states in ship names
    * Works for all completion paths (maintenance orders, auto-repair, stale orders)
    * Consistent behavior across all repair/resupply scenarios
  - Technical Notes:
    * Auto-repair ships use Level 12+ pilot ability (no maintenance order created)
    * Stale orders occur when ships complete resupply but tracking was cleared/aborted
    * Both scenarios now properly clean up operational states

FIX: Stale Delayed Trade Search Cues Causing "AI Parameters Missing" Errors
  - Fixed race condition where delayed trade search cues fired after search already completed
  - Problem: "AI parameters missing for ship" errors occurred when delayed searches fired
    * `FindBestTrade_Delayed` schedules searches with skill-based delays (e.g., 19 seconds)
    * During delay, live search can run and complete immediately
    * Live search cleanup deletes AI parameters via `GT_RequestRegistry_Release`
    * When delayed cue fires, it calls `FindBestTrade` which expects parameters to exist
    * Result: "AI parameters missing" error logged
  - Root Cause:
    * Delayed cue instances outlived the searches they were meant to trigger
    * No check to verify parameters still exist before proceeding after delay
    * Race condition: Search completes faster than delay expires
  - Solution: Added parameter existence check after delay expires
    * Check if `global.$GT_AIParameters.{ship}` still exists after delay
    * If parameters missing → Search already completed, cancel delayed cue
    * If parameters exist → Proceed with normal search flow
  - Implementation:
    * `FindBestTrade_Delayed` (gt_trading_queue.xml, lines ~181-198):
      - Added parameter existence check after delay expires
      - If parameters missing: Cancel cue and signal `GT_No_Trade_Found`
      - If parameters exist: Proceed with normal checks (ship exists, operational, not busy)
  - Files Modified:
    * `md/gt_trading_queue.xml`: Added parameter existence check in `FindBestTrade_Delayed`
  - Benefits:
    * Prevents "AI parameters missing" errors from stale delayed cues
    * Handles race condition where search completes during delay
    * Proper cleanup: Cancels stale delayed instances automatically
    * No impact on normal operation: Only affects edge case where search completes early
  - Technical Notes:
    * This fix addresses a pre-existing race condition, not related to repair/resupply fixes
    * Occurs when live search completes faster than skill-based delay (common for high-level pilots)
    * Pattern observed in logs: Multiple ships (BSF-660, KTE-617, NZA-371) affected when delays are long enough

FEATURE: Training License Costs
  - Added training license fees that must be paid when pilots begin certification training
  - Problem: Training was free, making pilot progression cost-free
  - Solution: Implemented tiered cost structure based on training level
    * Level 3: 5,000 Cr (Apprentice certification)
    * Level 6: 12,000 Cr (Courier certification)
    * Level 9: 35,000 Cr (Supplier certification)
    * Level 12: 100,000 Cr (Master Trader certification - final exam)
  - Implementation:
    * Cost calculation in `InitiateTraining` cue (gt_xp_training.xml, lines ~1346-1400)
    * Costs deducted immediately when training starts using `reward_player` with negative value
    * Cost stored in `global.$GT_Pilots.{$pilot}.$TrainingCost` for reference
    * Training notifications show cost paid
  - Insufficient Funds Handling:
    * If player lacks funds, training is blocked but ship continues trading
    * XP remains blocked (via BlockedLevel) until training can be completed
    * Logbook entry created explaining cost, available funds, and shortfall
    * System automatically retries after next trade run
    * Behavior matches "no training station found" scenario (ship trades, XP blocked)
  - User Experience:
    * Training notifications include cost information
    * Logbook entries provide detailed financial breakdown when funds insufficient
    * Clear communication about why training cannot proceed
  - Files Modified:
    * `md/gt_xp_training.xml` (added cost calculation and insufficient funds handling, lines ~1346-1400)
  - Files Created:
    * `DOCS/Training_License_Costs.md` (complete feature documentation)
  - Benefits:
    * Adds economic depth to pilot progression system
    * Creates meaningful resource management decisions
    * Higher-level certifications cost more, reflecting their value
    * Non-blocking: Ships continue trading even if funds insufficient
    * Clear communication via logbook entries
  - Documentation:
    * Complete feature documentation in `DOCS/Training_License_Costs.md`
    * Updated `HowTo/Training-System.md` with cost information

OPTIMIZATION: Incremental Radius Search with CPU Yielding
  - Implemented cue-based incremental radius search to replace synchronous sector enumeration
  - Problem: Synchronous `GT_BuildTradeSectorLists` could cause game stutter when processing many sectors
    * Large search radii (10+ jumps) processed all sectors in single frame
    * No CPU yielding between sector processing
    * Could freeze game UI during trade searches
  - Solution: Cue-based asynchronous pattern with CPU yielding between radius increments
    * New cue: `GT_IncrementalRadiusSearch` (instantiate="true") processes one radius per iteration
    * CPU yielding: `<delay exact="10ms"/>` between each radius increment
    * State persistence: Uses cue instance variables (`this.$variable`) to maintain state across delays
    * Recursive signaling: Signals itself for next radius iteration with continuation flag
    * Completion handler: `GT_IncrementalRadiusSearch_Complete` signals `SearchLiveTrades_Resume` when done
  - Implementation Details:
    * Escape Path Detection (Phase 1):
      - Searches from ship's current position for closest non-blacklisted sector
      - Validates escape sector is within `maxDistance` from home sector
      - Prefers sectors closer to home sector when multiple candidates found
      - Max escape search radius: 10 jumps
      - Marks ship as isolated if no escape path found
    * Trade Search:
      - Searches from ship's current position, incrementing radius from 0 to `maxDistance`
      - Validates each sector is within `maxDistance` from home sector before adding to lists
      - Early termination: Stops if radius returns only fallback current sector (no new sectors found)
      - Isolation detection: If radius 1 returns only fallback, ship is marked as isolated
      - Collects sectors into `$buyspaces` and `$sellspaces` lists for downstream processing
    * Fallback Detection:
      - Distinguishes legitimate radius 0 results (current sector expected) from fallbacks
      - Radius 0: Always processes current sector
      - Radius > 0: Only fallback if only current sector returned
      - Prevents false isolation detection and premature termination
    * Integration:
      - `SearchLiveTrades` stores state in `global.$GT_SearchLiveTrades_State.{$ship}` before signaling incremental search
      - `SearchLiveTrades_Resume` receives results and restores state, then signals `SearchLiveTrades` with continuation flag
      - `SearchLiveTrades` checks for continuation flag and skips sector list building, proceeding directly to trade finding
  - Files Modified:
    * `md/gt_libraries_pathfinding.xml`:
      - Added `GT_IncrementalRadiusSearch` cue (lines ~800-1100)
      - Added `GT_IncrementalRadiusSearch_Complete` cue (lines ~1096-1133)
      - Implements escape path detection, trade search, isolation detection, and fallback handling
    * `md/gt_search_methods.xml`:
      - Modified `SearchLiveTrades` to use async incremental search (lines ~1355-1440)
      - Added `SearchLiveTrades_Resume` cue to handle incremental search completion (lines ~1442-1570)
      - State storage/restoration pattern for seamless continuation
  - Benefits:
    * Eliminates game stutter during trade searches
    * Cooperative multitasking: Game engine regains control between radius increments
    * Better performance: Large searches no longer freeze UI
    * Early termination: Stops searching when no new sectors found (saves CPU)
    * Isolation detection: Identifies ships trapped in blacklisted sectors
    * Escape path detection: Finds closest non-blacklisted sector for isolated ships
    * Maintains compatibility: Drop-in replacement for `GT_BuildTradeSectorLists`
  - Technical Notes:
    * Uses recursive `signal_cue_instantly` pattern (not `resume`/`label` - invalid in MD scripts)
    * Cue instance variables persist across delays (unlike local variables)
    * Continuation pattern allows seamless state transfer between cue instances
    * Same-sector `gatedistance` edge case handled explicitly (returns error, not 0)
  - Performance:
    * CPU yielding: 10ms delay between radius increments
    * Typical search (radius 0-10): ~110ms total delay (11 iterations × 10ms)
    * Prevents frame drops even with large search radii
    * Early termination reduces delay when no sectors found

FEATURE: Ship Status Renaming - Customizable State Abbreviations
  - Added user-configurable abbreviations for ship operational states in ship names
  - Solution: Text input fields in global settings menu with default values
    * Default abbreviations: RS (Resupply), RP (Repair), MT (Maintenance), TR (Training), RR (Reroute), CL (Clearance), BL (Blocked), FB (Fallback), IS (Isolated), TD (Trading), ID (Idle)
    * Players can override any abbreviation via text input fields
    * Maximum 12 characters per abbreviation
    * Changes apply immediately to all ship names
  - Implementation:
    * Library function: `Get_State_Abbreviation` in `gt_ship_management.xml`
      - Checks custom values first (`global.$GT_GlobalSettings.$ShipNaming.$StateAbbreviations`)
      - Falls back to defaults if custom value not set
    * Menu section: "Ship State Naming" in global settings menu
      - 11 text input fields (one per state) using `Make_EditBox` widget
      - Each field shows current/default value
      - Tooltips explain each field
    * Callback handler: `GT_StateAbbreviation_Update`
      - Saves custom abbreviations to global settings
      - Trims whitespace and enforces character limit
      - Automatically updates all ship names when changed
      - Restores default if field is cleared
    * Ship naming integration:
      - Updated operational states (Resupply, Repair, Maintenance, Reroute, Clearance) to use abbreviations
      - Updated status states (Blocked, Training, Fallback, Isolated) to use abbreviations
      - All states display as `[ABBR]` format (e.g., `[RS]`, `[TR]`)
  - Files Modified:
    * `md/gt_global_settings.xml`:
      - Added default abbreviation initialization (lines ~82-92)
      - Added "Ship State Naming" menu section with text input fields (lines ~2178-2350)
      - Added `GT_StateAbbreviation_Update` callback handler (lines ~2664-2705)
    * `md/gt_ship_management.xml`:
      - Added `Get_State_Abbreviation` library function (lines ~1326-1385)
    * `md/gt_xp_training.xml`:
      - Updated operational state text to use abbreviations (lines ~1148-1167)
      - Updated status text to use abbreviations (lines ~1068-1081)
    * All translation files (`t/0001-l*.xml`):
      - Added translation IDs 9250-9261 (labels) and 9350-9361 (tooltips)
      - Translations added for all 9 supported languages
  - Benefits:
    * User customization: Players can set abbreviations that make sense in their language
    * Language-neutral defaults: 2-character abbreviations work across all languages
    * Real-time updates: Changes apply immediately to all ship names
    * Fallback protection: Defaults ensure system always has valid abbreviations
    * Character limit: Prevents overly long abbreviations from breaking UI
  - User Experience:
    * Simple text input fields in global settings menu
    * Default values shown in input boxes
    * Clear tooltips explain each field
    * Changes take effect immediately
    * Empty fields restore defaults automatically

Version 0.6.12 - 2025-11-21
---------------------------

FIX: RouteCacheCleanup Property Lookup Errors
  - Fixed null property access errors in cache cleanup routines
  - Problem: Property lookup failed when accessing `global.$GT_TradeCache.keys.count` and `$cacheKeys.count`
    * Error: "Property lookup failed: global.$GT_TradeCache.count" in RouteCacheCleanup
    * Error: "Property lookup failed: $cacheKeys.count" where `$cacheKeys == null`
    * Cache structure changed in v5 to table indexed by home sector, so direct `.count` access was invalid
  - Root Cause: Incorrect null/existence checks - `$cacheKeys?` only checks existence, not if value is null
  - Solution: Implemented robust null/existence check pattern:
    * Extract property with safe operator (`@`) first
    * Extract count with safe operator (`@$cacheKeys.count`)
    * Store count in separate variable (`$cacheKeysCount`)
    * Check if count exists AND is greater than 0 before using in `<do_all>`
  - Files Modified:
    * `md/gt_trading_execution.xml` (fixed RouteCacheCleanup null checks, lines 691-694)
    * `md/gt_fleet_coordination.xml` (fixed GetCacheStatistics null checks, lines 219-224)
  - Benefits:
    * No more property lookup errors during cache cleanup
    * Robust handling of null/empty cache states
    * Proper iteration through cache keys only when cache exists and has entries

IMPROVEMENT: Hybrid Amount Clamping Implementation
  - Implemented hybrid approach combining detailed validation with vanilla `clamp_trade_amount`
  - Problem: Manual cargo space validation was redundant and could miss edge cases
  - Solution: Leverage vanilla `clamp_trade_amount` for final amount adjustment while retaining detailed early validation
    * Early validation: Blacklist, pathfinding, docking, cargo type, offer validity, cargo space, distance
    * Final clamping: Use `clamp_trade_amount` before order creation to adjust amounts based on:
      - Buyer cargo space
      - Buyer money
      - Seller cargo space
      - Offer amount limits
    * Store clamped amounts in `$pendingTrade.$FinalBuyAmount` and `$pendingTrade.$FinalSellAmount`
    * Check if clamped amounts are zero and skip trade if so (with logging)
  - Implementation:
    * Added `clamp_trade_amount` calls within validation loop, before `create_trade_order`
    * Clamps both buy and sell amounts separately
    * Logs clamp reasons for debugging
    * Continues to next trade if clamping results in zero amount
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (added clamping logic before order creation)
  - Benefits:
    * More accurate amount calculation (handles all edge cases vanilla handles)
    * Detailed logging of clamp reasons
    * Prevents creating orders with zero amounts
    * Retains comprehensive early validation while leveraging vanilla clamping
  - Vanilla Pattern Reference:
    * `order.trade.routine.xml:773-797` (buy clamping)
    * `order.trade.routine.xml:817-825` (sell clamping)

IMPROVEMENT: Final Docking Verification with find_dockingbay
  - Added accurate dock size verification right before creating trade orders
  - Problem: `dockingallowed` property check is fast but may miss dock size mismatches
    * L/XL ships could be sent to stations without L/XL docks
    * S/M ships could be sent to stations without appropriate docks
  - Solution: Two-stage docking verification:
    * Stage 1 (loop): Fast `dockingallowed` check for early filtering
    * Stage 2 (before orders): Accurate `find_dockingbay` check for final verification
      - Uses `find_dockingbay` with `match_dock size="this.ship.docksize"`
      - Checks both buy and sell stations (if applicable)
      - Verifies trading permissions, dock size, and relation (not enemy)
      - Only checks once per trade that passed all validation (efficient)
  - Implementation:
    * Added `find_dockingbay` check right before `create_trade_order` calls
    * If check fails, sets `$validTradeFound = false` and resumes to `main_loop`
    * Logs detailed debug messages explaining why docking failed
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (added final docking verification, lines 3064-3105)
  - Benefits:
    * More accurate: Verifies dock size right before creating orders
    * More efficient: Only checks `find_dockingbay` once per trade that passed all validation
    * Better error recovery: If docking fails, tries next trade instead of failing completely
    * Catches edge cases: Dock size mismatches, dock availability issues
  - Pattern Consistency:
    * Matches pattern used in GalaxyTrader MD scripts (maintenance, training, trading search)
    * Uses same `find_dockingbay` approach as vanilla `order.dock.xml:381-384`

FIX: StateHistory List Slicing Property Lookup Error
  - Fixed property lookup error when trimming StateHistory list
  - Problem: Property lookup failed when slicing StateHistory list using `$historyList.[$startIdx, $endIdx]`
    * Error: "Property lookup failed: $historyList.[1,51]" at line 364
    * Issue: List slicing syntax `$list.[start, end]` was failing even with validated indices
    * X4 list slicing may have edge cases or syntax requirements that caused failures
  - Root Cause: List slicing syntax unreliable even with proper validation
    * Indices were validated correctly (`$startIdx ge 0 and $endIdx gt $startIdx and $endIdx le $listCount`)
    * But slice operation still failed, suggesting X4 slice syntax has limitations
  - Solution: Replaced list slicing with explicit loop-based copying:
    * Extract list count with safe operator (`@$state.$StateHistory.count`)
    * Check if count exists and is greater than threshold (50)
    * Extract list with safe operator (`@$state.$StateHistory`) into temporary variable
    * Build new list by looping through last 50 entries (1-indexed: `$listCount - 50 + 1` to `$listCount`)
    * Copy each item explicitly using `append_to_list` instead of slicing
    * Replace StateHistory with the new trimmed list
  - Files Modified:
    * `md/gt_ship_state_manager.xml` (replaced slicing with loop-based copying, lines 354-374)
  - Benefits:
    * No more property lookup errors when trimming StateHistory
    * More reliable: Explicit copying avoids slice syntax edge cases
    * Robust handling of null/empty StateHistory lists
    * Proper validation of indices before copying
    * Prevents crashes when StateHistory is null or has insufficient entries

FIX: SearchSellOpportunities Property Lookup Errors
  - Fixed property lookup errors when processing sell-only trade offers
  - Problem: Property lookup failed when accessing properties on invalid trade offers
    * Error: "Property lookup failed: $offer.owner" - `$offer == trade.{0x7d36L} (invalid)`
    * Error: "Property lookup failed: $station.sector" - `$station == null`
    * Error: "Property lookup failed: $ship.gatedistance.{null}" - `$stationSector == null`
    * Trade offers can become invalid between `find_buy_offer` and processing (stations destroyed/removed)
  - Root Cause: Code accessed properties without validation
    * Accessed `$offer.owner` without checking if offer is still valid
    * Accessed `$station.sector` without checking if station exists
    * Used `$stationSector` in `gatedistance` calculation without validating it's not null
    * Stations can be destroyed/removed between search and processing, causing invalid trade objects
  - Solution: Added comprehensive validation before processing offers:
    * Use safe operator (`@`) when accessing `$offer.owner`
    * Validate `$station` exists before accessing its properties
    * Validate `$stationSector` is valid before using it in calculations
    * Set `$offerValid` flag to track valid offers
    * Wrap all offer processing logic inside `do_if value="$offerValid"` block
    * Invalid offers are skipped gracefully without causing property lookup errors
  - Files Modified:
    * `md/gt_trading_search.xml` (added offer validation in SearchSellOpportunities, lines 3013-3027)
  - Benefits:
    * No more property lookup errors when processing sell-only trades
    * Robust handling of invalid trade offers (stations destroyed/removed)
    * Graceful skipping of invalid offers without crashing
    * Prevents crashes when stations are destroyed between search and order creation
    * Follows same safe property access pattern used elsewhere in codebase

IMPROVEMENT: Research Requirement Check for Ship Modifications
  - Added research requirement validation before installing ship modifications
  - Problem: Modifications were installed based only on pilot level, ignoring research requirements
    * Player must research modifications at HQ before they can be installed
    * If only level 1 mods are researched, level 2/3 mods cannot be installed
    * System was installing mods based on pilot level alone, ignoring research status
  - Solution: Two-stage level determination:
    * Stage 1: Calculate pilot-supported mod level (Level 9 = Level 1, Level 12 = Level 2, Level 15 = Level 3)
    * Stage 2: Check research requirements from highest level down, find highest researched level that pilot supports
      - Checks `ware.mod_ship_gt_levelX.research.unlocked` and `ware.mod_engine_gt_levelX.research.unlocked`
      - Both ship and engine mods must be researched for a level to be available
      - Falls back to lower levels if higher levels aren't researched
      - Example: Pilot supports level 3, but only level 1 researched → installs level 1
  - Implementation:
    * Modified `Install_GT_Modifications` library (lines 40-95):
      - Separated pilot-supported level (`$pilotModLevel`) from final mod level (`$modLevel`)
      - Added research checks for each level (3 → 2 → 1)
      - Only sets `$modLevel` if both ship and engine mods are researched for that level
      - Enhanced debug messages to show pilot-supported level vs researched level
    * Enhanced error messages (lines 175-195):
      - Shows why mods weren't installed (pilot level too low vs research not completed)
      - Indicates which level is missing research
  - Files Modified:
    * `md/gt_ship_modifications.xml` (added research requirement checks, lines 40-95)
  - Benefits:
    * Respects player research progress: Only installs mods that player has researched
    * Prevents installation failures: Won't try to install unresearched mods
    * Graceful fallback: Installs highest researched level that pilot supports
    * Better debugging: Clear messages explaining why mods weren't installed
    * Matches game mechanics: Research is required before mods can be installed
  - Vanilla Pattern Reference:
    * Uses `ware.research.unlocked` property (scriptproperties.xml:1910)
    * Pattern matches vanilla research checks (diplomacy.xml, story_thefan.xml)

IMPROVEMENT: Final Docking Verification for Repair and Resupply Orders
  - Added accurate dock size verification right before creating repair and resupply orders
  - Problem: `dockingallowed` property check is fast but may miss dock size mismatches
    * L/XL ships could be sent to stations without L/XL docks for repair/resupply
    * S/M ships could be sent to stations without appropriate docks
    * MD scripts already use `find_dockingbay` in search loops, but no final verification before order creation
  - Solution: Two-stage docking verification (consistent with trading):
    * Stage 1 (MD script): Fast `dockingallowed` check and `find_dockingbay` in search loop for early filtering
    * Stage 2 (AI script): Accurate `find_dockingbay` check right before creating orders
      - Uses `find_dockingbay` with `match_dock size="this.ship.docksize"`
      - Verifies dock size and operational status
      - Only checks once per repair/resupply order that passed all validation (efficient)
  - Implementation:
    * Repair Orders:
      - Added `find_dockingbay` check before `create_order` for Repair (lines 1547-1560)
      - Skips docking check for capital ships docking at non-stations (matches MD script logic)
      - If check fails, clears repair order data and continues trading
      - Logs detailed debug messages explaining why docking failed
    * Resupply Orders:
      - Added `find_dockingbay` check before `add_build_to_modify_ship` (lines 1628-1649)
      - If check fails, clears resupply order data and continues trading
      - Logs detailed debug messages explaining why docking failed
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml`:
      - Added final docking verification for repair orders (lines 1547-1560)
      - Added final docking verification for resupply orders (lines 1628-1649)
  - Benefits:
    * More accurate: Verifies dock size right before creating orders
    * More efficient: Only checks `find_dockingbay` once per order that passed all validation
    * Better error recovery: If docking fails, clears order data and continues trading instead of failing
    * Catches edge cases: Dock size mismatches, dock availability issues
    * Consistent pattern: Same approach as trading orders for maintainability
  - Pattern Consistency:
    * Matches pattern used for trading orders (same two-stage verification)
    * Uses same `find_dockingbay` approach as vanilla `order.dock.xml:381-384`

FIX: Sell-Only Trade Search Filtering for Small Cargo Amounts
  - Fixed issue where ships with very small amounts of cheap cargo couldn't find trades
  - Problem: `find_buy_offer` without explicit amount filters may filter out offers where ship has less cargo than station wants
    * Example: Ship has 5 energy cells, station wants 100 → offer filtered out
    * Ship couldn't find any buyers for small cargo amounts
  - Root Cause: Missing explicit minimum amount filters in `find_buy_offer` for sell-only trades
    * Normal trades use `<amount min="10"/>` and `<totalvolume min="100"/>`
    * Sell-only trades had no filters, allowing implicit filtering based on tradepartner capacity
  - Solution: Added explicit minimum filters that allow any amount ≥ 1 for sell-only trades
    * Added `<amount min="1"/>` and `<totalvolume min="1"/>` to `find_buy_offer` in SearchSellOpportunities
    * Added zero amount check to skip offers where tradeAmount is 0 or negative
    * Changed profit comparison from `gt` to `ge` to allow zero profit (minProfit is 0Cr for cargo disposal)
    * Added debug logging when no offers are found
  - Files Modified:
    * `md/gt_trading_search.xml`:
      - Added explicit amount filters to find_buy_offer (lines 2993-2994)
      - Added zero amount check before profit calculation (line 3138)
      - Changed profit comparison to allow zero profit (line 3153)
      - Added debug logging for no offers found (lines 2997-3001)
  - Benefits:
    * Ships can now find buyers for very small cargo amounts (even 1-10 units)
    * Cargo disposal works correctly for cheap/low-value wares
    * Better debugging with explicit logging when no offers found
    * Proper handling of zero-profit trades (cargo disposal priority)

FIX: Debug Message Gating
  - Fixed debug message not properly gated behind full debug toggle
  - Problem: Cache miss cooldown debug message was only gated by TradeSearch debug, not full debug toggle
  - Solution: Added full debug toggle check to message condition
  - Files Modified:
    * `md/gt_trading_search.xml` (line 768): Added `@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging` check
  - Benefits:
    * Debug messages now properly respect full debug toggle setting
    * Reduces log spam when full debug is disabled

Version 0.6.11 - 2025-11-21
---------------------------

FIX: Ship Registry Cleanup for Reassigned Ships
  - Added ship registry cleanup to remove ships that no longer have GT orders
  - Problem: Ships reassigned to vanilla station traders or other non-GT orders remained in `global.$GT_Ships` registry
    * Ghost ships in ship count (e.g., 21 ships reported but only 15 actually GT-controlled)
    * GT continued trying to manage training/XP for ships under station control
    * Training messages appearing for ships that can't gain XP
  - Solution: Added ship registry cleanup loop to `OrphanedPilotCleanup` cue
    * Iterates through all ships in `global.$GT_Ships` registry
    * Checks if each ship still has GT order (direct `GalaxyTraderMK3` or `Assist` with GT commander)
    * If no GT order found, removes ship from registry and cleans up:
      - Removes from `global.$GT_Ships`
      - Removes from `global.$GT_FleetData`
      - Clears pending trade data
      - Updates active trader count
    * Runs on game load + every 5 minutes (same schedule as pilot cleanup)
  - Files Modified:
    * `md/gt_core_system.xml` (added ship registry cleanup loop, lines 796-861)
  - Benefits:
    * Accurate ship count (no ghost ships)
    * No more training messages for station-controlled ships
    * GT stops managing ships that are no longer GT-controlled
    * Backward-compatible (cleans up existing orphaned ships)

FIX: Subordinate Removal Detection
  - Fixed detection logic to properly detect when subordinates are removed from their commanders
  - Problem: When a subordinate was removed from its commander, the ship wasn't detected as a subordinate
    * Ship remained in `global.$GT_Ships` registry
    * Ship only got cleaned up after commander's GT order was revoked
    * Delayed cleanup caused ghost ships in registry
  - Root Cause: Detection logic checked `$ship.commander` (current commander), but when subordinate is removed:
    * `event.param` is `null` (no new commander)
    * `$ship.commander` is already `null` (commander was removed)
    * Check failed and `$wasSubordinate` wasn't set to `true`
  - Solution: Updated `DetectCommanderRemoval` to detect subordinate removal by:
    * Checking if `event.param` is `null` (commander was removed)
    * Checking if ship has `Assist` order (subordinates have Assist orders)
    * Fallback: If ship doesn't have direct GT order and commander was removed, treat as subordinate
  - Files Modified:
    * `md/gt_ship_state_manager.xml` (fixed subordinate detection logic, lines 593-617)
  - Benefits:
    * Subordinates are detected immediately when removed from commander
    * `GT_Ship_Order_Aborted` signal sent immediately
    * Ship removed from `global.$GT_Ships` registry immediately
    * No delayed cleanup waiting for commander's GT order to be revoked

FIX: Vanilla Debug Output Suppression
  - Set `debugchance` to 0 when GT debug logging is disabled
  - Problem: Vanilla docking/movement debug output appeared for GT ships even when GT debug logging was disabled
  - Solution: Check `global.$GT_GlobalSettings.$Debug.$EnableDebugLogging` before passing `debugchance` to vanilla orders
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (gate debugchance behind GT debug toggle)
    * `aiscripts/order.dock.train.xml` (gate debugchance behind GT debug toggle)
  - Benefits:
    * No vanilla debug output when GT debug logging is disabled
    * Cleaner log files

FIX: Debug Log Gating
  - Gated all debug logs and debug-only calculations behind debug toggle
  - Problem: Debug logs and debug-only variable assignments executed even when debug logging was disabled
  - Solution: All `debug_text` statements and debug-only calculations now check full debug condition:
    * `global.$GT_Config.$Debug.$Enabled and global.$GT_Config.$Debug.$TradeSearch and @global.$GT_GlobalSettings.$Debug.$EnableDebugLogging`
  - Files Modified:
    * `md/gt_trading_search.xml` (gated all debug logs and debug-only calculations)
  - Benefits:
    * No debug output when debug logging is disabled
    * Reduced CPU overhead from debug-only calculations
    * Cleaner log files

PERFORMANCE: Batch Ship Initialization
  - Improved batch processing delays and removed synchronous operations to prevent stutter
  - Problem: Initializing large fleets (50+ ships) caused game stutter
    * Synchronous ship name updates during registration
    * Insufficient delays between ship processing
  - Solution:
    * Increased PostRegistrationDelay: 100ms → 200ms
    * Increased DelayedRegistrationProcessing: 200ms → 300ms
    * Increased DeferredShipNameUpdate delay: 50ms → 100ms
    * Removed synchronous ship name updates (deferred to prevent stutter)
    * Total delay per ship: 300ms → 500ms
  - Files Modified:
    * `md/gt_core_system.xml` (increased delays, removed synchronous name updates)
  - Benefits:
    * Smooth initialization of large fleets (50+ ships)
    * No game stutter during ship registration
    * Ship name updates deferred to prevent blocking


PERFORMANCE: Removed FleetPosition Calculation Loop
  - Removed expensive O(n) loop that calculated fleet position during ship registration
  - Problem: When assigning orders to commander ships with many subordinates, each subordinate registration looped through ALL subordinates to find its position
    * Commander with 50 subordinates → Each registration loops through 50 ships
    * Total: 50 × 50 = 2,500 iterations synchronously
    * Result: Game stutter when assigning orders to large fleets
  - Solution: Removed FleetPosition calculation entirely
    * FleetPosition was not being used (Get_Fleet_Startup_Delay library not called)
    * Trade search queue already prevents simultaneous searches via MaxConcurrent
    * FleetPosition remains initialized to 0 (default value)
  - Files Modified:
    * `md/gt_libraries_general.xml` (removed FleetPosition calculation loop, lines 1903-1910)
  - Benefits:
    * Eliminates O(n) loop during ship registration
    * No stutter when assigning orders to commander ships with many subordinates
    * No functional changes (FleetPosition wasn't being used anyway)

PERFORMANCE: Cached Active Trader Count (Fleet Coordination Optimization)
  - Implemented cached active trader count to replace expensive O(n) loops
  - Problem: Handle_Fleet_Coordination library looped through ALL registered ships to count active traders
    * When assigning orders to many ships, each registration triggered fleet coordination check
    * Each check looped through all ships (50 ships × 50 iterations = 2,500 operations)
    * Result: Game stutter during order assignment
  - Solution: Implemented incremental cache maintenance
    * Cache initialized: `global.$GT_ActiveTraderCount` (starts at 0)
    * Incremented when operational ships register
    * Decremented when operational ships unregister/cleanup
    * Used directly instead of expensive loop
    * Fallback to manual count if cache missing (safety)
  - Implementation:
    * Initialization (`md/gt_trading_ai.xml`): Initialize cache to 0
    * Registration (`md/gt_libraries_general.xml` - Register_Ship): Increment cache if ship operational
    * Cleanup (`md/gt_libraries_general.xml` - Cleanup_Ship_Data): Decrement cache if ship operational
    * Unregistration (`md/gt_core_system.xml` - UnregisterShip): Decrement cache if ship operational
    * Fleet Coordination (`md/gt_libraries_general.xml` - Handle_Fleet_Coordination): Use cached value instead of loop
  - Files Modified:
    * `md/gt_trading_ai.xml` (added cache initialization)
    * `md/gt_libraries_general.xml` (added cache updates in Register_Ship, Cleanup_Ship_Data, Handle_Fleet_Coordination)
    * `md/gt_core_system.xml` (added cache update in UnregisterShip)
  - Benefits:
    * Eliminates O(n) loops during fleet coordination checks
    * O(1) cache lookup instead of O(n) iteration
    * Cache maintained incrementally (no expensive recalculation)
    * Significant performance improvement with large fleets

PERFORMANCE: Skip Fleet Coordination Count If Disabled
  - Added optimization to skip active trader counting when fleet coordination is disabled
  - Problem: Even when fleet coordination was disabled, system still counted active traders unnecessarily
  - Solution: Skip counting entirely if fleet coordination disabled
    * Check `$config.$FleetCoordination` before counting
    * If disabled, set `$activeTraders = 0` immediately
    * No cache access or counting overhead
  - Files Modified:
    * `md/gt_libraries_general.xml` (added skip logic in Handle_Fleet_Coordination)
  - Benefits:
    * Zero overhead when fleet coordination disabled
    * Faster registration for ships without fleet coordination
    * Cleaner code flow

FIX: SearchFallbackTrades Namespace Missing
  - Issue: SearchFallbackTrades cue referenced without full namespace path
  - Problem: Line 1752 in `gt_trading_search.xml` used `cue="SearchFallbackTrades"` instead of full path
    * Cue exists in `gt_search_methods.xml` (script `GT_Search_Methods`)
    * Without namespace, X4 couldn't find cue → returned null → error
  - Solution: Added full namespace path: `md.GT_Search_Methods.SearchFallbackTrades`
  - Files Modified:
    * `md/gt_trading_search.xml` (fixed namespace on line 1752)
  - Impact: Fallback trade search now works correctly when triggered
  - Error Fixed:
    * "Property lookup failed: SearchFallbackTrades"
    * "Evaluated value 'null' is not of type cue"

Version 0.6.10 - 2025-11-19
---------------------------

PERFORMANCE: Removed Redundant Maintenance Timeout Monitor
  - Removed `MonitorMaintenanceTimeouts` cue that was polling every 5 seconds
  - This was redundant because AI script already has built-in timeout
  - The MD timeout monitor only cleaned up stale MD state, but didn't prevent ships from getting stuck
  - AI script timeout already handles ship recovery if maintenance signals fail
  - Impact: Eliminates unnecessary CPU polling every 5 seconds
  - Files Modified:
    * `md/gt_maintenance.xml` (removed MonitorMaintenanceTimeouts cue)

CHANGE: Increased Maintenance Timeout from 600s to 900s
  - Increased AI script maintenance wait timeout from 600s to 900s
  - Gives maintenance orders more time to complete before timeout
  - Updated debug messages to reflect new timeout value
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (increased wait max from 600s to 900s)

PERFORMANCE: Improved Trade Search Loop CPU Yielding
  - Reduced batch size from 15 to 10 trades per batch
  - Added CPU yielding inside loops: delays every 3 iterations (1ms delay)
  - Prevents game stuttering during large trade searches
  - Maintains responsiveness while processing thousands of trades
  - Impact: Better frame rate stability during trade filtering operations
  - Files Modified:
    * `md/gt_trading_search.xml` (reduced batch size, added yielding inside loops)

FIX: ROUTE_PATH_CHANGED Categorization
  - Issue: Route path changes during transit were incorrectly categorized as MARKET failures
  - Problem: When route path changed mid-flight, system triggered new search instead of trying next cached trade
  - Root Cause: ROUTE_PATH_CHANGED was missing from pathingFailureReasons list
  - Solution: Added 'ROUTE_PATH_CHANGED' to pathingFailureReasons list
  - Impact: Route changes during transit now correctly trigger "try next trade" behavior instead of "start new search"
  - Behavior Change:
    * PATHING failures: Try next best trade from cache (skip failed route)
    * MARKET failures: Start new search (market conditions changed)
  - Files Modified:
    * `md/gt_trading_signals.xml` (added ROUTE_PATH_CHANGED to pathingFailureReasons list)
  - Benefits:
    * Ships recover faster from route changes during transit
    * More efficient trade execution (uses cached trades instead of expensive new searches)
    * Better handling of dynamic route changes (blacklist updates, sector threats)

FIX: GT_FailedTrades Deadlock Prevention
  - Issue: Ships could get stuck in infinite loop when all trades matched failed sector pairs
  - Problem Scenario:
    1. Ship accumulates failed sector pairs in $GT_FailedTrades
    2. All trades filtered out (match failed sector pairs)
    3. GT_No_Trade_Found → retry search
    4. Same trades found → all filtered again → infinite loop
    5. $GT_FailedTrades never cleared (only cleared on successful trade)
  - Solution: Implemented three-layer protection
    1. Time-based expiration: Failed trade entries expire after 30 minutes
       * Automatically cleaned when loading failed trades list
       * Routes may become available again after temporary issues resolve
    2. Clear on fallback failure: Clear $GT_FailedTrades when fallback search also finds nothing
       * Prevents deadlock when all routes are blocked
       * Allows ship to retry routes that may have become available
    3. Expiration applied in all three search methods (cache, best trade, live search)
  - Implementation:
    * Expiration check runs when loading failed trades (3 locations)
    * Entries older than 30 minutes automatically removed
    * Fallback search failure triggers full list clear
  - Files Modified:
    * `md/gt_search_methods.xml` (added expiration logic in 3 locations: cache search, best trade selection, live search)
    * `md/gt_trading_search.xml` (added clear on fallback failure)
  - Benefits:
    * Prevents ships from getting permanently stuck
    * Routes become available again after temporary issues (gates destroyed/rebuilt, blacklists cleared)
    * Better recovery from edge cases (all routes blocked)
    * No manual intervention needed

PERFORMANCE: Event-Driven Mobile Satellite Intelligence (Replaces Polling System)
  - Major performance improvement: Converted Mobile Satellite Intelligence from polling-based to event-driven architecture
  - Problem: Old system polled every 10 seconds (`checkinterval="10s"`), processing ALL active trading ships
    * Used expensive `find_station` queries for every ship
    * High CPU overhead with large fleets (N ships × every 10s = constant CPU load)
    * Processed ships even when no stations were nearby
  - Solution: Replaced with true event-driven system using vanilla gravidar scan events
    * Uses `event_gravidar_has_scanned` (vanilla event, zero CPU when no stations detected)
    * Only processes when stations actually enter radar range
    * AI script detects stations via gravidar, signals MD immediately
    * MD processes station (cooldown check, subscription, trade snapshot)
  - Implementation:
    * AI Script Handler (`aiscripts/order.trade.galaxytrader.xml`):
      - Event handler: `event_gravidar_has_scanned` fires when stations enter radar range
      - Level check: Only Level 9+ pilots can detect stations (skill gate maintained)
      - Settings check: Respects MobileIntel enable/disable setting
      - Station detection: Uses `find_gravidar_contact` to find stations in radar range
      - Signals MD: `signal_objects` with `GT_Station_Detected` signal
    * MD Handler (`md/gt_market_intelligence.xml`):
      - Event-driven cue: `ProcessStationDetection` receives `GT_Station_Detected` signal
      - Processes station: Cooldown check, trade subscription, trade snapshot
      - Validation: Station exists, operational, no faction-level subscription
    * Old System: Disabled (polling cue commented out to prevent CPU overhead)
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (added event-driven gravidar scan handler)
    * `md/gt_market_intelligence.xml` (added ProcessStationDetection cue, disabled old polling cue)
  - Benefits:
    * 90%+ CPU reduction (no polling, only processes when stations detected)
    * Uses vanilla patterns (same approach as threat intelligence system)
    * Skill gate maintained (Level 9+ pilots only)
    * Same functionality as old system (cooldown, subscription, trade snapshot)
    * Zero CPU overhead when ships are in empty space
    * Scales efficiently with fleet size (event-driven, not per-ship polling)
  - Impact: Eliminates unnecessary CPU polling every 10 seconds for all active trading ships

Version 0.6.9 - 2025-11-19
---------------------------

FEATURE: Configurable Report Frequencies
  - Added two sliders in Global Settings > Notifications section to control report frequencies
  - Simple Report Frequency: 0-30 minutes (0 = disabled, default: 1 minute)
    * Controls popup notification reports with basic fleet stats
    * Shows Active Ships, Total Profit, and Trades Completed
  - Comprehensive Report Frequency: 0-60 minutes (0 = disabled, default: 30 minutes)
    * Controls detailed logbook reports with full fleet analysis
    * Includes fleet overview, top performers, XP/training status, market intelligence, and configuration summary
  - Implementation:
    * Settings stored in global.$GT_GlobalSettings.$Notifications
    * Simple reports check every 60 seconds, only generate if frequency > 0 and enough time has passed
    * Comprehensive reports check every 5 minutes, only generate if frequency > 0 and enough time has passed
    * Both reports respect the 0 = disabled setting
  - Files Modified:
    * `md/gt_global_settings.xml` (initialization, validation, UI sliders)
    * `md/gt_core_system.xml` (simple report timing logic)
    * `md/gt_reporting.xml` (comprehensive report timing logic)
    * All 8 translation files (IDs 9246-9247, 9346-9347)
  - Benefits:
    * Players can customize report frequency to their preference
    * Can disable either report type by setting to 0
    * More control over notification spam
    * Better performance for players who don't want frequent reports

FEATURE: Korean Translation Support
  - Added complete Korean translation file (0001-l082.xml)
  - Includes all translation IDs from other language files
  - Covers all recent features: sector whitelist, carrier/aux filters, build storage filters, number formatting, report frequencies
  - Files Added:
    * `t/0001-l082.xml` (Korean translation file)
  - Benefits:
    * Full Korean language support for GalaxyTrader MK3
    * Consistent translation coverage across all 9 supported languages

FIX: Risk Tolerance Parameter Removal
  - Removed all remaining references to non-functional risk tolerance parameter
  - Fixed errors: "Property lookup failed: $order.$risktolerance" and "script parameter 'risktolerance' was not expected"
  - Removed from:
    * order.assist.xml: Parameter passing in create_order and run_script (3 instances)
    * order.trade.galaxytrader.xml: GT_Find_Sell signal parameter
    * gt_configuration.xml: Order parameter extraction
    * gt_libraries_general.xml: Variable assignment and debug output
    * gt_reporting.xml: Fleet report display
  - Files Modified:
    * `aiscripts/order.assist.xml` (removed risktolerance parameter passing)
    * `aiscripts/order.trade.galaxytrader.xml` (removed RiskTolerance from GT_Find_Sell signal)
    * `md/gt_configuration.xml` (removed RiskTolerance from order parameter extraction)
    * `md/gt_libraries_general.xml` (removed gt_risktolerance variable and debug output)
    * `md/gt_reporting.xml` (removed Risk Tolerance from fleet report)
  - Benefits:
    * Eliminates script errors related to missing risk tolerance parameter
    * Cleaner codebase without unused parameter references
    * No more error spam in game logs

FIX: Cargo Disposal Spam Prevention
  - Issue: When a trader had cargo and couldn't find a buyer, it would retry repeatedly and generate spam messages
  - Root Cause: Cargo disposal attempts used the same retry logic as normal trades, but didn't track failures separately
  - Problem Scenario:
    1. Ship has cargo → sends GT_Find_Sell
    2. No buyer found → GT_No_Trade_Found signal
    3. Retry logic waits and retries
    4. Returns to main loop → cargo check still true → sends GT_Find_Sell again
    5. Infinite loop → spam messages
  - Solution: Separate cargo disposal tracking with escalating timing
    * Added separate failure counter: `this.$cargoDisposalFailed` (independent from normal trade failures)
    * Uses same escalating wait timing as normal trades: 10s, 20s, 30s, 40s, 50s, 60s (max)
    * Only logs initial cargo disposal message once (checks if counter == 0)
    * After 6 attempts (60s wait), writes separate logbook entry explaining failure
    * Counter resets when: successful trade completes OR cargo is cleared
  - Implementation:
    * Modified `order.trade.galaxytrader.xml`:
      - Cargo check section (~line 1691): Only logs initial message on first attempt
      - GT_No_Trade_Found handler (~line 1821): Detects if failure is from cargo disposal
      - no_trade_retry label (~line 3120): Tracks cargo disposal failures separately, uses escalating timing
      - Logbook entry (~line 3160): Separate failure message after multiple attempts
      - Success handlers: Reset cargo disposal counter on trade success or cargo clearance
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (separate cargo disposal tracking, escalating timing, single initial message, separate failure message)
  - Benefits:
    * No more spam: Initial message only logged once
    * Escalating timing: Same pattern as normal trades (10s → 60s)
    * Separate failure message: Distinct logbook entry after multiple failures
    * Automatic cleanup: Counters reset on success or cargo clearance
    * Better UX: Players informed about cargo disposal status without spam

FIX: Sector Whitelist Null Property Access
  - Issue: Error "Property lookup failed: $commanderWhitelist.count" when commander's sector whitelist was null
  - Root Cause: The `?` operator checks if a variable EXISTS, not if it's non-null. A variable set to null still "exists" and returns true for `?`, but accessing `.count` on null fails
  - Problem: In `GT_GetSectorWhitelist` library, when `@$ship.commander.defaultorder.$sectorwhitelist` returned null, the code checked `$commanderWhitelist?` (which returned true) then tried to access `.count` on null, causing a crash
  - Solution: Extract the count property with `@` operator first, then check if that result exists and is valid
    * Changed from: `$commanderWhitelist? and $commanderWhitelist.count gt 0`
    * Changed to: Extract `@$commanderWhitelist.count` → `$commanderWhitelistCount`, then check `$commanderWhitelistCount? and $commanderWhitelistCount gt 0`
    * Applied same fix to both commander whitelist and ship whitelist checks
  - Files Modified:
    * `md/gt_libraries_blacklist.xml` (GT_GetSectorWhitelist library, lines 35 and 45)
  - Benefits:
    * Eliminates "Property lookup failed" errors when whitelist is null
    * Proper null-checking pattern following validated X4 MD script conventions
    * Prevents crashes when ships don't have sector whitelists configured


Version 0.6.8 - 2025-11-19
---------------------------

FEATURE: Additional Trade Filters - Carrier/Aux and Build Storage Exclusion
  - Added two new filter options to exclude specific station types from trading
  - New Parameters:
    * Ignore Carrier/Aux Ships: Excludes carriers and auxiliary ships from trading (default: off)
    * Ignore Build Storage: Excludes build storage stations from trading (default: off)
  - Implementation:
    * Filters applied during trade search and filtering phases
    * Carrier/Aux detection: Checks station primarypurpose (purpose.auxiliary or purpose.fight)
    * Build Storage detection: Checks station isclass.buildstorage property
    * Filters both buy and sell stations in trade routes
    * Works with both normal trade search and cargo disposal (GT_Find_Sell)
    * Subordinate ships inherit filter settings from commander
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (parameter definitions, inheritance, signal passing)
    * `md/gt_libraries_general.xml` (GT_FilterTradeForShip - filtering logic)
    * `md/gt_trading_search.xml` (GT_Find_Sell filtering, parameter passing)
    * `md/gt_trading_ai.xml` (parameter storage)
    * All 8 translation files (IDs 1054-1057)
  - Benefits:
    * Players can exclude carrier/auxiliary ships from trading if desired
    * Players can exclude build storage stations from trading
    * Better control over trade route selection
    * Consistent filtering across all trade search methods

FEATURE: Sector Whitelist - Override Blacklists for Specific Sectors
  - Added sector whitelist parameter to default order menu
  - Allows players to define sectors that are always allowed, overriding blacklist restrictions
  - Implementation:
    * New parameter: Sector Whitelist (list of sectors, default: empty)
    * Galaxy map selection support for easy sector selection
    * Whitelist checked before blacklist checks in all pathfinding and filtering logic
    * Subordinate ships inherit whitelist from commander
    * Integrated into GT_IsSectorBlacklisted library (checks whitelist first)
    * Integrated into GT_FindSectorsInRange pathfinding library
    * Direct blacklist checks in AI script respect whitelist
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (parameter definition, inheritance, signal passing)
    * `md/gt_libraries_blacklist.xml` (GT_IsSectorBlacklisted, GT_GetSectorWhitelist)
    * `md/gt_libraries_pathfinding.xml` (GT_FindSectorsInRange)
    * All 8 translation files (IDs 1052-1053)
  - Benefits:
    * Override blacklists for specific sectors (e.g., always allow trading in home sectors)
    * Fine-grained control over sector access
    * Works with all blacklist types (sector activity, sector travel, object activity)
    * Fleet-wide inheritance for consistent behavior

FEATURE: Customizable Number Formatting
  - Added configurable number formatting for profit displays and reports
  - New Global Settings:
    * Format Style: Choose between German (123.456.789) or English (123,456,789) format
    * Use M Suffix: Enable "M" suffix for numbers greater than threshold (e.g., 1.5 M Cr)
    * M Suffix Threshold: Minimum value to use M suffix (default: 999,999)
  - Implementation:
    * New library: GT_FormatNumber (md/gt_libraries_general.xml)
    * Formats numbers with thousand/decimal separators based on style
    * Adds "M" suffix for large numbers when enabled
    * All profit displays use formatted numbers with "Cr" suffix
    * Applied to trade logbook entries, fleet reports, and all profit displays
  - Files Modified:
    * `md/gt_libraries_general.xml` (GT_FormatNumber library)
    * `md/gt_global_settings.xml` (UI controls and validation)
    * `md/gt_trade_logging.xml` (all profit displays)
    * `md/gt_reporting.xml` (fleet report profit displays)
    * All 8 translation files (IDs 9239-9245, 9340, 9342-9343)
  - Benefits:
    * Better readability for large numbers
    * Language-appropriate formatting (German vs English)
    * Consistent formatting across all displays
    * Customizable threshold for M suffix

REMOVED: Risk Tolerance Setting
  - Removed non-functional risk tolerance parameter from default order menu
  - Parameter was stored and passed through system but never used in trade filtering or scoring
  - Price range filtering uses global settings sliders instead
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (parameter removed, all references cleaned up)
    * `md/gt_trading_ai.xml` (parameter removed from signal handlers)
  - Note: Global risk tolerance config setting remains (unused, may be used in future)

Version 0.6.7 - 2025-11-15
---------------------------

FIX: Race Condition in Search Results - Per-Ship Global Table
  - Issue: Critical race condition in global.$GT_SearchResult causing ships to receive wrong trade results
  - Root Cause: Single shared global.$GT_SearchResult table accessed by multiple ships simultaneously during parallel searches
  - Problem:
    * Ship A starts search → writes results to global.$GT_SearchResult
    * Ship B starts search → overwrites Ship A's results with its own
    * Ship A reads results → gets Ship B's trades instead of its own
    * Ship B reads results → gets its own trades (correct)
    * Result: Ships execute trades for wrong destinations, wrong wares, wrong stations
    * Multiple ships searching simultaneously caused frequent cross-contamination
  - Solution: Changed from single shared table to per-ship indexed global table:
    * Old: global.$GT_SearchResult.$Found, global.$GT_SearchResult.$BestTrade, etc.
    * New: global.$GT_SearchResult.{$ship}.$Found, global.$GT_SearchResult.{$ship}.$BestTrade, etc.
    * Each ship now has isolated storage: global.$GT_SearchResult.{$ship}
    * Shared data (LastRejectionStats) remains at top level: global.$GT_SearchResult.$LastRejectionStats
  - Implementation:
    * Modified GT_InitializeGlobalTables (gt_configuration.xml)
      - Initialize global.$GT_SearchResult as container table with $LastRejectionStats
      - Per-ship entries created on-demand when searches complete
    * Modified SearchCachedTrades (gt_search_methods.xml)
      - Write results to global.$GT_SearchResult.{$ship} instead of shared table
      - Removed defensive checks for other waiting ships (no longer needed)
    * Modified CheckTradeCache (gt_trading_queue.xml)
      - Read results from global.$GT_SearchResult.{$ship}
      - Removed verification block that checked if results belong to THIS ship
    * Modified SearchTradeRoutes (gt_trading_search.xml)
      - Parameter reconstruction: Removed reliance on global.$GT_SearchResult for ship identification
      - Continuation detection: Read from global.$GT_SearchResult.{$ship}
      - Cache results extraction: Read from global.$GT_SearchResult.{$ship}
      - Final results storage: Write to global.$GT_SearchResult.{$ship}
      - Cleanup: Remove entire global.$GT_SearchResult.{$ship} entry when done
    * Modified SearchLiveTrades_Resume (gt_trading_search.xml)
      - Write final results to global.$GT_SearchResult.{$ship}
    * Modified GT_CheckBatchStatus (gt_libraries_general.xml)
      - Read from global.$GT_SearchResult.{$ship}
    * Confirmed GT_UpdateLastRejectionStats (gt_libraries_general.xml)
      - Correctly handles shared global.$GT_SearchResult.$LastRejectionStats at top level
  - Files Modified:
    * `md/gt_configuration.xml` (GT_InitializeGlobalTables)
    * `md/gt_search_methods.xml` (SearchCachedTrades)
    * `md/gt_trading_queue.xml` (CheckTradeCache)
    * `md/gt_trading_search.xml` (SearchTradeRoutes, SearchLiveTrades_Resume)
    * `md/gt_libraries_general.xml` (GT_CheckBatchStatus)
  - Benefits:
    * Eliminates race condition completely - each ship has isolated storage
    * Ships can search simultaneously without cross-contamination
    * No more wrong trades executed due to shared state corruption
    * Proper cleanup prevents memory leaks (per-ship entries removed when done)
    * Shared LastRejectionStats still works correctly for rejection tracking

FIX: Rerouting Logic Flaw - Unreachable Destination Detection
  - Issue: Ships didn't reroute when destination became unreachable via normal path (disconnected sectors, destroyed gates)
  - Root Cause: Reroute check only executed when $normalDistance ge 0, skipping case where normal path doesn't exist
  - Problem:
    * Ship enters new sector → checks destination reachability
    * Normal path doesn't exist ($normalDistance lt 0) → reroute check skipped entirely
    * Ship continues trying to reach unreachable destination
    * Ship gets stuck or wastes time attempting impossible route
    * Only blacklist-aware path changes triggered rerouting, not complete path failures
  - Solution: Split reroute logic into two cases:
    * Case 1: Normal path doesn't exist ($normalDistance lt 0) → Always reroute immediately
    * Case 2: Normal path exists but blacklist-aware path blocked/longer → Reroute if needed
  - Implementation:
    * Modified GT Sector-Change Rerouting handler (aiscripts/move.generic.xml)
      - Changed from nested do_if to do_if/do_elseif structure
      - Case 1: Handle $normalDistance lt 0 (unreachable destination)
        * Set reroute flag
        * Update ship name to show [REROUTE] state
        * Send logbook notification with "UNREACHABLE" status
        * Signal dock failure to parent order
        * Abort move.generic to return control
      - Case 2: Handle $normalDistance ge 0 with path changes (existing logic)
        * Check if blacklist-aware path blocked or longer
        * Same reroute logic as before
  - Files Modified:
    * `aiscripts/move.generic.xml` (lines 59-165)
  - Benefits:
    * Ships now detect unreachable destinations when entering new sectors
    * Ships reroute immediately when sectors disconnect or gates destroyed
    * Proper logbook notifications for both unreachable and blocked paths
    * Prevents ships from wasting time on impossible routes
    * Complete coverage: handles both path failures and path changes

FIX: Decreasing Fallback Distance
  - Issue: Fallback search distance was decreasing with each attempt (e.g., 3 → 1 jumps)
  - Root Cause: Fallback distance calculation was using already-reduced $maxDistance instead of original $originalMaxDistance
  - Solution: Use $originalMaxDistance for fallback calculation if available
    * Preserves original search range for fallback distance calculation
    * Ensures fallback distance remains consistent across attempts
  - Files Modified:
    * `md/gt_trading_search.xml` (SearchTradeRoutes, FilterTradeList_Resume)
  - Benefits:
    * Fallback distance remains consistent (doesn't decrease)
    * Better fallback search coverage
    * More accurate logbook messages showing original search range

FIX: Temporary XP Block Release Clearing
  - Issue: Temporary XPBlocked release (when no training stations found) wasn't being cleared after trades
  - Root Cause: XPBlocked was cleared to allow trading, but wasn't restored after trade completion
  - Solution: Restore XPBlocked flag after every trade completion and on ship restart/reinitialization
    * Ensures pilots cannot gain XP without training while still allowing ships to trade
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (GT_Trade_Completed handler, init label)
  - Benefits:
    * Temporary XP block release properly cleared after trades
    * Pilots cannot bypass training requirement
    * Ships can still trade when training stations unavailable

FIX: Missing MaxBuy/MaxSell Parameters in GT_Find_Trade Signal
  - Issue: "null jumps" appearing in logs when triggering live search after cached trades rejected
  - Root Cause: GT_Find_Trade signal sent without MaxBuy/MaxSell parameters when forcing live search
  - Solution: Include MaxBuy/MaxSell parameters in all GT_Find_Trade signals
    * Use effectiveMaxBuy/effectiveMaxSell if available (for subordinates)
    * Fall back to maxbuy/maxsell from order parameters
    * Also include HomeBase parameter
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (GT_Trade_Found interrupt handler)
    * `md/gt_trading_search.xml` (added validation to fail loudly if maxDistance is null)
    * `md/gt_trading_queue.xml` (added validation to fail loudly if maxDistance is null)
  - Benefits:
    * No more "null jumps" in logs
    * Proper distance parameters always included
    * System fails loudly if parameters are missing (no silent fallbacks)

NEW FEATURE: Ship Name Label [FALLBACK] for Fallback Search Mode
  - Added new ship name prefix [FALLBACK] to indicate when ships are using fallback search mode
  - Behavior: Ship name shows [FALLBACK] when a trade is found during fallback search (expanded search range when normal search fails)
  - Implementation:
    * Added TextDB entry 7008 for [FALLBACK] in all 8 language files
    * Added nameType='fallback' handling in UpdateShipName cue (gt_xp_training.xml)
    * Fallback detection: Checks if searchState == 'fallback' when trade is found
    * Sets global.$GT_FallbackTradeActive.{$ship} = true when fallback trade is found
    * Updates ship name with [FALLBACK] flag when trade comes from fallback search
  - Flag Management:
    * Flag is set when a fallback trade is found (searchState == 'fallback')
    * Flag persists during trade execution
    * Flag is cleared when a normal search succeeds (cache or live, not fallback)
    * Flag is cleared on trade failure
  - Files Modified:
    * `md/gt_xp_training.xml` (UpdateShipName cue - added fallback nameType handling)
    * `md/gt_trading_search.xml` (SearchTradeRoutes - fallback detection and flag management)
    * `aiscripts/order.trade.galaxytrader.xml` (GT_Trade_Failed handler - flag clearing)
    * `t/0001-l044.xml` (English: [FALLBACK])
    * `t/0001-l049.xml` (German: [FALLBACK])
    * `t/0001-l033.xml` (French: [REPLI])
    * `t/0001-l034.xml` (Spanish: [RESPALDO])
    * `t/0001-l039.xml` (Italian: [FALLBACK])
    * `t/0001-l055.xml` (Portuguese: [FALLBACK])
    * `t/0001-l007.xml` (Russian: [ОТКАТ])
    * `t/0001-l086.xml` (Chinese: [后备])
  - Benefits:
    * Easy visual identification of ships using fallback search mode
    * Helps players understand when ships are using expanded search ranges
    * Provides operational state visibility for debugging and monitoring
    * Proper localization for all supported languages

NEW FEATURE: Ship Name Label [ISOLATED] for Isolated Ships
  - Added new ship name prefix [ISOLATED] to indicate when ships are operating in isolated sectors
  - Behavior: Similar to [FALLBACK] label, but specifically for ships that are isolated (all routes blocked by blacklisted sectors)
  - Implementation:
    * Added TextDB entry 7009 for [ISOLATED] in all 8 language files
    * Added nameType='isolated' handling in UpdateShipName cue (gt_xp_training.xml)
    * Isolation detection when trade is found: Checks if ship is isolated using GT_CheckAndHandleIsolation
    * Sets global.$GT_IsolatedTradeActive.{$ship} = true when isolated trade is found
    * Updates ship name with [ISOLATED] flag when ship is isolated and finds a trade
  - Flag Management:
    * Flag is set when an isolated trade is found (and not in fallback mode)
    * Flag persists during trade execution
    * Flag is cleared when a normal search succeeds (not fallback)
    * Flag is cleared on trade failure
  - Files Modified:
    * `md/gt_xp_training.xml` (UpdateShipName cue - added isolated nameType handling)
    * `md/gt_trading_search.xml` (SearchTradeRoutes - isolation detection and flag management)
    * `aiscripts/order.trade.galaxytrader.xml` (GT_Trade_Failed handler - flag clearing)
    * `t/0001-l044.xml` (English: [ISOLATED])
    * `t/0001-l049.xml` (German: [ISOLATED])
    * `t/0001-l033.xml` (French: [ISOLÉ])
    * `t/0001-l034.xml` (Spanish: [AISLADO])
    * `t/0001-l039.xml` (Italian: [ISOLATED])
    * `t/0001-l055.xml` (Portuguese: [ISOLATED])
    * `t/0001-l007.xml` (Russian: [ИЗОЛИРОВАН])
    * `t/0001-l086.xml` (Chinese: [隔离])
  - Benefits:
    * Easy visual identification of ships operating in isolated sectors
    * Helps players understand why ships are limited to intra-sector trading
    * Consistent with [FALLBACK] label pattern for operational state visibility
    * Proper localization for all supported languages


Version 0.6.6 - 2025-11-15 => reverted
---------------------------

FIX: Search Queue Deadlock - Config Reload Recovery => reverted
  - Issue: Search queue permanently deadlocked after configuration reloads or other resets
  - Root Cause: When SearchLiveTrades_Resume couldn't find original parameters ($originalParams? is false) because config reload cleared global.$GT_SearchQueue.$Params and global.$GT_BatchDataList, it only logged a warning and didn't signal SearchTradeRoutes
  - Problem:
    * SearchTradeRoutes cleanup never runs (where locks are released and counter is decremented)
    * global.$GT_SearchLocks.{ship} stays set forever, preventing ship from requesting new trades
    * global.$GT_SearchQueue.$ActiveSearches never decrements, blocking all subsequent ships
    * All GT traders stop finding trades immediately after any config reload
  - Solution: Added emergency cleanup in the $originalParams? false branch:
    * Release search lock (global.$GT_SearchLocks.{ship})
    * Clean up AI parameters (global.$GT_AIParameters.{ship})
    * Clean up queue params (global.$GT_SearchQueue.$Params.{ship})
    * Decrement active search counter (global.$GT_SearchQueue.$ActiveSearches)
    * Try to reconstruct params from batch data (if still available) and requeue ship
    * If no params available, signal AI with GT_No_Trade_Found to restart
  - Implementation:
    * Modified SearchLiveTrades_Resume (gt_trading_search.xml)
      - Added emergency cleanup code in $originalParams? false branch (lines 2701-2778)
      - Reconstructs params from batch data if available, otherwise signals AI to restart
  - Files Modified:
    * `md/gt_trading_search.xml` (lines 2701-2778)
  - Benefits:
    * Prevents queue deadlock when config reload clears params mid-search
    * Ships can request new trades even after config reload
    * Queue continues processing other ships instead of blocking permanently
    * Eliminates "all traders stuck after config change" scenario
    * Proper resource cleanup prevents memory leaks

FIX: Search Queue Deadlock - Missing Batch Results Cleanup => reverted
  - Issue: Search queue permanently deadlocked when batch results were missing
  - Root Cause: When SearchLiveTrades_Resume couldn't fetch batch results ($results? is false), it cleaned up batch data and requeued the ship but didn't release search locks or decrement active search counter
  - Problem: 
    * global.$GT_SearchQueue.$ActiveSearches never decremented, blocking all subsequent ships from being processed
    * global.$GT_SearchLocks.{$ship} never cleared, preventing ship from requesting new trades
    * global.$GT_SearchQueue.$Params.{$ship} and global.$GT_AIParameters.{$ship} left as stale data
  - Solution: Added proper cleanup in the not $results? branch before requeueing:
    * Release search lock (global.$GT_SearchLocks.{$ship})
    * Clean up AI parameters (global.$GT_AIParameters.{$ship})
    * Clean up queue params (global.$GT_SearchQueue.$Params.{$ship})
    * Decrement active search counter (global.$GT_SearchQueue.$ActiveSearches)
  - Implementation:
    * Modified SearchLiveTrades_Resume (gt_trading_search.xml)
      - Added cleanup code in not $results? branch (lines 1715-1741)
      - Matches cleanup pattern from normal SearchTradeRoutes completion path
  - Files Modified:
    * `md/gt_trading_search.xml` (lines 1715-1741)
  - Benefits:
    * Prevents queue deadlock when batch results are missing (race conditions, save/load timing)
    * Ships can request new trades even after batch failure
    * Queue continues processing other ships instead of blocking permanently
    * Eliminates "all traders stuck" scenario
    * Proper resource cleanup prevents memory leaks

FIX: Training Station Search Failed - Ship Continues Trading => reverted
  - Issue: Ships with ADVANCE status (XPBlocked) got stuck in infinite loop when no training stations were accessible
  - Root Cause: When HandleTrainingNeeded couldn't find any reachable training stations, it didn't signal the AI, causing the AI's 10-second wait loop to timeout and retry indefinitely
  - Problem:
    * Ship detects XPBlocked status → initiates training search
    * Training system finds no accessible stations → doesn't signal AI
    * AI waits 10s for GT_Training_Station_Found → timeout
    * AI resumes main_loop → detects XPBlocked again → infinite loop
    * Ship never trades, just keeps searching for training stations
  - Solution: When no training stations found, temporarily clear XPBlocked to allow trading while preserving BlockedLevel:
    * Clear XPBlocked flag (allows ship to trade)
    * Keep BlockedLevel (remembers what level training is needed)
    * Signal GT_No_Trade_Found to break AI wait loop
    * Ship continues trading and checks for training again on next opportunity
  - Implementation:
    * Modified HandleTrainingNeeded (gt_xp_training.xml)
      - Added else branch when no stations found (lines 1957-1984)
      - Clears XPBlocked, keeps BlockedLevel, signals AI
    * Modified AI training wait block (order.trade.galaxytrader.xml)
      - Added GT_No_Trade_Found to interrupt conditions (lines 1555-1576)
      - Removed 30s cooldown (ship continues immediately)
  - Files Modified:
    * `md/gt_xp_training.xml` (lines 1957-1984)
    * `aiscripts/order.trade.galaxytrader.xml` (lines 1555-1576)
  - Benefits:
    * Ships don't get stuck when training stations are unavailable
    * Ships continue trading while waiting for training opportunities
    * Automatic retry when stations become available
    * No wasted time waiting for unreachable stations

FEATURE: Logbook Message for Training Station Search Failure
  - Added immersive logbook message when pilots cannot find accessible training stations
  - Content: Pilot reports inability to find training station, will continue trading, understands XP will be blocked, will search again after trade run
  - Implementation:
    * Added TextDB entry 3223 in all 8 language files
    * Updated HandleTrainingNeeded to write logbook message when no stations found
    * Message uses readtext.{77000}.{3223}.[$blockedLevel] for localization
  - Files Modified:
    * `md/gt_xp_training.xml` (lines 1965-1976)
    * `t/0001-l044.xml` (English)
    * `t/0001-l049.xml` (German)
    * `t/0001-l033.xml` (French)
    * `t/0001-l034.xml` (Spanish)
    * `t/0001-l039.xml` (Italian)
    * `t/0001-l055.xml` (Portuguese)
    * `t/0001-l007.xml` (Russian)
    * `t/0001-l086.xml` (Chinese)
  - Benefits:
    * Players informed when pilots cannot find training stations
    * Immersive role-play experience maintained
    * Clear communication about XP blocking and retry behavior
    * Proper localization for all supported languages

Version 0.6.5 - 2025-11-15
---------------------------

FIX: Cache Hit Detection - Trade List Execution => reverted
  - Issue: Cache hits never executed trades when tradeList had entries but bestTrade was null
  - Root Cause: $Found flag required both tradeList.count > 0 AND bestTrade? to be true
  - Problem: When tradeList had valid entries but none passed GT_IsTradeValid validation, bestTrade stayed null, causing $Found to be false
  - Solution: Changed $Found logic to only require tradeList.count > 0 (bestTrade is for backward compatibility, ExecuteTrade uses TradeList anyway)
  - Implementation:
    * Modified SearchCachedTrades (gt_search_methods.xml)
      - Changed: $Found = ($foundCachedTrade and $tradeList.count gt 0 and $bestTrade?)
      - To: $Found = ($foundCachedTrade and $tradeList.count gt 0)
  - Files Modified:
    * `md/gt_search_methods.xml` (line 1147)
  - Benefits:
    * More cache hits result in trade execution
    * Ships with valid trade lists that don't pass validation can still execute trades
    * Reduces unnecessary live searches when cache has valid entries

FIX: Search Result State Preservation - Waiting Ships => reverted
  - Issue: Search result state was overwritten for ships waiting on live/batch searches
  - Root Cause: When batch results were missing, SearchLiveTrades_Resume reset entire global.$GT_SearchResult structure without preserving waiting ship state
  - Problem: Waiting ship's $WaitingForBatch, $Ship, and trade list were wiped, causing search lock to remain set and live results to never resume
  - Solution: Preserve $WaitingForBatch and $Ship when batch results are missing (another ship might be waiting)
  - Implementation:
    * Modified SearchLiveTrades_Resume (gt_trading_search.xml)
      - Added preservation of $WaitingForBatch and $Ship before resetting structure
      - Only sets empty results, preserves waiting state for other ships
  - Files Modified:
    * `md/gt_trading_search.xml` (lines 1654-1684)
  - Benefits:
    * Ships waiting for batch results don't lose their state
    * Live search continuations can resume properly
    * Prevents search locks from becoming stale

FIX: Continuation Cleanup - Prevent Permanent Blocking => reverted
  - Issue: Zero-trade continuations permanently blocked ships from searching again
  - Root Cause: When live search continuation completed with trades, $Ship was never removed from global.$GT_SearchResult
  - Problem: Next SearchTradeRoutes run detected continuation (Ship == current ship) but no waiting flag, assumed previous search just finished, hit cooldown path and exited without searching
  - Solution: Remove $Ship from global.$GT_SearchResult after successful trade execution when continuation detected
  - Implementation:
    * Modified SearchTradeRoutes (gt_trading_search.xml)
      - Added cleanup code after ExecuteTrade signal when $isLiveSearchContinuation is true
      - Removes $WaitingForBatch and $Ship to prevent future requests from being treated as continuations
  - Files Modified:
    * `md/gt_trading_search.xml` (lines 1189-1198)
  - Benefits:
    * Ships are no longer permanently blocked after successful continuation completion
    * Future search requests proceed normally instead of hitting cooldown shortcut
    * Prevents infinite cooldown loops

FIX: TradeList Preservation - Waiting Ship State Protection => reverted
  - Issue: When another ship was mid-live search, SearchCachedTrades wiped that ship's stored trade list
  - Root Cause: "Another ship waiting" branch cleared global.$GT_SearchResult.$TradeList = [], destroying waiting ship's live results
  - Problem: Waiting ship's $TradeList contained their live search results - clearing it destroyed them, kept search lock set, causing stall
  - Solution: Do NOT modify global.$GT_SearchResult at all when another ship is waiting - preserve ALL state including TradeList
  - Implementation:
    * Modified SearchCachedTrades (gt_search_methods.xml)
      - Removed line that cleared $TradeList when another ship waiting
      - Now preserves all waiting ship state (Found, TradeList, WaitingForBatch, Ship)
    * Modified CheckTradeCache (gt_trading_queue.xml)
      - Added verification that results belong to current ship
      - Checks if global.$GT_SearchResult.$Ship matches current ship
      - If results belong to another ship, treats as cache miss and proceeds to live search
    * Modified SearchTradeRoutes (gt_trading_search.xml)
      - Added same verification logic to ensure doesn't use another ship's cache results
  - Files Modified:
    * `md/gt_search_methods.xml` (lines 1160-1182)
    * `md/gt_trading_queue.xml` (lines 537-563)
    * `md/gt_trading_search.xml` (lines 351-363)
  - Benefits:
    * Waiting ship's TradeList (live results) is preserved intact
    * Current ship correctly detects results don't belong to them
    * No state is lost or overwritten
    * Waiting ship's continuation can find TradeList intact when SearchLiveTrades_Resume completes

Version 0.6.4 - 2025-11-15
---------------------------

FEATURE: MK3 Rename - Custom Ship Renaming via Context Menu
  - Added "MK3 Rename" context menu entry for player-owned ships
  - Opens floating text input dialog with Cancel/OK buttons
  - Stores custom original ship name in GT_Pilots registry ($OriginalShipName)
  - Integrates with GT ship naming system (triggers Update_Pilot_Ship_Name)
  - Features:
    * Event-driven communication (Lua ↔ MD via SignalObject/NPCBlackboard)
    * Displays current GT original name when opening dialog
    * Persists name across game sessions
    * Automatically registers pilots if not yet in GT_Pilots registry
    * Works for multiple ships independently
  - Implementation:
    * MD script: `md/gt_context_rename.xml`
      - Listens for Interact_Menu_API.Get_Actions to add context menu entry
      - Handles rename confirmation via event_object_signalled
      - Registers pilots if needed before storing original name
    * Lua script: `ui/gt_context_rename.lua`
      - Creates floating context menu with text input field
      - Hooks into vanilla menu system (createContextFrame, refreshContextFrame)
      - Stores newName in NPCBlackboard and signals MD via SignalObject
      - Reads originalName from NPCBlackboard when opening dialog
  - Files Added:
    * `md/gt_context_rename.xml` (MD script for context menu integration)
    * `ui/gt_context_rename.lua` (Lua script for UI dialog)
  - Files Modified:
    * `ui.xml` (added gt_context_rename.lua to UI addons)
    * `t/0001-L001.xml` (added localization string for "MK3 Rename")
  - Benefits:
    * Allows players to set custom original ship names
    * Integrates seamlessly with GT naming system
    * Non-intrusive (separate from vanilla rename, doesn't interfere)
    * Event-driven architecture (no polling, efficient)

IMPROVEMENT: Original Ship Name Protection
  - Original ship name ($OriginalShipName) is now protected from automatic overwriting
  - Once set (via rename feature or initial registration), it is preserved across:
    * Ship reassignments (pilot moved to different ship)
    * Pilot reactivations (after being paused)
    * Default order restarts
  - Only the "MK3 Rename" feature can overwrite the stored original name
  - Implementation:
    * Modified `Register_Pilot` library (gt_ship_management.xml)
      - Added checks before setting $OriginalShipName when pilot reassigned to new ship
      - Added checks before setting $OriginalShipName when pilot reactivated
      - First-time registration still sets original name (unchanged behavior)
  - Files Modified:
    * `md/gt_ship_management.xml` (added protection checks in Register_Pilot)
  - Benefits:
    * Custom ship names set via rename feature are preserved permanently
    * No accidental overwriting when ships are reassigned or pilots reactivate
    * User has full control over ship names via rename feature

IMPROVEMENT: Rename Dialog - Start Empty When No Original Name
  - Rename dialog now starts empty if no GT original name is stored
  - Removed fallback to current ship name (was showing ship's current name instead of empty)
  - If GT original name exists: Dialog displays the stored original name
  - If no GT original name: Dialog starts empty (user can enter new name)
  - Implementation:
    * Modified `GT_RenameAction` cue (gt_context_rename.xml)
      - Changed fallback from `$component.knownname` to empty string `''`
    * Modified `createGTRenameContext` function (gt_context_rename.lua)
      - Removed fallback to `GetComponentName(component)`
      - Only uses GT original name from NPCBlackboard
  - Files Modified:
    * `md/gt_context_rename.xml` (removed fallback to current ship name)
    * `ui/gt_context_rename.lua` (removed fallback to GetComponentName)
  - Benefits:
    * Clear distinction between "no name set" (empty) and "name set" (shows stored name)
    * Better UX: User knows when they're setting a name for the first time

FEATURE: Basename Option for Ship Renaming
  - Added new "basename" option to Default Name Source setting
  - When selected, ship renaming uses stored GT original ship name directly
  - No stripping or special handling applied - uses $OriginalShipName as-is
  - Cycle order: Model Name → Type Name → Base Name → Basename → Model Name
  - Implementation:
    * Added 'basename' option to cycle handler (gt_global_settings.xml)
    * Added 'basename' handling in UpdateShipName (gt_xp_training.xml)
      - Uses `global.$GT_Pilots.{$pilot}.$OriginalShipName` directly
      - Fallback to `macro.name` if no stored original name exists
    * Added UI text display for "Basename" option
  - Files Modified:
    * `md/gt_global_settings.xml` (added basename to cycle, updated UI text logic)
    * `md/gt_xp_training.xml` (added basename handling in UpdateShipName)
    * `t/0001-L001.xml` (added translation text ID 9083: "Basename")
  - Benefits:
    * Allows players to use custom names set via rename feature as base for ship naming
    * Works with all naming options (prefixes, suffixes, rank, level, XP, etc.)
    * Provides full control over ship name base while maintaining GT naming features

FIX: Search Lock Management - Prevent Duplicate Search Requests
  - Issue: Search locks were being released immediately after queueing, before the search actually started, allowing duplicate search requests to slip through
  - Root Cause: `ProcessDelayedTradeRequest` was removing the search lock inline immediately after adding the ship to the queue, long before `SearchTradeRoutes` ran
  - Problem Scenario:
    1. Ship sends GT_Find_Trade signal → lock set, ship queued
    2. Lock immediately removed in ProcessDelayedTradeRequest
    3. Ship sends another GT_Find_Trade signal (before first search starts)
    4. No lock found → second request slips through → duplicate queue entries
    5. Results: redundant searches, wasted AI parameter tables, extra GT_No_Trade_Found churn
  - Solution: Keep lock set until search actually completes or request is rejected
    * Lock only released when request is rejected (busy ship, duplicate in queue)
    * Lock released by SearchTradeRoutes when search completes (existing behavior)
    * Lock released by queue cleanup handlers when search aborted (existing behavior)
  - Implementation:
    * Removed premature lock cleanup from `ProcessDelayedTradeRequest` (gt_trading_ai.xml:335-341)
    * Added lock release when request rejected (busy ship or duplicate)
    * Added cleanup of AI parameters when request rejected (prevents stale data)
  - Files Modified:
    * `md/gt_trading_ai.xml` (removed premature lock cleanup, added cleanup on rejection)
  - Benefits:
    * Prevents duplicate search requests from slipping through
    * Eliminates redundant queue entries and wasted CPU cycles
    * Reduces GT_No_Trade_Found signal churn
    * Proper cleanup of AI parameters on rejection

FIX: Cache Check Performance - Implement Actual Cache Checking
  - Issue: `CheckTradeCache` cue was skipping cache check entirely, always queuing for live search even when valid cached trades existed
  - Root Cause: Cache check was implemented as TODO placeholder - just logged "skip cache" and queued for live search
  - Problem Scenario:
    1. Ship requests trade search → CheckTradeCache called
    2. Cache check skipped → ship queued for live search
    3. Ship waits in queue (25-35s skill delay)
    4. Live search runs → finds same trades that were already in cache
    5. Result: Artificial delays even when cache has valid trades
  - Solution: Implement actual synchronous cache checking
    * Call `SearchCachedTrades` synchronously with proper parameters
    * If cache hit: Send directly to execution pipeline (bypass queue, instant)
    * If cache miss: Queue for live search (existing behavior)
    * Respect ForceLiveSearch flag (skip cache if set)
  - Implementation:
    * Modified `CheckTradeCache` cue (gt_trading_queue.xml:440-605)
      - Extract search parameters from event
      - Calculate derived parameters (distance penalty, skill level, ROI multiplier)
      - Call `SearchCachedTrades` synchronously
      - Check cache results (foundCachedTrade, cacheTradeList)
      - Cache hit: Signal ExecuteTrade directly (bypass queue)
      - Cache miss: Queue for live search (existing behavior)
  - Files Modified:
    * `md/gt_trading_queue.xml` (implemented actual cache checking logic)
  - Benefits:
    * Removes artificial 25-35s skill delays for cached trades
    * Dramatically reduces CPU load (no queueing/batch processing for cache hits)
    * Cache now provides intended performance benefit
    * Instant trade execution when cache has valid trades

FIX: Forced Sell Pipeline - Use Normal Execution Pipeline
  - Issue: Forced sell orders (when ship has cargo) were bypassing the normal execution pipeline, creating orders directly in MD script
  - Root Cause: `SearchSellOpportunities` was calling `create_trade_order` directly instead of using the normal pipeline
  - Problem Scenario:
    1. Ship has cargo → SearchSellOpportunities finds buyer
    2. MD script creates order directly → violates "MD finds, AI executes" rule
    3. Order created while AI waits → X4 terminates wait context instead of suspending
    4. Trade never stored in GT_PendingTrades → failure handler can't track sector pairs
    5. Pathing failures during cargo-dump runs invisible to blacklist system → infinite loops
  - Solution: Use normal pipeline for forced sell trades
    * Create trade structure compatible with ExecuteTrade
    * Store in GT_PendingTrades (enables failure tracking)
    * Send to ExecuteTrade cue (stores pending trade, signals AI)
    * AI script creates orders (maintains wait state safety)
    * Modified ExecuteTrade to handle sell-only trades ($IsSellOnly flag)
  - Implementation:
    * Modified `SearchSellOpportunities` (gt_trading_search.xml:2732-2789)
      - Create sell-only trade structure (BuyOffer=null, IsSellOnly=true)
      - Store BuyStation (ship's sector), SellStation (target station), Ware, SellOffer
      - Signal ExecuteTrade with trade structure
    * Modified `ExecuteTrade` (gt_trading_execution.xml:27-116)
      - Added support for sell-only trades ($IsSellOnly flag)
      - Validate: Sell-only trades only require SellOffer (BuyOffer can be null)
      - Handle logging for sell-only trades (no buy station)
      - Validate only SellOffer for sell-only trades (BuyOffer always valid)
  - Files Modified:
    * `md/gt_trading_search.xml` (use normal pipeline for forced sell)
    * `md/gt_trading_execution.xml` (support sell-only trades)
  - Benefits:
    * Maintains wait state safety (AI creates orders, not MD)
    * Enables failure tracking (GT_PendingTrades populated)
    * Failure handler can track sector pairs for forced sell trades
    * Consistent behavior with normal trades (reservations, statistics, telemetry)

FIX: Busy Ship Rejection - Clean Up AI Parameters
  - Issue: When trade requests were rejected (busy ship, duplicate), AI parameters were set but never cleaned up, causing stale data to persist
  - Root Cause: AI parameters were set before checking if ship was busy, and busy/duplicate rejection paths didn't clean up the parameters
  - Problem Scenario:
    1. Ship sends GT_Find_Trade → AI parameters set (ForceLiveSearch=true, WareBasket=[...], AllowIllegal=false)
    2. Ship is busy → request rejected, GT_No_Trade_Found signaled
    3. AI parameters NOT cleaned up → stale data persists
    4. Next request inherits stale ForceLiveSearch=true → cache bypassed unnecessarily
    5. Next request inherits stale WareBasket → wrong wares searched
    6. Next request inherits stale AllowIllegal → incorrect illegal ware handling
  - Solution: Clean up AI parameters when request is rejected
    * Remove global.$GT_AIParameters.{ship} when busy ship rejected
    * Remove global.$GT_AIParameters.{ship} when duplicate request rejected
    * Also release search lock when request rejected (proper cleanup)
  - Implementation:
    * Modified `ProcessDelayedTradeRequest` (gt_trading_ai.xml:320-358)
      - Added cleanup of AI parameters when busy ship rejected
      - Added cleanup of AI parameters when duplicate request rejected
      - Added search lock release when request rejected
  - Files Modified:
    * `md/gt_trading_ai.xml` (added parameter cleanup on rejection)
  - Benefits:
    * Prevents stale ForceLiveSearch flag from bypassing cache unnecessarily
    * Prevents stale WareBasket from affecting future searches
    * Prevents stale AllowIllegal from incorrectly blocking/allowing illegal wares
    * Proper cleanup ensures each request starts with fresh parameters

FIX: Cache Hit Lock Cleanup - Release Search Lock After Cache Hit
  - Issue: When CheckTradeCache found a valid cached trade, it sent the trade to ExecuteTrade but never released the search lock or cleaned up AI parameters
  - Root Cause: Cache hits bypass SearchTradeRoutes (which normally releases locks), so the cleanup code in SearchTradeRoutes never ran
  - Problem Scenario:
    1. Ship requests trade search → lock set, cache checked
    2. Cache hit found → trade sent to ExecuteTrade, cue exits
    3. Search lock never released → ship idles for ~60s until maintenance cue purges old locks
    4. Ship cannot request next trade until lock expires
    5. Result: Every cache-served trader sits idle for about a minute between trades
  - Solution: Explicitly release search lock and clean up AI parameters after cache hit
    * Mirror the cleanup done in SearchTradeRoutes (lines 1584-1606)
    * Release global.$GT_SearchLocks.{ship} after successful cache hit
    * Remove global.$GT_AIParameters.{ship} after successful cache hit
  - Implementation:
    * Modified `CheckTradeCache` cue (gt_trading_queue.xml:561-573)
      - Added lock release after cache hit (before sending to ExecuteTrade)
      - Added AI parameter cleanup after cache hit
      - Added debug logging for lock release
  - Files Modified:
    * `md/gt_trading_queue.xml` (added lock and parameter cleanup after cache hit)
  - Benefits:
    * Ships can request next trade immediately after cache hit (no 60s wait)
    * Proper cleanup prevents resource leaks
    * Consistent behavior with live search completion

FIX: Forced Sell BuyStation - Use Station Object Instead of Sector
  - Issue: Forced sell trades stored ship's sector object in $BuyStation, but downstream code expects a station object with .sector and .knownname properties
  - Root Cause: SearchSellOpportunities was storing `$ship.sector` (a sector object) in $BuyStation field
  - Problem Scenario:
    1. Ship has cargo → forced sell trade created
    2. $BuyStation = $ship.sector (sector object, not station)
    3. Failure handler tries to access $buyStation.sector → null (sectors don't have .sector)
    4. Failure handler logs "Pending trade entry MISSING" instead of recording blocked route
    5. ExecuteTrade gatedistance checks receive null sectors → may misreport unreachable routes
  - Solution: Use actual station object (or ship) for $BuyStation
    * If ship is docked: Use $ship.dock.container (docked station)
    * If ship is parked: Use $ship.parkedat (parked station)
    * Otherwise: Use $ship itself (ships have .sector and .knownname properties)
  - Implementation:
    * Modified `SearchSellOpportunities` (gt_trading_search.xml:2746-2756)
      - Check if ship is docked → use dock.container
      - Check if ship is parked → use parkedat
      - Fallback to ship object itself (has required properties)
  - Files Modified:
    * `md/gt_trading_search.xml` (use station/ship object instead of sector)
  - Benefits:
    * Failure handler can properly extract sector pairs for blacklisting
    * ExecuteTrade pathfinding checks work correctly
    * Proper telemetry and failure tracking for forced sell trades

FIX: Forced Sell Cargo Rotation - Avoid Getting Stuck on Unsellable Wares
  - Issue: Forced sell routine only examined the first cargo entry (cargo.list.{1}), so if that ware was banned, blacklisted, or mission-tied, the ship would retry the same ware forever
  - Root Cause: Code always selected `$currentCargo.{1}` without rotating through cargo list
  - Problem Scenario:
    1. Ship has cargo: [Energy Cells, Food Rations, Illegal Ware]
    2. First ware (Energy Cells) is mission-tied or blacklisted → GT_No_Trade_Found
    3. Ship requests forced sell again → selects Energy Cells again (always first)
    4. Same failure → retry → stuck forever
    5. Other wares (Food Rations, Illegal Ware) never attempted
  - Solution: Rotate through cargo entries on each request
    * Track last attempted ware index in global.$GT_ForcedSellLastWare.{ship}
    * On next request, start from next ware (wrap around)
    * If one ware can't be sold, next request tries different ware
  - Implementation:
    * Modified `SearchSellOpportunities` (gt_trading_search.xml:2591-2614)
      - Track last attempted ware index per ship
      - Rotate to next ware on each request: (lastIndex mod count) + 1
      - Store attempted index for next rotation
      - Added debug logging showing rotation
  - Files Modified:
    * `md/gt_trading_search.xml` (implemented cargo rotation system)
  - Benefits:
    * Ships don't get stuck retrying same unsellable ware
    * All cargo entries eventually attempted
    * Better cargo disposal for ships with mixed cargo types
    * Prevents infinite retry loops on mission-tied or blacklisted wares

FIX: Cache Hit Execution - Extract Trade from TradeList
  - Issue: CheckTradeCache sent only $TradeList to ExecuteTrade, but ExecuteTrade requires $Trade parameter, causing cache hits to fail immediately
  - Root Cause: ExecuteTrade validated $Trade was not null and aborted if missing, but CheckTradeCache only sent $TradeList
  - Problem Scenario:
    1. Cache hit found → CheckTradeCache signals ExecuteTrade with only $TradeList
    2. ExecuteTrade checks $Trade → null → logs error and aborts
    3. Ship receives GT_No_Trade_Found → cache hit behaves like miss
    4. Queue restarts whole search → negates cache performance benefit
  - Solution: Extract $Trade from $TradeList if $Trade is null
    * Check if $Trade is null but $TradeList exists and has trades
    * Extract first trade: $Trade = $TradeList.{1}
    * Proceed with normal execution using extracted trade
  - Implementation:
    * Modified `ExecuteTrade` (gt_trading_execution.xml:20-26)
      - Added check: if $Trade is null and $TradeList has trades, extract first trade
      - Added debug logging when trade extracted from list
      - Enhanced error message to show TradeList count for debugging
  - Files Modified:
    * `md/gt_trading_execution.xml` (extract trade from TradeList if missing)
  - Benefits:
    * Cache hits now execute correctly (no false negatives)
    * Cache performance benefit realized (instant trade execution)
    * Consistent behavior with live search results (both use TradeList)

FIX: Cache Hit Lock Cleanup - Already Fixed
  - Status: This issue was already fixed in previous changes
  - Fix Location: CheckTradeCache now releases search lock and cleans up AI parameters after cache hit (gt_trading_queue.xml:561-573)
  - Note: Lock cleanup happens after ExecuteTrade is signaled, which is correct timing

FIX: Cache Lookups Clobber In-Flight Live Searches - Prevent Race Condition
  - Issue: SearchCachedTrades unconditionally overwrote global.$GT_SearchResult, clobbering in-flight live search results when another ship was waiting for batch processing
  - Root Cause: SearchCachedTrades always replaced global.$GT_SearchResult without checking if another ship had WaitingForBatch=true
  - Problem Scenario:
    1. Ship A starts live search → SearchLiveTrades sets WaitingForBatch=true, Ship=A in global.$GT_SearchResult
    2. Ship B requests cache check → SearchCachedTrades runs
    3. SearchCachedTrades overwrites global.$GT_SearchResult → Ship A's state lost
    4. Ship A's batch completes → SearchLiveTrades_Resume fires
    5. global.$GT_SearchResult.$Ship != Ship A → continuation check fails
    6. Search never resumes → lock held indefinitely
  - Solution: Check for waiting ships before overwriting global.$GT_SearchResult
    * Before overwriting, check if WaitingForBatch=true and Ship != current ship
    * If another ship is waiting, skip overwrite (preserve their state)
    * If no other ship waiting, proceed with overwrite
    * Applied to both early exit (cache disabled) and successful cache results
  - Implementation:
    * Modified `SearchCachedTrades` (gt_search_methods.xml:77-118, 1124-1186)
      - Early exit path: Check WaitingForBatch before overwriting empty results
      - Success path: Check WaitingForBatch before overwriting cache results
      - If another ship waiting: Skip overwrite, log debug message, return empty results (triggers live search)
      - If no other ship waiting: Proceed with overwrite as normal
  - Files Modified:
    * `md/gt_search_methods.xml` (added WaitingForBatch check before overwriting results)
  - Benefits:
    * Prevents race condition between concurrent cache checks and live searches
    * In-flight live searches no longer lose their state
    * Locks properly released when searches complete
    * Concurrent searches work correctly without interfering

FIX: Cache Hit Execution - Send $Trade Parameter
  - Issue: CheckTradeCache sent only $TradeList to ExecuteTrade, but ExecuteTrade's validation guard checked $Trade first and aborted before extraction could occur
  - Root Cause: CheckTradeCache extracted first trade but didn't send it as $Trade parameter, relying on ExecuteTrade's extraction logic
  - Problem Scenario:
    1. Cache hit found → CheckTradeCache signals ExecuteTrade with only $TradeList
    2. ExecuteTrade checks $Trade → null → validation guard aborts immediately (line 29)
    3. Extraction code (lines 20-26) never executes because guard aborts first
    4. Ship receives GT_No_Trade_Found → cache hit treated as miss
    5. Ship queues for live search → wastes cycles, negates cache performance benefit
  - Solution: Extract first trade in CheckTradeCache and send both $Trade and $TradeList
    * Extract first trade: $firstTrade = $cacheTradeList.{1}
    * Send both parameters: $Trade = $firstTrade, $TradeList = $cacheTradeList
    * ExecuteTrade receives $Trade directly, validation passes, execution proceeds
  - Implementation:
    * Modified `CheckTradeCache` (gt_trading_queue.xml:555-565)
      - Extract first trade from cacheTradeList before signaling ExecuteTrade
      - Send both $Trade and $TradeList parameters for compatibility
      - Ensures ExecuteTrade validation guard passes immediately
  - Files Modified:
    * `md/gt_trading_queue.xml` (extract and send $Trade parameter)
  - Benefits:
    * Cache hits execute correctly (validation guard passes)
    * Cache performance benefit realized (instant trade execution)
    * No wasted cycles queuing live searches for cached trades
    * Consistent with live search path (both send $Trade parameter)

FIX: Cache Checks Preserve In-Progress Live Search State
  - Issue: SearchCachedTrades overwrote global.$GT_SearchResult with empty defaults when another ship was waiting, wiping $WaitingForBatch, $Ship, and $TradeList needed for live search continuation
  - Root Cause: When another ship was waiting, the else branch replaced entire global.$GT_SearchResult structure, destroying waiting ship's state
  - Problem Scenario:
    1. Ship A starts live search → SearchLiveTrades sets WaitingForBatch=true, Ship=A, TradeList=[...] in global.$GT_SearchResult
    2. Ship B requests cache check → SearchCachedTrades runs
    3. SearchCachedTrades detects Ship A waiting → enters else branch
    4. Else branch overwrites global.$GT_SearchResult with empty table → Ship A's state lost
    5. Ship A's batch completes → SearchLiveTrades_Resume fires
    6. global.$GT_SearchResult.$Ship != Ship A or WaitingForBatch missing → continuation check fails
    7. Search never resumes → lock held indefinitely
  - Solution: Preserve waiting ship's state when another ship requests cache check
    * When another ship waiting: Set only $Found=false and clear $TradeList (indicate cache miss)
    * Preserve $WaitingForBatch and $Ship (needed for waiting ship's continuation)
    * Don't overwrite entire structure - only modify fields needed for current ship
  - Implementation:
    * Modified `SearchCachedTrades` (gt_search_methods.xml:1169-1174)
      - When another ship waiting: Set $Found=false, clear $TradeList
      - Preserve $WaitingForBatch and $Ship for waiting ship
      - CheckTradeCache reads $Found=false and queues for live search (correct behavior)
      - Waiting ship's state remains intact for continuation
  - Files Modified:
    * `md/gt_search_methods.xml` (preserve waiting ship state when cache check occurs)
  - Benefits:
    * In-progress live searches no longer lose their state
    * Locks properly released when searches complete
    * Concurrent cache checks don't interfere with live searches
    * Both ships proceed correctly (current ship queues, waiting ship continues)

FIX: Zero-Trade Live Searches - Remove $Ship from Global State
  - Issue: When live search returned zero trades, $Ship was never removed from global.$GT_SearchResult, causing all future requests to be treated as continuations hitting cooldown path
  - Root Cause: Zero-trade cleanup removed $WaitingForBatch and $TradeList but not $Ship, leaving stale continuation state
  - Problem Scenario:
    1. Ship requests trade search → live search returns 0 trades
    2. Code clears continuation state → removes $WaitingForBatch, $TradeList, etc. but NOT $Ship
    3. Next request → SearchTradeRoutes checks global.$GT_SearchResult.$Ship == $ship (line 111)
    4. $Ship still set → $isLiveSearchContinuation = true
    5. Continuation block checks $liveTradeList.count == 0 → hits cooldown path
    6. Ship never performs another real search → permanently throttled
  - Solution: Remove $Ship from global.$GT_SearchResult when clearing continuation state
    * When zero-trade live search completes, remove $Ship along with other continuation fields
    * Prevents future requests from being incorrectly treated as continuations
    * Allows ship to perform fresh searches on next request
  - Implementation:
    * Modified `SearchTradeRoutes` (gt_trading_search.xml:640-641)
      - Added removal of global.$GT_SearchResult.$Ship when clearing continuation state
      - Ensures no stale continuation state remains after zero-trade searches
  - Files Modified:
    * `md/gt_trading_search.xml` (remove $Ship when clearing zero-trade continuation state)
  - Benefits:
    * Ships no longer permanently throttled after zero-trade searches
    * Future requests perform fresh searches instead of hitting cooldown
    * Continuation state properly cleared when searches complete
    * Ships can recover from stuck states (blacklisted sectors, etc.)

Version 0.6.3 - 2025-11-15
---------------------------

FEATURE: Modifications Feature Toggle - Enable/Disable Automatic Modification Installation
  - Added global setting to control whether GT automatically installs modifications on ships
  - Location: Global Settings menu → Ship Modifications section
  - Default: Enabled (true)
  - When disabled: GT will not install modifications on ships, even if pilot level qualifies
  - When enabled: GT installs modifications as before (based on pilot level)
  - Implementation:
    * Added `global.$GT_GlobalSettings.$Modifications.$Enabled` setting
    * Added toggle button in Global Settings menu (text IDs: 77000,9061/9062/9162)
    * Modified `Install_GT_Modifications` library to check setting before installing
    * Exits early with debug log if modifications are disabled
  - Files Modified:
    * `md/gt_global_settings.xml` (added Modifications settings section and menu toggle)
    * `md/gt_ship_modifications.xml` (added feature check before installation)
  - Benefits:
    * Players can disable automatic modification installation if desired
    * Allows players to manually manage ship modifications
    * Setting persists across game sessions
    * Clear debug logging when feature is disabled
  - Technical Details:
    * Setting checked at start of `Install_GT_Modifications` library
    * Defaults to true if setting doesn't exist (backward compatibility)
    * Toggle uses existing `GT_Setting_Toggle` handler (no code changes needed)
    * Menu entry follows same pattern as Auto-Repair toggle

FIX: Modification Installation Safety - Prevent Duplicate Installation and Protect Player Mods
  - Issue: GT modifications were being installed even when mods were already present (GT-installed or player-installed), and removal code could remove player-installed mods
  - Root Cause: 
    * Installation code didn't check `$GTInstalledSlots` before installing, causing duplicate installations
    * Removal code always tried to remove both ship and engine mods without checking if they were GT-installed, potentially removing player-installed mods
  - Problem Scenario:
    1. Ship has player-installed mods (or GT mods from previous installation)
    2. GT order assigned → mod installation code runs
    3. Code installs GT mods without checking if mods already exist → duplicate mods or overwrites player mods
    4. GT order removed → removal code runs
    5. Code removes ALL mods (ship + engine) without checking if they were GT-installed → player mods removed!
  - Solution: Added safety checks for both installation and removal
    * **Installation:** Check `$GTInstalledSlots` before installing - skip if mod already installed
    * **Removal:** Check `$GTInstalledSlots` before removing - only remove mods that WE installed
    * Prevents duplicate installations and protects player-installed mods
  - Implementation:
    * Modified `Install_GT_Modifications` library (lines 55-120)
      - Added check for `$GTInstalledSlots` before installation
      - Set flags `$shipModAlreadyInstalled` and `$engineModAlreadyInstalled`
      - Only install if not already installed
      - Log when skipping installation due to existing mods
    * Modified `RemoveModifications` cue (lines 337-395)
      - Added check for `$GTInstalledSlots` before removal
      - Only remove mods listed in `$GTInstalledSlots` (GT-installed)
      - Skip removal if mod not in list (protects player mods)
      - Log when skipping removal due to mod not being GT-installed
    * Modified `RemoveModificationsOnNameRestore` cue (lines 431-489)
      - Same safety checks as `RemoveModifications` cue
      - Protects player mods in backup removal path
  - Files Modified:
    * `md/gt_ship_modifications.xml` (added installation and removal safety checks)
  - Benefits:
    * Prevents duplicate mod installations
    * Protects player-installed mods from being removed
    * Only removes mods that GT system installed
    * Clear logging when mods are skipped (installation or removal)
    * Works for both primary and backup removal paths
  - Technical Details:
    * Uses `$GTInstalledSlots` list to track which slots GT installed mods in
    * Installation: Checks list before installing, adds to list after successful installation
    * Removal: Checks list before removing, only removes if slot is in list
    * If slot not in list = mod was not GT-installed (player mod or never installed) → skip removal

Version 0.6.2 - 2025-11-15
---------------------------

FIX: Trade Order Validation - Prevent "Trade Not Allowed" Errors
  - Issue: Ships were receiving "trade not allowed" errors when attempting to create trade orders
  - Root Cause: Trade offers were being validated earlier in the process, but not checked immediately before `create_trade_order` was called. Between validation and order creation, offers could be consumed or reserved by other ships, causing vanilla's `create_trade_order` to reject the order.
  - Problem Scenario:
    1. Ship validates trade offer (available=true, amount=1000)
    2. Another ship reserves/consumes part of the offer (now only 500 available)
    3. Ship calls `create_trade_order` with amount=1000
    4. Vanilla rejects: "trade not allowed" (insufficient amount)
  - Solution: Added final validation check immediately before `create_trade_order` following vanilla pattern
    * Checks `offer.available` (offer still exists)
    * Checks `offer.offeramount.{this.assignedcontrolled}` (ship-specific available amount after reservations)
    * Validates both buy and sell offers have sufficient amount for requested trade
    * If validation fails: Restart search (offers may have changed, need fresh search)
    * If validation passes: Proceed with order creation
  - Implementation:
    * Added final validation block in `order.trade.galaxytrader.xml` before `create_trade_order` calls
    * Uses vanilla pattern: `offer.available AND offer.offeramount.{this.assignedcontrolled} ge requestedAmount`
    * `offeramount.{this.assignedcontrolled}` returns ship-specific available amount (accounts for reservations by other ships)
    * If offer becomes invalid, signals `GT_No_Trade_Found` to restart search
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (added final validation check before order creation)
  - Benefits:
    * Prevents "trade not allowed" errors from race conditions
    * Follows vanilla's proven validation pattern
    * Handles multi-ship competition for same offers gracefully
    * Restarts search when offers are consumed (ensures fresh trade data)
  - Technical Details:
    * Vanilla pattern from `order.trade.routine.xml` lines 643, 666, 838, 844
    * `offeramount.{this.assignedcontrolled}` is ship-specific (different from total `amount`)
    * Validation happens as late as possible (right before order creation) to minimize race window
    * Debug logging shows which offer failed and why (available status and amounts)

FIX: Missing GT_Order_Assigned Signal Emission - State Initialization
  - Issue: Ships receiving GalaxyTrader orders never had their state properly initialized
  - Root Cause: Handlers existed for `GT_Order_Assigned` events in both `gt_ship_state_manager` and `gt_ship_modifications`, but no code ever sent this signal when a ship was assigned a GT order. As a result, state tracking fields (`$HasGTOrder`, `$OriginalShipName`, `$DefaultOrder`) were never initialized, leaving downstream systems to rely on stale or default state.
  - Problem Scenario:
    1. Ship gets GalaxyTraderMK3 order assigned
    2. State manager handler exists but never receives `GT_Order_Assigned` signal
    3. `$HasGTOrder` remains false (or stale value)
    4. `$OriginalShipName` never captured (name restoration fails)
    5. Modifications may not install correctly
  - Solution: Added `GT_Order_Assigned` signal emission when GT order is first assigned
    * Signal sent in `init` label when `trackedDefaultOrder` is initialized for first time
    * Includes `MacroShipName` parameter for proper state initialization
    * Only sent when order is actually `GalaxyTraderMK3` (not for other orders)
  - Implementation:
    * Added signal emission in `order.trade.galaxytrader.xml` init label (lines 655-663)
    * Checks if `trackedDefaultOrder` is being initialized for first time
    * If order is `GalaxyTraderMK3`, sends `GT_Ship_State_Update` with `UpdateType='GT_Order_Assigned'`
    * Includes `MacroShipName` from ship's macro for state tracking
  - Files Modified:
    * `aiscripts/order.trade.galaxytrader.xml` (added GT_Order_Assigned signal emission)
  - Benefits:
    * State now initializes correctly for all new GT order assignments
    * `$HasGTOrder` properly set to true
    * `$OriginalShipName` captured for name restoration
    * Modifications install correctly on new assignments
    * Downstream systems can rely on accurate state data
  - Technical Details:
    * Signal sent only once per ship (when order first assigned)
    * Uses existing `GT_Ship_State_Update` signal infrastructure
    * State manager handler already existed, just needed signal emission
    * Modifications handler also listens for this signal (already implemented)

FIX: State-Dependent Subordinate Cleanup - Memory Leaks
  - Issue: Subordinates removed from GT commanders didn't trigger cleanup if they never had state initialized
  - Root Cause: The Assist order patch only checked for subordinate removal if `global.$GT_Ship_State.{ship}` already existed. Subordinates that were assigned before state tracking existed, or that never had state initialized (e.g., they were just mirroring a commander), wouldn't trigger the cleanup block, leaving stale registry entries and preventing `GT_Order_Cancelled` signals.
  - Problem Scenario:
    1. Subordinate assigned to GT commander (before state tracking existed)
    2. Subordinate removed from commander
    3. Assist order detects no commander
    4. Cleanup code checks: `global.$GT_Ship_State.{ship}?` → false (never initialized)
    5. Cleanup block skipped → stale entries remain, mods not removed
  - Solution: Made subordinate cleanup state-independent with lazy initialization
    * Always initialize state registry and ship state if missing (lazy initialization)
    * Dual-check approach: Check state first, then check commander directly as fallback
    * Handles both cases: state-tracked subordinates and subordinates without prior state
  - Implementation:
    * Modified `order.assist.xml` patch (lines 66-112)
    * Removed dependency on existing state - now initializes state lazily if missing
    * Added dual-check: checks `$state.$SubordinateState` and `$state.$CommanderHasGT` first
    * Fallback: checks commander directly if state wasn't tracked
    * Ensures cleanup always runs, even if state was never initialized
  - Files Modified:
    * `aiscripts/order.assist.xml` (made subordinate cleanup state-independent)
  - Benefits:
    * All subordinates trigger cleanup correctly, regardless of state initialization
    * Prevents memory leaks from stale registry entries
    * Ensures `GT_Order_Cancelled` signal is sent for all subordinates
    * Mods are removed correctly for all subordinates (not just state-tracked ones)
    * Handles edge cases: ships assigned before state tracking existed
  - Technical Details:
    * Lazy initialization pattern: creates state entry only when needed
    * Dual-check ensures robustness: state OR direct commander check

FIX: StateHistory Null Error - Append to List Failure
  - Issue: MD cue error "Evaluated value 'null' is not of type list" when appending to StateHistory
  - Root Cause: StateHistory initialization check was flawed. The check `not $historyCount?` doesn't work correctly because `$historyCount` was just assigned (even if to null), so `$historyCount?` always returns true. This caused the reinitialization to be skipped when StateHistory was null from old save games.
  - Problem Scenario:
    1. Ship state loaded from old save game where StateHistory was null
    2. StateHistory property exists but is null (not initialized)
    3. Code checks `not $state.$StateHistory?` → false (property exists)
    4. Code sets `$historyCount = @$state.$StateHistory.count` → null
    5. Code checks `not $historyCount?` → false (variable exists, even though value is null)
    6. Reinitialization skipped → StateHistory remains null
    7. `append_to_list` called on null → ERROR: "Evaluated value 'null' is not of type list"
  - Solution: Fixed StateHistory initialization logic to properly detect null values
    * Initialize `$historyCount` to null first
    * Only try to get count if StateHistory property exists
    * Check if count is null (meaning StateHistory was null) OR property doesn't exist
    * Initialize StateHistory if either condition is true
  - Implementation:
    * Modified `gt_ship_state_manager.xml` UpdateState cue (lines 314-326)
    * Changed from nested `do_if/do_else` to sequential checks
    * Properly detects null StateHistory from old save games
    * Ensures StateHistory is always initialized before `append_to_list` is called
    * Added early initialization check in UpdateState cue (line 47) for existing ships
    * Added migration code in `gt_global_settings.xml` Init cue (lines 103-119)
    * Migration runs on mod load/game start to fix all existing ship states at once
  - Files Modified:
    * `md/gt_ship_state_manager.xml` (fixed StateHistory null detection, added early initialization check)
    * `md/gt_global_settings.xml` (added migration code in Init cue)
  - Benefits:
    * Prevents MD cue errors when appending to StateHistory
    * Handles old save games gracefully (null StateHistory is reinitialized)
    * StateHistory always initialized before use
    * No more crashes from null list operations
  - Technical Details:
    * The `?` operator checks if variable EXISTS, not if it's null
    * A variable assigned to null still "exists" and returns true for `?`
    * Must check the VALUE (null) separately, not just existence
    * Pattern: Initialize to null, try to get value, check if value is null

FIX: Incomplete Queue Awareness - Maintenance Orders
  - Issue: Trading queue could schedule trade searches while ships were busy with maintenance orders
  - Root Cause: The trading queue only checked for trade orders (`tradeorders.count gt 0`) and training orders (`DockAndTrain`), but ignored maintenance orders (`Repair`, `Resupply`, `order.build.equip`, `DockAndWait`). This caused unnecessary trade searches to be scheduled while ships were still performing maintenance.
  - Problem Scenario:
    1. Ship receives Repair order (hull damage)
    2. Trading queue checks: no trade orders, no DockAndTrain → ship not busy
    3. Queue schedules trade search
    4. Ship is still repairing → wasted CPU cycles, potential race conditions
  - Solution: Added maintenance order checks to queue awareness
    * Checks for `Repair` order (hull repairs)
    * Checks for `Resupply` order (ammunition/missiles)
    * Checks for `order.build.equip` (equipment installation)
    * Checks for `DockAndWait` (waiting at station)
    * Ships marked as "busy" when any maintenance order is active
  - Implementation:
    * Added maintenance order check in `gt_trading_queue.xml` (lines 251-260)
    * Checks `$ship.order.id` against maintenance order IDs
    * Sets `$isBusy = true` if maintenance order detected
    * Includes debug logging for maintenance order detection
  - Files Modified:
    * `md/gt_trading_queue.xml` (added maintenance order checks)
  - Benefits:
    * Reduces wasted CPU cycles from unnecessary trade searches
    * Prevents race conditions during maintenance
    * Ships complete maintenance before searching for new trades
    * Better performance and more predictable behavior
    * More accurate "busy" detection
  - Technical Details:
    * Checks performed after trade orders and training checks (efficient ordering)
    * Uses same `$isBusy` flag pattern as existing checks
    * Debug logging follows existing pattern for consistency
    * Order ID comparison uses exact match (no wildcards needed)


Version 0.6.1 - 2025-11-15
---------------------------

FEATURE: Cargo Capacity Scaling for Profit Thresholds
  - Issue: Small ships with Level 15 pilots could never reach the profit threshold (10,000 Cr) because they can't carry enough cargo
  - Problem: Profit thresholds were fixed per pilot level, regardless of ship cargo capacity
    * Merkur trader (8200 cargo): Can reach 10,000 Cr threshold
    * Small ship (2200 cargo): Cannot reach 10,000 Cr threshold (only ~27% of Merkur's capacity)
  - Solution: Scale profit thresholds by ship cargo capacity
    * Reference cargo: 8200 (Merkur - baseline for Level 15 = 10,000 Cr)
    * Scaling formula: `adjustedThreshold = baseThreshold * (shipCargoCapacity / referenceCargoCapacity)`
    * Minimum floor: 25% of base threshold (prevents thresholds from being too low)
  - Implementation:
    * Modified `GT_GetPilotLevelProfitThreshold` library to accept `shipCargoCapacity` parameter
    * Calculates scaling factor: `(shipCargo * 100) / referenceCargo` (using integer math)
    * Applies scaling: `baseThreshold * scalingFactor / 100`
    * Enforces minimum floor: `max(scaledThreshold, baseThreshold * 25 / 100)`
    * Updated `gt_trading_queue.xml` to pass ship cargo capacity to library function
  - Examples:
    * Level 15 pilot:
      - Merkur (8200 cargo): 10,000 Cr × (8200/8200) = 10,000 Cr (unchanged)
      - Small ship (2200 cargo): 10,000 Cr × (2200/8200) = ~2,683 Cr (vs 10,000 Cr before)
    * Level 10 pilot:
      - Merkur (8200 cargo): 3,673 Cr × (8200/8200) = 3,673 Cr (unchanged)
      - Small ship (2200 cargo): 3,673 Cr × (2200/8200) = ~985 Cr (vs 3,673 Cr before)
    * Level 5 pilot:
      - Merkur (8200 cargo): 816 Cr × (8200/8200) = 816 Cr (unchanged)
      - Small ship (2200 cargo): 816 Cr × (2200/8200) = ~219 Cr (vs 816 Cr before)
  - Benefits:
    * Small ships can now find trades appropriate for their cargo capacity
    * Large ships maintain their selective thresholds (no change for Merkur and larger)
    * Minimum floor ensures thresholds don't drop too low (Level 15 small ships: at least 2,500 Cr)
    * Proportional scaling ensures fair thresholds for all ship sizes
  - Files Modified:
    * `md/gt_trade_utilities.xml` (GT_GetPilotLevelProfitThreshold library - added cargo capacity scaling)
    * `md/gt_trading_queue.xml` (passes ship cargo capacity to library function)
  - Technical Details:
    * Uses integer math to avoid floating-point conversion warnings
    * Reference cargo (8200) is hardcoded but can be made configurable in future
    * Minimum floor (25%) prevents thresholds from being unreasonably low
    * Fallback to base threshold if cargo capacity is unavailable or invalid


Version 0.6.0 - 2025-11-15
---------------------------

PERFORMANCE OPTIMIZATION:
  - Overview: Implemented three high-impact, low-risk performance optimizations
  - Step 1: Guard Diagnostic Queries Behind Debug Flag
    * Added new debug flag: `global.$GT_Config.$Debug.$DiagnosticQueries` (default: false)
    * Diagnostic queries (4 galaxy-wide scans) now only run when flag is enabled
    * Impact: Eliminates unnecessary C++ queries in normal play
    * Files Modified: `md/gt_configuration.xml`, `md/gt_trading_search.xml`
  - Step 2: Reorder Filtering Checks (Cheap First)
    * Added early returns in `GT_FilterTradeForShip` after ware basket and illegal checks
    * Pathfinding now only runs if cheap checks pass
    * Impact: Reduces pathfinding calls by 50-70% (skips expensive checks when cheap checks fail)
    * Files Modified: `md/gt_trade_utilities.xml`
  - Expected Performance Improvement:
    * Diagnostic queries: 100% reduction in normal play (0 scans vs 4 per cache miss)
    * Native query results: No reduction (X4 limitation prevents C++-level distance filtering)
    * Pathfinding calls: 50-70% reduction (early returns from cheap checks)


CRITICAL FIX: Home Sector Drift Prevention
  - Issue: Ships were drifting away from their home sector over time, causing them to get stuck far from home
  - Root Cause: Home sector determination was checking GT_AIParameters first (which can be stale), then falling back to defaultorder.$home, and finally falling back to ship.sector (current position). When defaultorder.$home was null, the fallback to ship.sector caused the "home" to drift with the ship's position, creating a cascading problem where ships ended up far from their actual home sector.
  - Problem Scenario:
    1. Ship completes trade at Sector B (3 jumps from Home Sector A)
    2. Next search: defaultorder.$home is null → falls back to ship.sector = Sector B
    3. Home sector becomes Sector B (drifted!)
    4. Ship completes trade at Sector C (3 jumps from Sector B)
    5. Next search: Home sector becomes Sector C (drifted again!)
    6. This repeats, causing ships to drift further and further from actual home
  - Solution:
    * CRITICAL: Subordinates ALWAYS use commander's home sector (only option for subordinates)
    * Non-subordinates ALWAYS use defaultorder.$home as PRIMARY source (fixed value in order)
    * Removed fallback to ship.sector (except as emergency fallback with error logging)
    * Added error logging when defaultorder.$home is null (should never happen)
  - Files Modified:
    * md/gt_utilities.xml: GT_GetHomeSector library - subordinates use commander's home, non-subordinates use defaultorder.$home
    * md/gt_trading_search.xml: SearchLiveTrades and fallback search - subordinates use commander's home, non-subordinates use defaultorder.$home
    * aiscripts/order.trade.galaxytrader.xml: Trade validation - uses $effectiveHome (already handles subordinates correctly)
  - Impact:
    * Subordinates ALWAYS use commander's home sector (consistent fleet behavior - no other option)
    * Non-subordinate ships always use their fixed home sector from the order settings
    * No more cascading drift - home sector remains stable
    * Ships far from home will correctly search for trades within maxDistance from their actual home sector
    * Error logging will help detect if defaultorder.$home is somehow null


NEW FEATURE: Ship Modifications System (Initial Implementation)
  - Overview: Automatic installation and removal of Trade Consortium modifications on ships with active GT orders
  - NOTE: This feature is in its initial implementation phase and will be expanded in future updates
  - What Was Implemented:
    * Modification Wares: 6 modification wares (Ship and Engine only, 3 levels each)
      - Ship Mods: "Consortium Standard Refinement", "Consortium Rare Enhancement", "Consortium Lost Technology"
      - Engine Mods: "Consortium Standard Maneuverability", "Consortium Rare Thruster System", "Consortium Lost Propulsion Technology"
    * Agility-Focused Bonuses:
      - Ship Mods: Mass reduction (-5%, -10%, -25%) and radar range (+10%, +20%, +40%)
      - Engine Mods: Rotation thrust (+20%, +50%, +120%) and strafe thrust (+10%, +25%, +60%)
    * Automatic Installation: Mods install when GT order is assigned (direct or via commander)
    * Automatic Removal: Mods remove when GT default order is cancelled
    * Subordinate Support: Subordinates assisting GT commanders also receive mods
    * Pilot Level Requirements: Level 9 = Level 1 mod, Level 12 = Level 2 mod, Level 15 = Level 3 mod
    * Lua-Based Removal: Uses Lua extensions for reliable mod removal via C API
    * Player Protection: GT modifications cannot be acquired or installed manually by players (`noplayerblueprint` tag)
  - What Was NOT Implemented (Planned for Future Updates):
    * Shield Modifications: Removed per design decision (focus on agility)
    * Weapon Modifications: Removed per design decision (focus on agility)
    * Thruster Modifications: Removed per design decision (focus on ship and engine only)
    * Maximum Equipment Check: Not implemented (mods install regardless of equipment level)
    * Mission Unlock System: Not implemented (mods are always available - mission unlock planned for future)
  - Files Created:
    * libraries/wares.xml: Modification ware definitions
    * libraries/equipmentmods.xml: Modification bonus definitions
    * md/gt_ship_modifications.xml: Main modification management script
    * lua/gt_mod_removal.lua: Lua module for mod removal
  - Files Modified:
    * md/gt_ship_management.xml: Added mod installation trigger in Handle_Pilot_Ship_Assignment
    * aiscripts/order.trade.galaxytrader.xml: Added mod removal trigger on GT order cancellation
    * aiscripts/order.wait.xml: Added mod removal trigger when GT order removed
    * aiscripts/order.assist.xml: Added mod removal trigger for subordinates
    * content.xml: Added libraries section for wares.xml and equipmentmods.xml
  - Technical Details:
    * Modifications are temporary: Installed when GT order starts, removed when it stops
    * Player-installed modifications are never overwritten or removed
    * Mod level calculated based on pilot XP level (not skill level)
    * Uses FFI C API for reliable mod removal (DismantleShipMod, DismantleEngineMod)
    * Default order detection ensures mods only remove when GT default order is cancelled (not sub-orders)
  - Future Plans:
    * Mission unlock system: Mods will require completing a special mission (first pilot to reach Level 15 MAX XP)
    * Maximum equipment check: Mods will only install on ships with maximum equipment (MK3 shields/thrusters/engines)
    * Additional modification slots may be added based on user feedback
  - Status: Basic functionality implemented and tested. Feature will be expanded in future updates.


CODE REFACTORING: Search Methods Extraction
  - Overview: Extracted three main search methods into separate file for better code organization and maintainability
  - Implementation:
    * **New File**: `md/gt_search_methods.xml` - Contains all three search method cues
      - `SearchCachedTrades` (~1115 lines) - Searches cached trade entries
      - `SearchLiveTrades` (~710 lines) - Performs live trade searches with batch processing
      - `SearchFallbackTrades` (~76 lines) - Fallback search with relaxed parameters
    * **Updated References**: All signal calls in `gt_trading_search.xml` updated to use `md.gt_cuename`
    * **Signal Updates**: 
      - `SearchCachedTrades` → `md.gt_searchcachedtrades`
      - `SearchLiveTrades` → `md.gt_searchlivetrades`
      - `SearchFallbackTrades` → `md.gt_searchfallbacktrades`
    * **Internal Signal**: `SearchFallbackTrades` signals `md.gt_searchlivetrades` internally
  - Benefits:
    * **Code Organization**: Reduced `gt_trading_search.xml` from 4676 lines to 2779 lines (~40% reduction)
    * **Maintainability**: Search methods now isolated in dedicated file, easier to locate and modify
    * **Separation of Concerns**: Search logic separated from main trade route coordination logic
    * **No Functional Changes**: All functionality preserved, only organizational improvement
  - Files Created:
    * `md/gt_search_methods.xml` (new file with 1901 lines)
  - Files Modified:
    * `md/gt_trading_search.xml` (removed 3 cues, updated signal references)


FIX: Integer Division Bug in Profit Threshold Calculation
  - Issue: Level 11 pilot showing "Profit threshold calculated: 0 Cr" despite formula expecting ~6,122 Cr
  - Root Cause: Integer division bug in `GT_GetPilotLevelProfitThreshold` library function
  - Problem: Formula `1000000 * ((skillLevel - 1) / 14)^2` was performing integer division, causing `(skillLevel - 1) / 14` to evaluate to 0 for skillLevel < 15
  - Solution: Changed formula to `((skillLevel - 1)^2 * 1000000) / 196` to ensure correct floating-point calculation
  - Impact:
    * Level 1: 0 Cr (unchanged)
    * Level 11: Now correctly calculates ~6,122 Cr (was 0 Cr due to integer division)
    * Level 15: 10,000 Cr (unchanged)
  - Files Modified:
    * `md/gt_trade_utilities.xml` (GT_GetPilotLevelProfitThreshold function, lines 303-311)


FIX: Race Condition in Trade Execution - Trade Becomes Invalid Between Selection and Execution
  - Issue: Selected trade offers were consumed by another ship between selection and execution, causing "trade no longer valid" errors
  - Root Cause: Trade offers can be consumed between `SearchTradeRoutes` selecting a trade and `ExecuteTrade` executing it
  - Problem: When trade becomes invalid, ship would immediately restart search, wasting time and potentially missing other valid trades from the same search
  - Solution: Implemented fallback mechanism in `ExecuteTrade` to iterate through `$tradeList` and find next valid trade
    * If selected trade's buy/sell offers are no longer `available` or `amount gt 0`, iterate through `$tradeList`
    * Find first valid trade (both offers available and have amount > 0)
    * Replace current trade with valid fallback and continue execution
    * If no valid fallback found, signal `GT_No_Trade_Found` to trigger new search
  - Benefits:
    * **Reduced Search Restarts**: Ship tries fallback trades before restarting search
    * **Better Trade Utilization**: Uses other valid trades from same search result
    * **Improved Performance**: Avoids unnecessary search restarts when valid alternatives exist
  - Files Modified:
    * `md/gt_trading_execution.xml` (ExecuteTrade cue, lines 70-113)
    * `md/gt_trading_search.xml` (SearchTradeRoutes now passes `$tradeList` to ExecuteTrade)


FIX: Maintenance Station Selection - Stations Not Sorted by Distance After Combining Lists
  - Issue: Ships were flying past closer stations to reach farther stations for equipment resupply
  - Root Cause: Station lists (equipment docks, wharfs, shipyards) were found separately and sorted individually, but when combined, the final list was NOT re-sorted by distance
  - Problem: Final list order was: all equipment docks (sorted) + all wharfs (sorted) + all shipyards (sorted)
    * A shipyard 2 jumps away would come after an equipment dock 6 jumps away
    * Ship would select the equipment dock 6 jumps away instead of the closer shipyard
  - Solution: After combining all station types, re-sort the combined list by distance from ship
    * Create temporary table mapping stations to their `gatedistance` from ship
    * Sort combined list using `sort_list` with distance table
    * Unreachable stations (distance < 0) sorted last (distance set to 999999)
  - Impact:
    * Ships now always select the nearest station regardless of station type
    * Equipment docks, wharfs, and shipyards are evaluated in distance order
    * Reduces unnecessary travel time for equipment resupply
  - Files Modified:
    * `md/gt_maintenance.xml` (ExecuteMaintenance cue, lines 414-431)


Version 0.5.20 - 2025-11-13
---------------------------

CRITICAL FIX: Maintenance System Sending Ships to Undiscovered Stations
  - Fixed: Ships were getting "target not reachable" errors when trying to resupply/repair
  - Root cause: Maintenance system was creating orders for stations that weren't known to the player
  - Problem: Vanilla's `move.generic` requires stations to be known to the player for pathfinding to work
  - Solution: Added comprehensive validation checks BEFORE creating maintenance orders using new library function:
    * **New Library Function**: `GT_Pathfinding_Utilities.GT_IsStationReachable` - Centralized reachability checking
    * **Station Known Check**: Verify station is known to player using `$station.isknown` (correct property syntax)
    * **Same Zone Check**: If ship and station are in same zone, skip pathfinding (directly reachable)
    * **Basic Path Check**: Verify vanilla's `move.generic` can find a path (uses basic `gatedistance`)
    * **Blacklist-Aware Path Check**: Verify safe path exists (respects blacklists)
    * **Docking Check**: Verify station allows docking (already existed, now properly ordered)
  - Implementation:
    * **New Library**: `md/gt_pathfinding_utilities.xml` - Added `GT_IsStationReachable` function (lines 209-310)
      - Checks: Station exists → Station known OR same zone → Basic path exists → Blacklist-aware path exists
      - If same zone: Returns reachable immediately (no pathfinding needed)
      - Returns boolean or detailed table with failure reasons and distances
    * **Equipment Station Search**: Refactored to use library function (lines 486-503)
    * **Repair Station Search**: Refactored to use library function (lines 1580-1593)
    * **Training Station Search**: Also updated to use library function (lines 1808-1821)
    * All checks now use single library call instead of inline validation logic
  - Technical details:
    * Same zone optimization: Ships in same zone as station can reach it directly (no pathfinding needed)
    * Vanilla's `move.generic` line 821 uses basic `gatedistance.{$destination}` for initial path check
    * If basic path fails, vanilla aborts before blacklist-aware pathfinding can help
    * We now verify BOTH paths exist before creating orders, ensuring vanilla's check will pass
    * Station known check prevents sending ships to undiscovered stations (which vanilla can't pathfind to)
  - Benefits:
    * Ships no longer get "target not reachable" errors from undiscovered stations
    * Ships no longer get "target not reachable" errors when basic path doesn't exist
    * Ships in same zone as station can reach it directly (no false negatives)
    * Maintenance orders only created for stations that vanilla can actually reach
    * Consistent with trade order validation (we verify reachability before creating orders)
    * **Code quality**: Centralized reachability logic in reusable library function (DRY principle)
  - Files modified:
    * `md/gt_pathfinding_utilities.xml` (new library function: GT_IsStationReachable)
    * `md/gt_maintenance.xml` (refactored to use library function)
    * `md/gt_xp_training.xml` (updated to use library function)
  - Note: This fix ensures we only send stations to vanilla that vanilla can reach, matching how trade orders work

CHANGE: Pilot Level Profit Threshold Formula Updated
  - Changed: Quadratic formula for pilot level-based profit thresholds adjusted
  - Old formula: Level 1: 0 Cr, Level 15: 50,000 Cr
  - New formula: Level 1: 0 Cr, Level 15: 10,000 Cr
  - Formula: `1000000 * ((skillLevel - 1) / 14)^2`
  - Thresholds:
    * Level 1: 0 Cr (0 raw) - accepts trades with 0 profit
    * Level 2: ~51 Cr (5,102 raw)
    * Level 3: ~204 Cr (20,408 raw)
    * Level 5: ~816 Cr (81,633 raw)
    * Level 10: ~3,673 Cr (367,347 raw)
    * Level 15: 10,000 Cr (1,000,000 raw)
  - Rationale: Level 1 pilots accept any profitable trade (even 0 Cr profit), level 15 pilots are selective but reasonable (10,000 Cr minimum)
  - Files modified:
    * `md/gt_trade_utilities.xml` (GT_GetPilotLevelProfitThreshold function)

FIX: Debug Logging Performance - Added Debug Flag Checks
  - Fixed: Heavy debug logging was always active, causing performance issues and log spam
  - Problem: Many `debug_text` statements with `chance="100"` were not checking debug flags before logging
  - Solution: Wrapped all heavy debug logging statements with `@global.$GT_GlobalSettings.$Debug.$EnableDebugLogging` checks
  - Files fixed:
    * `md/gt_maintenance.xml` - Maintenance check start message
    * `aiscripts/order.build.equip.xml` - Build.Equip completion and restock messages (3 instances)
    * `aiscripts/order.restock.xml` - Restock completion and summary messages (2 instances)
    * `md/gt_trade_logging.xml` - System initialization, cue triggers, training messages, repair logging, toggle messages (15+ instances)
    * `aiscripts/order.trade.galaxytrader.xml` - Commander change, phase 6/7 messages, LastRejectionStats debug dump (5 instances)
  - Benefits:
    * **Performance**: Reduced log spam when debug logging is disabled
    * **Cleaner logs**: Only logs when explicitly enabled via debug settings
    * **Heavy logging controlled**: Large debug dumps (like LastRejectionStats with 15+ lines) now only log when debugging
  - Note: All debug logging now respects the global debug flag setting

CHANGE: Fallback Search Profit Threshold Fixed
  - Changed: Fallback search now uses fixed 100 Cr threshold regardless of pilot level
  - Previous behavior: Used halved pilot level threshold (level 15 would require 25,000 Cr in fallback)
  - New behavior: All pilots use 100 Cr minimum in fallback search (last resort mode)
  - Rationale: Fallback is last resort - should accept lower profits to find ANY trade, regardless of pilot level
  - Files modified:
    * `md/gt_trading_search.xml` (SearchFallbackTrades cue)

Version 0.5.19 - 2025-11-13
---------------------------

PERFORMANCE: Event-Driven Architecture Conversion - Eliminated All Polling Overhead
  - Major performance improvement: Converted all polling-based event processing to true event-driven architecture
  - Problem: Multiple systems were using `checkinterval` polling (0.05s-0.1s) to check global flags, causing unnecessary CPU overhead
  - Solution: Replaced all polling with direct event signals using `signal_objects` (AI→MD) and `signal_cue_instantly` (MD→MD)
  - Implementation:
    * **AI Scripts → MD Cues**: Replaced `set_value name="global.$GT_XXXPending" exact="true"` with `signal_objects object="player.galaxy" param="'GT_XXX'"`
    * **MD Scripts → MD Cues**: Replaced `set_value name="global.$GT_XXXPending" exact="true"` with `signal_cue_instantly cue="md.ScriptName.CueName"`
    * **MD Cue Conditions**: Replaced `checkinterval` + `check_value` with `event_object_signalled` or `event_cue_signalled`
    * Removed all obsolete pending flag initialization code
  - Systems converted (10 total):
    * **Trade Success Processing** (`GT_DirectTradePending` → `ProcessTradeSuccess`)
      - AI script: `aiscripts/order.trade.perform.xml` - Signals `GT_DirectTrade` on trade completion
      - MD cue: `md/gt_trading_signals.xml` - Listens for `GT_DirectTrade` signal
    * **Trade Failure Processing** (`GT_TradeFailurePending` → `ProcessTradeFailure`)
      - AI script: `aiscripts/order.trade.perform.xml` - Signals `GT_TradeFailure` on trade failure
      - MD cue: `md/gt_trading_signals.xml` - Listens for `GT_TradeFailure` signal
    * **Buy Completion Processing** (`GT_BuyCompletePending` → `ProcessBuyCompletion`)
      - AI script: `aiscripts/order.trade.perform.xml` - Signals `GT_BuyComplete` on buy completion
      - MD cue: `md/gt_buy_tracking.xml` - Listens for `GT_BuyComplete` signal
    * **XP Event Processing** (`GT_XPEventPending` → `ProcessXPEvents`)
      - MD script: `md/gt_debug.xml` - Signals `ProcessXPEvents` directly
      - MD cue: `md/gt_xp_training.xml` - Listens for `ProcessXPEvents` signal
    * **Training Event Processing** (`GT_TrainingEventPending` → `ProcessTrainingEvents`)
      - MD script: `md/gt_xp_training.xml` - Signals `ProcessTrainingEvents` on training completion
      - MD cue: `md/gt_xp_training.xml` - Listens for `ProcessTrainingEvents` signal
    * **Competitor Event Processing** (`GT_CompetitorEventPending` → `ProcessCompetitorEvents`)
      - MD script: `md/gt_market_intelligence.xml` - Signals `ProcessCompetitorEvents` when competitors detected
      - MD cue: `md/gt_market_intelligence.xml` - Listens for `ProcessCompetitorEvents` signal
    * **Territory Event Processing** (`GT_TerritoryEventPending` → `ProcessTerritoryEvents`)
      - MD script: `md/gt_territory_management.xml` - Signals `ProcessTerritoryEvents` on conflict detection
      - MD cue: `md/gt_territory_management.xml` - Listens for `ProcessTerritoryEvents` signal
    * **Ware Filter Event Processing** (`GT_WareFilterEventPending` → `ProcessWareFilterEvents`)
      - MD script: `md/gt_ware_filter.xml` - Signals `ProcessWareFilterEvents` when filter events occur
      - MD cue: `md/gt_ware_filter.xml` - Listens for `ProcessWareFilterEvents` signal
    * **Configuration Event Processing** (`GT_ConfigEventPending` → `ProcessConfigurationEvents`)
      - MD cue: `md/gt_configuration.xml` - Converted for consistency (currently unused, ready for future use)
    * **Market Event Processing** (`GT_MarketEventPending` → `ProcessMarketEvents`)
      - MD cue: `md/gt_market_intelligence.xml` - Converted for consistency (currently unused, ready for future use)
  - Technical details:
    * Removed `checkinterval="0.05s"` and `checkinterval="0.1s"` from 10 processing cues
    * Removed `check_value value="global.$GT_XXXPending?"` conditions
    * Removed `remove_value name="global.$GT_XXXPending"` actions
    * Removed obsolete pending flag initialization (`set_value name="global.$GT_XXXPending" exact="false"`)
    * Fixed script name references (underscores vs no underscores) for proper cue resolution
  - Benefits:
    * **Performance**: Eliminated all polling overhead (0.05s-0.1s intervals removed)
    * **Responsiveness**: Events processed immediately when they occur, not on next poll cycle
    * **CPU Usage**: Reduced CPU cycles by removing constant polling checks
    * **Architecture**: Consistent event-driven pattern throughout the mod
    * **Scalability**: Event-driven architecture scales better with more ships/events
  - Files modified:
    * AI scripts: `aiscripts/order.trade.perform.xml` (3 conversions)
    * MD scripts: `md/gt_trading_signals.xml`, `md/gt_buy_tracking.xml`, `md/gt_xp_training.xml`, `md/gt_market_intelligence.xml`, `md/gt_territory_management.xml`, `md/gt_ware_filter.xml`, `md/gt_configuration.xml`, `md/gt_debug.xml`
  - Note: This conversion builds on the previous event-driven improvements for resupply/repair completion (version 0.5.18)

FIX: Property Lookup Failures - Missing Variable Initializations
  - Fixed multiple property lookup failures caused by variables/globals not being initialized before use
  - Problem: Race conditions and missing initialization checks caused "Property lookup failed" errors
  - Solution: Added proper initialization checks and defensive programming throughout the codebase
  - Fixes:
    * **GT_Maintenance.DoMaintenance** - Fixed `$pilotLevel` property lookup failure
      - Problem: `$pilotLevel` was used in conditions before being initialized
      - Solution: Added initialization from `global.$GT_Pilots.{$ship.pilot}.$Level` with safe fallback to level 1
      - File: `md/gt_maintenance.xml` (lines 20-24)
    * **GT_TradingAI.ProcessDelayedTradeRequest** - Fixed `global.$GT_SearchLocks` and `global.$GT_AIParameters` property lookup failures
      - Problem: Code accessed global tables without checking if they existed first
      - Solution: Added existence checks and initialization before accessing nested properties
      - File: `md/gt_trading_ai.xml` (lines 225-233)
    * **GT_Trading_Queue.CheckTradeCache** - Fixed `global.$GT_SearchQueue.$Params` property lookup failure
      - Problem: Code tried to set `global.$GT_SearchQueue.$Params.{$ship}` without ensuring `$Params` table existed
      - Solution: Added comprehensive initialization checks for all `$GT_SearchQueue` properties including `$Params`
      - File: `md/gt_trading_queue.xml` (lines 413-439)
    * **GT_Trading_Queue.ProcessSearchQueue** - Fixed missing global table initialization and null parameter handling
      - Problem: Code accessed `global.$GT_SearchQueue.$Params.{$ship}` without validation, causing null parameter errors
      - Solution: Added initialization checks for all required properties and validation before using parameters
      - File: `md/gt_trading_queue.xml` (lines 475-521)
    * **GT_Trading_Search.SearchTradeRoutes** - Fixed null parameter validation
      - Problem: `$params` could be null but code only checked existence (not null), causing property access failures
      - Solution: Improved validation to check if `$params.$Ship` exists (handles null case properly)
      - File: `md/gt_trading_search.xml` (lines 51-67)
  - Technical details:
    * All fixes follow the pattern: Check existence → Initialize if missing → Use safely
    * Used safe operators (`@`) where appropriate
    * Added defensive checks even though initialization should guarantee existence (handles race conditions)
  - Files modified:
    * `md/gt_maintenance.xml`
    * `md/gt_trading_ai.xml`
    * `md/gt_trading_queue.xml`
    * `md/gt_trading_search.xml`

FIX: Fallback Search Skill Multiplier Applied Twice - Inflated Profit Thresholds
  - Critical bug fix: Fallback search was applying skill multiplier twice, causing profit thresholds to be massively inflated
  - Problem: When fallback search continuation ran, it applied skill multiplier to already-multiplied values
    * Example: Level 1 pilot (0.5x multiplier) with 5000 Cr threshold
    * First application: 5000 Cr → 2500 Cr (correct)
    * Fallback relaxation: 2500 Cr → 1250 Cr (correct)
    * Continuation re-application: 1250 Cr → 125000 Cr (WRONG - 25x inflation!)
  - Solution: Added detection for fallback search continuations and skip skill multiplier application
    * Fallback search receives already-multiplied values, relaxes them, then passes to continuation
    * Continuation now detects fallback search (maxDistance == 2 + isLiveSearchContinuation) and skips multiplier
  - Impact: Ships were rejecting all trades because profit thresholds were 25-50x higher than intended
  - File: `md/gt_trading_search.xml` (lines 107-135)
  - Result: Fallback search now correctly uses relaxed profit thresholds, allowing trades to be found

FEATURE: Pilot-Level Based Profit Thresholds
  - New feature: Profit thresholds now scale with pilot skill level using non-linear progression
  - Formula: `5000000 * ((skillLevel - 1) / 14)^2` (quadratic curve)
  - Thresholds:
    * Level 1: 0 Cr (accepts trades with 0 profit - perfect for beginners)
    * Level 2: ~255 Cr
    * Level 3: ~1,020 Cr
    * Level 4: ~2,296 Cr
    * Level 5: ~4,082 Cr
    * Level 10: ~18,367 Cr
    * Level 15: 50,000 Cr (very selective traders)
  - Implementation:
    * New library function: `GT_GetPilotLevelProfitThreshold` in `gt_trade_utilities.xml`
    * Integrated into trade search queue (`gt_trading_queue.xml`) and trade search (`gt_trading_search.xml`)
    * Fallback search also respects pilot level thresholds
  - Rationale: Lower-level pilots are more forgiving (accept lower profits), higher-level pilots are more selective (require higher profits)
  - Files modified:
    * `md/gt_trade_utilities.xml` (new library function)
    * `md/gt_trading_queue.xml` (uses pilot level for threshold calculation)
    * `md/gt_trading_search.xml` (uses pilot level from parameters)
  - Result: Profit thresholds now scale appropriately with pilot skill, making trading progression more meaningful

FIX: Critical Profit Threshold Calculation Bug - 100x Inflation for Intra-Sector Trades
  - Critical bug fix: Intra-sector profit thresholds were calculated incorrectly, causing 100x inflation
  - Problem: `GT_CalculateTradeThresholds` was applying `Cr` suffix after multiplication, causing X4 to misinterpret values
    * Example: Base threshold 2500 Cr (250000 raw centicredits)
    * Intra-sector should be: 250000 / 2 = 125000 raw = 1250 Cr
    * Bug was calculating: (250000 * 50 / 100)Cr = 125000Cr = 125000 Cr (100x too high!)
  - Impact: All intra-sector trades were being rejected because thresholds were 100x higher than intended
    * Trades with profit 2108 Cr, 31390 Cr, 1386 Cr, 26506 Cr were all rejected
    * Threshold showed as 125000 Cr instead of 1250 Cr
    * This affected ALL intra-sector trade evaluation (Phase 1 in batch processor)
  - Solution: Removed `Cr` suffix from threshold calculations - values are already in raw format (centicredits)
    * Intra-sector (50%): Changed from `($profitThreshold * 50 / 100)Cr` to `$profitThreshold / 2`
    * Isolated intra-sector (25%): Changed from `($profitThreshold * 25 / 100)Cr` to `$profitThreshold * 25 / 100`
    * Advanced analytics (95%): Changed from `($profitThreshold * 95 / 100)Cr` to `$profitThreshold * 95 / 100`
  - Technical details:
    * `$profitThreshold` is already in raw format (centicredits), so no `Cr` suffix needed
    * Applying `Cr` suffix after calculation causes X4 to interpret result as credits, multiplying by 100
    * Example: 125000 raw → 125000Cr = 125000 Cr (wrong) vs 125000 raw = 1250 Cr (correct)
  - Files modified:
    * `md/gt_trade_utilities.xml` (GT_CalculateTradeThresholds library, lines 838-860)
  - Result: Intra-sector trades now correctly evaluated with proper thresholds (1250 Cr instead of 125000 Cr)
    * Trades that were previously rejected are now correctly accepted
    * Fallback search can now find profitable intra-sector trades

FIX: Resupply Loop Bug - Immediate Re-Trigger After Successful Resupply
  - Critical bug fix: Ships were immediately re-triggering resupply after completing it successfully
  - Note: This bug was observed after removing the resupply cooldown
  - Problem: After resupply completed, maintenance check ran again immediately and saw CM=0 (even though CM wasn't needed originally), triggering another resupply
  - Root cause: Incorrect property access - using `@` operator on `.count` properties caused incorrect reads
  - Solution:
    * Removed `@` operator from all `.count` property accesses (matches vanilla pattern)
    * Added verification after resupply completion - only check if what was originally needed is satisfied
    * Store what was actually needed (`$NeededCM`, `$NeededUnits`) when creating maintenance order
    * After resupply, verify that what we needed is now satisfied (ignore items that weren't needed)
  - Technical details:
    * Vanilla uses `$ship.ammostorage.countermeasure.count` directly (no `@` operator)
    * `.count` properties always return integer (0+), so `@` operator causes incorrect reads
    * Fixed inconsistent usage: storing "before" values with `@` but reading "current" without `@`
  - Files modified: md/gt_maintenance.xml
    * Lines 67-68, 72-73, 76-77: Removed `@` from initial equipment checks
    * Lines 520-521, 524-525: Removed `@` from station evaluation checks
    * Lines 746-748: Removed `@` from "before" value storage
    * Lines 751-752, 755-756, 759-760: Removed `@` from shopping list calculations
    * Lines 1015-1017: Removed `@` from post-resupply value reads
    * Lines 975-985: Added `$NeededCM` and `$NeededUnits` tracking
    * Lines 1043-1107: Added verification logic to check if what was needed is satisfied
  - Result: Ships no longer immediately re-trigger resupply after successful completion

FIX: UI Shield/Hull Bar Limit Exceeded - Widget System Error
  - Fixed "Widget system error. Already displaying 50 shield/hull bar elements" error in info menu
  - Problem: X4 automatically creates shield/hull bars for selectable table rows (`addRow(true, {})`), and has a global limit of 50 shield/hull bars
  - Root cause: With 64+ ships, each selectable row in the info menu tables created a shield/hull bar, exceeding X4's 50-element limit
  - Solution: Limited all three info menu tables (Overview, Renaming, Control) to display maximum 50 rows to stay under the limit
  - Implementation:
    * Added row limiting logic before creating rows in all three display functions (`displayPilotTable`, `displayRenaming`, `displayPilotControl`)
    * If more than 50 pilots exist, only first 50 are displayed
    * Footer text updated to show "Total Pilots: N (Showing: 50)" when limit is applied
    * Applied consistently across all three tabs (Overview, Renaming, Control)
  - Technical details:
    * X4's widget system has a hard limit of 50 shield/hull bar elements globally
    * Selectable rows (`addRow(true, {})`) automatically create shield/hull bars for ship-related data
    * Non-selectable rows (`addRow(false, {})`) or `addRow(nil, {})` do not create shield/hull bars
    * Header rows use `fixed = true` which also doesn't count toward limit
  - Benefits:
    * Prevents widget system errors when displaying large fleets (64+ ships)
    * Menu remains functional with clear indication when limit is applied
    * Consistent behavior across all three tabs
    * No performance impact - simply limits visible rows
  - Location:
    * ui/gt_info_menu.lua (lines ~296-307, ~582-591, ~788-797, ~343-349, ~674-679, ~903-908)

Version 0.5.18 - 2025-11-12
---------------------------

REFACTOR: Comprehensive Global Tables Initialization and Race Condition Fixes
  - Major refactoring effort to centralize global table initialization and eliminate race conditions
  - Problem: Event-driven cues could run before initialization completed, causing null reference errors
  - Solution: Expanded initialization system and added defensive checks in all event-driven cues
  - Implementation:
    * Expanded `GT_InitializeGlobalTables` to initialize 45+ global tables and lists
    * Added defensive checks in all event-driven cues that access global tables
    * Removed redundant runtime checks after confirming initialization guarantees table existence
    * Added race condition protection for cues that can run before initialization completes
  - Tables now initialized (45+ total):
    * Core search/trading: `$GT_SearchResult.$LastRejectionStats`, `$GT_SearchQueue` (with `$Params`, `$Ships`, `$ActiveSearches`, `$MaxConcurrent`), `$GT_FallbackAttempted`, `$GT_PendingTradesSearchMethod`
    * Trade tracking: `$GT_TradeLogging.$LifetimeProfit`, `$GT_TradeStats` (with `$TotalTrades`, `$TotalProfit`), `$GT_PendingTrades`, `$GT_CargoCostTracking`, `$GT_BuyCompleteQueue`
    * Batch processing: `$GT_BatchDataList` (with validation and cleanup of invalid entries), `$GT_BatchResultsList`, `$GT_TradeCache`, `$GT_FilterState`
    * Cooldowns/timing: `$GT_CacheMissCooldowns`, `$GT_ActiveTradeReservations`, `$GT_MaintenanceFailedResupply`, `$GT_LastResupplyTime`
    * Maintenance: `$GT_RepairOrders`, `$GT_ResupplyOrders`, `$GT_MaintenanceOrders`
    * Core registries: `$GT_Pilots`, `$GT_Ships`
    * Fleet & coordination: `$GT_FleetData`, `$GT_ActiveTradeReservations`
    * Market intelligence: `$GT_MarketData`, `$GT_LastTradeScan`, `$GT_CompetitorData`
    * Territory management: `$GT_TerritoryData`, `$GT_SectorAnalysis`, `$GT_Territories`, `$GT_SectorExpertise`
    * Event queues: `$GT_XPEventQueue`, `$GT_TrainingEventQueue`, `$GT_FleetEventQueue`, `$GT_MarketEventQueue`, `$GT_ConfigEventQueue`
    * Reporting & stats: `$GT_Reports`, `$GT_SessionStats`, `$GT_TradeStats`
    * Threat intelligence: `$GT_ThreatIntelligence`, `$GT_ThreatCleanupTime`
    * Failed trades & locks: `$GT_FailedTrades`, `$GT_SearchLocks`
    * AI & trading: `$GT_AIParameters`, `$GT_TradingQueue`
    * Cache management: `$GT_TradeCacheVersion`, `$GT_TradeCacheLastCleanup`
    * Migration flags: `$GT_BatchDataListMigrated`, `$GT_Applied_Mods`
  - Race condition fixes (8 locations):
    * `GT_Buy_Tracking.ProcessBuyCompletion` - Added condition check and defensive initialization for `$GT_CargoCostTracking` and `$GT_BuyCompleteQueue`
    * `GT_Trading_Execution.ExecuteTrade` - Added defensive check for `$GT_PendingTradesSearchMethod`
    * `GT_ThreatIntelligence.ReceiveThreatWarning` - Added defensive check for `$GT_ThreatIntelligence`
    * `GT_ThreatIntelligence.StoreTrackedEnemyShips` (library) - Added defensive checks for `$GT_ThreatIntelligence` table and sector entries
    * `GT_Trading_Search.SearchTradeRoutes` - Added defensive check for `$GT_FallbackAttempted`
    * `GT_TradingAI.HandleAITradeFailure` - Added defensive check for `$GT_FailedTrades`
    * `GT_Maintenance.ExecuteMaintenance` - Added defensive checks for `$GT_LastResupplyTime` and `$GT_MaintenanceOrders`
    * `GT_Ship_State_Manager.UpdateState` - Improved null check for `$StateHistory` list property
  - Code cleanup:
    * Removed 200+ lines of redundant runtime checks from 20+ files after confirming initialization guarantees
    * All redundant checks removed from:
      - md/gt_trading_search.xml, md/gt_trading_batch_processor.xml, md/gt_trade_logging.xml
      - md/gt_trading_queue.xml, md/gt_maintenance.xml, md/gt_reporting.xml
      - md/gt_ship_management.xml, md/gt_threat_intelligence.xml, md/gt_xp_training.xml
      - md/gt_core_system.xml, md/gt_blacklist_utilities.xml, md/gt_trading_ai.xml
      - md/gt_trading_execution.xml, md/gt_info_menu_loader.xml, md/gt_trading_signals.xml
      - md/gt_buy_tracking.xml, md/gt_fleet_coordination.xml, md/gt_market_intelligence.xml
      - md/gt_territory_management.xml, md/gt_debug.xml, GT_Data_Utilities.xml
      - aiscripts/order.trade.perform.xml
  - Benefits:
    * **Reliability**: Eliminates race condition crashes when loading save games
    * **Performance**: One-time initialization instead of checks on every access
    * **Maintainability**: Centralized initialization logic - easy to add new tables
    * **Code quality**: Cleaner, simpler code without repetitive validation
    * **Save game compatibility**: Automatically fixes table structures from old save games
    * **Robustness**: Defensive checks handle edge cases even if initialization hasn't completed
  - Location:
    * md/gt_configuration.xml (GT_InitializeGlobalTables library, expanded initialization)
    * Multiple MD files (race condition fixes and redundant check removal)

FEATURE: Enhanced Sector Blacklist Logbook Messages with Enemy Ship Details
  - Added detailed enemy ship information to logbook messages when sectors are blacklisted
  - Problem: When a sector gets blacklisted, players had no visibility into which specific enemy ships triggered the blacklist
  - Solution: Logbook messages now include all tracked enemy ships, sorted by size class with ship names and IDs
  - Implementation:
    * When a sector is blacklisted in `ReceiveThreatWarning`, enemy ships are retrieved from threat intelligence tracking
    * Ships are sorted by size class (XL, L, M, S) in descending order
    * Each ship entry includes the ship's class name (knownname) followed by its ID code
    * Ships are grouped by size class with labels (XL:, L:, M:, S:)
    * Multiple ships per class are comma-separated on the same line
    * Only size classes with detected ships are included in the message
  - Message format:
    * TextDB entry: `{77000,3220}.[sector name, '', ship details string]` (3 parameters: sector, empty destination, ship list)
    * Ship details format: "XL: ShipName ID, ShipName ID\nL: ShipName ID\nM: ShipName ID, ShipName ID\nS: ShipName ID"
    * Example: "XL: Destroyer XEN-001, Carrier XEN-002\nL: Frigate ARG-123\nM: Corvette HOP-456, Gunboat HOP-789"
    * Note: Empty string provided as second parameter since destination sector is unknown when blacklisting
  - Benefits:
    * **Visibility**: Players can see exactly which enemy ships caused the blacklist
    * **Intelligence**: Ship class names help identify threat types (Destroyer, Carrier, Frigate, etc.)
    * **Organization**: Ships sorted by size class make it easy to assess threat level
    * **Actionable**: Ship IDs allow players to track specific threats
  - Location:
    * md/gt_threat_intelligence.xml (ReceiveThreatWarning cue, lines ~990-1108)

FIX: Dedicated TextDB Entry for Sector Blacklist Logbook Messages
  - Created dedicated TextDB entry for sector blacklisting messages instead of reusing "enemy ship escaped" entry
  - Problem: TextDB entry `{77000,3220}` is designed for "enemy ship escaped" messages (3 params: sector, destination, ship) but was being reused for "sector blacklisted" messages (2 params: sector, ship list)
  - Root cause: Reusing TextDB entry with mismatched parameters required workaround (empty destination parameter) and wording didn't match the use case
  - Solution: Created new TextDB entry `{77000,3222}` specifically designed for sector blacklisting with ship lists (2 parameters: sector, ship list)
  - Implementation:
    * Created new TextDB entry `{77000,3222}` in all translation files (8 languages: English, German, Italian, Russian, French, Portuguese, Spanish, and default)
    * Updated code to use new entry: `{77000,3222}.[$sector.knownname, $shipIDString]`
    * Removed workaround empty parameter that was needed for old entry
    * Message format: "SECTOR BLACKLISTED" with detected enemy ships listed by size class (XL, L, M, S)
  - Benefits:
    * **Accuracy**: Message wording now perfectly matches the blacklist use case
    * **Clarity**: No confusion with "enemy ship escaped" message format
    * **Maintainability**: Dedicated entry makes future improvements easier
    * **Localization**: Proper translations for all supported languages
  - Location:
    * md/gt_threat_intelligence.xml (ReceiveThreatWarning cue, line 1097)
    * t/0001-L001.xml, t/0001-L007.xml, t/0001-L033.xml, t/0001-L034.xml, t/0001-L039.xml, t/0001-L044.xml, t/0001-L049.xml, t/0001-L055.xml (TextDB entry 3222)

FIX: Null Check for Batch Processor List Properties
  - Fixed crash when accessing `.count` on batch processor lists that could be null
  - Problem: `$wareKeysList.count`, `$sellOffersList.count`, and `$buyOffersList.count` could fail if lists were null
  - Root cause: Even with `?` operator check, extracting lists from state could result in null, and accessing `.count` on null causes crash
  - Solution: Added validation at start of batch processor to ensure critical list properties are valid before processing
  - Implementation:
    * Use safe operator `@` when extracting lists from batch state
    * Validate all critical lists exist (not null) before processing
    * Clean up invalid batch state and exit gracefully if validation fails
    * Added null checks before accessing `.count` on all list properties
    * Extract `.count` to intermediate variable using safe operator `@` and validate before use
  - Benefits:
    * Prevents crashes when processing batch data from old save games
    * Handles edge cases where batch state might have null properties
    * Ensures batch processor exits gracefully on invalid data
    * Save game compatibility: Automatically handles stale batch data from previous versions
  - Location:
    * md/gt_trading_batch_processor.xml (lines ~50-74, ~135-152, ~203-229) - List extraction, validation, and count access

FIX: Training Station Search Improvements - Trading Stations Only with Enhanced Safety Checks
  - Improved training station search to only use trading stations and added comprehensive safety checks
  - Problem: Ships could be sent to unreachable training stations (shipyards, wharves, equipment docks) that were in blacklisted sectors or lacked proper docking capability
  - Solution: Restricted training station search to trading stations only and added blacklist-aware pathfinding with docking capability validation
  - Implementation:
    * Removed shipyard/wharf and equipment dock searches from training station finder
    * Now only searches for trading stations (`tradestation="true"`)
    * Added blacklist-aware pathfinding using `GT_Pathfinding_Utilities.GT_CalculatePathDistance`
    * Added comprehensive validation checks in order:
      1. Blacklist-aware distance check (filters unreachable stations)
      2. Blacklist checks (station + sector travel/activity blacklists)
      3. Technical docking capability (verifies station has docking bay for ship size using `find_dockingbay`)
      4. Docking permission check (verifies `station.dockingallowed.{$ship}`)
    * Nearest station selection now uses blacklist-aware pathfinding to ensure selected station is actually reachable
  - Benefits:
    * **Reliability**: Ships only sent to trading stations that can actually be reached
    * **Safety**: Prevents ships from being sent to blacklisted sectors or stations
    * **Docking**: Ensures station has proper docking bay for ship size before sending
    * **Permission**: Verifies docking is allowed before sending ship
    * **Consistency**: Uses same blacklist-aware pathfinding as repair/resupply systems
  - Location:
    * md/gt_xp_training.xml (FindTrainingStation cue, lines ~1786-1921)

PERFORMANCE: Increased Early Exit Threshold for Batch Processing
  - Increased early exit threshold to improve batch processing performance
  - Problem: Early exit threshold was too low, causing batch processor to exit prematurely before finding optimal trades
  - Solution: Increased `$GT_GlobalSettings.$Performance.$EarlyExitThreshold` value
  - Benefits:
    * **Performance**: Batch processor now searches more thoroughly before early exit
    * **Trade Quality**: Allows more time to find better trade matches
    * **Efficiency**: Better balance between search thoroughness and performance
  - Location:
    * md/gt_global_settings.xml (Performance settings, EarlyExitThreshold)

FIX: Repair Station Search - Capability-Based Instead of Station Type-Based
  - Fixed repair station search to use actual repair capabilities instead of station type assumptions
  - Problem: Previous logic relied on station types (Wharf, Shipyard, Equipment Dock) to infer repair capability, which is not always accurate
  - Root cause: Station type alone does not guarantee repair capability - stations must have `shiptrader` control entity AND be able to build OR supply the ship's class
  - Solution: Switched to capability-based search that directly queries for stations with repair capabilities, aligning with vanilla game logic
  - Implementation:
    * Removed ship class detection logic (`Detect_Ship_Class`) and conditional searches for different station types
    * Replaced with single `find_station` query that searches for stations with `hascontrolentity="controlpost.shiptrader"`
    * After initial search, validates each station manually:
      - Verifies repair capability: `station.canbuildclass.{$ship.class}` OR `station.cansupplyclass.{$ship.class}`
      - Verifies docking capability: `find_dockingbay` for ship's docksize
    * Existing safety checks (blacklist, pathfinding, max jump distance, docking permission, excluded sectors) preserved and now operate on accurately filtered station list
  - Vanilla pattern reference:
    * Source: `interrupt.restock.xml:778`, `order.repair.xml:71-73`
    * Vanilla checks: `station.shiptrader?` AND (`canbuildclass.{ship.class}` OR `cansupplyclass.{ship.class}`)
  - Benefits:
    * **Accuracy**: Only finds stations that can actually repair the ship
    * **Reliability**: No false positives from station types that don't have repair capability
    * **Consistency**: Uses same logic as vanilla game repair system
    * **Robustness**: Works correctly regardless of station type or configuration
  - Location:
    * md/gt_maintenance.xml (FindNearestRepairStation library, lines ~1406-1541)

FIX: Resupply Station Search - Capability-Based Instead of Station Type-Based
  - Fixed resupply station search to use actual resupply capabilities instead of station type assumptions
  - Problem: Previous logic relied on station types (Wharf, Shipyard, Equipment Dock) and ship class detection to infer resupply capability, which is not always accurate
  - Root cause: Station type alone does not guarantee resupply capability - stations must be able to supply the ship's class (`cansupplyclass`)
  - Solution: Switched to capability-based search that validates stations can actually supply equipment to the ship's class, aligning with vanilla game logic
  - Implementation:
    * Removed ship class detection logic (`Detect_Ship_Class`) and conditional searches for different station types based on ship class
    * Replaced with unified search that queries for all potential equipment stations (equipment docks, wharfs, shipyards)
    * After initial search, validates each station manually:
      - Verifies resupply capability: `station.cansupplyclass.{$ship.class}` (station must be able to supply this ship class)
      - Verifies docking capability: `find_dockingbay` for ship's docksize
    * Existing safety checks (blacklist, pathfinding, max jump distance, docking permission, excluded sectors, stock availability) preserved and now operate on accurately filtered station list
  - Vanilla pattern reference:
    * Source: `interrupt.restock.xml` - vanilla checks `cansupplyclass.{ship.class}` for equipment stations
    * Vanilla logic: Station must be able to supply equipment to the ship's class to resupply
  - Benefits:
    * **Accuracy**: Only finds stations that can actually resupply the ship
    * **Reliability**: No false positives from station types that don't have resupply capability for the ship's class
    * **Consistency**: Uses same logic as vanilla game resupply system
    * **Robustness**: Works correctly regardless of station type or ship class configuration
    * **Simplicity**: Removed complex ship class detection and conditional logic
  - Location:
    * md/gt_maintenance.xml (ExecuteMaintenance cue, equipment station search section, lines ~360-459)

Version 0.5.17 - 2025-11-12
---------------------------

FEATURE: One-Time Global Tables Initialization System
  - Implemented centralized initialization system for all global table structures
  - Problem: Multiple global tables were being checked and initialized repeatedly throughout the codebase, causing performance overhead and code duplication
  - Solution: Created `GT_InitializeGlobalTables` library function that validates and initializes all global tables once at game start/load
  - Implementation:
    * New library function in `gt_configuration.xml` that runs automatically on `event_player_created` or `event_game_loaded`
    * Validates table existence and structure (checks nested properties are valid tables, not null)
    * Initializes missing or invalid tables with proper structure
    * Logs initialization results for debugging
  - Tables initialized (19 total):
    * Core search/trading: `$GT_SearchResult.$LastRejectionStats`, `$GT_SearchQueue` (with `$Params`, `$Ships`, `$ActiveSearches`, `$MaxConcurrent`), `$GT_FallbackAttempted`
    * Trade tracking: `$GT_TradeLogging.$LifetimeProfit`, `$GT_TradeStats` (with `$TotalTrades`, `$TotalProfit`), `$GT_PendingTrades`
    * Batch processing: `$GT_BatchDataList`, `$GT_BatchResultsList`, `$GT_TradeCache`, `$GT_FilterState`
    * Cooldowns/timing: `$GT_CacheMissCooldowns`, `$GT_ActiveTradeReservations`, `$GT_MaintenanceFailedResupply`, `$GT_LastResupplyTime`
    * Maintenance: `$GT_RepairOrders`, `$GT_ResupplyOrders`, `$GT_MaintenanceOrders`
    * Core registries: `$GT_Pilots`, `$GT_Ships`
  - Code cleanup:
    * Removed ~250+ lines of repetitive validation checks from multiple files
    * Simplified table writes to use atomic operations (extract to local, modify, set back)
    * All redundant checks removed from:
      - md/gt_trading_search.xml (removed checks at start of SearchTradeRoutes and before all LastRejectionStats writes)
      - md/gt_trading_queue.xml (removed checks from QueueSearch and ProcessSearchQueue)
      - md/gt_trade_logging.xml (removed checks before LifetimeProfit updates)
      - aiscripts/order.trade.galaxytrader.xml (removed checks before reading LastRejectionStats)
  - Benefits:
    * **Performance**: One-time initialization instead of checks on every access
    * **Maintainability**: Centralized initialization logic - easy to add new tables
    * **Reliability**: Tables guaranteed valid at startup, preventing save game compatibility issues
    * **Code quality**: Cleaner, simpler code without repetitive validation
    * **Save game compatibility**: Automatically fixes table structures from old save games
  - Location:
    * md/gt_configuration.xml (GT_InitializeGlobalTables library, called from ConfigInit cue)

FIX: Null Reference Error in LastRejectionStats Storage
  - Fixed crash when storing rejection statistics for logbook messages
  - Problem: `global.$GT_SearchResult.$LastRejectionStats` could be `null`, causing "Failed to set null.{component...}" error when trying to store per-ship statistics
  - Root cause: The `?` operator checks for existence, not null - a variable can exist but be `null`
  - **Additional root cause discovered**: Old save games may have table structures from previous mod versions where nested properties were `null` or missing
  - Solution: Added robust initialization checks to ensure `$LastRejectionStats` is always a valid table before use
  - Implementation:
    * **Save game compatibility**: Added initialization at start of `SearchTradeRoutes` cue to verify and fix table structure when loading from old saves
    * First ensures `global.$GT_SearchResult` exists (initializes as empty table if missing)
    * Validates `$LastRejectionStats` is a valid table by checking `.keys.count` property
    * Preserves existing data if it's already a valid table
    * Initializes as fresh table if it's `null` or invalid
    * Restores preserved data after initialization to prevent data loss
    * **Safety check layer 1**: Added safety validation right before each `set_value` operation to handle cases where `global.$GT_SearchResult` might be reset to `null` between initialization and use
    * **Safety check layer 2**: Added final safety check right before set_value to prevent race conditions
    * **Safety check layer 3**: Added absolute final check immediately before set_value to guarantee validity (handles any edge cases where global state might change between checks)
    * Uses safe operator `@` to extract `$LastRejectionStats` before validation to prevent crashes
    * Validates table validity by checking `.keys.count` property (returns number >= 0 for valid tables, null for invalid/null values)
    * **Atomic operation**: Uses local variable to ensure atomicity when setting nested properties
  - Benefits:
    * Prevents crashes when storing rejection statistics
    * Ensures logbook messages can always access rejection statistics
    * Preserves existing statistics when re-initializing (no data loss)
    * Handles edge cases where global variables might be reset or null
    * Defensive programming: Multiple layers of safety checks prevent crashes even if global state changes
    * Race condition protection: Multiple validation points ensure validity even if another cue modifies global state
    * **Save game compatibility**: Automatically fixes table structure when loading from old save games
  - Applied to all locations where `$LastRejectionStats` is set:
    * Initial initialization at start of `SearchTradeRoutes` cue (save game compatibility)
    * Initial initialization (continuation path and "No Trades Found" path)
    * Right before set_value in continuation path (around line 456)
    * Right before set_value in "No Trades Found" path (around line 1311)
    * **Reading location**: Added initialization in AI script before reading `$LastRejectionStats` for logbook messages
  - Location: 
    * md/gt_trading_search.xml (lines ~15-38, ~388-413, ~456-510, ~1231-1256, ~1311-1361)
    * aiscripts/order.trade.galaxytrader.xml (lines ~2662-2683)

FIX: Save Game Compatibility for Other Global Tables
  - Fixed potential null reference errors when loading from old save games
  - Problem: Old save games may have global tables with `null` nested properties from previous mod versions
  - Solution: Added initialization checks for other dynamically created tables with nested properties
  - Tables fixed:
    * `global.$GT_TradeLogging.$LifetimeProfit` - Per-ship lifetime profit tracking
    * `global.$GT_SearchQueue.$Params` - Search parameters storage per ship
  - Implementation:
    * Verify parent table exists before accessing nested properties
    * Validate nested property is a valid table (not null) using `.keys.count` check
    * Initialize nested property as empty table if missing or invalid
    * Applied at start of cues that use these tables
  - Benefits:
    * Prevents crashes when loading old save games
    * Ensures table structure is always correct regardless of save game age
    * No data loss - existing valid data is preserved
  - Location:
    * md/gt_trade_logging.xml (lines ~276-291) - Before setting lifetime profit
    * md/gt_trading_queue.xml (lines ~427-440, ~475-498) - In QueueSearch and ProcessSearchQueue cues

FIX: Null Check for .keys.count Property Access
  - Fixed crash when accessing `.count` on `.keys` property that could be null
  - Problem: `$existingStatsKeys.count` and `$existingKeys.count` could fail if `.keys` returned null
  - Root cause: Even with `?` operator check, extracting `.keys` to a variable could result in null, and accessing `.count` on null causes crash
  - Solution: Added additional null check by extracting `.count` with safe operator `@` and validating it before use
  - Implementation:
    * Extract `.count` to intermediate variable using safe operator `@`
    * Verify count variable exists and is greater than 0 before using in `do_all` loops
    * Applied to all locations where `.keys.count` is accessed in atomic write operations
  - Benefits:
    * Prevents crashes when copying existing table entries
    * Handles edge cases where `.keys` might return null
    * Ensures atomic write operations complete successfully
  - Location:
    * md/gt_trading_search.xml (lines ~1310-1340) - In atomic LastRejectionStats write operations

FIX: Vanilla order.assist Null Reference Bug
  - Fixed crash in vanilla Assist order when subordinate is removed
  - Problem: Vanilla code at line 870 accesses `this.assignedcontrolled.order.isrunning` without checking if `order` is null
  - Root cause: When a subordinate is removed from a GT commander, the Assist order is cancelled and becomes null, but vanilla code doesn't check for this
  - Solution: Added null check using nested `do_if` blocks (X4 doesn't short-circuit boolean expressions)
  - Implementation:
    * First check: `this.assignedcontrolled.order?` (outer `do_if`)
    * Second check: `this.assignedcontrolled.order.isrunning` (inner `do_if`, only runs if order exists)
    * Uses nested blocks instead of `and` expression because X4 evaluates both sides of `and` expressions
  - Benefits:
    * Prevents crashes when Assist order is cancelled
    * Fixes vanilla bug that affects GT mod when subordinates are removed
    * Ensures smooth handling of subordinate removal scenarios
  - Location:
    * aiscripts/order.assist.xml (line ~124) - Patch to vanilla Assist order script

Version 0.5.16 - 2025-11-12
--------------------------

FEATURE: Centralized Logbook Message System
  - Refactored all logbook message creation into centralized library system
  - New library: WriteLogbookMessage - handles all logbook entry creation with consistent enablement checks
  - New cue: HandleLogbookMessage - receives signals from AI scripts for logbook entries
  - Benefits:
    * Eliminates code duplication across MD and AI scripts
    * Consistent enablement checking via GT_IsLogbookEnabled library
    * Single point of maintenance for logbook message formatting
    * Improved code organization and readability
  - Migration:
    * Migrated ~30 instances from 8 MD scripts
    * Migrated ~12 instances from 2 AI scripts
    * All callers now pre-construct messages using TextDB syntax before calling library/cue
  - Technical details:
    * X4 TextDB limitation: Does not support list variables for parameters
    * Solution: Callers pre-construct full message string using inline TextDB syntax
    * Pattern: {77000,ID}.[param1, param2, ...] constructed before library call
    * Library accepts pre-constructed Message string along with Category, Title, Object, etc.
  - Location: md/gt_logbook_utilities.xml (WriteLogbookMessage library, HandleLogbookMessage cue)

FIX: No Trades Available Logbook Message Parameters
  - Fixed issue where "No Trades Available" logbook message showed zero for all parameters
  - Problem: LastRejectionStats was being stored using local variables that might be uninitialized
  - Solution: Now reads rejection statistics directly from global.$GT_SearchResult where they're stored by FilterTradeList_Resume
  - Ensures accurate reporting of:
    * Total trades evaluated
    * Trades rejected due to docking restrictions
    * Trades rejected due to insufficient profit
    * Trades rejected due to amount/quantity issues
    * Trades filtered by blacklist restrictions
  - Applied to both continuation path and "No Trades Found" path
  - Location: md/gt_trading_search.xml (LastRejectionStats storage, lines ~356-372 and ~996-1013)

FIX: Docking Capability Validation
  - Added docking capability checks to all station searches
  - Problem: Systems were checking docking permission (dockingallowed) but not verifying stations have physical docking bays for ship size
  - Solution: Now uses find_dockingbay with match_dock size="$ship.docksize" to verify stations can physically dock ships before checking permissions
  - Prevents L/XL ships from being sent to stations without L/XL docking bays
  - Prevents S/M ships from being sent to stations without appropriate docking bays
  - Applied to all systems:
    * Training station search (shipyards, trading posts, equipment docks)
    * Repair station search (wharfs, shipyards, equipment docks)
    * Resupply/equipment station search (wharfs, shipyards, equipment docks)
    * Trading station search (all stations)
  - Check order: Technical capability → Docking permission (consistent across all systems)
  - Benefits:
    * Ships only sent to stations that can physically accommodate them
    * No reliance on station type assumptions (wharfs/shipyards/equipment docks)
    * Double-checking: Capability verified both when adding stations to lists and in validation loops
  - Location:
    * md/gt_xp_training.xml (training station search, lines ~1808-1891)
    * md/gt_maintenance.xml (repair station search FindNearestRepairStation library, lines ~1415-1474 and ~1557-1585)
    * md/gt_maintenance.xml (resupply/equipment station search, lines ~682-716)
    * md/gt_trading_search.xml (trading station validation, lines ~4162-4184)

FEATURE: Fallback Search Price Range Settings
  - Added configurable price range sliders for fallback search mode
  - Problem: Fallback search (last resort when normal search fails) used same price ranges as normal search
  - Solution: Added separate price range controls specifically for fallback search
  - New sliders in Global Settings menu:
    * Fallback: Sell Price Max (range: -100% to +100%, default: 50%)
    * Fallback: Buy Price Min (range: -100% to +100%, default: -50%)
  - Fallback search automatically detected when MaxDistance == 2
  - Fallback search uses relaxed profit thresholds AND configurable price ranges
  - Benefits:
    * Independent control over fallback search aggressiveness
    * Can allow wider price ranges for fallback to find more trades
    * Can restrict fallback ranges to maintain profit quality
    * Better control over trade search behavior when normal search fails
  - Technical details:
    * Fallback search detection: Checks if MaxDistance == 2 in SearchLiveTrades
    * Price range selection: Fallback ranges used only when in fallback mode
    * Isolated ships: Still use isolated price ranges (even during fallback)
    * Settings stored in global.$GT_Config.$Trading.$FallbackSellPriceMax and $FallbackBuyPriceMin
  - Location:
    * md/gt_configuration.xml (initialization and validation, lines ~34-35, ~441-448)
    * md/gt_global_settings.xml (UI sliders, lines ~713-767)
    * md/gt_trading_search.xml (fallback detection and price range selection, lines ~2640-2667)
    * Translation IDs: 9009, 9014 (labels), 9108, 9109 (tooltips) - all 8 languages supported

FEATURE: Additional Performance Tuning Sliders
  - Added three new configurable performance settings to Global Settings → Performance section
  - Problem: Several trade search limits were hardcoded, preventing user customization
  - Solution: Made all trade search limits configurable via sliders
  - New sliders:
    * Max Trades Per Ware: Maximum trades per ware during batch processing (5-100, default: 20, step: 5)
    * Max Offers Per Ware For Matching: Maximum offers per ware for matching in batch processor (5-100, default: 20, step: 5)
    * Early Exit Threshold: Early exit threshold for batch processing (100-2000, default: 500, step: 10)
  - Consistency fix:
    * Live search now uses same MaxTradesToReturn setting as cache search (was hardcoded to 200)
    * Both cache and live search now respect user-configured MaxTradesToReturn setting
  - Benefits:
    * Fine-tune CPU performance vs. trade quality trade-offs
    * Adjust batch processing limits based on system performance
    * Control when batch processing stops early to save CPU
    * Consistent behavior between cache and live search
  - Technical details:
    * MaxTradesPerWare: Limits trades collected per ware during batch matching (prevents single ware monopolizing trade slots)
    * MaxOffersPerWareForMatching: Limits offers considered per ware before nested loops (reduces iterations from 50×100 to 20×20 = 92% reduction)
    * EarlyExitThreshold: When this many trades are found, batch processing stops early (default changed from 1000 to 500)
    * Settings stored in global.$GT_GlobalSettings.$Performance
  - Location:
    * md/gt_global_settings.xml (initialization, validation, UI sliders)
    * md/gt_trading_search.xml (live search MaxTradesToReturn usage, batch state MaxTradesPerWare and EarlyExitThreshold)
    * md/gt_trading_batch_processor.xml (MaxOffersPerWareForMatching usage)
    * Translation IDs: 9236, 9237, 9238 (labels), 9336, 9337, 9338 (tooltips) - all 8 languages supported

IMPROVEMENT: Fallback Search Logic Enhancement
  - Improved fallback search to search from current position while respecting pilot's trading range
  - Problem: Fallback search used home sector as search origin, limiting effectiveness when ship is far from home
  - Solution: Fallback search now searches sectors within 2 jumps from CURRENT POSITION, then filters results by pilot's maxDistance from HOME SECTOR
  - How it works:
    * Step 1: Build list of sectors within 2 jumps from ship's current position (breadth-first search)
    * Step 2: Search for trade offers in those sectors only (optimized search space)
    * Step 3: Filter results to ensure stations are within pilot's maxDistance from home sector
  - Benefits:
    * Ships far from home can still find nearby trades
    * Results respect pilot's trading range from home sector (prevents ships from trading too far from home)
    * More effective fallback search when ship is exploring or far from base
    * Maintains trading range constraints while expanding search space
  - Technical details:
    * Sector list built using find_gate to discover connected sectors (level 0: current, level 1: directly connected, level 2: connected to level 1)
    * Search space limited to sector list for find_sell_offer and find_buy_offer actions
    * Filtering uses originalMaxDistance (pilot's actual maxDistance) instead of fallback search distance (2)
    * OriginalMaxDistance passed through SearchFallbackTrades → SearchLiveTrades → batch state → SearchLiveTrades_Resume
  - Location: md/gt_trading_search.xml (fallback sector list building lines ~2659-2698, filtering logic lines ~3779-3787)



Version 0.5.15 - 2025-11-06
--------------------------

FIX: German Translation File Cleanup

FEATURE: Performance Settings Sliders
  - Added new "Performance" section to Global Settings menu
  - Three configurable settings for CPU performance tuning:
    * Batch Processing Delay: Controls delay between batches during trade search processing (1-100ms, default: 50ms)
    * Validation Delay: Controls delay between trade validations in AI script (1-100ms, default: 50ms)
    * Max Concurrent Searches: Controls maximum number of simultaneous trade searches (1-10, default: 1)
  - All sliders allow fine-tuning CPU load vs. performance trade-offs
  - Higher delays reduce CPU spikes but slow down processing
  - Lower delays improve responsiveness but may increase CPU load
  - Lower concurrent searches reduce CPU load but increase queue wait times
  - Higher concurrent searches process faster but may cause performance spikes
  - Settings are saved and persist between game sessions
  - Location: md/gt_global_settings.xml (Performance section, translation IDs 9230-9233)

IMPROVEMENT: Enhanced Ware Selection Logic
  - Improved trade list preparation to include more wares for AI validation
  - Increased number of trade opportunities sent to AI for final validation
  - Allows AI to evaluate more potential trades before making decisions
  - Better trade diversity and selection quality
  - Location: md/gt_trading_search.xml

IMPROVEMENT: Additional AI Wait Time for Smooth Gameplay
  - Added cooperative multitasking delays in AI trade validation loop
  - Uses configurable Validation Delay setting (default: 50ms)
  - Yields CPU control between trade validations to prevent frame rate drops
  - Keeps game smooth during intensive trade evaluation operations
  - Location: aiscripts/order.trade.galaxytrader.xml (trade validation loop, line ~1802)

FEATURE: Pilot Skill Progression System
  - Pilots now gain piloting skill alongside management skill progression
  - Proportional progression: Management Level 15 (5 stars) → Pilot Level 9 (3 stars)
  - Formula: pilot_level = (management_level * 9) / 15
  - Pilot skill never decreases, only increases when management skill improves
  - If pilot skill is already higher than target, it remains unchanged
  - Progressive skill gains:
    * Management Level 3 (1 star) → Pilot Level 2
    * Management Level 6 (2 stars) → Pilot Level 4
    * Management Level 9 (3 stars) → Pilot Level 6
    * Management Level 12 (4 stars) → Pilot Level 8
    * Management Level 15 (5 stars) → Pilot Level 9 (3 stars)
  - Updates automatically when management skill increases, including after training completion
  - Location: md/gt_xp_training.xml (all management skill update locations)

FEATURE: Sector-Change Rerouting System
  - Event-driven rerouting when ships enter new sectors
  - More efficient than threat-based polling system
  - Checks destination reachability using blacklist-aware pathfinding
  - Triggers when ship enters new sector (gate/anomaly) and has active orders
  - Compares normal distance vs blacklist-aware distance to detect path changes
  - Reroutes if:
    * Destination becomes unreachable (blacklist distance == -1), OR
    * Path changes (blacklist distance > normal distance)
  - Only Level 12+ pilots can analyze route threats mid-route (same as threat system)
  - Uses same reroute logic as GT_Destination_Threatened:
    * Sets reroute flag for ship name display
    * Updates ship name to show [REROUTE] state
    * Cancels all orders and resumes main loop
    * Cargo check automatically handles cargo disposal
  - Benefits:
    * Event-driven: only checks when entering new sector (no polling overhead)
    * Checks active orders (fills gap in threat system which only checks pending trades)
    * Catches route issues during active travel
    * Works even when threats appear mid-journey
    * Complements existing threat system for complete coverage
  - Location: aiscripts/move.generic.xml (sector-change handler)

FEATURE: Dynamic Threat Tracking and Blacklist Clearing
  - Tracks individual enemy ships that cause sector blacklisting
  - Automatically clears blacklisted sectors when all tracked threats are eliminated
  - Event-driven ship destruction handler removes destroyed ships from tracking
  - Cleanup cycle validates ship existence and location every 10 minutes
  - Features:
    * Stores enemy ship IDs when sector is blacklisted (all threat detection cues)
    * Ship destruction handler: instantly removes destroyed ships from tracking
    * Cleanup cycle: validates tracked ships (existence, operational status, sector location)
    * Auto-clears sectors when all tracked ships are destroyed or leave sector
    * Player notification when sector is cleared (uses sector name, not macro ID)
  - Implementation:
    * New library: StoreTrackedEnemyShips - stores enemy ship IDs, avoids duplicates
    * New library: ClearSectorIfAllShipsGone - clears sector and notifies player
    * New cue: TrackEnemyShipDestruction - handles event_object_destroyed for all ships
    * Enhanced cleanup cycle: validates ships, removes invalid/moved ships, clears empty sectors
    * All threat detection cues updated to store tracked ships when blacklisting
  - Benefits:
    * Dynamic blacklist clearing: sectors cleared immediately when threats eliminated
    * No fixed expiry times: blacklist persists only as long as threats exist
    * Accurate tracking: only tracks ships detected within radar range (no cheating)
    * Handles all scenarios: ship destruction, ships leaving sector, ships becoming non-operational
    * Player awareness: notifications show sector name when cleared
  - Technical details:
    * Data structure: global.$GT_ThreatIntelligence.{$sector}.$TrackedEnemyShips = [ship1, ship2, ...]
    * Ship validation: checks $ship.exists, $ship.isoperational, and sector location (macro ID comparison)
    * New enemies automatically tracked when detected by existing threat system (no duplicate detection needed)
    * Cleanup cycle only validates existing tracking (new enemy detection handled by threat system)
  - Location: md/gt_threat_intelligence.xml (libraries, cues, cleanup cycle)
  - Translation: t/0001-L*.xml (ID 3219: "Sector %1 cleared - All threats eliminated")

IMPROVEMENT: Enhanced Enemy Ship Departure Detection
  - Event-driven detection when tracked enemy ships leave blacklisted sectors
  - More efficient than periodic cleanup cycle checks
  - Immediate response: removes ships from tracking as soon as they leave sector
  - Features:
    * Detects sector changes for all ships via move.generic handler
    * Checks if ship is tracked in any blacklisted sector
    * Removes ship from tracking immediately when it leaves sector
    * Auto-clears sector if all tracked ships have left
    * Logbook notification when enemy escapes (includes sector they moved to)
  - Implementation:
    * New handler in move.generic.xml: detects sector changes for all ships
    * Removed sector location check from cleanup cycle (now handled by move.generic)
    * MD cue HandleEnemyShipDeparture: processes sector clearing signals
    * Logbook message (translation ID 3220): "ENEMY SHIP ESCAPED" with roleplay style
  - Benefits:
    * Event-driven: immediate response instead of waiting for cleanup cycle
    * More efficient: no periodic iteration through all sectors
    * Accurate: detects departures instantly when ships change sectors
    * Player awareness: logbook messages show which sector enemy moved to
  - Location: aiscripts/move.generic.xml (enemy departure handler), md/gt_threat_intelligence.xml (HandleEnemyShipDeparture cue)
  - Translation: t/0001-L*.xml (ID 3220: "ENEMY SHIP ESCAPED")

IMPROVEMENT: Sector-Change Rerouting Enhanced for All GT Ship Activities
  - Rerouting now applies to all GT ship activities, not just trading
  - Works for repair, supply, and other activities that use move.generic
  - Removed TradePerform order restriction
  - Still requires Level 12+ pilots for tactical route analysis
  - Features:
    * Applies to all GT ships regardless of current order type
    * Checks destination reachability when entering new sector
    * Triggers reroute if path becomes unreachable or changes
    * Works for repair orders, supply orders, and trade orders
  - Benefits:
    * Comprehensive coverage: all GT ship activities protected from route changes
    * Consistent behavior: same rerouting logic for all activities
    * Better visibility: sector change logs for all GT ships
  - Location: aiscripts/move.generic.xml (sector-change rerouting handler)

FEATURE: Clear All Blacklisted Sectors Button
  - Added maintenance button to clear all blacklisted sectors at once
  - Located in Global Settings menu under "Maintenance & Diagnostics" section
  - Features:
    * Clears all sectors from threat intelligence blacklist
    * Immediately removes all blacklisted sectors from ship blacklists
    * Shows notification with number of cleared sectors
    * Works even if no sectors are currently blacklisted (shows appropriate message)
  - Use cases:
    * Reset threat avoidance system after clearing threats manually
    * Remove incorrectly blacklisted sectors
    * Test threat detection system by clearing and re-detecting
    * Emergency reset if blacklist system gets stuck
  - Implementation:
    * Button handler: GT_ClearAllBlacklistedSectors cue
    * Clears global.$GT_ThreatIntelligence data structure
    * Sends empty string to Lua blacklist system to clear all sectors
    * Refreshes menu after clearing
  - Location: md/gt_global_settings.xml (Maintenance section, button handler)
  - Translation: t/0001-L*.xml (IDs 9223: "Clear All Blacklisted Sectors:", 9224: "CLEAR", 9323: tooltip)

BUGFIX: Property Lookup Failures - Null Safety Improvements
  - Issue: Multiple property lookup failures when accessing variables that could be null or undefined
  - Problems Fixed:
    * $wareBasket.count error: Variable could be null when accessing .count property
    * $requestData.$FleetCoordination error: Property missing in minimal trade signals
    * $requestData.$MaxSell error: Property missing in minimal trade signals
    * $tradesBlacklisted error: Variable not initialized before use in debug text
    * $tradesRejectedCargo error: Variable not initialized before use in conditions
    * $validTradeFound error: Variable not initialized before existence check
    * $tradeList.count error: Variable accessed in debug text without null check (multiple locations)
    * Loop counter error: Loop executed with empty/null list causing counter stack issues
    * $validationDelayTime error: Variable could be null when converting to time value
    * $tradeIdx error: Loop counter accessed in debug text without null check
    * $buyStation/$sellStation errors: Stations accessed without null checks after extraction
    * Loop counter continue error: continue statement used when loop counter doesn't exist
  - Solutions:
    * Initialized all validation variables before do_if blocks to ensure they always exist
    * Added null checks before accessing .count properties
    * Used safe access operator (@) for optional properties in requestData
    * Wrapped loop execution in existence check to prevent counter stack errors
    * Added safe variable access patterns in all debug text expressions
    * Created safe variables for debug text to prevent property lookup failures
    * Added null checks for $validationDelay before converting to time value
    * Added null checks for $currentTrade before processing
    * Added null checks for station extraction ($buyStation, $sellStation)
    * Added safe access for loop counter ($tradeIdx) in all debug text
    * Added do_else blocks to skip invalid trades when stations can't be extracted
    * Wrapped continue statements in existence checks for loop counter
    * Removed $tradeIdx access from debug text in do_else blocks (where it might not exist)
  - Impact:
    * Eliminates all property lookup failures in trade validation and search systems
    * Handles edge cases: empty trade lists, minimal signals, uninitialized variables
    * Prevents crashes when trade list is null or empty
    * Safe handling of optional properties in signal data
    * More robust error handling throughout trade system
    * Prevents time conversion errors when validation delay is null
    * Prevents loop counter errors when accessing $tradeIdx
    * Prevents station access errors when trade data is invalid
    * Prevents loop counter stack errors when using continue statements
    * Comprehensive null safety throughout trade validation loop
  - Locations:
    * md/gt_trading_search.xml (wareBasket initialization and null checks, lines 2275-2292, 2349, 2394)
    * md/gt_trading_ai.xml (requestData safe access, lines 253-266, 243-244, 362-377)
    * aiscripts/order.trade.galaxytrader.xml (variable initialization and safe access, lines 1766-1778, 1791-1793, 1805-2277, 1812-1830, 1855-1864, 2240-2275, 2453-2459)

Version 0.5.14 - 2025-11-06
--------------------------

BUGFIX: Property Lookup Error for effectiveMaxBuy/effectiveMaxSell Variables
  - Issue: Property lookup errors occurred when accessing $effectiveMaxBuy and $effectiveMaxSell variables
  - Problem: 
    * Variables were only initialized in the <init> block and conditionally updated in the init label for subordinates
    * When code jumped to start_trading label (e.g., after maintenance or training), variables could be undefined
    * Non-subordinate ships or ships where commander lacked these properties would have uninitialized variables
    * Error: "Property lookup failed: $effectiveMaxBuy" and "$effectiveMaxSell" at line 1634/1643
  - Solution:
    * Added initialization checks in the init label to ensure variables are always initialized from order parameters
    * Added initialization checks at the start of start_trading label to catch cases where code jumps directly to trading
    * Variables are initialized from $maxbuy and $maxsell order parameters if they don't exist
    * Preserves any values set during re-inheritance while ensuring variables are always defined
    * Uses existence check (? operator) to only initialize if variable doesn't exist
  - Impact:
    * Eliminates property lookup errors when accessing effectiveMaxBuy/effectiveMaxSell
    * Variables are guaranteed to be initialized before use in trade search signals (GT_Find_Trade and GT_Find_Sell)
    * Works correctly for all ship types: independent ships, subordinates, and ships after maintenance/training
    * Handles all code paths that lead to start_trading label
  - Location: aiscripts/order.trade.galaxytrader.xml (init label, lines 848-855; start_trading label, lines 1530-1537)

BUGFIX: German Translation Format String Error
  - Issue: Invalid format specifier error in German maintenance messages
  - Problem:
    * German translation used `%1%` instead of `%1%%` for percentage display
    * X4 format strings require `%%` to display a literal `%` sign
    * Error: "Invalid format specifier '% ' found in format string" when displaying hull integrity percentages
    * Affected maintenance logbook messages (translation IDs 3205 and 3206)
  - Solution:
    * Fixed format strings in German translation file: changed `%1%` to `%1%%` and `%2%` to `%2%%`
    * Now matches the correct format used in other language files (English, etc.)
  - Impact:
    * German maintenance messages now correctly display percentages (e.g., "80%" instead of causing parse errors)
    * Eliminates format string errors in German logbook entries
  - Location: t/0001-L049.xml (translation IDs 3205, 3206)

IMPROVEMENT: Increased CPU Batch Processing Delay
  - Increased batch processing delay from 5ms to 10ms for better CPU performance
  - Reduces CPU load during trade search operations by giving more time between batches
  - Improves game responsiveness during intensive trade matching operations
  - Location: md/gt_trading_batch_processor.xml (line 14), md/gt_trading_search.xml (line 2977)

IMPROVEMENT: More Shipnaming Options


Version 0.5.13 - 2025-11-06
--------------------------

FEATURE: Global Debug Logging Toggle
  - Added new debug logging setting in Global Settings menu under "Maintenance & Diagnostics"
  - Master toggle to enable/disable all debug_text output throughout the mod
  - When disabled (default), verbose debug messages are suppressed for cleaner logs
  - When enabled, debug messages appear based on their individual chance values and conditions
  - Provides centralized control over debug output without modifying game files
  - Location: md/gt_global_settings.xml (UI integration and setting initialization)


BUGFIX: Training Station Selection Now Validates Docking Permissions
  - Issue: Training system selected stations without checking if ship could actually dock
  - Problem: Ships could be sent to training stations where docking would fail due to:
    * Incompatible dock sizes (e.g., M-class ship at station with only L+ docks)
    * Trade restrictions or docking policy
    * Relation/reputation issues
    * War status or permissions
  - Solution:
    * Added dockingallowed.{$ship} validation for all training station types (shipyards, trading posts, equipment docks)
    * Follows same validation pattern as maintenance system for consistency
    * Capital ships skip docking check for non-station objects (use resupply ships)
    * Only stations where ship can actually dock are added to candidate list
  - Impact:
    * Prevents ships from traveling to incompatible training stations
    * Reduces failed docking attempts and wasted travel time
    * Ensures training orders only select stations where docking will succeed
    * Matches maintenance system's validation approach for consistency
  - Location: md/gt_xp_training.xml (SearchTrainingFacilities cue, lines 1559-1614)


BUGFIX: Subordinate Ships Now Inherit Commander's Max Jump Distance (Capped at Pilot Capability)
  - Issue: Subordinate ships were not inheriting commander's max jump distance settings
  - Problem: AI script parameters used only pilot's skill, ignoring commander's configured maxbuy/maxsell values
    * Example: Commander set to max jump = 1, subordinate Level 6 pilot would get 5 jumps (its capability) instead of 1
    * Subordinates should follow commander's strategic limits when within their capability
  - Solution:
    * Subordinates now inherit commander's maxbuy/maxsell settings
    * Inherited values are capped at subordinate's pilot capability: min(commander's max, pilot's capability)
    * Each ship respects both commander's strategic limits AND its own pilot's skill limitations
  - Behavior Examples:
    * Commander max jump = 1, Subordinate Level 6 (capability: 5) → Uses 1 jump (commander's limit)
    * Commander max jump = 15, Subordinate Level 6 (capability: 5) → Uses 5 jumps (capped at pilot capability)
    * Commander max jump = 10, Subordinate Level 12 (capability: 15) → Uses 10 jumps (commander's limit)
  - Impact:
    * Fleet commanders can now control subordinate trading ranges strategically
    * Subordinates automatically respect commander's distance limits when within their capability
    * Subordinates cannot exceed their own pilot's skill limitations regardless of commander settings
    * Commander skill still affects feature gates (threat intel, fleet coordination) but not jump distance
  - Location: aiscripts/order.trade.galaxytrader.xml (subordinate settings inheritance, lines 319-358, 498-533)

BUGFIX: Subordinate Ships Always Inherit Commander's Home Sector
  - Issue: Subordinate ships only inherited commander's home sector if their own home was not set or was default
  - Problem: Subordinates with explicitly set home sectors would not inherit commander's home, breaking fleet coordination
  - Solution:
    * Subordinates now ALWAYS inherit commander's home sector (removed conditional check)
    * Home sector inheritance is now consistent with other inherited settings
    * Ensures all subordinates in a fleet operate from the same home base
  - Impact:
    * Fleet subordinates always share commander's home sector
    * Improved fleet coordination - all ships in fleet operate from same base
    * Consistent behavior with other inherited settings
  - Location: aiscripts/order.trade.galaxytrader.xml (home sector inheritance, line 228-236)

BUGFIX: Global Settings Menu Translation Support
  - Issue: Several settings in the global settings menu were hardcoded in English and not translated
  - Problem: Settings like "Sell Offer Price Max", "Buy Offer Price Min", "Cache Dropoff Tolerance", "Block Enemy Faction Sectors", "Blacklist Threat Level", "Recreate Blacklist", and "Prefix"/"Suffix" buttons were not using translation IDs
  - Solution:
    * Added translation IDs for all missing settings (9004-9008, 9024, 9054-9057, 9076-9077)
    * Added tooltip translation IDs (9104-9107, 9124, 9154-9156)
    * Updated gt_global_settings.xml to use translation IDs instead of hardcoded strings
    * Added translations to all language files: English, Portuguese, French, German, Spanish, Italian, Russian, Polish

IMPROVEMENT: Enhanced Trade Scoring System - Reduced Profit Dominance and Increased Distance Penalties
  - Issue: Very high-profit trades were dominating trade selection even with 100% distance penalty, ignoring distance efficiency
  - Problem: 
    * Linear profit scaling meant 2x profit = 2x score, allowing extremely profitable trades to overcome distance penalties
    * Ship→buy distance penalty was not strong enough to discourage long initial travel distances
    * Example: Trade with 260,090 Cr profit and 7 jumps ship→buy was still selected despite 100% distance penalty
  - Solution:
    * **Non-Linear Profit Scaling**: Applied diminishing returns formula to reduce profit dominance
      - Formula: profit_scaled = profit / (1.0 + profit / 1,000,000)
      - Effect: Higher profits get scaled down more (260K Cr profit → 96% reduction)
      - Result: 2x profit now increases score by ~1.33x instead of 2x
    * **Increased Ship→Buy Distance Penalty**: Strengthened penalty for initial travel distance
      - Weight increased from 3.0 to 4.0 (33% increase)
      - Quadratic base reduced from 4.0 to 3.5 (steeper penalty curve)
      - Example: 7 jumps ship→buy now penalized at 280 units (with 100% multiplier) vs previous 170 units
    * **Multi-Factor Distance Penalties**: System already penalizes three factors separately:
      - Ship→Buy distance (heavy weight: 4.0) - ship must travel to buy station first
      - Buy→Sell distance (moderate weight: 1.5) - trade route length
      - Home distance (light weight: 0.5) - territorial control
  - Impact:
    * Distance penalties now have significantly more influence on trade selection
    * Very high-profit trades no longer automatically dominate - distance efficiency matters more
    * Ships prefer closer trades even when slightly less profitable
    * User's distance penalty setting (0-100%) is properly applied to all penalty factors
    * Better balance between profit and distance efficiency in trade selection
  - Examples:
    * Trade with 260,090 Cr profit, 7 jumps ship→buy: Score reduced from 1346 to ~400-500 (estimated)
    * Trade with 130,045 Cr profit, 3 jumps ship→buy: Now competitive with high-profit distant trades
    * Distance penalty multiplier (100% = 2.0x) correctly applied to all three penalty factors
  - Location: md/gt_trade_utilities.xml (GT_CalculateTradeEfficiency library)

FEATURE: Comprehensive Ship State Tracking and Name Restoration System
  - Implemented event-driven state tracking system for all GT-controlled ships
  - Problem: Ships with GT orders were not properly tracked, leading to:
    * Ships losing GT orders but keeping GT-prefixed names
    * State inconsistencies when orders were manually removed
    * Subordinate ships not properly detecting commander changes
    * No reliable way to detect when ships stopped being GT-controlled
  - Solution:
    * **State Manager (md/gt_ship_state_manager.xml)**:
      - Centralized state tracking for all GT-controlled ships
      - Tracks: HasGTOrder, OperationalState, SubordinateState, Commander, CommanderHasGT, ActiveTradeOrders
      - Stores original ship names for restoration when GT orders are removed
      - Event-driven updates via signals (no constant polling)
    * **Event-Driven Detection**:
      - Interrupt handler in GT AI script detects order cancellation immediately
      - on_abort handler catches order termination scenarios
      - HandleAIStarted cue detects state changes when AI scripts restart
      - Patches to order.wait.xml and order.assist.xml detect GT order removal
      - Delayed verification (5s) for Assist order scenarios catches stale subordinate states
    * **Name Restoration**:
      - Ships automatically restore original names when GT orders are removed
      - Handles both direct GT ships and subordinates
      - Checks if ship is still subordinate to GT commander before restoring name
      - Works for manual order removal, commander changes, and order cancellation
    * **Subordinate State Tracking**:
      - Tracks subordinate relationships and commander GT status
      - Detects when subordinates are removed from GT commanders
      - Handles Assist order inheritance (subordinates inherit commander's orders)
      - Fixes stale subordinate states when commander is removed
    * **State Utilities Library (md/gt_ship_state_utilities.xml)**:
      - Centralized functions for common state operations
      - GT_CheckCommanderStatus: Checks if ship has commander with GT order
      - GT_RestoreShipName: Handles name restoration logic
      - GT_GetShipState: Retrieves ship state from registry
      - GT_IsSubordinateOfGTCommander: Checks subordinate status
  - Technical Details:
    * Removed periodic polling (VerifyGTOrders cue) - relies entirely on event-driven detection
    * Delayed verification runs every 5s but only processes ships with scheduled checks
    * State updates are immediate via signals, no polling delays
    * Handles edge cases: order replacement, script termination, commander removal
  - Impact:
    * Ships always restore original names when GT orders are removed
    * State tracking is accurate and immediate (event-driven)
    * No performance overhead from constant polling
    * Reliable detection of all GT order removal scenarios
    * Proper handling of subordinate relationships and commander changes
  - Location: 
    * md/gt_ship_state_manager.xml (state manager)
    * md/gt_ship_state_utilities.xml (utility library)
    * aiscripts/order.trade.galaxytrader.xml (detection handlers)
    * aiscripts/order.wait.xml (diff patch for Hold Position detection)
    * aiscripts/order.assist.xml (diff patch for subordinate removal detection)


Version 0.5.12 - 2025-11-05
--------------------------

IMPROVEMENT: Cargo Type Compatibility Filtering in Trade Search
  - Added cargo type validation to trade search/cache retrieval to prevent assigning incompatible trades
  - Problem: Ships were being assigned trades for wares they cannot carry (e.g., Methane requires gas containment, Feststoffe require solid cargo bays)
  - Solution:
    * Added cargo type check in SearchCachedTrades - filters incompatible wares early during cache retrieval
    * Added cargo type check in GT_FilterTradeForShip - filters incompatible wares during live search filtering
    * Uses ship.cargo.{$ware}.max gt 0 to verify ship has cargo bay capacity for specific ware type
    * Trades for incompatible cargo types are filtered out before scoring/selection
  - Impact:
    * Ships no longer receive trades for wares they cannot carry
    * Prevents wasted trade searches and execution attempts
    * Reduces "not enough cargo space" errors caused by incompatible cargo types
    * More efficient trade selection - only considers wares ship can actually transport
  - Location: md/gt_trading_search.xml (SearchCachedTrades), md/gt_trade_utilities.xml (GT_FilterTradeForShip)

IMPROVEMENT: "Same Path" Routing Bonus for Trade Scoring
  - Added intelligent routing bonus that favors trades where stations are "in order" relative to home and ship position
  - Problem: Previous scoring didn't distinguish between efficient routes (moving toward home) and inefficient routes (backtracking)
  - Example: Home=E, Ship=B, maxDistance=3
    * Buy=C, Sell=E: Ship goes B→C→E (toward home) - Efficient, gets 10% bonus 
    * Buy=E, Sell=C: Ship goes B→E (toward home), then E→C (backtrack) - Less efficient, no bonus 
  - Implementation:
    * Calculates distances: home→buy, home→sell, ship→buy, ship→sell
    * Detects if stations are "in order" (one further from home than the other)
    * Checks if ship position allows efficient routing without backtracking
    * Applies 10% efficiency boost for same-path trades (5% for same-sector trades)
  - Logic:
    * Case 1: Buy further from home than sell → Efficient if ship closer to buy than sell
    * Case 2: Sell further from home than buy → Efficient if ship closer to sell than buy
    * Case 3: Both stations same distance from home → Already efficient (5% bonus)
  - Impact:
    * Ships prefer trades that move them toward home (or at least don't backtrack)
    * More efficient routing reduces unnecessary travel time
    * Better trade selection based on actual routing efficiency, not just distance
  - Location: md/gt_trade_utilities.xml (GT_CalculateTradeEfficiency), md/gt_trading_search.xml (cache retrieval)

IMPROVEMENT: Distance Calculation and Penalty Optimization
  - Issue: Trade validation was incorrectly comparing travel distance (ship → buy → sell) to home-based range limit (maxDistance)
  - Problem: System rejected valid trades that were within operational range but required longer travel paths
  - Example: Ship in sector B, home in sector E, maxDistance=3. Buy station in H (3 jumps from home), sell station in B (3 jumps from home).
    Trade was valid (both stations within 3 jumps of home) but rejected because travel distance (6 jumps) exceeded maxDistance
  - Solution:
    * Fixed distance validation to use home-based distance for range checking (both stations must be within maxDistance from home)
    * Removed redundant travel distance constraint check that incorrectly filtered valid trades
    * Distance validation now correctly checks: max(home→buy, home→sell) ≤ maxDistance
    * Actual travel distance (ship→buy→sell) is still used for penalty scoring, not validation
    * Trade Distance field now stores actual travel distance for accurate penalty calculation
  - Impact:
    * Ships can now accept trades where stations are within operational range, regardless of ship's current position
    * Trade efficiency scoring correctly penalizes longer travel distances
    * More trades available for ships, improving trading opportunities
  - Location: md/gt_trading_search.xml (SearchCachedTrades, trade validation and Distance field)

FEATURE: Pilot Data Preservation System - Pilots Never Lose XP/Skills
  - CRITICAL IMPROVEMENT: Pilots are now preserved when orders are cancelled instead of being removed from registry
  - Implementation:
    * When a ship's GT order is cancelled, pilot is marked as 'paused' instead of being deleted
    * All pilot data preserved: XP, Level, TotalTrades, TotalProfit, TrainingCompleted, etc.
    * Pilot can be reactivated later with all progress intact
  - Reactivation System:
    * When GT order is assigned again, system detects if pilot was previously paused
    * Pilot is reactivated with all preserved data (XP, skills, trades, profit)
    * Management skill level is restored based on preserved XP
    * Ship name is updated to reflect pilot's current level/rank
  - Ship Swap Detection:
    * System now stores ShipID (e.g., "ZUB-916") in pilot registry for reliable swap detection
    * Detects when pilot is transferred from one ship to another
    * Updates original ship name when pilot changes ships
  - Ship Association Tracking:
    * Pilot registry stores both ship object and ShipID for redundancy
    * ShipID comparison is more reliable than object comparison (objects can become invalid)
    * Enables accurate detection of ship swaps even after save/load cycles
  - Benefits:
    * Pilots retain all XP and progress even when orders are temporarily cancelled
    * No data loss when swapping pilots between ships
    * Seamless reactivation preserves player investment in pilot training
    * Players can pause/resume GT operations without losing pilot progress
  - Location: md/gt_core_system.xml (HandleShipOrderAborted), md/gt_ship_management.xml (Register_Pilot, Initialize_Pilot_Data)

FEATURE: Roleplay Logbook Messages - Pilot Communication System
  - Added immersive logbook messages for pilot lifecycle events
  - New Pilot Registration:
    * Message: "It is an honor to work for you, [Player]! I am excited to begin my trading career..."
    * Triggered when a completely new pilot is registered for the first time
  - Pilot Paused (Holiday):
    * Message: "Thank you for giving me this well-deserved holiday, [Player]! My trading skills remain intact..."
    * Triggered when pilot's order is cancelled (pilot goes on holiday)
    * Confirms pilot's skills are preserved for future reactivation
  - Pilot Reactivated (Back from Holiday):
    * Message: "I am back from holiday and ready to work again, [Player]! My trading skills remain sharp..."
    * Triggered when paused pilot is reactivated on the same ship
    * Expresses readiness to continue serving
  - Pilot Transfer:
    * Message: "Thank you for my transfer to [Ship Name], [Player]! I am honored by this new assignment..."
    * Triggered when paused pilot is reactivated on a different ship
    * Pilot acknowledges transfer and commits to taking care of new ship
  - Logbook Entry Details:
    * Category: "general"
    * Title: "New Pilot: [Name]", "Pilot Status: [Name]", "Pilot Return: [Name]", or "Pilot Transfer: [Name]"
    * Interaction: Clickable to show ship on map
    * All messages personalized with player name and ship/pilot names
  - Benefits:
    * Adds personality and immersion to pilot management
    * Provides clear feedback about pilot status changes
    * Confirms data preservation in roleplay-friendly way
  - Location: md/gt_core_system.xml (HandleShipOrderAborted, HandleShipModificationUpdate), md/gt_ship_management.xml (Register_Pilot)

IMPROVEMENT: Skill Level Restoration on Pilot Reactivation
  - Issue: When pilots were reactivated, their management skill level was not restored, showing as Level 1 despite having high XP
  - Root Cause: Skill restoration logic was missing XP parameter, defaulting to 0 and returning Level 1
  - Solution:
    * Fixed skill restoration to explicitly pass XP value when calculating level
    * Added skill restoration for both paused pilots (reactivated) and already-active pilots
    * Skill level is now calculated from preserved XP and restored to X4's management skill
    * Stored Level field is updated to match calculated level
  - Impact:
    * Pilots now maintain correct skill levels when reactivated
    * Ship names display correct level/rank based on actual XP
    * AI scripts use correct skill level for distance calculations
  - Location: md/gt_ship_management.xml (Initialize_Pilot_Data, Register_Pilot)

IMPROVEMENT: Cargo Type Compatibility Validation
  - Issue: Ships were assigned trades for wares they cannot carry (e.g., Methane requires gas cargo bay, Feststoffe require solid cargo bay)
  - Problem: Trade validation only checked total cargo space, not cargo bay type compatibility
  - Solution:
    * Added cargo bay type check before cargo space validation
    * Checks `ship.cargo.{$ware}.max gt 0` to verify ship can carry this ware type
    * Rejects trades for incompatible cargo types (gas, liquid, solid) before attempting execution
    * Uses ware-specific cargo space (`cargo.{$ware}.free`) instead of generic `cargo.free.all`
  - Impact:
    * Prevents "not enough cargo space" errors for incompatible cargo types
    * Ships automatically skip to next trade in list that they can actually carry
    * Eliminates failed trade attempts for wares requiring special containment
  - Location: aiscripts/order.trade.galaxytrader.xml (trade validation loop)

IMPROVEMENT: Enhanced Cargo Space Validation Before Trade Execution
  - Added real-time cargo space check during trade validation loop
  - Checks cargo space availability for specific ware type before creating trade orders
  - Prevents trade failures due to cargo gained between trade search and execution
  - If all trades rejected due to insufficient cargo, triggers cargo disposal system
  - Location: aiscripts/order.trade.galaxytrader.xml (trade validation loop)

BUGFIX: Subordinate Ship Name Preservation
  - Issue: Subordinate ships (using "Assist" order) were incorrectly losing their GT names when orders were cancelled
  - Root Cause: System treated "Assist" order as permanent removal instead of recognizing it as normal subordinate behavior
  - Solution:
    * Added subordinate detection in order abort handler
    * Subordinate ships with "Assist" order are now recognized as normal (not permanent removal)
    * Name is only restored if ship is actually removed from GT (not registered in GT_Ships)
  - Impact:
    * Subordinate ships maintain GT names correctly
    * Names only restored when ship is genuinely removed from GalaxyTrader
  - Location: aiscripts/order.trade.galaxytrader.xml (on_abort handler)

BUGFIX: Skill Level Not Restored After Order Cancellation
  - Issue: Ships showing Management Level 1 despite pilots having thousands of XP
  - Root Cause: Calculate_Skill_Level_From_XP was called without XP parameter, defaulting to 0
  - Solution: Explicitly pass XP value when calculating and restoring skill levels
  - Impact: Pilots maintain correct skill levels across order cancellations and reactivations
  - Location: md/gt_ship_management.xml (Initialize_Pilot_Data)

FEATURE: Configurable Price Ranges for Trade Offer Collection (Global Settings Menu)
  - Added configurable price range settings for trade offer collection to allow fine-tuning of trade search behavior
  - Price ranges control which offers are collected during trade search (before scoring and filtering)
  - Settings exposed in Global Settings Menu → Trading Price Ranges section:
    * Sell Offer Price Max: Maximum relative price for sell offers (ship buys FROM stations)
    * Buy Offer Price Min: Minimum relative price for buy offers (ship sells TO stations)
    * Isolated: Sell Price Max: Price range for isolated ships (stuck in single sector)
    * Isolated: Buy Price Min: Price range for isolated ships (stuck in single sector)
  - Configuration:
    * Settings stored in `global.$GT_Config.$Trading` (persistent across game sessions)
    * Range: -100% to +100% (relative to average price, converted to -1.0 to +1.0 internally)
    * Default values: Sell max = 0.5 (50% above average), Buy min = -0.5 (50% below average)
    * Settings are validated on load (range -1.0 to +1.0)
  - Implementation:
    * Price ranges loaded from config in `gt_trading_search.xml` before offer collection
    * Isolated ships use separate price ranges (can be adjusted independently)
    * Falls back to defaults if config missing
  - Benefits:
    * Players can adjust trade search behavior to prefer better prices (narrower range) or more options (wider range)
    * Different ranges for isolated ships allow fine-tuning when ships are stuck in single sectors
    * Supports diverse trade selection by including both best and worse offers for scoring system
  - Location: md/gt_configuration.xml (defaults), md/gt_global_settings.xml (menu), md/gt_trading_search.xml (usage)

CRITICAL FIX: Diff Patch Now Only Affects GT Ships (Vanilla Behavior Preserved)
  - Issue: The diff patch in `aiscripts/order.trade.perform.xml` was replacing vanilla's blacklist check for ALL ships, potentially interfering with vanilla ship behavior (e.g., scout ships with custom blacklists)
  - Problem: The replaced blacklist check included escape logic that could affect non-GT ships
  - Root Cause: Escape logic variable (`$allowEscapeTrade`) was used in replaced check, but only initialized for GT ships
  - Solution: Wrapped replaced blacklist checks with GT ship detection:
    * For GT ships: Apply escape logic (allow trades FROM blacklisted sectors)
    * For non-GT ships: Use exact vanilla behavior (no escape logic, standard blacklist checks)
  - Impact: Prevents any interference with vanilla ship behavior; scout ships and other non-GT ships now use exact vanilla blacklist behavior

OPTIMIZATION: Code Refactoring - Extracted Complex Structures into Reusable Libraries
  - Improved code maintainability and readability by extracting repeated/complex code patterns into library functions
  - Extracted to `gt_trade_utilities.xml`:
    * `GT_FilterTradeForShip` - Complex trade filtering logic (ware basket, illegal, blacklist, path availability checks)
    * `GT_SortTradesByScore` - Optimized trade sorting (selection sort for large lists, bubble sort for small)
  - Extracted to `gt_pathfinding_utilities.xml`:
    * `GT_CalculateTradePathDistances` - Path availability calculation with escape logic for blacklisted sectors
    * `GT_BuildStationDistanceCache` - Batch calculation of station distances for multiple offers
  - Benefits:
    * Reduced `gt_trading_search.xml` file size by ~300 lines
    * Improved code reusability and testability
    * Easier to maintain and debug complex logic
    * Consistent behavior across all trade filtering locations

OPTIMIZATION: Parallel Filtering with Cooperative Multitasking (Prevents Frame Stutter)
  - Issue: Filtering large trade lists (100+ trades) could cause frame stutter/freezing during trade search
  - Solution: Implemented batch processing with cooperative multitasking for trade filtering
  - Implementation:
    * Added `FilterTradeList_Batch` cue that processes trades in batches of 15 with 1ms delay between batches
    * Added `FilterTradeList_Resume` cue that continues processing after batch filtering completes
    * State persistence via `global.$GT_FilterState` table (survives across cue instances)
  - Performance Impact:
    * Large trade lists (150+ trades) are processed across multiple frames instead of blocking
    * Example: 150 trades = 10 batches × 1ms = 10ms total delay = smooth gameplay
    * Prevents frame stutter when filtering large trade lists
  - Benefits:
    * Smooth gameplay even with large trade lists
    * Game engine can process other tasks between batches
    * No performance degradation for small trade lists (< 15 trades)
  - Location: md/gt_trading_search.xml (FilterTradeList_Batch and FilterTradeList_Resume cues)

IMPROVEMENT: Non-Linear Distance Penalty (Quadratic Scaling)
  - Changed distance penalty calculation from linear to quadratic to increase penalty impact for longer distances
  - Formula Change:
    * Before (Linear): `adjustedDistance = distance × multiplier`
    * After (Quadratic): `adjustedDistance = distance × multiplier × (1 + (distance / 10)²)`
  - Impact Examples (with multiplier=2.0):
    * Distance 1 jump: Adjusted = 2.02 (minimal penalty)
    * Distance 5 jumps: Adjusted = 12.5 (25% extra penalty)
    * Distance 10 jumps: Adjusted = 40 (100% extra = 2x penalty)
    * Distance 20 jumps: Adjusted = 200 (400% extra = 5x penalty)
  - Benefits:
    * Ships with high distance penalty settings now strongly prefer nearby trades
    * Longer distances get exponentially more penalized, making local trading more attractive
    * More noticeable impact on trade selection when distance penalty is enabled
  - Location: md/gt_trade_utilities.xml (GT_CalculateTradeEfficiency library)

IMPROVEMENT: Refactored Isolation Detection Logic (Accurate Gate/Accelerator/Highway Enumeration)
  - Issue: Previous isolation detection used indirect methods (`find_sector_in_range` + distance filtering) that could miss sectors connected via accelerators or highway entry gates
  - Problem: Sectors connected via accelerators have `gatedistance = 0` (same as same-sector), making them difficult to detect accurately. Highway entry gates were completely missed.
  - Solution: Refactored to directly enumerate all connection types using X4's native actions
  - Implementation:
    * New utility function: `GT_CheckConnectedSectorsBlacklisted` in `gt_blacklist_utilities.xml`
    * Directly finds all gates: `<find_gate name="$gates" multiple="true" space="$sector"/>`
    * Directly finds all accelerators: `<find_gate accelerator="true" .../>`
    * Directly finds all highway entry gates: `<find_object class="class.highwayentrygate" .../>`
    * Gets connected sectors via `$gate.exit.sector`, `$accelerator.exit.sector`, and `$highwayEntry.destination.sector`
    * Bidirectional fallback search for accelerators and highway entries (checks both directions)
    * Deduplicates sectors (multiple gates/accelerators/highways can connect to same sector)
    * Checks blacklist status for each unique connected sector
  - Refactored Usage:
    * Replaced ~250 lines of complex isolation detection code in `gt_trading_batch_processor.xml`
    * Now uses simple call to `GT_CheckConnectedSectorsBlacklisted` utility (~40 lines)
  - Benefits:
    * **More accurate**: Enumerates all gates/accelerators/highways directly, not distance-based approximations
    * **More efficient**: No distance calculations or filtering needed
    * **Complete coverage**: Finds all connections regardless of distance (gates + accelerators + highway entry gates)
    * **Cleaner code**: Reduced from ~250 lines to ~40 lines
    * **Better isolation detection**: Correctly identifies when ship is isolated due to all connected sectors being blacklisted (including highway connections)
  - Location: md/gt_blacklist_utilities.xml (GT_CheckConnectedSectorsBlacklisted library), md/gt_trading_batch_processor.xml (refactored isolation detection)


Version 0.5.11 - 2025-11-02
--------------------------

FIX: Ship Not Renamed When Resupply Order Created
  - Issue: Ships with resupply orders were not renamed to show [RESUPPLY] status
  - Root Cause: `$pilot` variable was not set before checking for ship rename in ExecuteMaintenance cue
  - Problem: Line 974 checked `@$pilot` but `$pilot` was never initialized from `$ship.pilot`
  - Solution: Added `<set_value name="$pilot" exact="$ship.pilot"/>` before rename trigger (matches pattern used at maintenance completion)
  - Impact: Ships now correctly display [RESUPPLY] or [MAINTENANCE] status in name when resupply/repair orders are active
  - Location: md/gt_maintenance.xml line 973 (ExecuteMaintenance cue)

FIX: Null Reference Errors in Cache Trade Statistics (SearchCachedTrades)
  - Issue: Property lookup failures when `$ware` variable was null in cache trade statistics tracking
  - Error: "Property lookup failed: $wareStats.$filtered" and "Failed to set null.$filtered to value 1"
  - Root Cause: The `?` operator only checks if variable EXISTS, not if it's non-null
    * When `$cacheEntry.$BuyOffer` was null, `@$cacheEntry.$BuyOffer.ware` returned null
    * `$ware?` still returned true (variable exists, even though null)
    * Using `$ware` as table key `$tradesByWareBeforeFiltering.{$ware}` caused errors
  - Solution: Updated all 20+ occurrences to check both existence AND non-null:
    * Changed `$ware?` to `$ware? and $ware != null` before using as table key
    * Applied to all statistics tracking points in SearchCachedTrades cue:
      - Initial ware statistics tracking (line 1168)
      - Filter conditions: invalidStructure, expired, offersNoLongerExist, offersNotAvailable (lines 1206-1251)
      - Filter conditions: stationNotOperational, failedSectorPair, outOfRange, unreachable (lines 1269-1429)
      - Filter conditions: illegal, wareBasket, distanceConstraint, profitConstraint (lines 1461-1533)
      - Fresh offer validation and tracking (lines 1607-1905)
  - Impact: Prevents null reference errors when cache entries have invalid or missing buy offer data

FIX: Station Reachability and Docking Validation for Repair and Resupply Orders (introduced in 0.5.10)
  - Issue: Repair and resupply orders could be created for stations that are unreachable or don't allow docking
  - Problems:
    * Stations unreachable due to blacklisted routes would cause failed orders
    * Stations with trade restrictions, relation issues, or docking policies would reject orders
    * Ships would enter repair/resupply loops when stations became unreachable
  - Solution: Added comprehensive validation checks at multiple stages:
    * REPAIR STATIONS:
      - Added blacklist-aware pathfinding check in FindNearestRepairStation library function (filters unreachable stations)
      - Added final reachability check using blacklist-aware pathfinding BEFORE creating order
      - Added docking check in FindNearestRepairStation library function (filters undockable stations early)
      - Added final docking check before creating repair order (safety validation)
      - Skips capital ships or uses station-specific logic (same pattern as resupply)
      - Station class restrictions: Wharfs for S/M ships, Shipyards for L/XL ships, Equipment Docks for all
    * RESUPPLY STATIONS:
      - Already had blacklist-aware pathfinding and docking check in search loop (no change needed)
      - Added final reachability check using blacklist-aware pathfinding BEFORE creating order
      - Added final docking check before creating resupply order (double-check for safety)
      - Station class restrictions: Wharfs for S/M ships, Shipyards for L/XL ships, Equipment Docks for all
  - Behavior: If station is unreachable (blacklist-aware distance < 0) OR doesn't allow docking, order is NOT created and ship continues trading
  - Logbook: Logbook messages written when station unreachable or not dockable (translation ID 3212 for repair, 3213 for resupply)
  - Impact: Prevents failed orders and repair/resupply loops caused by unreachable stations or docking permission issues
  - Pattern: Consistent with trading system which validates pathfinding and docking before trade execution

Version 0.5.10 - 2025-11-02
--------------------------

REFACTORING: Code Modularization - Utility Library Extraction
  - NEW STRUCTURE: Extracted 10 repeated code patterns into specialized utility libraries
  - Purpose: Eliminate code duplication, improve maintainability, reduce file sizes
  - Files created:
    * md/gt_blacklist_utilities.xml - Blacklist-related functions
      - GT_GetBlacklistGroup: Determines civilian/military blacklist group for ships
      - GT_IsSectorBlacklisted: Checks if sector is blacklisted for activity/travel
      - GT_IsStationBlacklisted: Checks if station is blacklisted for object activity
      - GT_CheckTradeBlacklist: Comprehensive trade blacklist validation
    * md/gt_pathfinding_utilities.xml - Pathfinding functions
      - GT_CalculatePathDistance: Calculates gate distance with blacklist-aware or escape mode support
    * md/gt_trade_utilities.xml - Trade calculation functions
      - GT_IsIntraSectorTrade: Detects if trade occurs entirely within one sector
      - GT_CalculateTradeEfficiency: Calculates efficiency score (profit/distance/faction priority)
      - GT_GetDistancePenaltyMultiplier: Converts AI parameter to distance penalty multiplier
      - GT_GetFactionPriorityText: Generates human-readable faction priority text
    * md/gt_logbook_utilities.xml - Logbook utility functions
      - GT_IsLogbookEnabled: Checks if logbook entries enabled for ship/commander
  - Files refactored (replaced duplicated code with library calls):
    * md/gt_trading_search.xml - 6+ occurrences of blacklist group determination, sector/station checks, path distance, efficiency calculations
    * md/gt_trading_execution.xml - Blacklist checks and path distance calculations
    * md/gt_trading_batch_processor.xml - Blacklist determination and sector checks
    * md/gt_maintenance.xml - Blacklist checks for repair/resupply stations
    * md/gt_trade_logging.xml - Logbook enabled checks
    * md/gt_utilities.xml - Updated internal library references to use full script paths
  - Implementation details:
    * All library functions use full script paths (md.ScriptName.FunctionName) for external calls
    * Internal calls within same script use short names for readability
    * Functions maintain backward compatibility with existing parameter signatures
    * Null-safe parameter handling (blacklistgroup auto-determination when null)
  - Benefits:
    * Reduced code duplication: ~500+ lines of repeated code eliminated
    * Easier maintenance: Bug fixes/improvements applied once in utility, benefits all callers
    * Improved readability: Main scripts focus on business logic, not implementation details
    * Better organization: Related functions grouped by domain (blacklist, pathfinding, trade, logbook)
  - Code reduction estimate: ~500 lines of duplicated code replaced with ~350 lines of reusable utilities
  - Migration: No breaking changes - all existing functionality preserved, only internal structure improved

FIX: Missing Translations in Global Settings Menu (Danke CadvanVLirigon !!!)
  - Fixed: Translation IDs 9220-9222 and 9321 were missing in non-English language files
  - Issue: Global Settings menu displayed "=ReadText77000-9220=" instead of translated text
  - Missing translations:
    * 9220: "Maintenance & Diagnostics" section header
    * 9221: "Reset Profit Statistics:" label
    * 9222: "RESET" button text
    * 9321: Tooltip explaining profit statistics reset functionality
  - Solution: Added translations to all language files:
    * t/0001-L001.xml (Chinese) - English translations added
    * t/0001-L033.xml (French) - "Maintenance et Diagnostics", etc.
    * t/0001-L034.xml (Spanish) - "Mantenimiento y Diagnósticos", etc.
    * t/0001-L039.xml (Italian) - "Manutenzione e Diagnostica", etc.
    * t/0001-L049.xml (German) - "Wartung und Diagnose", etc.
    * t/0001-L055.xml (Portuguese) - "Manutenção e Diagnósticos", etc.
    * t/0001-L007.xml (Russian) - "Обслуживание и Диагностика", etc.
  - Result: Global Settings menu now displays correctly in all 8 supported languages
  - Note: English (L044) already had translations, only other languages were missing

IMPROVEMENT: Repair Station Search - Check All Types Regardless of Ship Class
  - Issue: Repair station search was restricted by ship class (S/M ships only searched wharfs, L/XL only shipyards)
  - Problem: All three station types (wharfs, shipyards, equipment docks) can support all ship classes if configured properly
  - Solution: Now searches ALL three station types for ALL ships, filters by docking permission instead
    * Wharfs (Raumdock): Always searched regardless of ship class
    * Shipyards (Schiffswerft): Always searched regardless of ship class
    * Equipment Docks (Ausrüstungsdock): Always searched regardless of ship class
  - Behavior: First station that allows docking AND passes validation checks (blacklist, pathfinding, distance) is used
  - Benefits:
    * Ships can use any available repair station that allows docking (maximum flexibility)
    * Better coverage - no missed opportunities due to ship class restrictions
    * Consistent with resupply system which already searches all three types
  - Impact: Ships can now repair at any compatible station, not just those matching traditional ship class expectations

Version 0.5.9 - 2025-10-28
--------------------------

MOD DEPENDENCY CHANGE: kuerteeUIExtensionsAndHUD added

NEW FEATURE: Ship Escape from Blacklisted Sectors
  - NEW BEHAVIOR: Ships trapped in blacklisted sectors can now automatically escape via trade routes
  - Mechanism: Ships in blacklisted sectors can execute trades that lead to safe sectors
  - Escape logic: Ships must buy from a different (non-blacklisted) sector to initiate escape
    * Prevents buying in blacklisted sectors (forces escape route)
    * Allows selling in current blacklisted sector if ship already there (escape FROM)
  - Pathfinding: Uses non-blacklist-aware gatedistance for escape routes to find ANY path
    * Allows escape even if all paths go through blacklisted sectors
    * Applies to buy path when ship escaping from blacklisted sector
    * Applies to sell path when ship escaping from blacklisted sector
  - Cooldown bypass: Escape searches bypass live search cooldown (critical for escaping)
    * Ships in blacklisted sectors can search immediately, even after failed searches
    * Prevents ships from being trapped by cooldown when escape is needed
  - Logbook notification: Escape routes trigger informative logbook messages (translated)
  - Impact: Ships no longer permanently stuck in blacklisted sectors, autonomous escape capability

NEW FEATURE: Isolated Intra-Sector Trading Mode
  - NEW BEHAVIOR: Ships in non-blacklisted sectors with all routes blocked by blacklisted hub sectors automatically switch to intra-sector trading
  - Detection: System detects when ship cannot reach ANY other sector via gates (isolation check)
    * Tests up to 10 unique sectors from trade offers for reachability
    * Only counts sectors requiring gate jumps (distance > 0) for isolation determination
    * Distance 0 sectors (same zone via accelerators) checked for blacklist status
    * Ship is isolated if ALL sectors requiring gates are unreachable OR no gate-requiring sectors found
  - Intelligent profit threshold reduction: Isolated ships get reduced profit requirements
    * Normal intra-sector threshold: 50% of standard threshold
    * Isolated intra-sector threshold: 25% of standard threshold (further reduced)
    * Allows ships to find trades when normal threshold would reject everything
  - Guaranteed intra-sector offer inclusion: Intra-sector offers always included in matching
    * Bypasses normal top-20 offer limit for intra-sector offers (performance optimization)
    * Ensures ships can find trades within their isolated sector even if offers ranked low by price
    - Prioritized matching: Intra-sector sell offers matched with intra-sector buy offers first
    - True intra-sector trades: Only matches buy and sell from same sector (distance = 0)
  - Logbook notification: Isolation triggers informative logbook message (translation ID 3211)
    * Informs player that ship is isolated and forced to intra-sector trades only
    * Message logged to debug log for troubleshooting
    * Only logged once per ship (persistent global flag prevents spam)
  - Implementation files:
    * md/gt_trading_batch_processor.xml (isolation detection, offer inclusion, matching prioritization)
    * md/gt_trading_search.xml (intra-sector trade tracking, enhanced logging)
    * t/0001-L*.xml (translations for isolation message in all 8 languages)
  - User scenario: Ship in non-blacklisted sector → all routes blocked by blacklisted hub → detected as isolated → reduced thresholds → finds intra-sector trade → logbook notification
  - Impact: Ships no longer stuck when isolated by blacklisted hub sectors, can continue trading within sector

BUGFIX: Fleet Coordination - Ship Statistics Not Initialized
  - Fixed: Property lookup failed on $TotalProfit and $TradesCompleted (line 66, 73-74)
  - Issue: Ships registered before these fields existed don't have them in their table
  - Solution: Add initialization checks before updating (like pilot statistics already had)
  - Pattern: Check if field exists with ?, initialize to 0 if missing, then update
  - Result: Backwards compatible with ships registered by older mod versions
  - Files: gt_fleet_coordination.xml

CHANGE: Removed Skill Level Requirement for Trade Cache
  - Removed: Level 12+ requirement for writing to trade cache
  - Reason: Trade cache is a technical optimization feature, not a roleplay progression mechanic
  - Impact: All pilots (Level 1-15) can now contribute to and benefit from trade cache
  - Performance: Better cache population rate, especially with large fleets of new pilots

ENHANCEMENT: Relative Percentage-Based Cache Dropoff Validation
  - NEW FEATURE: Added configurable "Cache Dropoff Tolerance" slider in Mod Menu (Fleet section)
  - Location: gt_global_settings.xml (UI slider), gt_trading_search.xml:707-723 (validation logic)
  - Previous behavior: Cache used ABSOLUTE ROI threshold (20% default) for validation
  - New behavior: Cache validates using RELATIVE percentage drop from cached ROI
  - Example: 
    * Cached trade: 20% ROI
    * Dropoff tolerance: 15% (default)
    * Fresh ROI: 17% → Drop = 15% →  ACCEPTED (within tolerance)
    * Fresh ROI: 16% → Drop = 20% →  REJECTED (exceeds tolerance)
  - Formula: $roiDrop = (($cachedROI - $freshROI) * 100) / $cachedROI
  - Range: 0-50% (slider configurable, default: 15%)
  - Impact: More intelligent cache invalidation based on relative profit decline
  - Benefit: Prevents rejecting still-profitable trades due to minor market fluctuations

BUGFIX: Trade Search Distance Mismatch (Basic vs Blacklist-Aware Pathfinding)
  - ISSUE: Native trade queries used basic distance, but distance checks used blacklist-aware distance
  - Location: gt_trading_search.xml:887-944 (SearchLiveTrades native queries)
  - Problem: match_gate_distance uses BASIC pathfinding (shortest path, ignores sectortravel blacklists)
  - Manual distance checks use BLACKLIST-AWARE pathfinding (respects threatened sectors in path)
  - Symptom: "Distance too far" rejections even when offers within max distance (e.g., KYL-239: 4 rejected at 1 jump limit)
  - Root cause: Native query returned offers 1 jump away via basic pathfinding, but actual blacklist-aware path was 2-3 jumps (detour around threats)
  - Solution: Removed match_gate_distance, use vanilla's approach (only objectactivity in native query)
  - Filtering strategy (vanilla pattern):
    * Native C++ query: Fast objectactivity blacklist filter (station blacklists only)
    * Manual MD pre-filter 1: Sector blacklists (sectoractivity, sectortravel) - lines 984-1055
    * Manual MD pre-filter 2: Blacklist-aware distance validation - lines 1104-1161
  - New flow: Native query (objectactivity only) → Sector blacklist pre-filter → Distance pre-filter → Matching
  - Impact: Zero "distance too far" rejections, consistent pathfinding, no game stutter
  - Performance: Vanilla-level C++ performance, minimal MD overhead for thorough validation

BUGFIX: Sell Search Missing Blacklist-Aware Path Validation
  - ISSUE: Ships with cargo tried to reach stations through blacklisted sectors
  - Location: gt_trading_search.xml:1809-1848 (SearchSellOpportunities)
  - Problem: Code checked if destination station/sector is blacklisted, but NOT if path goes through blacklisted sectors
  - Symptom: "unable to reach destination" errors when selling cargo
  - Root cause: find_buy_offer used basic match_gate_distance (ignores blacklists), only validated destination, not path

OPTIMIZATION: Threat Detection Overhaul
  - NEW APPROACH: Two-check comparison leveraging X4's built-in blacklist pathfinding
    * Calculate normal gatedistance (shortest path without blacklist)
    * Calculate blacklist-aware gatedistance (avoiding threatened sectors)
    * Compare: if blacklist > normal OR blacklist == -1, preferred route goes through threat
  - Impact: Threat detection NOW WORKS - ships will detect and avoid routes through threatened sectors

PERFORMANCE: Trade Search Optimization Suite (15-20× faster searches)
  - Implemented comprehensive 5-part optimization targeting all major bottlenecks
  - Combined impact: Search time reduced from 5-10s to 0.3-0.5s (15-20× speedup)
  - Operation count: 16.8M → 1.75M operations per search (89.6% reduction)
  - Fleet scaling: Now linear instead of quadratic (10 ships: 15× faster, 50 ships: 75× faster)
  
  OPTIMIZATION 1: Removed Redundant Blacklist Safety Net (-4.8M property lookups)
    - Eliminated: Inner loop blacklist checks (12 property lookups × 100K combinations)
    - Before: Safety net checked 1.3M combinations to catch ~0.01% edge cases
    - After: Pre-filtering (lines 1261-1308) removes blacklisted offers before matching
    - Safety: Final validation at execution (gt_trading_execution.xml) catches mid-search updates
    - Impact: 4.8M property lookups eliminated per search, 10× faster inner loop
    - Files: gt_trading_search.xml (removed lines 1596-1634), gt_trading_execution.xml (added lines 58-94)
  
  OPTIMIZATION 2: Reduced Per-Ware Offer Limit (100 → 50) (-75% combinations)
    - Changed: Top 100 → top 50 offers per ware (sorted by relativeprice)
    - Rationale: Best trades typically found in top 20-30 offers; 50 provides safety margin
    - Impact: 100×100=10K → 50×50=2.5K combinations per ware (75% reduction)
    - Quality: Minimal impact on trade quality (top trades still found in top 50)
    - Result: 400K → 100K total combinations across 40 wares (4× faster matching)
  
  OPTIMIZATION 3: Early Profit Rejection for Impossible Trades (-50% wasted calculations)
    - Added: Price check before expensive calculations (docking, cargo, distance, ROI)
    - Logic: If sellPrice ≤ buyPrice, trade is impossible (zero/negative profit)
    - Impact: Skip ~50% of combinations instantly (saves ~1.5M operations)
    - Benefit: No need to check docking, cargo, distances for impossible trades
    - Also removed duplicate price calculations (lines 1495-1496) since calculated earlier
  
  OPTIMIZATION 4: Final Blacklist Validation at Execution (catches edge cases gracefully)
    - Added: Single blacklist check before creating trade order (12 property lookups once)
    - Purpose: Catches rare edge case where station becomes blacklisted mid-search (~0.01%)
    - Response: Send GT_No_Trade_Found signal → ship restarts search with updated blacklist
    - Overhead: Minimal (12 lookups once per execution vs. 4.8M during search)
    - Safety: Pre-filtering catches 99.9%, execution validation catches remaining 0.01%
  
  OPTIMIZATION 5: Fleet Coordination Cache (-93% fleet overhead)
    - Before: Loop through ALL ships for EACH trade (N × M complexity)
    - Before cost: 10 ships × 100K trades × 3 checks = 3M operations
    - After: Build cache ONCE, lookup ONCE per trade (M + N complexity)
    - After cost: 10 ships (build cache) + 200K lookups = 200,010 operations
    - Cache format: "BuyStationID|SellStationID|WareID" = true (O(1) table lookup)
    - Impact: 93% reduction (3M → 200K operations), scales linearly with fleet size
    - Large fleet benefit: 50 ships: 15M → 200K operations (75× faster)
  
  Performance Breakdown:
    - Inner loop: 400K combos × 42 ops = 16.8M ops → 100K combos × 17.5 ops = 1.75M ops
    - Fleet coordination: 3M ops (10 ships) → 200K ops (93% reduction)
    - Search time: 5-10 seconds → 0.3-0.5 seconds (15-20× faster)
    - Cache hit rate: ~90% after warm-up (instant 0.01s results)
    - Quality maintained: Still finds top 20 best trades per search
  
  Additional Changes:
    - Added $BuyStation and $SellStation to trade structure (required for OPT 4 & 5)
    - Reduced detailed rejection logging from 5 to 2 trades (less verbose)
    - Removed $tradesRejectedBlacklist counter and debug output (safety net eliminated)
    - Cache validation reviewed: No per-ware limiting needed (small size, pre-validated)

CRITICAL FIX: Resupply Cooldown Race Condition Causing Duplicate Orders
  - Fixed: Ships created duplicate resupply orders immediately after completing resupply

CRITICAL FIX: Trade Search Cargo Capacity Calculation Broken
  - Fixed: ALL trades rejected for "insufficient profit" due to incorrect cargo capacity calculation

CRITICAL FIX: Global Offer Limiting Breaking Per-Ware Trade Matching
  - Fixed: Global offer limiting (top 250) eliminated ALL matching buy/sell offers for specific wares

FIX: Missing Maintenance Transition Flag in on_abort Handler
  - Fixed: Maintenance orders (repair/resupply) triggered on_abort handler without protection flag

CRITICAL FIX: Maintenance System Station Selection Failures
  - Fixed: Ships received "target unreachable" errors for repair/resupply orders
  - Fixed: Wrong property name $IsXL used instead of $IsCapital (returned null)
  - Fixed: Missing @ safe operator on $IsLarge/$IsCapital causing property lookup errors
  - Fixed: Wharfs completely excluded from equipment station search

FIX: Maintenance System Missing Threat Intelligence Integration
  - Fixed: Maintenance ignored threat system blacklists, sent ships to dangerous sectors

FIX: Profit Statistics Showing Revenue Instead of Actual Profit
  - Fixed: Statistics displayed REVENUE (sale price) instead of PROFIT (sale price - purchase cost)

FIX: Training Duration Type Error
  - Fixed: Training duration calculations converted time values to integers, causing "Attribute max=30 is not of type time" errors
  - Root cause: Arithmetic operations on time values (600s + 60s) resulted in integer type instead of time type
  - Solution: Added type checks after duration calculations to convert integers back to time type (* 1s)
  - Files: gt_xp_training.xml (lines 1018-1021, 1393-1396), order.dock.train.xml (lines 157-161)
  - Impact: Training system now works correctly without AI script errors

FIX: Accidentally deleted icon in Version 0.5.8 and added it back

NEW FEATURE PREVIEW: GalaxyTrader Fleet Info Menu (Phase 1 BETA - WIP)

FIX: Orphaned Pilot Cleanup Running Twice
  - Fixed: Cleanup system executed twice in succession every 5 minutes
  - Root cause: Double-signaling - TriggerCleanupOnLoad signaled both OrphanedPilotCleanup AND scheduler, but cleanup also signals scheduler at end
  - Result: Two scheduler instances created, both firing after 5 minutes
  - Solution: Removed redundant scheduler signal from TriggerCleanupOnLoad
  - Flow now: Load → Cleanup → Scheduler → (5min) → Cleanup → Scheduler → (repeat)
  - Files: md/gt_core_system.xml (lines 684-693)

Version 0.5.8 - 2025-10-26
--------------------------

NEW FEATURE: Master Toggle for Ship Renaming System
  - Added global setting to enable/disable entire ship renaming functionality
  - Setting: $GT_GlobalSettings.$ShipNaming.$Enabled (default: OFF)
  - UI button added in Ship Naming Configuration section of mod settings menu
  - When disabled: Ships keep their original vanilla names (e.g., "Mercury Vanguard")
  - When enabled: Full GT renaming applies (XP, Level, Rank, Status, Operational states)
  - Toggle affects ALL renaming elements:
    * Trader progression info (XP, Level, Rank)
    * Status indicators ([ADVANCE], [TRAINING])
    * Operational states ([REPAIR], [RESUPPLY], [MAINTENANCE], [REROUTE], [CLEARANCE])
  - Instant effect: When toggled ON, triggers UpdateAllShipNames to rename entire fleet
  - Fully localized: Button text and tooltip in all 8 languages
  - Translation IDs: 9075 (button label), 9175 (tooltip)
  - Files: gt_global_settings.xml, gt_xp_training.xml, all t/0001-L*.xml files (8 language files)

CRITICAL FIX: Ship Renaming Toggle Not Working (return statement in instantiated cue)
  - Fixed: Master toggle debug message appeared but ships were still renamed
  - Root cause: <return/> statement doesn't work in instantiated cues in X4 MD scripts
  - Solution: Wrapped all renaming logic in <do_else> block instead of using early return
  - Pattern change: <do_if disabled> debug only </do_if> <do_else> all logic </do_else>
  - Now correctly skips ALL renaming code when toggle is OFF
  - Files: gt_xp_training.xml (UpdateShipName cue, lines 705-979)

Version 0.5.7 - 2025-10-26
--------------------------

IMPROVEMENT: Consistent Ship Name Prefix System with User Configuration
  - Standardized all prefixes: ALL states now use brackets for consistency ([ADVANCE], [TRAINING])
  - Added operational state prefixes: [REPAIR], [RESUPPLY], [MAINTENANCE], [REROUTE], [CLEARANCE]
  - Brackets ensure ships with active states sort to top of fleet overview for easy identification
  - Added global settings: DisplayOperationalState, OperationalStatePosition (prefix/suffix)
  - Respects user's naming preferences for display and position of operational states
  - Example: "[ADVANCE] [REPAIR] Mercury Sentinel (Trader Lv.9 XP:2850)"
  - [MAINTENANCE] shown when both repair and resupply needed simultaneously
  - [REROUTE] shown when destination threatened/blacklisted, cleared when new destination found
  - [CLEARANCE] shown during emergency cargo disposal (cargo safety), cleared when cargo empty
  - Operational state changes trigger automatic ship renaming to update display
  - Fully localized: All operational state prefixes translated to 8 languages (English, German, French, Spanish, Italian, Portuguese, Russian, plus L001)
  - Translation IDs: 7003-7007 for operational states in all language files
  - Backwards compatible: Works with existing save games (defaults to enabled/prefix if settings don't exist)
  - Files: gt_xp_training.xml, gt_maintenance.xml, gt_trading_ai.xml, gt_global_settings.xml, order.trade.galaxytrader.xml, all t/0001-L*.xml files

IMPROVEMENT: Simplified Ship Name Building Using macro.name
  - Replaced complex Lua-based string stripping with native macro.name property
  - Removed 2 files completely (gt_string_utils.lua, gt_string_utils_loader.xml)
  - Removed ReceiveStrippedName cue from gt_ship_management.xml
  - Eliminated async event communication and 5ms delay
  - Benefits: 97% less code (250 lines → 7 lines), no timing issues, no Lua dependency
  - macro.name provides ship model with variant (e.g., "Mercury Sentinel", "Shuyaku Vanguard")
  - Always localized correctly by X4 engine, works across all languages
  - Files: gt_xp_training.xml (simplified), deleted 2 files, cleaned gt_ship_management.xml

CRITICAL FIX: Unreliable List Membership Checks Using indexof
  - Fixed: 20+ instances of unreliable indexof checks across entire codebase
    * Root cause: X4's $list.indexof.{$item}? is unreliable for object/value lists
    * Even when list empty or item absent, ? check can fail silently or give wrong results
    * Caused silent logic failures, duplicate queue entries, incorrect training validation
    * Affected: Queue deduplication, training validation, maintenance, utilities, coordination
  - Solution: Replace ALL list indexof checks with explicit do_all loops
    * Pattern: Set $found=false, loop through list, compare each item, break if found
    * 100% reliable, handles empty lists, objects, and values correctly
    * Early break optimization minimizes performance impact
  - Locations Fixed (20 total):
    * Queue Deduplication (4): gt_trading_ai.xml (2), gt_trading_queue.xml (1), gt_trading_maintenance.xml (1)
      - Ships no longer added to queue multiple times
      - Search queue deduplication now works correctly
      - Idle ship recovery no longer creates duplicates
    * Training System (10): gt_xp_training.xml (6), gt_configuration.xml (4)
      - RequiredLevels checks now reliable (lines 136, 321, 336, 536, 564)
      - TrainingCompleted checks now reliable (lines 140, 325, 341, 540, 569)
      - Configuration retroactive fix checks now reliable (lines 187, 191, 449, 453)
      - Pilots no longer incorrectly blocked/unblocked from trading
    * Maintenance (1): gt_maintenance.xml (line 972)
      - Excluded sectors check now reliable
      - Ships respect sector exclusion configuration correctly
    * Utilities (2): gt_utilities.xml (lines 309, 395)
      - Ware basket membership check now reliable
      - Sector path deduplication now reliable
    * Fleet Coordination (1): gt_fleet_coordination.xml (line 213)
      - Unique wares tracking now reliable
      - Fleet statistics accurate
    * Trading Signals (1): gt_trading_signals.xml (line 118)
      - Pathing failure reason detection now reliable
      - Trade failure categorization accurate
    * Market Intelligence (1): gt_market_intelligence.xml (line 435)
      - SpottedBy ship tracking now reliable
      - Competitor tracking accurate
  - IMPORTANT: String indexof UNCHANGED (still safe and correct)
    * Character lookups in strings work fine: $string.indexof.{'['}?
    * Only LIST membership checks were affected and fixed
    * Lines with string indexof: gt_xp_training.xml (770, 777, 778, 783, 881, 921)
  - Impact: Eliminates silent logic failures, improves reliability across all systems
  - Files: 10 MD files modified (gt_trading_ai.xml, gt_trading_queue.xml, gt_trading_maintenance.xml, gt_xp_training.xml, gt_configuration.xml, gt_maintenance.xml, gt_utilities.xml, gt_fleet_coordination.xml, gt_trading_signals.xml, gt_market_intelligence.xml)

CRITICAL FIX: Cargo Safety System Blocking Ship Operations
  - Fixed: Ships with multiple cargo types creating concurrent trade orders
    * Root cause: Cargo safety looped through ALL wares and tried to sell each simultaneously
    * Problem: Created multiple trade orders at once → first succeeds, others fail
    * Result: Ship stuck in loop trying to execute failed orders for remaining cargo
    * Example: Ship with Energy Cells + Food Rations created 2 orders at once
    * Solution: Sell ONE ware at a time (first ware in cargo list)
    * After trade completes, ship loops back and sells next ware sequentially
    * This prevents multiple concurrent orders and ensures clean cargo disposal
  - Solution: Cargo safety now accepts ANY offer, even losses (0 Cr minimum)
    * Ship MUST clear cargo before new trades, profitability irrelevant
    * Changed MinProfit from 500Cr to 0Cr in HandleAISellRequest
    * Added blacklist validation (station, sector activity, sector travel)
    * Added operational status checks (isoperational, isclosingdown with @ operator)
    * Added docking permission checks (dockingallowed)
    * Added final offer validity check before creating trade order
    * Sells wares one at a time sequentially to prevent concurrent order conflicts
    * Guarantees only valid, reachable, dockable offers result in trade orders
    * Accepts losses if necessary - better to dump cargo than stay stuck
  - Impact: Ships no longer get stuck with unsellable cargo, NO failed trade orders, NO infinite loops, NO concurrent order conflicts
  - Files: md/gt_trading_ai.xml (line 331), md/gt_trading_search.xml (lines 1835-1950)

CRITICAL FIX: Stale Maintenance Orders Persisting from Save Files
  - Fixed: Ships executing obsolete repair/resupply orders from previous sessions
    * Root cause: global.$GT_RepairOrders and global.$GT_ResupplyOrders persisted in save files
    * Maintenance check would correctly determine "no repair needed"
    * But AI script would still find old order data and execute it anyway
    * Result: Ships flying to irrelevant repair stations from old game sessions
  - Solution: Clear stale orders at start of every maintenance check
    * Added cleanup code at beginning of DoMaintenance (lines 67-75)
    * Ensures fresh decisions based on current ship state
    * Prevents stale data from old sessions affecting current gameplay
  - Impact: Ships no longer execute outdated maintenance orders after game load
  - Files: md/gt_maintenance.xml
  - User report: Ships stuck trying to reach old repair stations after save/load

FIX: Trade Search Reliability and Correctness
  - Fixed: Incorrect @ operator usage with gatedistance (5 locations)
    * gatedistance returns -1 for unreachable routes (not null)
    * Using @ masked semantic meaning and required extra null checks
    * Removed @ and simplified to direct -1 checks for clarity
    * Locations: Lines 437, 443, 888, 1302, 1309
  - Fixed: Stage 2 distance not blacklist-aware
    * Stage 2 computed distances through blacklisted sectors for scoring
    * Caused futile trade selection that would fail during execution
    * Changed to use station objects (blacklist-aware) instead of sectors
    * Buy distance: $ship.gatedistance.{$station} (was .{$sector})
    * Sell distance: $buyStation.gatedistance.{$sellStation} (was sector-to-sector)
  - Fixed: Sell-only path lacked blacklist pre-filtering
    * Live search filtered blacklisted stations, sell-only did not
    * Inconsistent behavior could select blacklisted buyers
    * Added same pre-filter logic to sell-only path for consistency
    * Checks: objectactivity, sectoractivity, sectortravel blacklists
  - Removed: Redundant GT_ValidateStation call in sell-only path
    * Function only checked operational status
    * find_buy_offer already filters operational stations
    * Removed redundant call for clarity and performance
  - Implemented: Faction Priority parameter now functional
    * Player Only (0): Boosts trades involving player-owned stations by 20%
    * Foreign First (1): Boosts trades with non-player stations by 20%
    * Equal Priority (2): No boost applied (default behavior)
    * Applied in both cached trade search and live trade search
  - Fixed: Money type conversion warnings in faction priority boost
    * Root cause: Attempting to convert money to pure number and multiply by float
    * Original approach: $efficiency / 1Cr * 0.2 (failed - division doesn't remove money type)
    * Solution: Calculate boost as division instead of multiplication
    * Changed: $boost = $efficiency / 5 (20% = 1/5), then $efficiency + $boost
    * Eliminates "Loss of data while converting floating point to money value" warnings
    * Works because division and addition preserve money type naturally
  - Impact: More reliable trade selection, fewer futile attempts, clearer code, configurable faction preference, no type warnings
  - Files: md/gt_trading_search.xml

FEATURE: Language-Independent Ship Name Stripping
  - Improved: Ship name stripping now works with ALL languages
  - Problem: Strip_GT_Name_Formatting only recognized English prefixes
    * Only stripped: "ADVANCE ", "[TRAINING] " (hardcoded English)
    * Failed on: "FORTSCHRITT", "[AUSBILDUNG]", "AVANCER", "AWANS", etc.
    * Result: Duplicate prefixes in non-English locales ("ADVANCE FORTSCHRITT...")
  - Solution: Pattern-based detection instead of hardcoded strings
    * Step 0: BACKWARD COMPATIBILITY - Explicitly strips old English "ADVANCE ", "[TRAINING] "
      (Ensures migration from pre-0.5.7 saves works correctly when language changes)
    * Step 1: Detects ANY bracketed prefix: [ANYTHING] pattern
    * Step 2: Detects ANY ALL-CAPS word prefix: Pattern-based comparison (language-independent)
    * Step 3: Suffix handling - skipped due to X4 string API limitations
      - X4 only supports substring.{position} (from position to end)
      - No substring.{start, end} or substring.{pos, length} available
      - Cannot truncate strings at arbitrary positions
      - Duplicate detection prevents adding new suffixes anyway
    * Works with all character sets: Latin, Cyrillic, Chinese, etc.
    * Prevents duplicates: Pattern-based detection catches existing formatting
  - Migration Example (German player with old English save):
    * Old save: "ADVANCE Merkur (Lv.5)" (English prefix from v0.5.6)
    * Step 0: Strip "ADVANCE " → "Merkur (Lv.5)"
    * Note: Suffix remains due to X4 API limits (cannot truncate at arbitrary position)
    * New name: "FORTSCHRITT Merkur (Lv.5)" (German prefix from v0.5.7)
    * Result: Clean migration without "FORTSCHRITT ADVANCE" duplication
    * Suffix is updated dynamically each rename, so old suffix will be replaced eventually
  - Benefits:
    * Fully multilingual - no hardcoded language strings
    * No maintenance needed for new languages
    * Automatic support for all X4 languages
    * Prevents duplicate prefixes in all locales
    * Seamless migration from pre-0.5.7 saves
  - Files: md/gt_ship_management.xml (Strip_GT_Name_Formatting library, lines 49-117)
           md/gt_xp_training.xml (duplicate prevention logic, lines 730-761)

FIX: Missing Order Menu Translations
  - Fixed: Order parameter names were hardcoded in English
  - Problem: Parameters displayed in English regardless of game language
    * Affected: Allow Illegal Wares, Logbook Entries, Risk Tolerance, etc.
    * 11 parameters total with hardcoded English text
  - Solution: Added proper translation references
    * Added translation IDs 1011-1019, 1050-1051 to all language files
    * Updated order.trade.galaxytrader.xml to use {77000,XXXX} references
  - Translations added for:
    * English (L001, L044)
    * German (L007, L049)  
    * French (L033)
    * Spanish (L034)
    * Italian (L039)
    * Portuguese (L055)
    * Russian (L007)
  - Files: t/0001-L*.xml (all language files)
           aiscripts/order.trade.galaxytrader.xml (parameter text attributes)

FIX: Critical Reliability - Replaced Unreliable indexof Checks with Explicit Loops
  - Fixed: indexof list membership checks can silently fail in X4
  - Problem: `$list.indexof.{$item}` is unreliable for list membership testing
    * Can return false negatives with object references
    * Fails silently on empty lists or null values
    * No error indication when comparison fails
  - Affected Areas (3 critical checks):
    * Ware basket filtering (line 577) - could skip valid manually selected wares
    * Faction restriction checks (lines 1000-1015, 1048-1063) - could allow/deny wrong trades
  - Solution: Replaced with explicit loop pattern
    ```xml
    <set_value name="$found" exact="false"/>
    <do_all exact="$list.count" counter="$i">
      <do_if value="$list.{$i} == $targetItem">
        <set_value name="$found" exact="true"/>
        <break/>
      </do_if>
    </do_all>
    ```
  - Benefits:
    * Deterministic behavior - always works correctly
    * Debuggable - can add logging to see comparisons
    * Performant - breaks early when match found
    * Null-safe - explicit count check prevents crashes
  - Files: md/gt_trading_search.xml (lines 577-591, 1000-1029, 1048-1077)

FIX: Ship Name Status Prefixes Now Fully Translated
  - Fixed: "ADVANCE" and "[TRAINING]" prefixes were hardcoded in English
  - Problem: Ship names showed English prefixes regardless of game language
    * Example: German player saw "ADVANCE Merkur" instead of "FORTSCHRITT Merkur"
    * Affected all non-English players (German, French, Russian, etc.)
  - Solution: Added translation IDs 7001-7002 for status prefixes
    * English: "ADVANCE", "[TRAINING]"
    * German: "FORTSCHRITT", "[TRAINING]"
    * French: "AVANCER", "[FORMATION]"
    * Russian: "ПРОГРЕСС", "[ТРЕНИРОВКА]"
    * Spanish: "AVANZAR", "[ENTRENAMIENTO]"
    * Italian: "AVANZAMENTO", "[ADDESTRAMENTO]"
    * Portuguese: "AVANÇAR", "[TREINAMENTO]"
  - Implementation: Changed from hardcoded strings to readtext.{77000}.{700X}
  - Pattern-based stripping still works - detects ALL-CAPS and bracketed patterns
  - Files: t/0001-L*.xml (all language files)
           md/gt_xp_training.xml (lines 724, 727)

Version 0.5.6 - 2025-10-25
--------------------------

CRITICAL FIX: Duplicate Ship Names During Mod Updates
  - Fixed: Ships getting duplicate GT name formatting when updating the mod
  - Problem: "Shipname (Apprentice Lv.3 XP:181) (Courier Lv.3 XP:258)" during updates
  - Root Cause: System stored current ship name as "original" without checking for existing GT formatting
  - What happened during updates:
    * Old mod: Ship = "MyShip (Apprentice Lv.3 XP:181)"
    * User updates mod
    * System stored: OriginalShipName = "MyShip (Apprentice Lv.3 XP:181)" ← WRONG!
    * System added new formatting: Result = "MyShip (Apprentice Lv.3 XP:181) (Courier Lv.3 XP:258)"
  - Solution: New Strip_GT_Name_Formatting library automatically cleans ship names
    * Strips status prefixes: "ADVANCE ", "[TRAINING] "
    * Strips rank suffixes: " (RankName Lv.X XP:Y)"
    * Detects patterns using "Lv." indicator to identify GT formatting
    * Applied at ALL locations where original names are stored
  - Benefits:
    * Updates work seamlessly - no manual steps required
    * Retroactive - next save/load will clean existing corrupted names
    * Prevents all duplicate name patterns
    * Users no longer need to disable auto-naming before updating
  - Files: gt_ship_management.xml (new Strip_GT_Name_Formatting library)
           gt_xp_training.xml (lines 73, 91, 703)
           gt_core_system.xml (lines 84, 312, 363, 752)
  - THX @ CadvanVLirigon

CRITICAL FIX: SearchCachedTrades Early Exit Error
  - Fixed: MD error when trade cache is too small (< 10 entries)
  - Error: "Property lookup failed: $params.$ResultCue"
  - Root Cause: Legacy code trying to signal non-existent result cue parameter
  - Problem: SearchCachedTrades was refactored to use global return variables
    * Old code: Signaled result cue with return value
    * New code: Sets global.$GT_SearchResult and completes normally
    * Line 341: Still had old signal code using non-existent $params.$ResultCue
  - Solution: Use global return variable pattern for early exit
    * Returns: global.$GT_SearchResult with Found=false to trigger live search
    * Consistent with normal return path (line 732)
  - Files: md/gt_trading_search.xml (lines 340-348)

CRITICAL FIX: Pathfinding Failures Not Blacklisted (Infinite Loop Bug)
  - Fixed: Ships repeatedly attempting to reach same unreachable station
  - Root Cause: Data structure mismatch between trade execution and failure tracking
  - Problem: When dock order failed with ERR_NO_PATH_TO_DESTINATION:
    * Execution stored: global.$GT_PendingTrades.{ship} = [LIST of 20 trades]
    * AI selected: One trade from list, created orders
    * Failure handler expected: global.$GT_PendingTrades.{ship}.$BuyStation (table properties)
    * Result: Structure mismatch → couldn't read data → couldn't blacklist station
  - Impact: Ships stuck in infinite loop:
    1. Search finds trade to unreachable station (passes gatedistance checks)
    2. Try to dock → "no path to destination" error
    3. Fail to blacklist station (pending trade data missing)
    4. Repeat from step 1 ← INFINITE LOOP
  - Example from log: IZB-061, SYN-274, others repeatedly failing to "TEL Ilja's Observation Outpost"
  - Solution: AI script now updates pending trade entry BEFORE creating orders
    * Replaces trade list with specific trade data (BuyStation, SellStation, Ware)
    * Provides structure failure handler expects
    * Enables proper blacklisting of unreachable sector pairs
  - Files: aiscripts/order.trade.galaxytrader.xml (lines 1112-1127)
  - Benefit: Ships learn from pathfinding failures and stop retrying unreachable routes

CRITICAL FIX: Maintenance System Not Checking Blacklists and Path Safety
  - Fixed: Repair and resupply orders did NOT check if destination was safe/reachable
  - Previously: Used basic gatedistance (ignores blacklists)
  - Previously: No check if station itself was blacklisted
  - Previously: No check if route passed through blacklisted sectors
  - Problem: Ships could travel to repair stations in hostile sectors or through war zones
  - Now: Comprehensive safety checks matching trading system:
    * Blacklist-aware gatedistance (respects sector travel blacklists)
    * Station blacklist check (skips blacklisted stations)
    * Path availability check (returns -1 if no safe path)
    * Already had: Station known to player (knownto="player.entity")
    * Already had: Max jump distance limit
    * Already had: Excluded sectors (from ship config)
  - Equipment Station Search (lines 316-329):
    * Uses $ship.gatedistance.{$station.sector}.{blacklistgroup.civilian}.{$ship}
    * Checks @station.isblacklisted.{blacklisttype.objectactivity}.{blacklistgroup.civilian}.{ship}
    * Skips stations with distance < 0 (no path or route blacklisted)
  - Repair Station Search (lines 930-954):
    * Same blacklist-aware checks as equipment search
    * Filters out blacklisted stations first
    * Then checks blacklist-aware path availability
    * Only considers safe, reachable stations within configured distance
  - Benefits:
    * Ships never sent to dangerous sectors for maintenance
    * Respects all player blacklist settings
    * Consistent safety model across trading, maintenance, and threat avoidance
    * Ships can still trade/operate even when maintenance stations are in hostile territory
  - Files: gt_maintenance.xml (lines 317, 941)
  - Note: Correct syntax is $ship.gatedistance.{sector}.{blacklistgroup.civilian}.{$ship}
  - Important: Use blacklistgroup.civilian (NOT blacklisttype.sectortravel)


Version 0.5.5 - 2025-10-21
--------------------------

CRITICAL ARCHITECTURE: Blacklist-Aware Pathfinding System
  - Problem: MD scripts cannot access blacklist-aware pathfinding
  - Solution: Sector-Pair Filtering System
    * Trades are ranked by profit potential without blacklist pre-checking
    * If a ship cannot reach a destination due to blacklists, that sector-pair is stored
    * Future trade searches filter out stored failed sector-pairs for that ship
    * Each ship maintains its own list of unreachable sector combinations
  - Benefits:
    * Respects player-set blacklists (sector, station, activity, travel)
    * Ships learn which routes they cannot take and avoid them
    * Simpler and more reliable than attempting to replicate vanilla pathfinding
    * Works within MD script limitations
  - Files: md/gt_trading_search.xml, aiscripts/order.trade.galaxytrader.xml
  - Status: FULLY IMPLEMENTED

CRITICAL FIX: Pilot Registration and Ship Naming System
  - Problem: Ships were not renamed back to original names when GT order was removed
  - Problem: Pilot changes were detected with 15-second delay due to polling system
  - Problem: Subordinate ships kept GT names after commander switched to different order
  - Solution: Complete event-driven system with instant detection
    * AI script detects pilot changes, order removal, and commander changes instantly
    * Ships automatically renamed when order removed or pilot changed
    * Orphaned pilot cleanup runs on game load and every 5 minutes
    * Ship reassignment properly tracks and updates original names
  - Benefits:
    * Instant response (0-1 second vs 15 seconds)
    * Zero CPU overhead (no polling loops)
    * Ship names always correct after assignment/removal/reassignment/save-load
    * XP data preserved across all scenarios
  - Files: order.trade.galaxytrader.xml, gt_core_system.xml, gt_ship_management.xml
  - Status: FULLY IMPLEMENTED

CRITICAL FIX: Manual Ware Selection Not Applied
  - Fixed: Ships were trading ALL wares instead of only manually selected wares from ware basket
  - Root cause: $WareBasket parameter was retrieved but never used in offer filtering
  - Solution: Restructured live search to query X4 engine for specific wares (optimal performance)
  - Implementation:
    * Manual mode ($wareBasket has items): Loop through each ware, query offers per-ware
    * AutoWares mode ($wareBasket empty): Query all compatible wares (original behavior)
    * Per-ware querying is MUCH more efficient than querying all + post-filtering
    * X4 engine filters at native level instead of MD script loops
    * Cache validation: Added ware basket filter in cached trade validation
    * Only trades matching selected wares are now considered
  - Performance gain: Massive reduction in data transfer and processing when using manual ware selection
  - Debug logging improvements:
    * LogLevel 2: Shows when manual ware selection is active and total offers per station
    * LogLevel 3: Shows per-ware offer counts (which wares have offers, which don't)
    * Cache: Shows when cached trades filtered due to ware not in basket
  - Files: gt_trading_search.xml

CRITICAL FIX: Lifetime Revenue Incremented at Wrong Time
  - Fixed: Lifetime revenue was being updated when trades were PLANNED, not when COMPLETED
  - This caused revenue to increase even when trades failed (e.g., cargo stuck loops)
  - Root cause: LogTradeOrder cue updated lifetime profit during trade assignment
  - Solution: Moved lifetime profit tracking to LogCompletedTrade cue (triggered by diff patch system)
  - Lifetime revenue now only increases when trades actually complete successfully
  - Logbook messages now show lifetime revenue in completion entries instead of planning entries
  - Files: gt_trade_logging.xml

ENHANCEMENT: Path-Aware Threat Detection for Mid-Trade Sector Blacklisting
  - Enhanced: Threat detection now checks ENTIRE travel path, not just destination
  - Previously: Only checked if buy/sell destination was in threatened sector
  - Now: Checks if threatened sector is anywhere in ship's complete route:
    * Ship's current sector
    * All intermediate sectors from ship to buy station
    * Buy station sector
    * All intermediate sectors from buy to sell station
    * Sell station sector
  - Example: Ship at A traveling to E via B->C->D
    * If sector C gets blacklisted while ship is at B -> trade aborts immediately
    * Ship won't try to travel through dangerous sectors even if destination is safe
  - LEVEL REQUIREMENT: Only Level 12+ pilots can analyze route threats mid-trade
    * Matches fleet coordination level requirement (Level 12+)
    * Ensures only highly experienced pilots have tactical awareness for complex route threat analysis
    * Lower level pilots (1-11) will complete their current trade normally
    * Rationale: Mid-trade route threat analysis requires advanced tactical decision-making
  - Uses X4's gatedistance.{destination}.path to get all intermediate sectors
  - If threatened sector found in path -> sends GT_Destination_Threatened signal (Level 12+ only)
  - AI script cancels all orders and returns to main loop
  - Cargo check handles the rest (sell cargo if present, find new trade if not)
  - Much safer: Experienced ships now avoid ALL dangerous sectors in their route
  - Files: gt_threat_intelligence.xml

CRITICAL FIX: Total Profit and Trades Completed Statistics Always Zero
  - Fixed: Periodic fleet report notifications always showed 0 Cr profit and 0 trades completed
  - Root cause: UpdateShipStats library existed but was never called when trades completed
  - Solution: Added call to md.gt_updateshipstats in gt_trading_signals.xml
  - Statistics now updated immediately after each successful trade completion
  - Updates both $TotalProfit and $TradesCompleted for individual ships
  - Fleet reports now show accurate cumulative statistics
  - Files: gt_trading_signals.xml, gt_fleet_coordination.xml

ENHANCEMENT: Roleplay-Style Logbook Messages for Ship Operations
  - Added: Immersive logbook entries for cargo safety, maintenance, and trade search events
  - New Messages (all text-only, no emojis):
    * Cargo Safety: When ship detects cargo and needs to sell before trading
    * Auto-Repair: When ship requests repair services (with cost estimate)
    * Partial Repair: When funds insufficient for full repair (highlighted warning)
    * Equipment Resupply: When ship restocks defensive equipment
    * No Trades Found: Detailed rejection statistics when no profitable trades available
    * Route Threat Detected: When ship's planned trade route becomes dangerous mid-trade
  - Rejection statistics breakdown:
    * Docking restrictions (station doesn't permit ship class)
    * Insufficient profitability (below minimum threshold)
    * Insufficient volume (zero or negative tradeable amount)
    * Safety restrictions (blacklisted stations/dangerous sectors)
  - Route Threat Alert (NEW):
    * Triggered when threatened sector detected in ship's complete trade route
    * Shows sector name and threat level
    * Explains actions taken (orders cancelled, safe mode activated)
    * Reassures player that cargo will be handled automatically if present
    * Highlighted as "alerts" category in logbook for immediate visibility
  - Messages written in professional roleplay style with recommendations
  - Full translation support across all 8 languages (English, German, French, Spanish, Italian, Russian, Portuguese, Korean)
  - Messages respect logbook setting (only appear if player enabled logbook entries)
  - Category: "upkeep" for maintenance/cargo, "alerts" for route threats
  - Files: order.trade.galaxytrader.xml, gt_maintenance.xml, gt_trading_search.xml, all t/0001-L*.xml files
  - Status: FULLY IMPLEMENTED

CRITICAL FIX: Initial Ship Renaming on Assignment/Reassignment
  - Fixed: Ships not renamed immediately when assigned GT order with existing pilot
  - Problem: Ship with registered pilot assigned to GT order didn't trigger rename
  - Root cause: GT_Update_Ship only fired when pilot CHANGED, not on initial assignment
  - Previous behavior: Ship "MyShip" with pilot John -> assign GT order -> still named "MyShip"
  - Solution: AI script now sends GT_Update_Ship signal during initialization phase
  - Initial registration signal sent regardless of whether pilot changed
  - Ships now renamed instantly upon assignment, even if pilot was already registered
  - Also fixes reassignment scenario (ship on Hold Position -> reassigned to GT)
  - Files: order.trade.galaxytrader.xml (lines 420-430), gt_core_system.xml

CRITICAL FIX: Event Listener Mismatch in Ship Modification Handler
  - Fixed: HandleShipModificationUpdate cue not firing, preventing ship renaming
  - Root cause: Listener type mismatch between signal sender and receiver
  - AI script sent: event_object_signalled (object signal to player.galaxy)
  - MD cue listened for: event_cue_signalled (cue signal)
  - Solution: Changed HandleShipModificationUpdate to listen for event_object_signalled
  - Also corrected parameter access from event.param to event.param2
  - Ship modification signals now properly received by MD system
  - Enables instant ship renaming on pilot changes and initial assignments
  - Files: gt_core_system.xml (lines 956-990)

========================================

Version 0.5.4 - 2025-10-21
--------------------------

CRITICAL FIX: Trade Search Not Respecting Threat Avoidance Blacklist
  - I thought this would be automatically handled by Vanilla
  - Fixed: Ships were accepting trades to blacklisted/dangerous sectors
  - Root cause: Neither live trade search nor cache validation checked threat intelligence
  - Solution: Added threat intelligence validation to BOTH systems:
    * Live trade search: GT_ValidateStation now filters stations in dangerous sectors
    * Cache validation: Cached trades now validated against current threat intelligence
  - Both buy AND sell station sectors are checked against ship's risk tolerance
  - Ships will only accept trades to sectors that are safe enough based on threat level
  - Files: gt_utilities.xml, gt_trading_search.xml


Version 0.5.3 - 2025-10-21
--------------------------

FIX: Mobile Satellite Intelligence Property Lookup Error
  - Fixed: Property lookup failure for $ship.isdocked causing MD script errors
  - Affects ships performing mobile satellite intelligence scans (not game breaking)
  - Files: gt_market_intelligence.xml

========================================

Version 0.5.2 - 2025-10-20
--------------------------

MAJOR ENHANCEMENT: Threat Avoidance Blacklist System Improvements
  - Blacklists now persistent across save/load cycles with proper ID storage in global.$GT_BlacklistID
  - Event-driven threat detection: updates blacklist instantly when threats are detected/cleared (removed 5-second polling loop)
  - Integrated X4's native enemy faction blocking using relation checkbox
  - Auto-recovery: automatically detects manually deleted blacklists and recreates them using GetBlacklistInfo2
  - New Settings in Global Menu (Threat Avoidance section):
    * "Block Enemy Faction Sectors" toggle - controls X4's native faction-based sector blocking
    * "Recreate Blacklist" button - manually recreate blacklist if needed (e.g. accidentally deleted)
  - Files: gt_threat_intelligence.xml, gt_blacklist_manager.lua (new), gt_global_settings.xml

OPTIMIZATION: Mobile Satellite Intelligence System
  - Fixed: Docked ships no longer scan for stations (they only scan when actively flying)
  - Optimization: Ships skip scanning stations whose factions already have player trade subscriptions
  - Improved efficiency by avoiding redundant trade data collection when subscriptions exist
  - Files: gt_market_intelligence.xml

CRITICAL FIX: New Game Initialization Errors & Menu API Integration
  - Fixed: Property lookup failures on new game start preventing global menu from opening
  - Fixed three cues that checked for global variables before initialization:
    * SystemMaintenance: Added @ to global.$GT_Initialized (ich koffer)
    * TrainingProgressReport: Added @ to global.$GT_Config.$XP.$Enabled (ich koffer)
    * ShipRecovery: Uses ? operator with boolean logic (global.$GT_Ships? and ...)
  - CRITICAL: Fixed Simple Menu API integration following SN Mod Support APIs best practices (RTFM)
    * Moved DefensiveEquipment settings initialization to menu registration phase (Reloaded event)
    * Settings now initialize BEFORE menu registration, not during menu open
    * Follows official SN Mod Support APIs pattern for options menu registration
    * Prevents ~30 property lookup errors when opening global menu on fresh games
  - Settings menu now loads correctly on fresh games without any errors
  - Files: gt_core_system.xml, gt_reporting.xml, gt_trading_maintenance.xml, gt_global_settings.xml

CRITICAL FIX: Missing Translations Across All Languages
  - Fixed missing translation IDs for Threat Avoidance settings (9050-9074)
  - Fixed missing translation IDs for Defensive Equipment settings (9151-9174)
  - Added missing trade logging and training message translations (1002, 3101, 3104-3106, 3200-3203)
  - Affected languages: German (L049), English (L001), Russian (L007), French (L033), Spanish (L034), Italian (L039)
  - Fixed "missing translation" errors appearing in X4 UI
  - Files: t/0001-L049.xml, t/0001-L001.xml, t/0001-L007.xml, t/0001-L033.xml, t/0001-L034.xml, t/0001-L039.xml

ENHANCEMENT: Training Required Notifications Now Logged
  - Fixed: "Training Required" notifications now written to logbook instead of just screen messages
  - All training notifications now appear in Upkeep category with clickable ship links
  - Includes:
    * "Training Required" - when pilot needs to advance skill level
    * "XP Blocked" - when pilot earns XP but can't advance without training
  - Notifications are highlighted and include interaction="showonmap" for easy navigation
  - No more missing important training alerts!
  - Files: gt_xp_training.xml

CRITICAL FIX: Multi-Language Text Resolution Issues
  - Fixed two critical issues where text displayed in wrong language despite player's game settings
  - Root cause: Text ID objects stored in variables don't auto-resolve to player's language; some strings were hardcoded in English
  - Solution: Use readtext.{page}.{line} syntax directly to force proper language resolution
  
  Issue 1: Pilot Rank Titles in Ship Names
    * Problem: Rank titles showing in German ("lehrling") instead of Portuguese ("Aprendiz") even when game is in language 55
    * Fix: Calculate text line ID dynamically (6001-6006) and use readtext.{77000}.{$textLineID}
    * Now properly displays: Aprendiz, Lehrling, Apprentice, etc. based on player's language
  
  Issue 2: Defensive Equipment Balance Profiles
    * Problem: Balance profile names showing in English instead of player's selected language
    * Fix: Created translation IDs (6101-6105) for all profiles and use readtext for dynamic resolution
    * Affected profiles: Balanced, Defensive, Trading-Focused, Heavy Defense, Tower Support
  
  - All languages now properly supported: Brazilian Portuguese (55), English (44), German (49), French (33), Spanish (34), Italian (39), Russian (7), International/Default (1)
  - Files: gt_xp_training.xml (lines 729-745), gt_global_settings.xml (lines 916-933), all translation files (0001-L*.xml)


Version 0.5.1 - 2025-10-20
--------------------------

CRITICAL FIX: Brazilian Portuguese Text Display Bug

  - All UI text now fully translated including:
    * Order names and descriptions
    * XP/training messages and immersive roleplay letters
    * Fleet coordination, territory management, ware filters
    * Auto-repair system settings
    * Threat Avoidance System settings (NEW)
    * Defensive Equipment Auto-Replenishment settings (NEW)
    * Ship Naming Configuration settings (NEW)
    * Pilot rank titles in ship names (Aprendiz, Mensageiro, etc.)
    * Error messages and trader titles
  - Files: 0001-L055.xml (NEW), 0001-L044.xml (updated), gt_global_settings.xml (updated), 
           gt_xp_training.xml (updated), content.xml (updated)

========================================

Version 0.5.0 - 2025-10-20
--------------------------

========== NEW FEATURES ==========

NEW FEATURE: Dynamic Blacklist System for Threat Intelligence
  - Added: Lua-based dynamic blacklist manager for real-time threat avoidance
  - Integrates with existing threat intelligence system (gt_threat_intelligence.xml)
  - Creates and manages fleet-wide blacklists via X4's internal FFI API
  - Threatened sectors automatically blacklisted using sector macro IDs
  - Blacklists applied only to fleet commanders and solo ships (subordinates inherit)
  - Empty blacklist created at game start/load for instant threat updates
  - Uses sn_mod_support_apis framework for Lua event handling
  - Vanilla pathfinding (gatedistance) automatically respects blacklists
  - No custom pathfinding needed - ships naturally avoid dangerous sectors
  - Configurable enable/disable in Global Settings
  - Configurable threat level threshold for blacklisting (default: 5)
  - Recurring sync (5s), apply (5s), and cleanup (30s) cycles
  - Files: gt_blacklist_manager.lua (NEW), gt_blacklist_loader.xml (NEW),
          gt_threat_intelligence.xml (modified), gt_global_settings.xml (modified)

NEW FEATURE: Defensive Equipment Auto-Replenishment System (Level 15)
  - Added: Automatic restocking of countermeasures AND units (drones/towers)
  - Countermeasures: Flares, chaff (ammostorage.countermeasure) - restocked to configured threshold
  - Units: Defense Drones, Cargo Drones, Repair Drones, Laser Towers (this.ship.units)
  - Configurable equipment balance profiles (5 presets: Balanced, Defense-Focused, etc.)
  - Configurable restock thresholds (countermeasures: 50%, deployables: 70%)
  - Individual toggles for each equipment type
  - Menu UI in Global Settings for all configuration options
  - Properly distinguishes ammostorage.countermeasure vs. ammostorage.deployable vs. this.ship.units
  - Ships request units using vanilla macro references (macro.ship_gen_s_fightingdrone_01_a_macro.ware)
  - Checks this.ship.units.maxcount for capacity (not units.capacity which returns null)
  - Uses add_build_to_modify_ship with proper shopping lists for BOTH ammo and units
  - Initial check: Ships check equipment status BEFORE starting to trade (not just after)
  - Ships no longer enter dangerous sectors with depleted defensive equipment
  - Prevents "one trade then restock" behavior, now "restock then trade"
  - Combined maintenance optimization (repair + equipment in single trip)
  - Integrated with existing auto-repair system (Level 12+)
  - Repair takes priority over equipment if both needed
  - Event-driven system using diff patch (order.resupply.xml)
  - Trading ships now properly maintain ALL defensive equipment in one trip
  - Failure handling: Monitors resupply orders, detects out-of-stock stations (60s timeout)
  - Detailed logbook messages for failed attempts with current equipment levels
  - Ships continue trading after failure and retry after next trade
  - Never get stuck waiting for unavailable equipment
  - Files: gt_maintenance.xml, gt_global_settings.xml, gt_defensive_equipment.xml, 
          gt_trading_signals.xml, gt_configuration.xml, order.resupply.xml (NEW),
          order.trade.galaxytrader.xml

MAJOR REFACTOR: Unified Maintenance System
  - Replaced separate repair/equipment systems with unified gt_maintenance.xml
  - Consolidates repair and equipment checks into single maintenance flow
  - MD scripts prepare data, AI scripts execute (vanilla-first approach)
  - Ships handle repair AND equipment restocking in one maintenance trip
  - Event-driven architecture using signal-based communication
  - Affects: All ships with Level 12+ (repair) and Level 15+ (equipment)
  - Files: gt_maintenance.xml (NEW), order.trade.galaxytrader.xml
  - Deprecated: gt_defensive_equipment.xml, gt_auto_repair.xml (logic moved to gt_maintenance.xml)

========== ENHANCEMENTS ==========

ENHANCEMENT: Logbook Category Reorganization
  - Improved: Reorganized logbook notifications to prevent "Upkeep" flooding
  - Level-up notifications now go to "News" category (was notification-only, now also in logbook)
  - Trade order logs moved to "Tips" category (was "Upkeep")
  - Training notices remain in "Upkeep" (correct category for maintenance)
  - Result: "Upkeep" category now only contains actual upkeep/maintenance notifications
  - Makes it much easier to spot important maintenance alerts
  - User-requested feature - Thanks to TheBaldNord (Nexus Mods) for the excellent suggestion!
  - Files: gt_xp_training.xml, gt_trade_logging.xml

ENHANCEMENT: MD Prepares, AI Executes Pattern
  - MD scripts (gt_maintenance.xml) now only prepare data and validate stations
  - AI scripts (order.trade.galaxytrader.xml) execute actual vanilla orders
  - Data stored in global variables: global.$GT_ResupplyOrders.{$ship}
  - AI uses vanilla actions: add_build_to_modify_ship (not create_order)
  - Prevents immediate="true" issues that terminate AI orders
  - Leverages vanilla's robust station finding, pathfinding, and execution
  - Eliminates need to duplicate complex vanilla logic
  - Files: gt_maintenance.xml, order.trade.galaxytrader.xml

ENHANCEMENT: Comprehensive Diagnostic Logging
  - Added extensive logging to every decision point in maintenance system
  - Logs include: station validation, stock checks, distance calculations, shopping lists
  - Uses visual markers for quick log scanning (checkmarks, warnings, errors, alerts, timers)
  - All critical decisions logged with chance="100" for reliable debugging
  - Equipment status logged with percentages and thresholds
  - Station selection logged with capabilities and distances
  - Makes troubleshooting equipment issues much easier
  - Files: gt_maintenance.xml, order.trade.galaxytrader.xml

ENHANCEMENT: Signal Flow Visibility
  - Added: Detailed logging for GT_No_Trade_Found signal (send + receive)
  - Trade execution now logs AllowIllegal setting when blocking illegal wares
  - AI script now logs signal reception with high visibility (chance="100")
  - Improved troubleshooting for stuck ships
  - Files: gt_trading_execution.xml, order.trade.galaxytrader.xml

========== BALANCE CHANGES ==========

BALANCE: XP Progression Rebalanced for Longer Campaigns
  - Rebalanced: XP values for more realistic progression (previously too fast)
  - Base XP per trade: 50 -> 8 (reduced by 84%)
  - Value divisor: 10,000 -> 100,000 (10x harder to get value bonus)
  - Quality multiplier: 0.5 -> 0.15 (reduced by 70%)
  - Distance divisor: 20 -> 50 (distance matters less)
  - XP cap per trade: 1000 -> 50 (prevents excessive gains)
  - Result: ~500 trades needed to reach max level (was ~85 trades)
  - With 50% multiplier: ~1000 trades | With 100%: ~500 trades | With 200%: ~250 trades
  - Provides meaningful progression throughout longer gameplay sessions
  - Files: gt_configuration.xml

========== CRITICAL FIXES ==========

CRITICAL FIX: Pilot Registration and Ship Naming System
  - Fixed: Complete refactor of pilot change detection and ship name management
  - Removed: ~260 line polling-based ShipPilotChangeMonitor (15-second delay + CPU overhead)
  - New Approach: Event-driven architecture with instant signal-based detection
  
  AI-Based Instant Pilot Change Detection:
    * AI script (order.trade.galaxytrader.xml) now tracks pilot on every loop
    * Detects pilot swaps immediately (0ms-1s latency vs 15s polling)
    * Sends GT_Update_Ship signal with old/new pilot info to MD system
    * Zero polling overhead, zero CPU waste
  
  Smart Order Removal Detection:
    * AI script's on_abort handler now intelligently distinguishes:
      - PERMANENT removal: No default order OR different order → Restore ship name
      - TEMPORARY replacement: Order paused/interrupted → Preserve ship name (for potential resume)
    * Sends GT_Ship_Order_Aborted (restore name) or GT_Ship_Order_Paused (preserve name)
    * Original ship name stored in global.$GT_Pilots.{$pilot}.$OriginalShipName
  
  Subordinate Commander Change Detection:
    * AI script checks if subordinate's commander still has GT order
    * If commander switches to different order → subordinate self-aborts GT order
    * Sends GT_Ship_Order_Aborted signal to restore subordinate's ship name
    * X4's native Assist order takes over subordinate behavior automatically
    * No orphaned subordinates with GT names and non-GT commanders
  
  Orphaned Pilot Cleanup System:
    * Runs immediately on game load + every 5 minutes thereafter
    * Detects pilots whose ships no longer have GT orders (load issues, manual changes)
    * Compares current ship name vs stored $OriginalShipName
    * If ship name still has GT prefix but no GT order → restores original name
    * Marks pilot as 'paused' to preserve XP data for potential resume
    * Handles both direct GT ships and subordinates of GT commanders
  
  Ship Reassignment and Name Tracking:
    * Register_Pilot now ALWAYS renames ship when called (even for existing pilots)
    * Handles three scenarios:
      - New pilot first registration → Store original name, apply GT name
      - Existing pilot resuming on SAME ship → Keep stored name, re-apply GT prefix with rank
      - Existing pilot assigned to DIFFERENT ship → Update stored original name, apply GT name
    * Fixes issue where ships weren't renamed after save/load/reassign cycles
  
  Pilot Change Handling:
    * GT_Update_Ship handler now correctly renames ships when pilots change
    * New pilot is GT pilot → Apply GT naming with rank
    * New pilot is NOT GT pilot → Restore original ship name
    * Cleans up old pilot data if old pilot no longer has associated ship
  
  Implementation Details:
    * AI signal sending: order.trade.galaxytrader.xml (on_abort handler, main loop)
    * MD signal handling: gt_core_system.xml (HandleShipOrderAborted, HandleShipOrderPaused, GT_Update_Ship)
    * Orphaned cleanup: gt_core_system.xml (OrphanedPilotCleanup, TriggerCleanupOnLoad, OrphanedPilotCleanupScheduler)
    * Pilot registration: gt_ship_management.xml (Register_Pilot library)
    * Documentation: PILOT_REGISTRATION_VALIDATION.md (comprehensive scenario validation)
  
  Technical Improvements:
    * Event-driven signals replace polling (instant response vs 15s delay)
    * Zero CPU overhead (no background loops)
    * Handles all edge cases (save/load, manual changes, fleet reassignment)
    * XP data preserved across all scenarios (never lost)
    * Ship names always correctly reflect current status
    * Subordinates properly synchronized with commanders
  
  Result: Ships ALWAYS renamed correctly on assignment/removal/reassignment/load
  Testing: All scenarios validated (see PILOT_REGISTRATION_VALIDATION.md)
  Files: order.trade.galaxytrader.xml, gt_core_system.xml, gt_ship_management.xml

CRITICAL FIX: Training Duration Showing "0 Minutes"
  - Fixed: Training messages showing "Die Prüfung wird etwa 0 Minuten dauern" (0 minutes duration)
  - Root cause: AI script (order.dock.train.xml) sent hardcoded 30-second duration to logging system
  - 30 seconds rounded down to 0 when converted to minutes for display
  - Solution: AI script now retrieves actual calculated duration from global.$GT_Pilots.{$pilot}.$TrainingDuration
  - No fallbacks - uses exact value calculated by MD system (10 min base + skill multiplier)
  - Removed unnecessary "minimum 1 minute" display logic - proper values don't need it
  - Training durations now correctly calculated based on config (10 min base + skill multiplier)
  - Files: order.dock.train.xml, gt_trade_logging.xml

CRITICAL FIX: Docking Check Log Flooding
  - Fixed: Debug logging causing massive log spam (thousands of lines per ship search)
  - Issue 1: Debug code was checking station capabilities using invalid syntax (class.ship_s)
  - Issue 2: After fix, debug logged EVERY trade pair evaluation during search loop
  - Issue 3: Selected trade logging failed with property lookup errors when $bestTrade incomplete
  - Each ship evaluates hundreds/thousands of trade combinations per search
  - Root cause: dockingallowed expects ship object, not ship class
  - Solution: Only log docking status for the FINAL SELECTED trade, not during search
  - Added: Null checks and safe operators (@) for trade property access
  - Debug output: "SELECTED TRADE DOCKING: Ship=X | BUY=Station [OK] | SELL=Station [OK]"
  - Summary: "Rejected X trade pairs due to incompatible docking" (counts only, no spam)
  - Prevents log flooding while maintaining diagnostic capability
  - Files: gt_trading_search.xml

CRITICAL FIX: XP Multiplier Not Applied
  - Fixed: XP Multiplier setting existed but was never applied to XP calculations
  - XP calculation was hardcoded, ignoring player's Global Settings multiplier
  - Implemented: Multiplier now properly applied to all XP gains in order.trade.perform.xml
  - Added: Save game compatibility with automatic validation (invalid values -> 100%)
  - Updated: Multiplier range from 10-100% to 50-200% (100% = default)
  - At 50%: ~1000 trades to max level | At 100%: ~500 trades | At 200%: ~250 trades
  - Allows players to customize progression speed to match playstyle
  - Files: order.trade.perform.xml, gt_global_settings.xml

CRITICAL FIX: Logbook Messages Too Long
  - Fixed: Fleet and Training reports exceeding X4's logbook message limit
  - Fleet Report: Reduced from showing 15 ships (120+ lines) to 5 ships with compact format
  - Training Report: Reduced from unlimited ships to 5 ships with compact format
  - Compact format: One line per ship instead of 8-10 lines
  - Example: "ABC-123: 1.2M Cr, 45 trades [ACTIVE]" or "ABC-123: 45% done, 12 min left"
  - Shows "+X more ships not shown" indicator when fleet exceeds display limit
  - Prevents logbook display errors and truncation issues
  - Files: gt_reporting.xml

CRITICAL FIX: M-Class Ships Stuck with Incompatible Docking
  - Fixed: M-class ships selecting factories with only E-piers (large L+ ship docks)
  - Fixed: Ships unable to complete trades, getting stuck with full cargo
  - Added: dockingallowed.{$ship} validation for BOTH buy and sell stations
  - Trade pairs where ship cannot dock are now skipped during search
  - Works for all ship classes (S/M/L/XL) with proper dock type checking
  - Debug logging shows docking status for SELECTED trade only (no spam)
  - Summary: "Rejected X trade pairs due to incompatible docking"
  - Prevents ships from selecting impossible trade routes
  - Files: gt_trading_search.xml

CRITICAL FIX: Illegal Ware Trade Loop
  - Fixed: Ships stuck in infinite loop when cache contains illegal wares
  - Added: Illegal ware filtering in cache search (respects AllowIllegal setting)
  - Cache now skips illegal trades and continues to next entry automatically
  - Added: $AllowIllegal parameter propagation (AI -> Queue -> Search -> Cache)
  - Ships without illegal trading enabled no longer attempt illegal trades
  - Fixed: Ship ENJ-399 loop issue (selecting Raumsprit repeatedly)
  - Files: gt_trading_search.xml, gt_trading_queue.xml, gt_trading_execution.xml

Version 0.4.0 - 2025-10-18
--------------------------

MAJOR: Trade Completion System Refactor
  - Replaced event_player_trade_completed monitoring with diff patch system
  - Created aiscripts/order.trade.perform.xml (diff patch for X4 native trade orders)
  - Created md/gt_trading_signals.xml (centralized signal router)
  - Removed ~140 lines of complex event monitoring from gt_trading_execution.xml
  - Trade completion/failure now detected via direct X4 engine signals
  - Better trade data (exact amounts, quality, failure reasons)
  - Better performance (event-driven, no polling)
  - Fixed: Subordinate ships now log trades correctly

Version 0.3.8 - 2025-10-18
--------------------------

Training System
  - Fixed: Training duration now uses configured values (not hardcoded 30s)
  - Fixed in: order.dock.train.xml

Trade Cache
  - Added: Cache replenishment system (forces live search if cache < 10 entries)
  - Cache now self-sustaining and never fully depletes
  - Fixed in: gt_trading_search.xml

Version 0.3.7 - 2025-10-18
--------------------------

Trade Cache - CRITICAL: Stale Tradeoffer Fix
  - Fixed: Cached trades failing with "insufficient funds" error
  - Fixed: Ships stuck in infinite restart loop
  - Cache now acts as "hint" - re-queries fresh offers from cached stations
  - Fixed: Corrected find_sell_offer/find_buy_offer syntax (tradepartner vs match_seller)
  - Fixed: Removed stale price pre-filter
  - Fixed: Swapped BuyOffer/SellOffer perspective (ship vs station)
  - Cache hits now work reliably
  - Fixed in: gt_trading_search.xml

Version 0.3.6 - 2025-10-18 (REVERTED)
--------------------------

Subordinate Ships
  - Attempted fix for subordinate trade order failures (reverted)

Version 0.3.5 - 2025-10-18
--------------------------

Trade Loop
  - Fixed: AI order rapid abort/restart cycle
  - Fixed: Ships accumulating multiple trade orders
  - Added: Check for existing orders before requesting new trades
  - Added: Clear stale training flags on order start
  - Fixed in: order.trade.galaxytrader.xml

Version 0.3.4 - 2025-10-18
--------------------------

Trade Queue
  - Fixed: Ships getting multiple trade orders simultaneously
  - Moved busy check to run BEFORE queueing (not after)
  - Ships now execute one trade at a time
  - Fixed in: gt_trading_ai.xml

Version 0.3.3 - 2025-10-18
--------------------------

Trade System
  - Major refactor: Separated XP tracking from ship availability checking
  - Simplified availability check (only checks: has trade orders? has training order?)
  - Removed complex cargo/dock/time validation
  - Ships no longer blocked from trading
  - Fixed in: gt_trading_queue.xml

Version 0.3.2 - 2025-10-18
--------------------------

Trade Cache
  - Added 4-layer validation for cached offers (availability, stock, prices)
  - Ships no longer get failed orders from stale cache
  - Fixed in: gt_trading_search.xml

Version 0.3.1 - 2025-10-18
--------------------------

Settings Menu
  - Removed unused "Notification Level" slider

Version 0.3.0 - 2025-10-18
--------------------------

Training & Settings
  - Removed testing mode (production durations active)
  - Updated slider ranges (ROI: 1-30%, XP: 10-100%)

Version 0.2.1 - 2025-10-18
--------------------------

FIXES:
  - Ship names now persist through interruptions
  - Trade cache system completely rewritten and working
  - Settings menu now appears correctly
  - Fixed table key errors in cache writes
  - Fixed reversed buy/sell assignments
  - Better error handling throughout

FILES CHANGED:
  - gt_core_system.xml
  - gt_territory_management.xml
  - gt_trading_search.xml
  - gt_trade_logging.xml
  - gt_trading_execution.xml
  - gt_market_intelligence.xml
  - gt_reporting.xml
  - gt_global_settings.xml
  - gt_trading_maintenance.xml
  - gt_fleet_coordination.xml

Version 0.2.0 - 2024-01-01
--------------------------

Initial Release

FEATURES:
  - Advanced Trading AI with smart route selection
  - XP Progression System (15 levels)
  - Training requirements at levels 3, 6, 9, and 12
  - Fleet Coordination
  - Mobile Satellite Intelligence (Level 9+)
  - Threat Intelligence System
  - Auto-Repair System (Level 12+)
  - Ship Management and automatic renaming
  - Configuration system

REQUIREMENTS:
  - SirNukes Mod Support APIs
  - X4 version 6.0+

Author: GoAhead
